/*! JointJS+ v3.6.3 - HTML5 Diagramming Framework

Copyright (c) 2022 client IO

 2022-12-09 


This Source Code Form is subject to the terms of the JointJS+ License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(k,n,B,d){"use strict";function F(t){return function(t){if(Array.isArray(t))return U(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?U(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,B=B&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function D(t,e){return t(e={exports:{}},e.exports),e.exports}function V(t){return t&&t.Math==Math&&t}function c(t){try{return!!t()}catch(t){return!0}}function $(t){return at?dt(t):function(){return ht.apply(t,arguments)}}function u(t){if("Function"===x(t))return $(t)}function f(t){if(xt(t))throw bt("Can't call method on "+t);return t}function z(t){return yt(f(t))}function G(t,e){return arguments.length<2?(n=y[t],w(n)?n:void 0):y[t]&&y[t][e];var n}function K(t){return Ft(f(t))}function Y(t){return"Symbol("+(void 0===t?"":t)+")_"+$t(++Dt+Vt,36)}function l(t){var e;return S(zt,t)&&(Tt||"string"==typeof zt[t])||(e="Symbol."+t,Tt&&S(Gt,t)?zt[t]=Gt[t]:zt[t]=(Ct&&Kt?Kt:Yt)(e)),zt[t]}function H(t){return ve[t]||(ve[t]=Y(t))}function m(t,e,n,r){var o=(r=r||{}).enumerable,i=void 0!==r.name?r.name:e;if(w(n)&&Ee(n,i,r),r.global)o?t[e]=n:kt(e,n);else{try{r.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=n:fe.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t}function W(a){return function(t,e,n){var r,o=z(t),i=je(o),s=Ne(n,i);if(a&&e!=e){for(;s<i;)if((r=o[s++])!=r)return!0}else for(;s<i;s++)if((a||s in o)&&o[s]===e)return a||s||0;return!a&&-1}}function X(t,e){var n,r=z(t),o=0,i=[];for(n in r)!S(me,n)&&S(r,n)&&_e(i,n);for(;e.length>o;)!S(r,n=e[o++])||~Le(i,n)||_e(i,n);return i}function q(t,e){return(t=ze[$e(t)])==Ke||t!=Ge&&(w(e)?c(e):!!e)}function e(t,e){var n,r,o,i=t.target,s=t.global,a=t.stat,c=s?y:a?y[i]||kt(i,{}):(y[i]||{}).prototype;if(c)for(n in e){if(r=e[n],o=t.dontCallGetSet?(o=He(c,n))&&o.value:c[n],!Ye(s?n:i+(a?".":"#")+n,t.forced)&&void 0!==o){if(typeof r==typeof o)continue;for(var u=r,l=o,f=v=g=p=d=h=void 0,h=De(l),d=fe.f,p=ne.f,g=0;g<h.length;g++){var v=h[g];S(u,v)||f&&S(f,v)||d(u,v,p(l,v))}}(t.sham||o&&o.sham)&&he(r,"sham",!0),m(c,n,r,t)}}function J(t,e){return Rt(t),void 0===e?t:at?We(t,e):function(){return t.apply(e,arguments)}}function Z(){}function Q(t){if(!w(t))return!1;try{return en(Z,tn,t),!0}catch(t){return!1}}function tt(t){if(!w(t))return!1;switch(Qe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return on||!!rn(nn,ge(t))}catch(t){return!0}}function et(t,e){return new(un(t))(0===e?0:e)}function nt(h){var d=1==h,p=2==h,g=3==h,v=4==h,m=6==h,y=7==h,x=5==h||m;return function(t,e,n,r){for(var o,i,s=K(t),a=yt(s),c=J(e,n),u=je(a),l=0,e=r||et,f=d?e(t,u):p||y?e(t,0):void 0;l<u;l++)if((x||l in a)&&(i=c(o=a[l],l,s),h))if(d)f[l]=i;else if(i)switch(h){case 3:return!0;case 5:return o;case 6:return l;case 2:ln(f,o)}else switch(h){case 4:return!1;case 7:ln(f,o)}return m?-1:g||v?v:f}}function rt(t,e){var n=[][t];return!!n&&c(function(){n.call(null,e||function(){return 1},1)})}var ot,it,r,st,y=V("object"==typeof globalThis&&globalThis)||V("object"==typeof window&&window)||V("object"==typeof self&&self)||V("object"==typeof t&&t)||function(){return this}()||Function("return this")(),h=!c(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),at=!c(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}),ct=Function.prototype.call,E=at?ct.bind(ct):function(){return ct.apply(ct,arguments)},t={}.propertyIsEnumerable,ut=Object.getOwnPropertyDescriptor,lt={f:ut&&!t.call({1:2},1)?function(t){t=ut(this,t);return!!t&&t.enumerable}:t},ft=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},t=Function.prototype,ht=t.call,dt=at&&t.bind.bind(ht,ht),pt=$({}.toString),gt=$("".slice),x=function(t){return gt(pt(t),8,-1)},vt=Object,mt=u("".split),yt=c(function(){return!vt("z").propertyIsEnumerable(0)})?function(t){return"String"==x(t)?mt(t,""):vt(t)}:vt,xt=function(t){return null==t},bt=TypeError,t="object"==typeof document&&document.all,t={all:t,IS_HTMLDDA:void 0===t&&void 0!==t},St=t.all,w=t.IS_HTMLDDA?function(t){return"function"==typeof t||t===St}:function(t){return"function"==typeof t},Et=t.all,b=t.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:w(t)||t===Et}:function(t){return"object"==typeof t?null!==t:w(t)},wt=u({}.isPrototypeOf),t=G("navigator","userAgent")||"",o=y.process,i=y.Deno,o=o&&o.versions||i&&i.version,i=o&&o.v8,s=p=!(p=i?0<(a=i.split("."))[0]&&a[0]<4?1:+(a[0]+a[1]):p)&&t&&(!(a=t.match(/Edge\/(\d+)/))||74<=a[1])&&(a=t.match(/Chrome\/(\d+)/))?+a[1]:p,Tt=!!Object.getOwnPropertySymbols&&!c(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}),Ct=Tt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,At=Object,It=Ct?function(t){return"symbol"==typeof t}:function(t){var e=G("Symbol");return w(e)&&wt(e.prototype,At(t))},Ot=String,Nt=function(t){try{return Ot(t)}catch(t){return"Object"}},Pt=TypeError,Rt=function(t){if(w(t))return t;throw Pt(Nt(t)+" is not a function")},jt=function(t,e){t=t[e];return xt(t)?void 0:Rt(t)},Lt=TypeError,_t=function(t,e){var n,r;if("string"===e&&w(n=t.toString)&&!b(r=E(n,t)))return r;if(w(n=t.valueOf)&&!b(r=E(n,t)))return r;if("string"!==e&&w(n=t.toString)&&!b(r=E(n,t)))return r;throw Lt("Can't convert object to primitive value")},Mt=Object.defineProperty,kt=function(e,n){try{Mt(y,e,{value:n,configurable:!0,writable:!0})}catch(t){y[e]=n}return n},o="__core-js_shared__",Bt=y[o]||kt(o,{}),i=D(function(t){(t.exports=function(t,e){return Bt[t]||(Bt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})}),Ft=Object,Ut=u({}.hasOwnProperty),S=Object.hasOwn||function(t,e){return Ut(K(t),e)},Dt=0,Vt=Math.random(),$t=u(1..toString),zt=i("wks"),Gt=y.Symbol,Kt=Gt&&Gt.for,Yt=Ct?Gt:Gt&&Gt.withoutSetter||Y,Ht=TypeError,Wt=l("toPrimitive"),Xt=function(t,e){if(!b(t)||It(t))return t;var n=jt(t,Wt);if(n){if(n=E(n,t,e=void 0===e?"default":e),!b(n)||It(n))return n;throw Ht("Can't convert object to primitive value")}return _t(t,e=void 0===e?"number":e)},qt=function(t){t=Xt(t,"string");return It(t)?t:t+""},Jt=y.document,Zt=b(Jt)&&b(Jt.createElement),Qt=function(t){return Zt?Jt.createElement(t):{}},te=!h&&!c(function(){return 7!=Object.defineProperty(Qt("div"),"a",{get:function(){return 7}}).a}),ee=Object.getOwnPropertyDescriptor,ne={f:h?ee:function(t,e){if(t=z(t),e=qt(e),te)try{return ee(t,e)}catch(t){}if(S(t,e))return ft(!E(lt.f,t,e),t[e])}},a=h&&c(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),re=String,oe=TypeError,T=function(t){if(b(t))return t;throw oe(re(t)+" is not an object")},ie=TypeError,se=Object.defineProperty,ae=Object.getOwnPropertyDescriptor,ce="enumerable",ue="configurable",le="writable",fe={f:h?a?function(t,e,n){var r;return T(t),e=qt(e),T(n),"function"==typeof t&&"prototype"===e&&"value"in n&&le in n&&!n[le]&&((r=ae(t,e))&&r[le]&&(t[e]=n.value,n={configurable:(ue in n?n:r)[ue],enumerable:(ce in n?n:r)[ce],writable:!1})),se(t,e,n)}:se:function(t,e,n){if(T(t),e=qt(e),T(n),te)try{return se(t,e,n)}catch(t){}if("get"in n||"set"in n)throw ie("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},he=h?function(t,e,n){return fe.f(t,e,ft(1,n))}:function(t,e,n){return t[e]=n,t},p=Function.prototype,o=h&&Object.getOwnPropertyDescriptor,g=S(p,"name"),de={EXISTS:g,PROPER:g&&"something"===function(){}.name,CONFIGURABLE:g&&(!h||o(p,"name").configurable)},pe=u(Function.toString),ge=(w(Bt.inspectSource)||(Bt.inspectSource=function(t){return pe(t)}),Bt.inspectSource),g=y.WeakMap,o=w(g)&&/native code/.test(String(g)),ve=i("keys"),me={},ye="Object already initialized",xe=y.TypeError,p=y.WeakMap,be=o||Bt.state?((r=Bt.state||(Bt.state=new p)).get=r.get,r.has=r.has,r.set=r.set,ot=function(t,e){if(r.has(t))throw xe(ye);return e.facade=t,r.set(t,e),e},it=function(t){return r.get(t)||{}},function(t){return r.has(t)}):(st=H("state"),me[st]=!0,ot=function(t,e){if(S(t,st))throw xe(ye);return e.facade=t,he(t,st,e),e},it=function(t){return S(t,st)?t[st]:{}},function(t){return S(t,st)}),Se={set:ot,get:it,has:be,enforce:function(t){return be(t)?it(t):ot(t,{})},getterFor:function(e){return function(t){if(b(t)&&(t=it(t)).type===e)return t;throw xe("Incompatible receiver, "+e+" required")}}},Ee=D(function(t){var r=de.CONFIGURABLE,o=Se.enforce,e=Se.get,i=Object.defineProperty,s=h&&!c(function(){return 8!==i(function(){},"length",{value:8}).length}),a=String(String).split("String"),t=t.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!S(t,"name")||r&&t.name!==e)&&(h?i(t,"name",{value:e,configurable:!0}):t.name=e),s&&n&&S(n,"arity")&&t.length!==n.arity&&i(t,"length",{value:n.arity});try{n&&S(n,"constructor")&&n.constructor?h&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}n=o(t);return S(n,"source")||(n.source=a.join("string"==typeof e?e:"")),t};Function.prototype.toString=t(function(){return w(this)&&e(this).source||ge(this)},"toString")}),we=Math.ceil,Te=Math.floor,Ce=Math.trunc||function(t){t=+t;return(0<t?Te:we)(t)},Ae=function(t){t=+t;return t!=t||0==t?0:Ce(t)},Ie=Math.max,Oe=Math.min,Ne=function(t,e){t=Ae(t);return t<0?Ie(t+e,0):Oe(t,e)},Pe=Math.min,Re=function(t){return 0<t?Pe(Ae(t),9007199254740991):0},je=function(t){return Re(t.length)},Le={includes:W(!0),indexOf:W(!1)}.indexOf,_e=u([].push),Me=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ke=Me.concat("length","prototype"),Be={f:Object.getOwnPropertyNames||function(t){return X(t,ke)}},Fe={f:Object.getOwnPropertySymbols},Ue=u([].concat),De=G("Reflect","ownKeys")||function(t){var e=Be.f(T(t)),n=Fe.f;return n?Ue(e,n(t)):e},Ve=/#|\.prototype\./,$e=q.normalize=function(t){return String(t).replace(Ve,".").toLowerCase()},ze=q.data={},Ge=q.NATIVE="N",Ke=q.POLYFILL="P",Ye=q,He=ne.f,We=u(u.bind),Xe=Array.isArray||function(t){return"Array"==x(t)},g={},o=(g[l("toStringTag")]="z","[object z]"===String(g)),qe=l("toStringTag"),Je=Object,Ze="Arguments"==x(function(){return arguments}()),Qe=o?x:function(t){var e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Je(t),qe))?e:Ze?x(t):"Object"==(e=x(t))&&w(t.callee)?"Arguments":e},tn=[],en=G("Reflect","construct"),nn=/^\s*(?:class|function)\b/,rn=u(nn.exec),on=!nn.exec(Z),sn=(tt.sham=!0,!en||c(function(){var t;return Q(Q.call)||!Q(Object)||!Q(function(){t=!0})||t})?tt:Q),an=l("species"),cn=Array,un=function(t){var e;return Xe(t)&&(e=t.constructor,(sn(e)&&(e===cn||Xe(e.prototype))||b(e)&&null===(e=e[an]))&&(e=void 0)),void 0===e?cn:e},ln=u([].push),p={forEach:nt(0),map:nt(1),filter:nt(2),some:nt(3),every:nt(4),find:nt(5),findIndex:nt(6),filterReject:nt(7)},fn=p.some,g=rt("some");e({target:"Array",proto:!0,forced:!g},{some:function(t){return fn(this,t,1<arguments.length?arguments[1]:void 0)}});function hn(e){if(e&&e.forEach!==gn)try{he(e,"forEach",gn)}catch(t){e.forEach=gn}}o||m(Object.prototype,"toString",o?{}.toString:function(){return"[object "+Qe(this)+"]"},{unsafe:!0});var dn,pn=p.forEach,gn=rt("forEach")?[].forEach:function(t){return pn(this,t,1<arguments.length?arguments[1]:void 0)},vn=(e({target:"Array",proto:!0,forced:[].forEach!=gn},{forEach:gn}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),g=Qt("span").classList,o=g&&g.constructor&&g.constructor.prototype,g=o===Object.prototype?void 0:o;for(dn in vn)vn[dn]&&hn(y[dn]&&y[dn].prototype);hn(g);function mn(t,e){var n,t=T(t).constructor;if(void 0===t||xt(n=T(t)[On]))return e;if(sn(t=n))return t;throw In(Nt(t)+" is not a constructor")}function yn(t,e){if(t<e)throw _n("Not enough arguments");return t}var xn,bn,v="process"==x(y.process),Sn=String,En=TypeError,wn=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=u(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return T(t),function(t){if("object"==typeof t||w(t))return;throw En("Can't set "+Sn(t)+" as a prototype")}(e),r?n(t,e):t.__proto__=e,t}}():void 0),Tn=fe.f,Cn=l("toStringTag"),o=function(t,e,n){(t=t&&!n?t.prototype:t)&&!S(t,Cn)&&Tn(t,Cn,{configurable:!0,value:e})},g=l("species"),An=TypeError,In=TypeError,On=l("species"),C=Function.prototype,Nn=C.apply,Pn=C.call,Rn="object"==typeof Reflect&&Reflect.apply||(at?Pn.bind(Nn):function(){return Pn.apply(Nn,arguments)}),jn=G("document","documentElement"),Ln=u([].slice),_n=TypeError,C=/(?:ipad|iphone|ipod).*applewebkit/i.test(t),A=y.setImmediate,I=y.clearImmediate,Mn=y.process,kn=y.Dispatch,Bn=y.Function,O=y.MessageChannel,Fn=y.String,Un=0,Dn={},Vn="onreadystatechange";try{xn=y.location}catch(t){}function $n(t){return function(){or(t)}}function zn(t){or(t.data)}function Gn(t){y.postMessage(Fn(t),xn.protocol+"//"+xn.host)}function Kn(){this.head=null,this.tail=null}function Yn(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw vr("Bad Promise constructor");n=t,r=e}),this.resolve=Rt(n),this.reject=Rt(r)}function Hn(t,e){var n,r,o,i,s=e.value,a=e.state==Lr,c=a?t.ok:t.fail,u=t.resolve,l=t.reject,f=t.domain;try{c?(a||(e.rejection===kr&&(i=e,E(yr,y,function(){var t=i.facade;v?Ir.emit("rejectionHandled",t):Ur(jr,t,i.value)})),e.rejection=Mr),!0===c?n=s:(f&&f.enter(),n=c(s),f&&(f.exit(),o=!0)),n===t.promise?l(Cr("Promise-chain cycle")):(r=Br(n))?E(r,n,u,l):u(n)):l(s)}catch(t){f&&!o&&f.exit(),l(t)}}var Wn,Xn,qn,Jn,Zn,Qn,tr,er,nr,rr,or=function(t){var e;S(Dn,t)&&(e=Dn[t],delete Dn[t],e())},O=(A&&I||(A=function(t){yn(arguments.length,1);var e=w(t)?t:Bn(t),n=Ln(arguments,1);return Dn[++Un]=function(){Rn(e,void 0,n)},bn(Un),Un},I=function(t){delete Dn[t]},v?bn=function(t){Mn.nextTick($n(t))}:kn&&kn.now?bn=function(t){kn.now($n(t))}:O&&!C?(N=(O=new O).port2,O.port1.onmessage=zn,bn=J(N.postMessage,N)):y.addEventListener&&w(y.postMessage)&&!y.importScripts&&xn&&"file:"!==xn.protocol&&!c(Gn)?(bn=Gn,y.addEventListener("message",zn,!1)):bn=Vn in Qt("script")?function(t){jn.appendChild(Qt("script"))[Vn]=function(){jn.removeChild(this),or(t)}}:function(t){setTimeout($n(t),0)}),{set:A,clear:I}),N=/ipad|iphone|ipod/i.test(t)&&void 0!==y.Pebble,A=/web0s(?!.*chrome)/i.test(t),I=ne.f,ir=O.set,sr=y.MutationObserver||y.WebKitMutationObserver,P=y.document,ar=y.process,R=y.Promise,I=I(y,"queueMicrotask"),I=I&&I.value,cr=(I||(Wn=function(){var t,e;for(v&&(t=ar.domain)&&t.exit();Xn;){e=Xn.fn,Xn=Xn.next;try{e()}catch(t){throw Xn?Jn():qn=void 0,t}}qn=void 0,t&&t.enter()},Jn=C||v||A||!sr||!P?!N&&R&&R.resolve?((C=R.resolve(void 0)).constructor=R,tr=J(C.then,C),function(){tr(Wn)}):v?function(){ar.nextTick(Wn)}:(ir=J(ir,y),function(){ir(Wn)}):(Zn=!0,Qn=P.createTextNode(""),new sr(Wn).observe(Qn,{characterData:!0}),function(){Qn.data=Zn=!Zn})),I||function(t){t={fn:t,next:void 0};qn&&(qn.next=t),Xn||(Xn=t,Jn()),qn=t}),ur=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},lr=(Kn.prototype={add:function(t){t={item:t,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},Kn),j=y.Promise,fr="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,hr=!fr&&!v&&"object"==typeof window&&"object"==typeof document,dr=(j&&j.prototype,l("species")),pr=!1,gr=w(y.PromiseRejectionEvent),A={CONSTRUCTOR:Ye("Promise",function(){var t=ge(j),e=t!==String(j);if(!e&&66===s)return!0;if(!s||s<51||!/native code/.test(t)){var t=new j(function(t){t(1)}),n=function(t){t(function(){},function(){})};if((t.constructor={})[dr]=n,!(pr=t.then(function(){})instanceof n))return!0}return!e&&(hr||fr)&&!gr}),REJECTION_EVENT:gr,SUBCLASSING:pr},vr=TypeError,mr={f:function(t){return new Yn(t)}},yr=O.set,xr="Promise",N=A.CONSTRUCTOR,br=A.REJECTION_EVENT,R=A.SUBCLASSING,Sr=Se.getterFor(xr),Er=Se.set,C=j&&j.prototype,wr=j,Tr=C,Cr=y.TypeError,Ar=y.document,Ir=y.process,Or=mr.f,Nr=Or,Pr=!!(Ar&&Ar.createEvent&&y.dispatchEvent),Rr="unhandledrejection",jr="rejectionhandled",Lr=1,_r=2,Mr=1,kr=2,Br=function(t){var e;return!(!b(t)||!w(e=t.then))&&e},Fr=function(n,o){n.notified||(n.notified=!0,cr(function(){for(var t,r,e=n.reactions;t=e.get();)Hn(t,n);n.notified=!1,o&&!n.rejection&&(r=n,E(yr,y,function(){var t=r.facade,e=r.value,n=Dr(r);if(n&&(n=ur(function(){v?Ir.emit("unhandledRejection",e,t):Ur(Rr,t,e)}),r.rejection=v||Dr(r)?kr:Mr,n.error))throw n.value}))}))},Ur=function(t,e,n){var r;Pr?((r=Ar.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),y.dispatchEvent(r)):r={promise:e,reason:n},!br&&(e=y["on"+t])?e(r):t===Rr&&function(t,e){var n=y.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},Dr=function(t){return t.rejection!==Mr&&!t.parent},Vr=function(e,n,r){return function(t){e(n,t,r)}},$r=function(t,e,n){t.done||(t.done=!0,(t=n?n:t).value=e,t.state=_r,Fr(t,!0))},zr=function(n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(n.facade===t)throw Cr("Promise can't be resolved itself");var r=Br(t);r?cr(function(){var e={done:!1};try{E(r,t,Vr(zr,e,n),Vr($r,e,n))}catch(t){$r(e,t,n)}}):(n.value=t,n.state=Lr,Fr(n,!1))}catch(t){$r({done:!1},t,n)}}};if(N&&(Tr=(wr=function(t){!function(t,e){if(wt(e,t))return;throw An("Incorrect invocation")}(this,Tr),Rt(t),E(er,this);var e=Sr(this);try{t(Vr(zr,e),Vr($r,e))}catch(t){$r(e,t)}}).prototype,(er=function(t){Er(this,{type:xr,done:!1,notified:!1,parent:!1,reactions:new lr,rejection:!1,state:0,value:void 0})}).prototype=m(Tr,"then",function(t,e){var n=Sr(this),r=Or(mn(this,wr));return n.parent=!0,r.ok=!w(t)||t,r.fail=w(e)&&e,r.domain=v?Ir.domain:void 0,0==n.state?n.reactions.add(r):cr(function(){Hn(r,n)}),r.promise}),nr=function(){var t=new er,e=Sr(t);this.promise=t,this.resolve=Vr(zr,e),this.reject=Vr($r,e)},mr.f=Or=function(t){return t===wr||void 0===t?new nr:Nr(t)},w(j)&&C!==Object.prototype)){rr=C.then,R||m(C,"then",function(t,e){var n=this;return new wr(function(t,e){E(rr,n,t,e)}).then(t,e)},{unsafe:!0});try{delete C.constructor}catch(t){}wn&&wn(C,Tr)}e({global:!0,constructor:!0,wrap:!0,forced:N},{Promise:wr}),o(wr,xr,!1),P=G(P=xr),sr=fe.f,h&&P&&!P[g]&&sr(P,g,{configurable:!0,get:function(){return this}});function Gr(t){return void 0!==t&&(Wr.Array===t||qr[Xr]===t)}function Kr(t,e){if(e=arguments.length<2?Zr(t):e,Rt(e))return T(E(e,t));throw Qr(Nt(t)+" is not iterable")}function Yr(t,e){this.stopped=t,this.result=e}function Hr(t,e,n){function r(t){return i&&to(i,"normal",t),new Yr(!0,t)}function o(t){return h?(T(t),g?v(t[0],t[1],r):v(t[0],t[1])):g?v(t,r):v(t)}var i,s,a,c,u,l,f=n&&n.that,h=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),v=J(e,f);if(d)i=t.iterator;else if(p)i=t;else{if(!(n=Zr(t)))throw eo(Nt(t)+" is not iterable");if(Gr(n)){for(s=0,a=je(t);s<a;s++)if((c=o(t[s]))&&wt(no,c))return;return}i=Kr(t,n)}for(u=(d?t:i).next;!(l=E(u,i)).done;){try{c=o(l.value)}catch(t){to(i,"throw",t)}if("object"==typeof c&&c&&wt(no,c))return}}var Wr={},Xr=l("iterator"),qr=Array.prototype,Jr=l("iterator"),Zr=function(t){if(!xt(t))return jt(t,Jr)||jt(t,"@@iterator")||Wr[Qe(t)]},Qr=TypeError,to=function(t,e,n){var r,o;T(t);try{if(!(r=jt(t,"return"))){if("throw"===e)throw n;return n}r=E(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return T(r),n},eo=TypeError,no=Yr.prototype,ro=l("iterator"),oo=!1;try{var io=0,so={next:function(){return{done:!!io++}},return:function(){oo=!0}};so[ro]=function(){return this},Array.from(so,function(){throw 2})}catch(t){}function ao(t,e){if(e||oo){var n=!1;try{var r={};r[ro]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}}I=A.CONSTRUCTOR||!ao(function(t){j.all(t).then(void 0,function(){})}),e({target:"Promise",stat:!0,forced:I},{all:function(t){var a=this,e=mr.f(a),c=e.resolve,u=e.reject,n=ur(function(){var r=Rt(a.resolve),o=[],i=0,s=1;Hr(t,function(t){var e=i++,n=!1;s++,E(r,a,t).then(function(t){n||(n=!0,o[e]=t,--s||c(o))},u)}),--s||c(o)});return n.error&&u(n.value),e.promise}}),O=A.CONSTRUCTOR,R=j&&j.prototype;e({target:"Promise",proto:!0,forced:O,real:!0},{catch:function(t){return this.then(void 0,t)}}),w(j)&&(C=G("Promise").prototype.catch,R.catch!==C&&m(R,"catch",C,{unsafe:!0})),e({target:"Promise",stat:!0,forced:I},{race:function(t){var n=this,r=mr.f(n),o=r.reject,e=ur(function(){var e=Rt(n.resolve);Hr(t,function(t){E(e,n,t).then(r.resolve,o)})});return e.error&&o(e.value),r.promise}});e({target:"Promise",stat:!0,forced:A.CONSTRUCTOR},{reject:function(t){var e=mr.f(this);return E(e.reject,void 0,t),e.promise}});function co(){}function uo(t){t.write(Io("")),t.close();var e=t.parentWindow.Object;return t=null,e}function lo(t){Ro[Po][t]=!0}function fo(u){return function(t,e,n,r){Rt(e);var o=K(t),i=yt(o),s=je(o),a=u?s-1:0,c=u?-1:1;if(n<2)for(;;){if(a in i){r=i[a],a+=c;break}if(a+=c,u?a<0:s<=a)throw _o("Reduce of empty array with no initial value")}for(;u?0<=a:a<s;a+=c)a in i&&(r=e(r,i[a],a,o));return r}}function L(t){if("Symbol"===Qe(t))throw TypeError("Cannot convert a Symbol value to a string");return Uo(t)}function ho(){var t=T(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}function po(n,t,e,r){var s,o=l(n),a=!c(function(){var t={};return t[o]=function(){return 7},7!=""[n](t)}),i=a&&!c(function(){var t=!1,e=/a/;return"split"===n&&((e={constructor:{}}).constructor[ri]=function(){return e},e.flags="",e[o]=/./[o]),e.exec=function(){return t=!0,null},e[o](""),!t});a&&i&&!e||(s=u(/./[o]),i=t(o,""[n],function(t,e,n,r,o){var t=u(t),i=e.exec;return i===ni||i===oi.exec?a&&!o?{done:!0,value:s(e,n,r)}:{done:!0,value:t(n,e,r)}:{done:!1}}),m(String.prototype,n,i[0]),m(oi,o,i[1])),r&&he(oi[o],"sham",!0)}function go(o){return function(t,e){var n,t=L(f(t)),e=Ae(e),r=t.length;return e<0||r<=e?o?"":void 0:(n=si(t,e))<55296||56319<n||e+1===r||(r=si(t,e+1))<56320||57343<r?o?ii(t,e):n:o?ai(t,e,e+2):r-56320+(n-55296<<10)+65536}}function vo(t,e,n){return e+(n?ci(t,e).length:1)}function mo(t,e){var n=t.exec;if(w(n))return null!==(n=E(n,t,e))&&T(n),n;if("RegExp"===x(t))return E(ni,t,e);throw gi("RegExp#exec called on incompatible receiver")}function yo(){return this}function xo(t,e){return{value:t,done:e}}var bo,So,N=A.CONSTRUCTOR,Eo=(G("Promise"),e({target:"Promise",stat:!0,forced:N},{resolve:function(t){return t=t,T(e=this),b(t)&&t.constructor===e?t:((0,(e=mr.f(e)).resolve)(t),e.promise);var e}}),Object.keys||function(t){return X(t,Me)}),wo={f:h&&!a?Object.defineProperties:function(t,e){T(t);for(var n,r=z(e),o=Eo(e),i=o.length,s=0;s<i;)fe.f(t,n=o[s++],r[n]);return t}},To="prototype",Co="script",Ao=H("IE_PROTO"),Io=function(t){return"<"+Co+">"+t+"</"+Co+">"},Oo=function(){try{bo=new ActiveXObject("htmlfile")}catch(t){}Oo="undefined"==typeof document||document.domain&&bo?uo(bo):(t=Qt("iframe"),e="java"+Co+":",t.style.display="none",jn.appendChild(t),t.src=String(e),(e=t.contentWindow.document).open(),e.write(Io("document.F=Object")),e.close(),e.F);for(var t,e,n=Me.length;n--;)delete Oo[To][Me[n]];return Oo()},No=(me[Ao]=!0,Object.create||function(t,e){var n;return null!==t?(co[To]=T(t),n=new co,co[To]=null,n[Ao]=t):n=Oo(),void 0===e?n:wo.f(n,e)}),sr=fe.f,Po=l("unscopables"),Ro=Array.prototype,jo=(null==Ro[Po]&&sr(Ro,Po,{configurable:!0,value:No(null)}),p.find),P="find",Lo=!0,_o=(P in[]&&Array(1)[P](function(){Lo=!1}),e({target:"Array",proto:!0,forced:Lo},{find:function(t){return jo(this,t,1<arguments.length?arguments[1]:void 0)}}),lo(P),TypeError),Mo={left:fo(!1),right:fo(!0)}.left,g=rt("reduce"),so=(e({target:"Array",proto:!0,forced:!g||!v&&79<s&&s<83},{reduce:function(t){var e=arguments.length;return Mo(this,t,e,1<e?arguments[1]:void 0)}}),Date.prototype),ko="Invalid Date",O="toString",Bo=u(so[O]),Fo=u(so.getTime),Uo=(String(new Date(NaN))!=ko&&m(so,O,function(){var t=Fo(this);return t==t?Bo(this):ko}),String),Do=RegExp.prototype,R=de.PROPER,C="toString",Vo=RegExp.prototype[C],I=c(function(){return"/a/b"!=Vo.call({source:"a",flags:"b"})}),A=R&&Vo.name!=C,$o=((I||A)&&m(RegExp.prototype,C,function(){var t,e=T(this);return"/"+L(e.source)+"/"+L(void 0!==(t=(e=e).flags)||"flags"in Do||S(e,"flags")||!wt(Do,e)?t:E(ho,e))},{unsafe:!0}),y.RegExp),N=c(function(){var t=$o("a","y");return t.lastIndex=2,null!=t.exec("abcd")}),a=N||c(function(){return!$o("a","y").sticky}),sr={BROKEN_CARET:N||c(function(){var t=$o("^r","gy");return t.lastIndex=2,null!=t.exec("str")}),MISSED_STICKY:a,UNSUPPORTED_Y:N},zo=y.RegExp,p=c(function(){var t=zo(".","s");return!t.dotAll||!t.exec("\n")||"s"!==t.flags}),Go=y.RegExp,P=c(function(){var t=Go("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")}),Ko=Se.get,Yo=i("native-string-replace",String.prototype.replace),Ho=RegExp.prototype.exec,Wo=Ho,Xo=u("".charAt),qo=u("".indexOf),Jo=u("".replace),Zo=u("".slice),Qo=(g=/b*/g,E(Ho,so=/a/,"a"),E(Ho,g,"a"),0!==so.lastIndex||0!==g.lastIndex),ti=sr.BROKEN_CARET,ei=void 0!==/()??/.exec("")[1],ni=Wo=Qo||ei||ti||p||P?function(t){var e,n,r,o,i,s,a=this,c=Ko(a),t=L(t),u=c.raw;if(u)return u.lastIndex=a.lastIndex,f=E(Wo,u,t),a.lastIndex=u.lastIndex,f;var l=c.groups,u=ti&&a.sticky,f=E(ho,a),c=a.source,h=0,d=t;if(u&&(f=Jo(f,"y",""),-1===qo(f,"g")&&(f+="g"),d=Zo(t,a.lastIndex),0<a.lastIndex&&(!a.multiline||a.multiline&&"\n"!==Xo(t,a.lastIndex-1))&&(c="(?: "+c+")",d=" "+d,h++),e=new RegExp("^(?:"+c+")",f)),ei&&(e=new RegExp("^"+c+"$(?!\\s)",f)),Qo&&(n=a.lastIndex),r=E(Ho,u?e:a,d),u?r?(r.input=Zo(r.input,h),r[0]=Zo(r[0],h),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:Qo&&r&&(a.lastIndex=a.global?r.index+r[0].length:n),ei&&r&&1<r.length&&E(Yo,r[0],e,function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)}),r&&l)for(r.groups=i=No(null),o=0;o<l.length;o++)i[(s=l[o])[0]]=r[s[1]];return r}:Wo,ri=(e({target:"RegExp",proto:!0,forced:/./.exec!==ni},{exec:ni}),l("species")),oi=RegExp.prototype,ii=u("".charAt),si=u("".charCodeAt),ai=u("".slice),O={codeAt:go(!1),charAt:go(!0)},ci=O.charAt,ui=Math.floor,li=u("".charAt),fi=u("".replace),hi=u("".slice),di=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,pi=/\$([$&'`]|\d{1,2})/g,gi=TypeError,vi=l("replace"),mi=Math.max,yi=Math.min,xi=u([].concat),bi=u([].push),Si=u("".indexOf),Ei=u("".slice),R="$0"==="a".replace(/./,"$0"),wi=!!/./[vi]&&""===/./[vi]("a","$0"),Ti=(po("replace",function(t,x,b){var S=wi?"$":"$0";return[function(t,e){var n=f(this),r=xt(t)?void 0:jt(t,vi);return r?E(r,t,n,e):E(x,L(n),t,e)},function(t,e){var n=T(this),r=L(t);if("string"==typeof e&&-1===Si(e,S)&&-1===Si(e,"$<")){t=b(x,n,r,e);if(t.done)return t.value}for(var o,i=w(e),s=(i||(e=L(e)),n.global),a=(s&&(o=n.unicode,n.lastIndex=0),[]);null!==(h=mo(n,r))&&(bi(a,h),s);)""===L(h[0])&&(n.lastIndex=vo(r,Re(n.lastIndex),o));for(var c,u="",l=0,f=0;f<a.length;f++){for(var h,d=L((h=a[f])[0]),p=mi(yi(Ae(h.index),r.length),0),g=[],v=1;v<h.length;v++)bi(g,void 0===(c=h[v])?c:String(c));var m=h.groups,y=i?(y=xi([d],g,p,r),void 0!==m&&bi(y,m),L(Rn(e,void 0,y))):function(i,s,a,c,u,t){var l=a+i.length,f=c.length,e=pi;return void 0!==u&&(u=K(u),e=di),fi(t,e,function(t,e){var n;switch(li(e,0)){case"$":return"$";case"&":return i;case"`":return hi(s,0,a);case"'":return hi(s,l);case"<":n=u[hi(e,1,-1)];break;default:var r,o=+e;if(0==o)return t;if(f<o)return 0!==(r=ui(o/10))&&r<=f?void 0===c[r-1]?li(e,1):c[r-1]+li(e,1):t;n=c[o-1]}return void 0===n?"":n})}(d,r,p,g,m,e);l<=p&&(u+=Ei(r,l,p)+y,l=p+d.length)}return u+Ei(r,l)}]},!!c(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})||!R||wi),Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}),Ci=(po("search",function(r,o,i){return[function(t){var e=f(this),n=xt(t)?void 0:jt(t,r);return n?E(n,t,e):new RegExp(t)[r](L(e))},function(t){var e=T(this),t=L(t),n=i(o,e,t);return n.done?n.value:(n=e.lastIndex,Ti(n,0)||(e.lastIndex=0),t=mo(e,t),Ti(e.lastIndex,n)||(e.lastIndex=n),null===t?-1:t.index)}]}),u([].join)),I=yt!=Object,A=rt("join",","),Ai=(e({target:"Array",proto:!0,forced:I||!A},{join:function(t){return Ci(z(this),void 0===t?",":t)}}),function(t,e,n){e=qt(e);e in t?fe.f(t,e,ft(0,n)):t[e]=n}),Ii=Array,C=!ao(function(t){Array.from(t)}),a=(e({target:"Array",stat:!0,forced:C},{from:function(t){var e,n,r,o,i,s,a=K(t),t=sn(this),c=arguments.length,u=1<c?arguments[1]:void 0,l=void 0!==u,c=(l&&(u=J(u,2<c?arguments[2]:void 0)),Zr(a)),f=0;if(!c||this===Ii&&Gr(c))for(e=je(a),n=t?new this(e):Ii(e);f<e;f++)s=l?u(a[f],f):a[f],Ai(n,f,s);else for(i=(o=Kr(a,c)).next,n=t?new this:[];!(r=E(i,o)).done;f++)s=l?function(e,t,n,r){try{return r?t(T(n)[0],n[1]):t(n)}catch(t){to(e,"throw",t)}}(o,u,[r.value,f],!0):r.value,Ai(n,f,s);return n.length=f,n}}),!c(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Oi=H("IE_PROTO"),Ni=Object,Pi=Ni.prototype,N=a?Ni.getPrototypeOf:function(t){var e,t=K(t);return S(t,Oi)?t[Oi]:(e=t.constructor,w(e)&&t instanceof e?e.prototype:t instanceof Ni?Pi:null)},Ri=l("iterator"),i=!1,P=([].keys&&("next"in(g=[].keys())?(p=N(N(g)))!==Object.prototype&&(So=p):i=!0),!b(So)||c(function(){var t={};return So[Ri].call(t)!==t})),R=(w((So=P?{}:So)[Ri])||m(So,Ri,function(){return this}),{IteratorPrototype:So,BUGGY_SAFARI_ITERATORS:i}),I=R.IteratorPrototype,A=function(){return this},C=de.PROPER,a=de.CONFIGURABLE,g=R.IteratorPrototype,ji=R.BUGGY_SAFARI_ITERATORS,p=l("iterator"),Li="values",_i="entries",Mi=O.charAt,ki="String Iterator",Bi=Se.set,Fi=Se.getterFor(ki),P=String,i="String",Ui=function(t){Bi(this,{type:ki,string:L(t),index:0})},R=function(){var t=Fi(this),e=t.string,n=t.index;return n>=e.length?xo(void 0,!0):(e=Mi(e,n),t.index+=e.length,xo(e,!1))},Di=void 0,O=void 0,Vi=void 0;function $i(t){if(t===Di&&Xi)return Xi;if(!ji&&t in M)return M[t];switch(t){case"keys":case Li:case _i:return function(){return new Ui(this,t)}}return function(){return new Ui(this)}}var zi,Gi,_=Ui,Ki=i,Yi=void 0,Yi=(Ki+=" Iterator",_.prototype=No(I,{next:ft(+!Yi,R)}),o(_,Ki,!1),Wr[Ki]=A,i+" Iterator"),Hi=!1,M=P.prototype,Wi=M[p]||M["@@iterator"]||Di&&M[Di],Xi=!ji&&Wi||$i(Di);if((R="Array"==i&&M.entries||Wi)&&(_=N(R.call(new P)))!==Object.prototype&&_.next&&(N(_)!==g&&(wn?wn(_,g):w(_[p])||m(_,p,yo)),o(_,Yi,!0)),C&&Di==Li&&Wi&&Wi.name!==Li&&(a?he(M,"name",Li):(Hi=!0,Xi=function(){return E(Wi,this)})),Di)if(zi={values:$i(Li),keys:O?Xi:$i("keys"),entries:$i(_i)},Vi)for(Gi in zi)!ji&&!Hi&&Gi in M||m(M,Gi,zi[Gi]);else e({target:i,proto:!0,forced:ji||Hi},zi);M[p]!==Xi&&m(M,p,Xi,{name:Di}),Wr[i]=Xi;function qi(t){if(9007199254740991<t)throw ts("Maximum allowed index exceeded")}function Ji(e){return 51<=s||!c(function(){var t=[];return(t.constructor={})[es]=function(){return{foo:1}},1!==t[e](Boolean).foo})}function Zi(t,e,n){for(var r=je(t),o=Ne(e,r),i=Ne(void 0===n?r:n,r),s=as(cs(i-o,0)),a=0;o<i;o++,a++)Ai(s,a,t[o]);return s.length=a,s}function Qi(e){return function(t){t=L(f(t));return 1&e&&(t=vs(t,ms,"")),t=2&e?vs(t,ys,""):t}}var ts=TypeError,es=l("species"),ns=l("isConcatSpreadable"),I=51<=s||!c(function(){var t=[];return t[ns]=!1,t.concat()[0]!==t}),Ki=Ji("concat"),A=(e({target:"Array",proto:!0,arity:1,forced:!I||!Ki},{concat:function(t){for(var e,n,r,o,i,s=K(this),a=et(s,0),c=0,u=-1,l=arguments.length;u<l;u++)if(i=void 0,!b(o=r=-1===u?s:arguments[u])||(void 0!==(i=o[ns])?!i:!Xe(o)))qi(c+1),Ai(a,c++,r);else for(n=je(r),qi(c+n),e=0;e<n;e++,c++)e in r&&Ai(a,c,r[e]);return a.length=c,a}}),Ji("slice")),rs=l("species"),os=Array,is=Math.max,ss=(e({target:"Array",proto:!0,forced:!A},{slice:function(t,e){var n,r,o,i=z(this),s=je(i),a=Ne(t,s),c=Ne(void 0===e?s:e,s);if(Xe(i)&&(n=i.constructor,(n=sn(n)&&(n===os||Xe(n.prototype))||b(n)&&null===(n=n[rs])?void 0:n)===os||void 0===n))return Ln(i,a,c);for(r=new(void 0===n?os:n)(is(c-a,0)),o=0;a<c;a++,o++)a in i&&Ai(r,o,i[a]);return r.length=o,r}}),l("match")),as=Array,cs=Math.max,us=sr.UNSUPPORTED_Y,ls=4294967295,fs=Math.min,hs=[].push,ds=u(/./.exec),ps=u(hs),gs=u("".slice),R=(po("split",function(o,p,g){var v="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(t,e){var n=L(f(this)),r=void 0===e?ls:e>>>0;if(0==r)return[];if(void 0===t)return[n];if(!b(e=t)||(void 0!==(c=e[ss])?!c:"RegExp"!=x(e)))return E(p,n,t,r);for(var o,i,s,a=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),u=0,l=new RegExp(t.source,c+"g");(o=E(ni,l,n))&&!(u<(i=l.lastIndex)&&(ps(a,gs(n,u,o.index)),1<o.length&&o.index<n.length&&Rn(hs,a,Zi(o,1)),s=o[0].length,u=i,r<=a.length));)l.lastIndex===o.index&&l.lastIndex++;return u===n.length?!s&&ds(l,"")||ps(a,""):ps(a,gs(n,u)),r<a.length?Zi(a,0,r):a}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:E(p,this,t,e)}:p;return[function(t,e){var n=f(this),r=xt(t)?void 0:jt(t,o);return r?E(r,t,n,e):E(v,L(n),t,e)},function(t,e){var n=T(this),r=L(t),t=g(v,n,r,e,v!==p);if(t.done)return t.value;var t=mn(n,RegExp),o=n.unicode,i=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(us?"g":"y"),s=new t(us?"^(?:"+n.source+")":n,i),a=void 0===e?ls:e>>>0;if(0==a)return[];if(0===r.length)return null===mo(s,r)?[r]:[];for(var c=0,u=0,l=[];u<r.length;){s.lastIndex=us?0:u;var f,h=mo(s,us?gs(r,u):r);if(null===h||(f=fs(Re(s.lastIndex+(us?u:0)),r.length))===c)u=vo(r,u,o);else{if(ps(l,gs(r,c,u)),l.length===a)return l;for(var d=1;d<=h.length-1;d++)if(ps(l,h[d]),l.length===a)return l;u=c=f}}return ps(l,gs(r,c)),l}]},!!c(function(){var t=/(?:)/,e=t.exec,t=(t.exec=function(){return e.apply(this,arguments)},"ab".split(t));return 2!==t.length||"a"!==t[0]||"b"!==t[1]}),us),po("match",function(r,a,c){return[function(t){var e=f(this),n=xt(t)?void 0:jt(t,r);return n?E(n,t,e):new RegExp(t)[r](L(e))},function(t){var e=T(this),n=L(t),t=c(a,e,n);if(t.done)return t.value;if(!e.global)return mo(e,n);for(var r=e.unicode,o=[],i=e.lastIndex=0;null!==(s=mo(e,n));){var s=L(s[0]);""===(o[i]=s)&&(e.lastIndex=vo(n,Re(e.lastIndex),r)),i++}return 0===i?null:o}]}),"\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"),vs=u("".replace),P="["+R+"]",ms=RegExp("^"+P+P+"*"),ys=RegExp(P+P+"*$"),g={start:Qi(1),end:Qi(2),trim:Qi(3)},xs=g.trim,bs=u("".charAt),Ss=y.parseFloat,o=y.Symbol,Es=o&&o.iterator,_=1/Ss(R+"-0")!=-1/0||Es&&!c(function(){Ss(Object(Es))})?function(t){var t=xs(L(t)),e=Ss(t);return 0===e&&"-"==bs(t,0)?-0:e}:Ss,ws=(e({global:!0,forced:parseFloat!=_},{parseFloat:_}),e({target:"Number",stat:!0},{isNaN:function(t){return t!=t}}),u(1..valueOf)),Yi=Be.f,Ts=ne.f,Cs=fe.f,As=g.trim,C="Number",Is=y[C],Os=Is.prototype,Ns=y.TypeError,Ps=u("".slice),Rs=u("".charCodeAt),js=function(t){var e,n,r,o,i,s,a,c=Xt(t,"number");if(It(c))throw Ns("Cannot convert a Symbol value to a number");if("string"==typeof c&&2<c.length)if(c=As(c),43===(t=Rs(c,0))||45===t){if(88===(e=Rs(c,2))||120===e)return NaN}else if(48===t){switch(Rs(c,1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+c}for(i=(o=Ps(c,2)).length,s=0;s<i;s++)if((a=Rs(o,s))<48||r<a)return NaN;return parseInt(o,n)}return+c};if(Ye(C,!Is(" 0o1")||!Is("0b1")||Is("+0x1"))){for(var Ls,_s=function(t){var e,n,r,t=arguments.length<1?0:Is(function(t){t=Xt(t,"number");return"bigint"==typeof t?t:js(t)}(t)),o=this;return wt(Os,o)&&c(function(){ws(o)})?(e=Object(t),n=o,r=_s,wn&&w(n=n.constructor)&&n!==r&&b(n=n.prototype)&&n!==r.prototype&&wn(e,n),e):t},Ms=h?Yi(Is):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),ks=0;Ms.length>ks;ks++)S(Is,Ls=Ms[ks])&&!S(_s,Ls)&&Cs(_s,Ls,Ts(Is,Ls));(_s.prototype=Os).constructor=_s,m(y,C,_s,{constructor:!0})}function Bs(i){return Fs?function(t,e){var n=2<yn(arguments.length,1),r=w(t)?t:Us(t),o=n?Ln(arguments,2):void 0;return i(n?function(){Rn(r,this,o)}:r,e)}:i}e({target:"Array",proto:!0},{fill:function(t){for(var e=K(this),n=je(e),r=arguments.length,o=Ne(1<r?arguments[1]:void 0,n),r=2<r?arguments[2]:void 0,i=void 0===r?n:Ne(r,n);o<i;)e[o++]=t;return e}}),lo("fill");var Fs=/MSIE .\./.test(t),Us=y.Function,O={setTimeout:Bs(y.setTimeout),setInterval:Bs(y.setInterval)},Vi=O.setInterval,p=(e({global:!0,bind:!0,forced:y.setInterval!==Vi},{setInterval:Vi}),O.setTimeout),Ds=(e({global:!0,bind:!0,forced:y.setTimeout!==p},{setTimeout:p}),d.V.mergeAttrs),Vs=d.util.isEqual,$s=d.util.isEmpty,zs=d.util.flattenObject,Gs=d.util.setByPath;function Ks(t,r){var e=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).merge,o=void 0===e?Ds:e,i={};return t.forEach(function(t){var e=t.start,n=t.end,t=t.attrs;(void 0===e&&void 0===n||e<=r&&r<n)&&o(i,t)}),i}function Ys(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=r.delim,i=void 0===o?"/":o,o=r.merge,s=void 0===o?Ds:o,a=d.V.findAnnotationsBetweenIndexes(t,e,n);if(e===n)return Ks(a,e,r);for(var c=e;c<n;c++){var u=Ks(a,c,r);if(f&&!Vs(f,u)){var l,f=zs(s({},f),i),h={};for(l in u=zs(s({},u),i))f[l]===u[l]&&Gs(h,l,u[l],i);f=h}else f=u}return f}var Hs=d.mvc.View.extend({options:{text:void 0,newlineCharacterBBoxWidth:10,placeholder:void 0,focus:!0,debug:!1,selectAllThreshold:20,useNativeSelection:!0,annotateUrls:!1,urlAnnotation:{attrs:{class:"url-annotation",fill:"lightblue","text-decoration":"underline"}},textareaAttributes:{autocorrect:"off",autocomplete:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}},className:"text-editor",events:{"keyup textarea":"onKeyup","input textarea":"onInput","copy textarea":"onCopy","cut textarea":"onCut","paste textarea":"onPaste","mousedown .char-selection-box":"onMousedown","dblclick .char-selection-box":"onDoubleClick","click .char-selection-box":"onTripleClick"},selection:{start:null,end:null},selecting:!1,_textCursor:null,AFTER_KEYDOWN_DELAY:10,DEFAULT_FONT_SIZE:12,init:function(){d.util.bindAll(this,"onMousedown","onMousemove","onMouseup","onDoubleClick","onTripleClick","onKeydown","onAfterPaste","onAfterKeydown","onDocumentPointerdown");var t=this.options.text;if(!t)throw new Error("ui.TextEditor: text option is mandatory");this.setTextElement(t),document.addEventListener("pointerdown",this.onDocumentPointerdown,{capture:!0}),n(document.body).on("mousemove",this.onMousemove),n(document.body).on("mouseup",this.onMouseup),n(document.body).on("keydown",this.onKeydown),this.$viewport=n(t),this.options.annotations&&this.setAnnotations(this.options.annotations)},setTextElement:function(t){this.options.text=t,this.bindTextElement(t)},bindTextElement:function(t){var e;this.unbindTextElement(),t&&((e=n(t)).on("mousedown",this.onMousedown),e.on("dblclick",this.onDoubleClick),e.on("click",this.onTripleClick),this.elText=t)},unbindTextElement:function(){var t=this.elText;t&&((t=n(t)).off("mousedown",this.onMousedown),t.off("dblclick",this.onDoubleClick),t.off("click",this.onTripleClick),this.elText=null)},render:function(t){this.$caret=n("<div>",{class:"caret"}),this.$selection=n("<div>"),this.$selectionBox=n("<div>",{class:"char-selection-box"}),this.$el.append(this.$caret,this.$selection),this.$textareaContainer=n("<div>",{class:"textarea-container"}),this.$textarea=n("<textarea>",this.options.textareaAttributes),this.textarea=this.$textarea[0],this._textContent=this.textarea.value=this.getTextContent(),this._textareaValueBeforeInput=this.textarea.value,this.$textareaContainer.append(this.textarea),this.options.focus&&this.$el.append(this.$textareaContainer),n(t||document.body).append(this.$el);var t=d.V(this.options.text),e=t.bbox();return this.$textareaContainer.css({left:e.x,top:e.y}),this.focus(),this._textCursor=t.attr("cursor"),t.attr("cursor","text"),this.selectAll(),this},annotateURLBeforeCaret:function(t){var e,n;return 0!==t&&(t=Math.max(t-1,0),e=this.getURLBoundary(t),n=this.getAnnotations()||[],e?(this.annotateURL(n,e[0],e[1]),!0):!!d.V.findAnnotationsAtIndex(n,t).some(function(t){return t.url}))},hasSelection:function(){return d.util.isNumber(this.selection.start)&&d.util.isNumber(this.selection.end)&&this.selection.start!==this.selection.end},textContentHasChanged:function(){return this._textContent!==this.textarea.value},restoreTextAreaSelectionDirection:function(){this._selectionDirection&&(this.textarea.selectionDirection=this._selectionDirection)},storeSelectionDirection:function(){this._selectionDirection=this.textarea.selectionDirection},updateSelectionFromTextarea:function(){var t=this.textarea,e=t.selectionStart,t=t.selectionEnd;e===t?this.setCaret(e):this.select(e,t)},textSelectionHasChanged:function(){var t=this.selection,e=this.textarea;return!(!t||!e)&&(t.start!==e.selectionStart||t.end!==e.selectionEnd)},isModifierKey:function(e){return[16,18,17,91].some(function(t){return e.which===t})},isArrowKey:function(t){return 37<=t.which&&t.which<=40},copyToClipboard:function(){document.queryCommandSupported&&document.queryCommandSupported("copy")&&(this._copied=!0,document.execCommand("copy"))},findAnnotationsUnderCursor:function(t,e){return d.V.findAnnotationsAtIndex(t,e)},findAnnotationsInSelection:function(t,e,n){return d.V.findAnnotationsBetweenIndexes(t,e,n)},inferTextOperationType:function(t,e,n){return t.start===t.end&&e.start===e.end&&0<n?"insert":t.start===t.end&&e.start===e.end&&n<=0?"delete-single":t.start!==t.end&&e.start===e.end&&e.start===t.start?"delete":t.start!==t.end&&e.start!==t.start?"delete-insert":void 0},annotate:function(t,o,i,s){var a=[],c=this.inferTextOperationType(o,i,s);return d.util.toArray(t).forEach(function(t){var e,n,r;switch(c){case"insert":t.start<o.start&&o.start<=t.end?t.end+=s:t.start>=o.start&&(t.start+=s,t.end+=s);break;case"delete-single":t.start<o.start&&o.start<=t.end&&o.start!==i.start||t.start<=o.start&&o.start<t.end&&o.start===i.start?t.end+=s:t.start>=o.start&&(t.start+=s,t.end+=s);break;case"delete":t.start<=o.start&&o.start<=t.end?o.end<=t.end?t.end+=s:t.end+=i.start-t.end:t.start>=o.start&&t.start<o.end?(r=t.end-t.start,n=o.end-t.start,t.start=o.start,t.end=t.start+r-n):t.start>=o.end&&(t.start+=s,t.end+=s);break;case"delete-insert":t.start<=o.start&&o.start<=t.end?o.start<t.end&&(o.end>t.end?t.end=i.end:t.end=i.end+(t.end-o.end)):t.start>=o.start&&t.start<=o.end?(e=i.start-o.start,n=o.end-t.start,r=t.end-t.start,t.start=o.start+e,t.end=t.start+r-n):t.start>=o.start&&t.end<=o.end?t.start=t.end=0:t.start>=o.end&&(t.start+=s,t.end+=s);break;default:this.options.debug&&console.log("ui.TextEditor: Unknown text operation.")}t.end>t.start&&a.push(t)},this),a},shiftAnnotations:function(t,e,n){return d.V.shiftAnnotations(t,e,n)},setCurrentAnnotation:function(t){this._currentAnnotationAttributes=t},setAnnotations:function(t){this._annotations=t},getAnnotations:function(){return this._annotations},getCombinedAnnotationAttrsAtIndex:function(t,e){return Ks(d.util.toArray(e),t)},getSelectionAttrs:function(t,e){var n=t.start,t=t.end,t=void 0===t?n:t;return n===t?Ks(e,n-1):Ys(e,n,t)},getTextContent:function(){var t=this.options.text,e=d.V(t).find(".v-line");return 0===e.length?t.textContent:e.reduce(function(t,e,n,r){var o=e.node.textContent;return e.hasClass("v-empty-line")&&(o=""),n===r.length-1?t+o:t+o+"\n"},"")},startSelecting:function(){this.selecting=!0},stopSelecting:function(){this.selecting=!1},selectionInProgress:function(){return!0===this.selecting},selectAll:function(){return this.select(0,this.getNumberOfChars())},select:function(t,e){var n=this.options,r=this.selection,n=(n.debug&&console.log("select(",t,e,")"),r.start),o=r.end,t=(void 0===e&&(e=t),d.util.isNumber(t)&&(r.start=t),d.util.isNumber(e)&&(r.end=e),d.util.isNumber(r.end)||(r.end=r.start),r.start),e=r.end;return d.util.isNumber(t)&&d.util.isNumber(e)&&(n===t&&o===e||this.setCurrentAnnotation(null),t===e?(this.clearSelection(),this.focus(),this.setCaret(t)):(this.hideCaret(),this.setTextAreaSelection(t,e),r=this.textarea.value,e<t&&this.constructor.isLineEnding(r,e)?this.constructor.isLineStart(r,t)&&e!==t-1?this.renderSelection(e,t-2):this.renderSelection(e,t-1):this.renderSelection(t,e)),this.trigger("select:change",t,e)),this},setTextAreaSelection:function(t,e){t=this.normalizeSelectionRange({start:t,end:e});this.textarea.focus(),this.textarea.selectionStart=t.start,this.textarea.selectionEnd=t.end},renderSelection:function(t,e){this.options.debug&&console.log("renderSelection()");t=this.normalizeSelectionRange({start:t,end:e});this.clearSelection(),this.options.useNativeSelection?(this.$viewport&&(this._viewportUserSelectBefore=this.$viewport.css("user-select"),this.$viewport.css({"-webkit-user-select":"all","-moz-user-select":"all","user-select":"all"})),e=t.end-t.start,this.selectTextInElement(this.options.text,t.start,e)):this.renderSelectionBoxes(t.start,t.end)},normalizeSelectionStartAndLength:function(t,e,n){var r=t.substr(0,e),t=t.substr(e,n),r=(e-=this.countLineBreaks(r),n-=this.countLineBreaks(t),this.countEmptyLines(r));return{start:e+=r,length:n=(n+=r)-r+this.countEmptyLines(t)}},selectTextInElement:function(e,n,r){if(d.util.isFunction(e.selectSubString)&&this.selectTextInElementUsingSelectSubString(e,n,r),!this.actualSelectionMatchesExpectedSelection(n,r))try{this.selectTextInElementUsingRanges(e,n,r)}catch(t){this.options.debug&&console.log(t),d.util.isFunction(e.selectSubString)&&this.selectTextInElementUsingSelectSubString(e,n,r)}},selectTextInElementUsingSelectSubString:function(t,e,n){e=this.normalizeSelectionStartAndLength(this.getTextContent(),e,n);try{t.selectSubString(e.start,e.length)}catch(t){this.options.debug&&console.log(t)}},selectTextInElementUsingRanges:function(t,e,n){for(var r,o,i,s=window.getSelection(),a=(s.removeAllRanges(),this.normalizeSelectionStartAndLength(this.getTextContent(),e,n)),c=(e=0+a.start,n=0+a.length,this.getTextNodesFromDomElement(t)),u=0,l=e+n,f=document.createRange();0<n&&0<c.length;)i=(o=u)+(r=c.shift()).length,(e<=o&&o<l||e<i&&i<=l||o<=e&&e<i||o<l&&l<=i)&&(o=Math.max(e-o,0),i=Math.min(o+Math.min(n,r.length),i),f.collapsed&&f.setStart(r,o),f.setEnd(r,i),n-=i-o),u+=r.length;f.collapsed||s.addRange(f)},actualSelectionMatchesExpectedSelection:function(t,e){var n=window.getSelection().toString();return this.getExpectedSelectedContent(t,e)===(n=n.replace(/\s/g," "))},getExpectedSelectedContent:function(t,e){t=this.getTextContent().substr(t,e);return t=(t=(t=(t=0===t.search(/(\n\r|\r|\n)/)?"-"+t:t).replace(/(\n\r|\r|\n){2,}/g,function(t){return Array.from({length:t.length-1},function(){return"-"}).join("")})).replace(/\n\r|\r|\n/g,"")).replace(/\s/g," ")},getTextNodesFromDomElement:function(t){for(var e=[],n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];void 0!==o.tagName?e=e.concat(this.getTextNodesFromDomElement(o)):e.push(o)}return e},renderSelectionBoxes:function(e,n){this.options.debug&&console.log("renderSelectionBoxes()"),this.$selection.empty();for(var t,r,o,i=this.getFontSize(),s=this.getTextTransforms(),a=s.rotation,c=e;c<n;c++){var u=this.$selectionBox.clone();try{o=this.getCharBBox(c)}catch(t){this.trigger("select:out-of-range",e,n);break}r&&0===a&&Math.round(o.y)===Math.round(r.y)&&Math.round(o.height)===Math.round(r.height)&&Math.round(o.x)===Math.round(r.x+r.width)?t.css({width:"+="+o.width}):(u.css({left:o.x,top:o.y-o.height,width:o.width,height:o.height,"-webkit-transform":"rotate("+a+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+a+"deg)","-moz-transform-origin":"0% 100%"}),this.$selection.append(u),t=u),r=o}o&&this.$textareaContainer.css({left:o.x,top:o.y-i*s.scaleY})},clearSelection:function(){return this.options.debug&&console.log("clearSelection()"),this.$selection.empty(),this.options.text.selectSubString&&(this.$viewport&&this._viewportUserSelectBefore&&this.$viewport.css({"-webkit-user-select":this._viewportUserSelectBefore,"-moz-user-select":this._viewportUserSelectBefore,"user-select":this._viewportUserSelectBefore}),window.getSelection().removeAllRanges()),this},deselect:function(){return this.options.debug&&console.log("deselect()"),this.stopSelecting(),this.clearSelection(),this.setTextAreaSelection(this.selection.start,this.selection.end),this},getSelectionStart:function(){return this.selection.start},getSelectionEnd:function(){return this.selection.end},getSelectionRange:function(){return this.normalizeSelectionRange(this.selection)},normalizeSelectionRange:function(t){return(t=d.util.clone(t)).start>t.end&&(t.end=[t.start,t.start=t.end][0]),t},getSelectionLength:function(){var t=this.getSelectionRange();return t.end-t.start},getSelection:function(){var t=this.getSelectionRange();return this.getTextContent().slice(t.start,t.end)},getWordBoundary:function(t){for(var e=this.textarea.value,n=/\W/,r=t;r;){if(n.test(e[r])){r+=1;break}--r}for(var o=this.getNumberOfChars(),i=t;i<o&&!n.test(e[i]);)i+=1;return r<i?[r,i]:[i,r]},getURLBoundary:function(t){for(var e=this.textarea.value,n=/\s/,r=t;-1<r;){if(n.test(e[r])){r+=1;break}--r}for(var r=Math.max(r,0),o=this.getNumberOfChars(),i=Math.max(r,t);i<=o&&!n.test(e[i]);)i+=1;if(i=Math.min(i,o),/[-a-zA-Z0-9@:%_+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_+.~#?&//=]*)?/.test(e.substring(r,i)))return[r,i]},annotateURL:function(t,e,n){var r=this.textarea.value.substring(e,n);if(!t.some(function(t){return t.url===r&&t.start===e&&t.end===n})){var o,i=this.options.urlAnnotation;if("function"==typeof i){if(!(o=i(r)))return t}else o=d.util.assign({},i);d.util.assign(o,{url:r,start:e,end:n}),t.push(o)}return t},getCharBBox:function(t){if(this.isLineEnding(t))return(e=this.getCharBBox(t-1)).x=e.x2,e.y=e.y2,e.width=this.options.newlineCharacterBBoxWidth||10,e;this.ensureTextVisibility();var e=this.realToSvgCharNum(t),t=this.options.text,n=t.getStartPositionOfChar(e),r=t.getEndPositionOfChar(e),t=t.getExtentOfChar(e),n=this.localToScreenCoordinates(n),r=this.localToScreenCoordinates(r),e=this.getTextTransforms();return{x:n.x,y:n.y,width:t.width*e.scaleX,height:t.height*e.scaleY,x2:r.x,y2:r.y}},realToSvgCharNum:function(t){for(var e=0,n=0;n<=t;n++)this.isLineEnding(n)&&(e+=1);return t-e},selectionStartToSvgCharNum:function(t){return t-this.nonEmptyLinesBefore(t)},svgToRealCharNum:function(t){for(var e=0,n=0;n<=t+e;n++)this.isLineEnding(n)&&(e+=1);return t+e},ensureTextVisibility:function(){n(this.options.text).show()},localToScreenCoordinates:function(t){return d.V.transformPoint(t,this.options.text.getCTM())},getNumberOfChars:function(){return this.getTextContent().length},getCharNumFromEvent:function(t){var e=this.options.text,e=d.V(e).toLocalPoint(t.clientX,t.clientY);return this.getCharNumAtPosition(e)},getCharNumAtPosition:function(t){this.ensureTextVisibility();var e=this.options.text,n=e.getCharNumAtPosition(t);if(n<0){var r=d.V(e).getBBox(),o=(r.inflate(-1),r.containsPoint(t));if(!o&&this.hasSelection()&&r.clone().inflate(this.options.selectAllThreshold).containsPoint(t))return this.selection.end;var o=o?t:r.pointNearestToPoint(t),i=d.V.createSVGPoint(o.x,o.y),s=e.getCharNumAtPosition(i),a=t.x>r.x;if(-1===s){var c,u=r.x,l=r.x+r.width,f=(u+l)/2;do{i.x=f;var h=e.getCharNumAtPosition(i)}while(-1<h&&(s=h),c=f,a&&-1<h||!a&&-1===h?(f=(f+l)/2,u=c):(f=(u+f)/2,l=c),1<Math.abs(c-f))}return-1<s?(o=this.svgToRealCharNum(s),a&&"\n"!==this.getTextContent()[o]?o+1:o):t.x<r.x&&t.y<r.y+r.height?0:this.getNumberOfChars()}o=this.localToScreenCoordinates(t),r=this.getCharBBox(this.svgToRealCharNum(n));return Math.abs(r.x-o.x)<Math.abs(r.x+r.width-o.x)?this.svgToRealCharNum(n):this.svgToRealCharNum(n)+1},lineNumber:function(t){t=this.textarea.value.substr(0,t);return this.countLineBreaks(t)},emptyLinesBefore:function(t){for(var e=this.textarea.value.split(/\n\r|\r|\n/g),n=0,r=this.lineNumber(t)-1;0<=r;r--)e[r]||(n+=1);return n},countLineBreaks:function(t){return(t.match(/\n\r|\r|\n/g)||[]).length},countEmptyLines:function(t){var e=(t.match(/(\n\r|\r|\n){2,}/g)||[]).reduce(function(t,e){return t+(e.length-1)},0);return 0===t.search(/(\n\r|\r|\n)/)&&e++,e},nonEmptyLinesBefore:function(t){return this.lineNumber(t)-this.emptyLinesBefore(t)},isEmptyLine:function(t){return!this.textarea.value.split(/\n\r|\r|\n/g)[t]},isEmptyLineUnderSelection:function(t){t=this.lineNumber(t);return this.isEmptyLine(t)},isLineEnding:function(t){return this.constructor.isLineEnding(this.textarea.value,t)},getTextTransforms:function(){var t=this.options.text.getCTM();return d.V.decomposeMatrix(t)},getFontSize:function(){var t=this.DEFAULT_FONT_SIZE,e=this.options,e=parseFloat(e.text.getAttribute("font-size"));return Number.isNaN(e)?t:e},getFontFill:function(){return this.options.text.getAttribute("fill")||""},getTextAnchor:function(){return this.options.text.getAttribute("text-anchor")||""},getCaretAttrs:function(t){var e=this.getAnnotations()||[],n=this._currentAnnotationAttributes;return 0!==e.length||n?(e=Ks([].concat(F(e),[{attrs:n}]),t-1),n=parseFloat(e["font-size"]),t=e.fill,{"font-size":Number.isNaN(n)?this.getFontSize():n,fill:t||this.getFontFill()}):{"font-size":this.getFontSize(),fill:this.getFontFill()}},setCaret:function(t,e){this.ensureTextVisibility(),d.util.isObject(t)&&(e=t,t=void 0),e=e||{};var n=this.getNumberOfChars(),r=this.selection.start;return void 0!==t&&(t=Math.min(Math.max(t,0),n),r=this.selection.start=this.selection.end=t),e.silent||this.trigger("caret:change",r),this.options.debug&&console.log("setCaret(",t,e,")","selectionStart",r,"isLineEnding",this.isLineEnding(r),"isEmptyLineUnderSelection",this.isEmptyLineUnderSelection(r),"svgCharNum",this.selectionStartToSvgCharNum(r),"nonEmptyLinesBefore",this.nonEmptyLinesBefore(r)),this.updateCaret(),this.setTextAreaSelection(r,r),this.focus(),this},updateCaret:function(){var t=this.$caret,e=this.$textareaContainer,n=this.selection,r=this.options,o=this.textarea,n=n.start,i=r.text,r=r.placeholder,s=this.getNumberOfChars();try{var a=this.isEmptyLineUnderSelection(n)||!this.isLineEnding(n)&&o.value.length!==n?(c=this.selectionStartToSvgCharNum(n),i.getStartPositionOfChar(c)):(c=this.selectionStartToSvgCharNum(n)-1,i.getEndPositionOfChar(c))}catch(t){this.trigger("caret:out-of-range",n),a={x:0,y:0}}var o=this.localToScreenCoordinates(a),i=o.x,c=o.y,a=this.getTextTransforms(),o=a.rotation,a=a.scaleY,n=this.getCaretAttrs(n),a=n["font-size"]*a,n=n.fill;r&&(t.attr("data-placeholder-text","string"==typeof r?r:"Enter text..."),t.toggleClass("placeholder",0===s)),t.css({left:i,top:c-a,height:a,"line-height":"".concat(a,"px"),"font-size":"".concat(a,"px"),"-webkit-transform":"rotate(".concat(o,"deg)"),"-webkit-transform-origin":"0% 100%","-moz-transform":"rotate(".concat(o,"deg)"),"-moz-transform-origin":"0% 100%","background-color":n}).attr({"text-anchor":this.getTextAnchor()}).show(),e.css({left:i,top:c-a})},focus:function(){return this.options.debug&&console.log("focus()"),this.showCaret(),this},blur:function(){return this.options.debug&&console.log("blur()"),this.hideCaret(),this},showCaret:function(){return this.options.debug&&console.log("showCaret()"),this.$caret.show(),this},hideCaret:function(){return this.options.debug&&console.log("hideCaret()"),this.$caret.hide(),this},onRemove:function(){var t=this.options,e=t.text,t=t.cellView,t=void 0===t?null:t;this.deselect(),this.unbindTextElement(),document.removeEventListener("pointerdown",this.onDocumentPointerdown,{capture:!0}),n(document.body).off("mousemove",this.onMousemove),n(document.body).off("mouseup",this.onMouseup),n(document.body).off("keydown",this.onKeydown),d.V(e).attr("cursor",this._textCursor),this.trigger("close",e,t)},onDocumentPointerdown:function(t){var e=this.options,n=e.text,e=e.onOutsidePointerdown,r=t.target;n===r||n.contains(r)||"function"==typeof e&&e.call(this,t,this)},onKeydown:function(t){this.options.debug&&console.log("onKeydown(): ",t.keyCode);var e=this.options.onKeydown;"function"==typeof e&&(e.call(this,t,this),t.isPropagationStopped())||this.isModifierKey(t)||(this.hasSelection()&&(this.deselect(),this.restoreTextAreaSelectionDirection()),setTimeout(this.onAfterKeydown,this.AFTER_KEYDOWN_DELAY),this._copied=!1,this._selectionStartBeforeInput=this.textarea.selectionStart,this._selectionEndBeforeInput=this.textarea.selectionEnd)},onAfterKeydown:function(){this.textarea===document.activeElement&&(this.storeSelectionDirection(),this.setCurrentAnnotation(null),this.updateSelectionFromTextarea())},onKeyup:function(t){this.textContentHasChanged()&&this.onInput(t),this.textSelectionHasChanged()&&!this.isArrowKey(t)&&(t=this.textarea).selectionEnd!==t.selectionStart&&this.updateSelectionFromTextarea()},onCopy:function(t){this._copied||this.copyToClipboard()},onCut:function(t){this._copied||this.copyToClipboard()},onInput:function(t){var e,n,r,o,i,s;this.textContentHasChanged()&&(e=this.textarea.value.length-this._textareaValueBeforeInput.length,n={start:this._selectionStartBeforeInput,end:this._selectionEndBeforeInput},r={start:this.textarea.selectionStart,end:this.textarea.selectionEnd},this.options.debug&&console.log("onInput()",t,"selectionBeforeInput",n,"selectionAfterInput",r,"diffLength",e),t=this.inferTextOperationType(n,r,e),o=!1,i=this.getAnnotations(),this.options.annotateUrls&&"insert"===t&&(s=this.textarea.value.substr(n.start,e),this.options.debug&&console.log("onInput()","inserted text",s),/\s/.test(s)&&(o=this.annotateURLBeforeCaret(n.start))&&(i=this.shiftAnnotations(i,r.end,e))),i&&(o||(i=this.annotate(i,n,r,e)),this.options.debug&&console.log("onInput()","modified annotations",i),this._currentAnnotationAttributes&&"insert"===t&&(s={start:n.start,end:r.end,attrs:this._currentAnnotationAttributes},i.push(s),this.setCurrentAnnotation(null),this.options.debug&&console.log("onInput()","insert annotation",s,"final annotations",i))),this._annotations=i,this.trigger("text:change",this.textarea.value,this._textareaValueBeforeInput,i,n,r),this._selectionBeforeInput=r,this._textareaValueBeforeInput=this.textarea.value,this._textContent=this.textarea.value)},onPaste:function(t){this.options.debug&&console.log("onPaste()"),this._textareaValueBeforeInput=this.textarea.value,setTimeout(this.onAfterPaste,0)},onAfterPaste:function(){this.setCaret(this.textarea.selectionStart)},onMousedown:function(t){var e;3!==t.originalEvent.detail&&(this.options.debug&&console.log("onMousedown()"),e=this.getCharNumFromEvent(t),this.startSelecting(),this.select(e),t.preventDefault(),t.stopPropagation())},onMousemove:function(t){var e;this.selectionInProgress()&&(this.options.debug&&console.log("onMousemove()"),e=this.getCharNumFromEvent(t),this.storeSelectionDirection(),this.select(null,e),t.preventDefault(),t.stopPropagation())},onMouseup:function(t){this.selectionInProgress()&&(this.options.debug&&console.log("onMouseup()"),this.stopSelecting(),this.trigger("select:changed",this.selection.start,this.selection.end))},onDoubleClick:function(t){this.options.debug&&console.log("onDoubleClick()");var e=this.getCharNumFromEvent(t),e=this.getWordBoundary(e);this.select(e[0],e[1]),t.preventDefault(),t.stopPropagation()},onTripleClick:function(t){3===t.originalEvent.detail&&(this.options.debug&&console.log("onTripleClick()"),this.hideCaret(),this.selectAll(),t.preventDefault(),t.stopPropagation())}},d.util.assign({getTextElement:function(t){var e=t.tagName.toUpperCase();if("TEXT"===e||"TSPAN"===e||"TEXTPATH"===e)return"TEXT"===e?t:this.getTextElement(t.parentNode)},edit:function(t,e){var r,n,o=this,i=!1!==(e=e||{}).update,s=(this.options=d.util.assign({},e,{update:i}),this.getTextElement(t));if(s)return this.close(),this.ed=new Hs(d.util.assign({text:s},e)),this.ed.on("all",this.trigger,this),t=e.cellView,this.trigger("open",s,r=void 0===t?null:t),r?(n=r.paper.el,this.cellViewUnderEdit=r,this.cellViewUnderEditInteractiveOption=this.cellViewUnderEdit.options.interactive,this.cellViewUnderEdit.options.interactive=!1,e.annotationsProperty&&!this.ed.getAnnotations()&&(t=this.cellViewUnderEdit.model.prop(e.annotationsProperty))&&this.ed.setAnnotations(Ws(t))):n=d.V(s).svg().parentNode,i&&this.ed.on("text:change",function(t,e,n){r?o.updateCellView(r,t,n):o.updateSVGTextNode(s,t,n)}),this.ed.render(n),this;this.options.debug&&console.log("ui.TextEditor: cannot find a text element.")},updateCellView:function(t,e,n){var r=this.options,o=r.textProperty,r=r.annotationsProperty,i=this.ed.cid,t=t.model;o&&t.prop(o,e,{textEditor:i,async:!1}),r&&t.prop(r,Ws(n),{rewrite:!0,textEditor:i,async:!1})},updateSVGTextNode:function(t,e,n){d.V(t).text(e,{annotations:n})},close:function(){var t;this.ed&&(this.ed.options.annotateUrls&&(t=this.ed.getSelectionStart(),this.findAnnotationsUnderCursor().find(function(t){return!!t.url&&t})||this.ed.annotateURLBeforeCaret(t)&&this.applyAnnotations(this.getAnnotations())),this.ed.remove(),this.cellViewUnderEdit&&(this.cellViewUnderEdit.options.interactive=this.cellViewUnderEditInteractiveOption),this.ed=this.cellViewUnderEdit=this.cellViewUnderEditInteractiveOption=void 0)},applyAnnotations:function(t){var e=this.options,n=this.ed;n&&e.update&&(e.cellView&&e.annotationsProperty?(e.cellView.model.prop(e.annotationsProperty,Ws(t),{rewrite:!0,textEditor:n.cid}),n.setAnnotations(t)):d.V(n.options.text).text(n.getTextContent(),{annotations:t}),e=this.getSelectionRange(),0<this.getSelectionLength()?n.select(e.start,e.end):n.setCaret())},proxy:function(t,e){var n=this.ed;if(n)return n[t].apply(n,e)},isEmptyLine:function(t,e){var n=t[e-1],r=t[e];return 0===e&&"\n"===r||("\n"===r&&"\n"===n||e===t.length&&"\n"===n)},isLineEnding:function(t,e){return"\n"===t[e]&&0<e&&"\n"!==t[e-1]},isLineStart:function(t,e){return"\n"!==t[e]&&(0===e||"\n"===t[e-1])},getCombinedAnnotationAttrsAtIndex:Ks,getCombinedAnnotationAttrsBetweenIndexes:Ys,normalizeAnnotations:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=e.compare,r=void 0===n?Vs:n,o=[],i=-1,s=t.reduce(function(t,e){e=e.end;return void 0===e?t:Math.max(t,e)},0);i<s;i++){for(var a=null,c=i+1;c<=s;c++){var u=Ys(t,c-1,c,e);a?r(u,a)||(c--,$s(a)||o.push({start:i,end:c,attrs:a}),a=null,i=c):a=u}if(a){i<s&&!$s(a)&&o.push({start:i,end:s,attrs:a});break}}return o}},B.Events));function Ws(t){try{return JSON.parse(JSON.stringify(t))}catch(t){}}Hs.findAnnotationsUnderCursor=function(){var t=this.ed;return t?this.proxy("findAnnotationsUnderCursor",[t.getAnnotations(),t.getSelectionStart()]):null},Hs.findAnnotationsInSelection=function(){var t,e,n=this.ed;return n?(t=(e=n.getSelectionRange()).start,e=e.end,this.proxy("findAnnotationsInSelection",[n.getAnnotations(),t,e])):null},Hs.getSelectionAttrs=function(t){var e=this.ed;return e?this.proxy("getSelectionAttrs",[e.getSelectionRange(),t]):null},["setCurrentAnnotation","getAnnotations","setCaret","deselect","selectAll","select","getNumberOfChars","getCharNumFromEvent","getWordBoundary","getSelectionLength","getSelectionRange"].forEach(function(t){Hs[t]=function(){return this.proxy(t,arguments)}}),k.TextEditor=Hs}(this.joint.ui=this.joint.ui||{},$,Backbone,joint);