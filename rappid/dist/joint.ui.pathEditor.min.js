/*! JointJS+ v3.6.3 - HTML5 Diagramming Framework

Copyright (c) 2022 client IO

 2022-12-09 


This Source Code Form is subject to the terms of the JointJS+ License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(N,c,j){"use strict";c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function R(t,e){return t(e={exports:{}},e.exports),e.exports}function z(t){return t&&t.Math==Math&&t}function u(t){try{return!!t()}catch(t){return!0}}function F(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function V(t){return x?nt(t):function(){return et.apply(t,arguments)}}function e(t){if("Function"===f(t))return V(t)}function Z(t){if(ct(t))throw ut("Can't call method on "+t);return t}function h(t){return st(Z(t))}function n(t,e){return arguments.length<2?(n=y[t],d(n)?n:void 0):y[t]&&y[t][e];var n}function G(t){return jt(Z(t))}function X(t){return"Symbol("+(void 0===t?"":t)+")_"+Lt(++kt+Ot,36)}function o(t){var e;return b(w,t)&&(ft||"string"==typeof w[t])||(e="Symbol."+t,ft&&b(E,t)?w[t]=E[t]:w[t]=(dt&&Mt?Mt:At)(e)),w[t]}function $(t){return t=function(t,e){if(!m(t)||yt(t))return t;var n=bt(t,Dt);if(n){if(n=p(n,t,e=void 0===e?"default":e),!m(n)||yt(n))return n;throw It("Can't convert object to primitive value")}return wt(t,e=void 0===e?"number":e)}(t,"string"),yt(t)?t:t+""}function Y(t){return Qt[t]||(Qt[t]=X(t))}function H(t,e,n,o){var r=(o=o||{}).enumerable,i=void 0!==o.name?o.name:e;if(d(n)&&ie(n,i,o),o.global)r?t[e]=n:Ct(e,n);else{try{o.unsafe?t[e]&&(r=!0):delete t[e]}catch(t){}r?t[e]=n:k.f(t,e,{value:n,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}}function U(t){return pe(t.length)}function B(s){return function(t,e,n){var o,r=h(t),i=U(r),a=function(t,e){t=ue(t);return t<0?he(t+e,0):le(t,e)}(n,i);if(s&&e!=e){for(;a<i;)if((o=r[a++])!=o)return!0}else for(;a<i;a++)if((s||a in r)&&r[a]===e)return s||a||0;return!s&&-1}}function W(t,e){var n,o=h(t),r=0,i=[];for(n in o)!b(te,n)&&b(o,n)&&de(i,n);for(;e.length>r;)!b(o,n=e[r++])||~fe(i,n)||de(i,n);return i}function r(t,e){return(t=Ee[we(t)])==je||t!=Ce&&(d(e)?u(e):!!e)}function i(t,e){var n,o,r,i=t.target,a=t.global,s=t.stat,c=a?y:s?y[i]||Ct(i,{}):(y[i]||{}).prototype;if(c)for(n in e){if(o=e[n],r=t.dontCallGetSet?(r=ke(c,n))&&r.value:c[n],!Te(a?n:i+(s?".":"#")+n,t.forced)&&void 0!==r){if(typeof o==typeof r)continue;for(var u=o,h=r,l=m=d=f=p=g=void 0,g=be(h),p=k.f,f=Vt.f,d=0;d<g.length;d++){var m=g[d];b(u,m)||l&&b(l,m)||p(u,m,f(h,m))}}(t.sham||r&&r.sham)&&Wt(o,"sham",!0),H(c,n,o,t)}}function q(t,e){var n=[][t];return!!n&&u(function(){n.call(null,e||function(){return 1},1)})}var K,a,s,l,y=z("object"==typeof globalThis&&globalThis)||z("object"==typeof window&&window)||z("object"==typeof self&&self)||z("object"==typeof t&&t)||function(){return this}()||Function("return this")(),g=!u(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),x=!u(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}),J=Function.prototype.call,p=x?J.bind(J):function(){return J.apply(J,arguments)},t={}.propertyIsEnumerable,Q=Object.getOwnPropertyDescriptor,tt={f:Q&&!t.call({1:2},1)?function(t){t=Q(this,t);return!!t&&t.enumerable}:t},t=Function.prototype,et=t.call,nt=x&&t.bind.bind(et,et),ot=V({}.toString),rt=V("".slice),f=function(t){return rt(ot(t),8,-1)},it=Object,at=e("".split),st=u(function(){return!it("z").propertyIsEnumerable(0)})?function(t){return"String"==f(t)?at(t,""):it(t)}:it,ct=function(t){return null==t},ut=TypeError,t="object"==typeof document&&document.all,t={all:t,IS_HTMLDDA:void 0===t&&void 0!==t},ht=t.all,d=t.IS_HTMLDDA?function(t){return"function"==typeof t||t===ht}:function(t){return"function"==typeof t},lt=t.all,m=t.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:d(t)||t===lt}:function(t){return"object"==typeof t?null!==t:d(t)},gt=e({}.isPrototypeOf),t=n("navigator","userAgent")||"",v=y.process,P=y.Deno,v=v&&v.versions||P&&P.version,P=v&&v.v8,pt=O=!(O=P?0<(C=P.split("."))[0]&&C[0]<4?1:+(C[0]+C[1]):O)&&t&&(!(C=t.match(/Edge\/(\d+)/))||74<=C[1])&&(C=t.match(/Chrome\/(\d+)/))?+C[1]:O,ft=!!Object.getOwnPropertySymbols&&!u(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&pt&&pt<41}),dt=ft&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,mt=Object,yt=dt?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return d(e)&&gt(e.prototype,mt(t))},vt=String,Pt=TypeError,St=function(t){if(d(t))return t;throw Pt(function(t){try{return vt(t)}catch(t){return"Object"}}(t)+" is not a function")},bt=function(t,e){t=t[e];return ct(t)?void 0:St(t)},xt=TypeError,wt=function(t,e){var n,o;if("string"===e&&d(n=t.toString)&&!m(o=p(n,t)))return o;if(d(n=t.valueOf)&&!m(o=p(n,t)))return o;if("string"!==e&&d(n=t.toString)&&!m(o=p(n,t)))return o;throw xt("Can't convert object to primitive value")},Et=Object.defineProperty,Ct=function(e,n){try{Et(y,e,{value:n,configurable:!0,writable:!0})}catch(t){y[e]=n}return n},v="__core-js_shared__",S=y[v]||Ct(v,{}),P=R(function(t){(t.exports=function(t,e){return S[t]||(S[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})}),jt=Object,Tt=e({}.hasOwnProperty),b=Object.hasOwn||function(t,e){return Tt(G(t),e)},kt=0,Ot=Math.random(),Lt=e(1..toString),w=P("wks"),E=y.Symbol,Mt=E&&E.for,At=dt?E:E&&E.withoutSetter||X,It=TypeError,Dt=o("toPrimitive"),_t=y.document,Nt=m(_t)&&m(_t.createElement),Rt=function(t){return Nt?_t.createElement(t):{}},zt=!g&&!u(function(){return 7!=Object.defineProperty(Rt("div"),"a",{get:function(){return 7}}).a}),Ft=Object.getOwnPropertyDescriptor,Vt={f:g?Ft:function(t,e){if(t=h(t),e=$(e),zt)try{return Ft(t,e)}catch(t){}if(b(t,e))return F(!p(tt.f,t,e),t[e])}},C=g&&u(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Zt=String,Gt=TypeError,T=function(t){if(m(t))return t;throw Gt(Zt(t)+" is not an object")},Xt=TypeError,$t=Object.defineProperty,Yt=Object.getOwnPropertyDescriptor,Ht="enumerable",Ut="configurable",Bt="writable",k={f:g?C?function(t,e,n){var o;return T(t),e=$(e),T(n),"function"==typeof t&&"prototype"===e&&"value"in n&&Bt in n&&!n[Bt]&&((o=Yt(t,e))&&o[Bt]&&(t[e]=n.value,n={configurable:(Ut in n?n:o)[Ut],enumerable:(Ht in n?n:o)[Ht],writable:!1})),$t(t,e,n)}:$t:function(t,e,n){if(T(t),e=$(e),T(n),zt)try{return $t(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Xt("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},Wt=g?function(t,e,n){return k.f(t,e,F(1,n))}:function(t,e,n){return t[e]=n,t},O=Function.prototype,v=g&&Object.getOwnPropertyDescriptor,L=b(O,"name"),qt={EXISTS:L,PROPER:L&&"something"===function(){}.name,CONFIGURABLE:L&&(!g||v(O,"name").configurable)},Kt=e(Function.toString),Jt=(d(S.inspectSource)||(S.inspectSource=function(t){return Kt(t)}),S.inspectSource),L=y.WeakMap,v=d(L)&&/native code/.test(String(L)),Qt=P("keys"),te={},ee="Object already initialized",ne=y.TypeError,O=y.WeakMap,oe=v||S.state?((s=S.state||(S.state=new O)).get=s.get,s.has=s.has,s.set=s.set,K=function(t,e){if(s.has(t))throw ne(ee);return e.facade=t,s.set(t,e),e},a=function(t){return s.get(t)||{}},function(t){return s.has(t)}):(l=Y("state"),te[l]=!0,K=function(t,e){if(b(t,l))throw ne(ee);return e.facade=t,Wt(t,l,e),e},a=function(t){return b(t,l)?t[l]:{}},function(t){return b(t,l)}),re={set:K,get:a,has:oe,enforce:function(t){return oe(t)?a(t):K(t,{})},getterFor:function(e){return function(t){if(m(t)&&(t=a(t)).type===e)return t;throw ne("Incompatible receiver, "+e+" required")}}},ie=R(function(t){var o=qt.CONFIGURABLE,r=re.enforce,e=re.get,i=Object.defineProperty,a=g&&!u(function(){return 8!==i(function(){},"length",{value:8}).length}),s=String(String).split("String"),t=t.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!b(t,"name")||o&&t.name!==e)&&(g?i(t,"name",{value:e,configurable:!0}):t.name=e),a&&n&&b(n,"arity")&&t.length!==n.arity&&i(t,"length",{value:n.arity});try{n&&b(n,"constructor")&&n.constructor?g&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}n=r(t);return b(n,"source")||(n.source=s.join("string"==typeof e?e:"")),t};Function.prototype.toString=t(function(){return d(this)&&e(this).source||Jt(this)},"toString")}),ae=Math.ceil,se=Math.floor,ce=Math.trunc||function(t){t=+t;return(0<t?se:ae)(t)},ue=function(t){t=+t;return t!=t||0==t?0:ce(t)},he=Math.max,le=Math.min,ge=Math.min,pe=function(t){return 0<t?ge(ue(t),9007199254740991):0},L={includes:B(!0),indexOf:B(!1)},fe=L.indexOf,de=e([].push),me=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ye=me.concat("length","prototype"),ve={f:Object.getOwnPropertyNames||function(t){return W(t,ye)}},Pe={f:Object.getOwnPropertySymbols},Se=e([].concat),be=n("Reflect","ownKeys")||function(t){var e=ve.f(T(t)),n=Pe.f;return n?Se(e,n(t)):e},xe=/#|\.prototype\./,we=r.normalize=function(t){return String(t).replace(xe,".").toLowerCase()},Ee=r.data={},Ce=r.NATIVE="N",je=r.POLYFILL="P",Te=r,ke=Vt.f,Oe=e([].join),P=st!=Object,v=q("join",","),O=(i({target:"Array",proto:!0,forced:P||!v},{join:function(t){return Oe(h(this),void 0===t?",":t)}}),Date.prototype),Le="Invalid Date",P="toString",Me=e(O[P]),Ae=e(O.getTime);String(new Date(NaN))!=Le&&H(O,P,function(){var t=Ae(this);return t==t?Me(this):Le});function M(t){if("Symbol"===Ge(t))throw TypeError("Cannot convert a Symbol value to a string");return Xe(t)}function Ie(){var t=T(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}function De(){}function A(t){if(!d(t))return!1;try{return We(De,Be,t),!0}catch(t){return!1}}function _e(t){if(!d(t))return!1;switch(Ge(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Je||!!Ke(qe,Jt(t))}catch(t){return!0}}function Ne(t,e){return new(nn(t))(0===e?0:e)}function I(f){var d=1==f,m=2==f,y=3==f,v=4==f,P=6==f,S=7==f,b=5==f||P;return function(t,e,n,o){for(var r,i,a,s,c=G(t),u=st(c),h=(i=n,St(r=e),void 0===i?r:x?He(r,i):function(){return r.apply(i,arguments)}),l=U(u),g=0,n=o||Ne,p=d?n(t,l):m||S?n(t,0):void 0;g<l;g++)if((b||g in u)&&(s=h(a=u[g],g,c),f))if(d)p[g]=s;else if(s)switch(f){case 3:return!0;case 5:return a;case 6:return g;case 2:on(p,a)}else switch(f){case 4:return!1;case 7:on(p,a)}return P?-1:y||v?v:p}}function Re(e){if(e&&e.forEach!==D)try{Wt(e,"forEach",D)}catch(t){e.forEach=D}}var ze,v={},O=(v[o("toStringTag")]="z","[object z]"===String(v)),Fe=o("toStringTag"),Ve=Object,Ze="Arguments"==f(function(){return arguments}()),Ge=O?f:function(t){var e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Ve(t),Fe))?e:Ze?f(t):"Object"==(e=f(t))&&d(t.callee)?"Arguments":e},Xe=(O||H(Object.prototype,"toString",O?{}.toString:function(){return"[object "+Ge(this)+"]"},{unsafe:!0}),String),$e=RegExp.prototype,P=qt.PROPER,v="toString",Ye=RegExp.prototype[v],O=u(function(){return"/a/b"!=Ye.call({source:"a",flags:"b"})}),P=P&&Ye.name!=v,He=((O||P)&&H(RegExp.prototype,v,function(){var t,e=T(this);return"/"+M(e.source)+"/"+M(void 0!==(t=(e=e).flags)||"flags"in $e||b(e,"flags")||!gt($e,e)?t:p(Ie,e))},{unsafe:!0}),e(e.bind)),Ue=Array.isArray||function(t){return"Array"==f(t)},Be=[],We=n("Reflect","construct"),qe=/^\s*(?:class|function)\b/,Ke=e(qe.exec),Je=!qe.exec(De),Qe=(_e.sham=!0,!We||u(function(){var t;return A(A.call)||!A(Object)||!A(function(){t=!0})||t})?_e:A),tn=o("species"),en=Array,nn=function(t){var e;return Ue(t)&&(e=t.constructor,(Qe(e)&&(e===en||Ue(e.prototype))||m(e)&&null===(e=e[tn]))&&(e=void 0)),void 0===e?en:e},on=e([].push),rn={forEach:I(0),map:I(1),filter:I(2),some:I(3),every:I(4),find:I(5),findIndex:I(6),filterReject:I(7)}.forEach,D=q("forEach")?[].forEach:function(t){return rn(this,t,1<arguments.length?arguments[1]:void 0)},an=(i({target:"Array",proto:!0,forced:[].forEach!=D},{forEach:D}),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),O=Rt("span").classList,P=O&&O.constructor&&O.constructor.prototype,v=P===Object.prototype?void 0:P;for(ze in an)an[ze]&&Re(y[ze]&&y[ze].prototype);Re(v);function sn(e){return function(t){t=M(Z(t));return 1&e&&(t=pn(t,fn,"")),t=2&e?pn(t,dn,""):t}}function cn(){}function un(t){t.write(jn("")),t.close();var e=t.parentWindow.Object;return t=null,e}function hn(t){if(m(e=t)&&(void 0!==(n=e[On])?!!n:"RegExp"==f(e)))throw Ln("The method doesn't accept regular expressions");var e,n;return t}function ln(i){return zn?function(t,e){var n=2<function(t,e){if(t<e)throw Rn("Not enough arguments");return t}(arguments.length,1),o=d(t)?t:Fn(t),r=n?Nn(arguments,2):void 0;return i(n?function(){_n(o,this,r)}:o,e)}:i}var gn,O="\t\n\v\f\r                　\u2028\u2029\ufeff",pn=e("".replace),P="["+O+"]",fn=RegExp("^"+P+P+"*"),dn=RegExp(P+P+"*$"),mn={start:sn(1),end:sn(2),trim:sn(3)}.trim,_=y.parseInt,v=y.Symbol,yn=v&&v.iterator,vn=/^[+-]?0x/i,Pn=e(vn.exec),P=8!==_(O+"08")||22!==_(O+"0x16")||yn&&!u(function(){_(Object(yn))})?function(t,e){t=mn(M(t));return _(t,e>>>0||(Pn(vn,t)?16:10))}:_,Sn=(i({global:!0,forced:parseInt!=P},{parseInt:P}),i({target:"Array",stat:!0},{isArray:Ue}),Object.keys||function(t){return W(t,me)}),bn={f:g&&!C?Object.defineProperties:function(t,e){T(t);for(var n,o=h(e),r=Sn(e),i=r.length,a=0;a<i;)k.f(t,n=r[a++],o[n]);return t}},xn=n("document","documentElement"),wn="prototype",En="script",Cn=Y("IE_PROTO"),jn=function(t){return"<"+En+">"+t+"</"+En+">"},Tn=function(){try{gn=new ActiveXObject("htmlfile")}catch(t){}Tn="undefined"==typeof document||document.domain&&gn?un(gn):(t=Rt("iframe"),e="java"+En+":",t.style.display="none",xn.appendChild(t),t.src=String(e),(e=t.contentWindow.document).open(),e.write(jn("document.F=Object")),e.close(),e.F);for(var t,e,n=me.length;n--;)delete Tn[wn][me[n]];return Tn()},v=(te[Cn]=!0,Object.create||function(t,e){var n;return null!==t?(cn[wn]=T(t),n=new cn,cn[wn]=null,n[Cn]=t):n=Tn(),void 0===e?n:bn.f(n,e)}),O=k.f,P=o("unscopables"),C=Array.prototype,kn=(null==C[P]&&O(C,P,{configurable:!0,value:v(null)}),L.includes),On=(i({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return kn(this,t,1<arguments.length?arguments[1]:void 0)}}),C[P].includes=!0,o("match")),Ln=TypeError,Mn=o("match"),An=e("".indexOf),O=(i({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Mn]=!1,"/./"[e](n)}catch(t){}}return!1}("includes")},{includes:function(t){return!!~An(M(Z(this)),M(hn(t)),1<arguments.length?arguments[1]:void 0)}}),Function.prototype),In=O.apply,Dn=O.call,_n="object"==typeof Reflect&&Reflect.apply||(x?Dn.bind(In):function(){return Dn.apply(In,arguments)}),Nn=e([].slice),Rn=TypeError,zn=/MSIE .\./.test(t),Fn=y.Function,v={setTimeout:ln(y.setTimeout),setInterval:ln(y.setInterval)},L=v.setInterval,C=(i({global:!0,bind:!0,forced:y.setInterval!==L},{setInterval:L}),v.setTimeout),P=(i({global:!0,bind:!0,forced:y.setTimeout!==C},{setTimeout:C}),j.mvc.View.extend({tagName:"g",svgElement:!0,className:"path-editor",events:{"mousedown .anchor-point":"onAnchorPointPointerDown","mousedown .control-point":"onControlPointPointerDown","mousedown .segment-path":"onSegmentPathPointerDown","touchstart .anchor-point":"onAnchorPointPointerDown","touchstart .control-point":"onControlPointPointerDown","touchstart .segment-path":"onSegmentPathPointerDown","dblclick .anchor-point":"onAnchorPointDoubleClick","dblclick .control-point":"onControlPointDoubleClick","dblclick .segment-path":"onSegmentPathDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{anchorPointMarkup:'<circle r="2.5"/>',controlPointMarkup:'<circle r="2.5"/>'},init:function(){var t=this.pathNode=j.V(this.options.pathElement).normalizePath().node;this.path=j.g.Path.parse(this.options.pathElement.getAttribute("d")),this.svgRoot=j.V(t.ownerSVGElement),this.$document=c(t.ownerDocument),this.render()},onRemove:function(){this.undelegateDocumentEvents(),this.clear()},clear:function(){this.vel.empty(),this.directionPaths=[],this.segmentPaths=[],this.segmentPathElements=[],this.controlPoints=[],this.anchorPoints=[],this._subPathIndices=[0],this.trigger("clear",this.pathNode)},_transformPoint:function(t,e,n){return j.V.transformPoint(new j.g.Point(t,e),n)},_getPathCTM:function(){return this.pathNode.getCTM()},render:function(){this.clear();for(var t=this.path,e=this.vel,n=this.anchorPoints,o=this.controlPoints,r=this.directionPaths,i=this.segmentPaths,a=this.segmentPathElements,s=this._getPathCTM(),c=j.V(this.options.anchorPointMarkup).addClass("anchor-point"),u=j.V(this.options.controlPointMarkup).addClass("control-point"),h=j.V('<path class="direction-path"/>'),l=j.V('<path class="segment-path"/>'),g=this._subPathIndices,p=0,f=0,d=0;p<t.segments.length;p++){var m=t.getSegment(p),y=this._transformPoint(m.end.x,m.end.y,s),v=y.x,P=y.y;if("Z"!==m.type&&(n[p]=c.clone().attr({index:p,cx:v,cy:P})),"M"!==m.type){var S=new j.g.Path;switch(S.appendSegment(new j.g.Path.createSegment("M",f,d)),m.type){case"Z":var b=t.getSegment(g[0]),b=this._transformPoint(b.end.x,b.end.y,s),v=b.x,P=b.y;S.appendSegment(new j.g.Path.createSegment("L",v,P)),g.unshift(p+1);break;case"L":S.appendSegment(new j.g.Path.createSegment("L",v,P));break;case"C":var b=this._transformPoint(m.controlPoint1.x,m.controlPoint1.y,s),x=u.clone().attr({index:p,"attribute-index":1,cx:b.x,cy:b.y}),w=this._transformPoint(m.controlPoint2.x,m.controlPoint2.y,s),E=u.clone().attr({index:p,"attribute-index":2,cx:w.x,cy:w.y});o[p]=[x,E],S.appendSegment(new j.g.Path.createSegment("C",b.x,b.y,w.x,w.y,v,P)),r[p]=[h.clone().attr("d",["M",f,d,"L",b.x,b.y].join(" ")),h.clone().attr("d",["M",v,P,"L",w.x,w.y].join(" "))]}i[p]=S;y=l.clone().attr("index",p).node;y.setAttribute("d",S.toString()),a[p]=y}f=v,d=P}var C=[];a.forEach(function(t){t&&C.push(t)}),r.forEach(function(t){t&&Array.prototype.push.apply(C,t)}),n.forEach(function(t){t&&C.push(t)}),o.forEach(function(t){t&&Array.prototype.push.apply(C,t)}),e.append(C),this.svgRoot.append(e)},startMoving:function(t){var t=j.util.normalizeEvent(t),e=this.$point=c(t.target),n=(this.prevClientX=t.clientX,this.prevClientY=t.clientY,parseInt(this.$point.attr("index"),10));this.trigger("path:interact"),e.hasClass("anchor-point")?this.trigger("path:anchor-point:select",n):e.hasClass("control-point")?(e=parseInt(this.$point.attr("attribute-index"),10),this.trigger("path:control-point:select",n,e)):this.trigger("path:segment:select",n),t.stopPropagation(),t.preventDefault(),this.index=void 0,this.controlPointIndex=void 0,this.segPoint=void 0,this.pathEditedEventType=void 0},move:function(t){var e,n,o,r=this.$point;r&&(e=(t=j.util.normalizeEvent(t)).clientX-this.prevClientX,n=t.clientY-this.prevClientY,o=parseInt(r.attr("index"),10),r.hasClass("anchor-point")?this.adjustAnchorPoint(o,e,n,t):r.hasClass("control-point")?(r=parseInt(r.attr("attribute-index"),10),this.adjustControlPoint(o,r,e,n,t)):this.adjustSegment(o,e,n,t),this.prevClientX=t.clientX,this.prevClientY=t.clientY)},adjustSegment:function(t,e,n,o){var r=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:{}).dry,r=void 0===r?void 0:r;this.adjustAnchorPoint(t-1,e,n,{dry:!0}),this.adjustAnchorPoint(t,e,n,{dry:!0}),r||(this.pathEditedEventType="path:segment:adjust",this.index=t,this.trigger("path:editing",this.pathNode,o),this.trigger("path:segment:adjusting",this.pathNode,o,{index:t}))},adjustControlPoint:function(t,e,n,o,r){var i,a,s,c=(5<arguments.length&&void 0!==arguments[5]?arguments[5]:{}).dry,c=void 0===c?void 0:c,u=this._getPathCTM(),h=this.path,l=this.controlPoints,g=h.getSegment(t),p=u.inverse(),n=(p.e=0,p.f=0,this._transformPoint(n,o,p)),o="controlPoint"+e,p=(g[o].x+=n.x,g[o].y+=n.y,this._transformPoint(g[o].x,g[o].y,u)),n=new j.g.Point(p);l[t][e-1].attr({cx:p.x,cy:p.y}).hasClass("locked")&&(p=this.getBoundIndex(t,e),i=1===e?2:1,h=h.getSegment(p),a="controlPoint"+i,s=new j.g.Point((1===e?h:g).end.x,(1===e?h:g).end.y),g=new j.g.Point(g[o].x,g[o].y),o=s.distance(new j.g.Point(h[a].x,h[a].y)),s=s.move(g,o),h[a].x=s.x,h[a].y=s.y,g=this._transformPoint(h[a].x,h[a].y,u),l[p][i-1].attr({cx:g.x,cy:g.y}),this.updateDirectionPaths(p),this.updateSegmentPath(p)),this.updateDirectionPaths(t),this.updateSegmentPath(t),c||(this.pathEditedEventType="path:control-point:adjust",this.index=t,this.controlPointIndex=e,this.segPoint=n,this.trigger("path:editing",this.pathNode,r),this.trigger("path:control-point:adjusting",this.pathNode,r,{index:t,controlPointIndex:e,segPoint:n}))},findSubpathIndex:function(t){for(var e=this._subPathIndices,n=0,o=e.length;n<o;n++)if(e[n]<t)return e[n]},findReversedSubpathIndex:function(t){for(var e=this._subPathIndices,n=e.length-1;0<=n;n--)if(e[n]>t)return e[n]},adjustAnchorPoint:function(t,e,n,o){var r=(4<arguments.length&&void 0!==arguments[4]?arguments[4]:{}).dry,r=void 0===r?void 0:r,i=this._getPathCTM(),a=this.path,s=this.anchorPoints,c=this.controlPoints,u=a.getSegment(t),h=("Z"===u.type&&(t=this.findSubpathIndex(t),u=a.getSegment(t)),s.length-1),l=((0===t||t===h)&&c[1]&&c[h]&&(l=c[1][0],h=c[h][1],l&&l.hasClass("locked")&&l.removeClass("locked"),h&&h.hasClass("locked")&&h.removeClass("locked")),i.inverse()),h=(l.e=0,l.f=0,this._transformPoint(e,n,l)),e=(u.end.x+=h.x,u.end.y+=h.y,this._transformPoint(u.end.x,u.end.y,i)),n=new j.g.Point(e),s=(s[t].attr({cx:e.x,cy:e.y}),"C"===u.type&&(u.controlPoint2.x+=h.x,u.controlPoint2.y+=h.y,l=this._transformPoint(u.controlPoint2.x,u.controlPoint2.y,i),c[t][1].attr({cx:l.x,cy:l.y})),t+1<a.segments.length?a.getSegment(t+1):0);s&&("C"===s.type&&(s.controlPoint1.x+=h.x,s.controlPoint1.y+=h.y,e=this._transformPoint(s.controlPoint1.x,s.controlPoint1.y,i),c[t+1][0].attr({cx:e.x,cy:e.y}),this.updateDirectionPaths(t+1)),this.updateSegmentPath(t+1)),this.updateDirectionPaths(t),this.updateSegmentPath(t),r||(this.pathEditedEventType="path:anchor-point:adjust",this.index=t,this.segPoint=n,this.trigger("path:editing",this.pathNode,o),this.trigger("path:anchor-point:adjusting",this.pathNode,o,{index:t,segPoint:n}))},updateDirectionPaths:function(t){var o=this._getPathCTM(),e=this.path,r=e.getSegment(t),i=this._transformPoint(r.end.x,r.end.y,o),a=0<t?e.getSegment(t-1):null,s=a?this._transformPoint(a.end.x,a.end.y,o):null,e=this.directionPaths[t];Array.isArray(e)&&e.forEach(function(t,e){var n=this._transformPoint(r["controlPoint"+ ++e].x,r["controlPoint"+e].y,o);t.attr("d",["M",(1<e||!a?i:s).x,(1<e||!a?i:s).y,n.x,n.y].join(" "))},this)},updateSegmentPath:function(t){var e=this.path;if(this._subPathIndices.includes(t)){var n=this.findReversedSubpathIndex(t)||this.path.segments.length;if("Z"!==e.getSegment(--n).type)return;t=n}if(n=this.segmentPaths[t]){var o=this._getPathCTM(),r=e.getSegment(t-1),r=this._transformPoint(r.end.x,r.end.y,o),n=new j.g.Path,i=j.g.Path.createSegment("M",r.x,r.y),a=(n.appendSegment(i),e.getSegment(t)),s=this._transformPoint(a.end.x,a.end.y,o);switch(a.type){case"Z":var c=e.getSegment(this.findSubpathIndex(t)),c=this._transformPoint(c.end.x,c.end.y,o),i=j.g.Path.createSegment("L",c.x,c.y);break;case"L":i=j.g.Path.createSegment("L",s.x,s.y);break;case"C":var c=this._transformPoint(a.controlPoint1.x,a.controlPoint1.y,o),u=this._transformPoint(a.controlPoint2.x,a.controlPoint2.y,o);i=j.g.Path.createSegment("C",c.x,c.y,u.x,u.y,s.x,s.y)}n.appendSegment(i),this.segmentPaths[t]=n;r=this.segmentPathElements[t];r&&r.setAttribute("d",n.toString()),this.pathNode.setAttribute("d",e.toString())}},stopMoving:function(t){var e,n,o,r,t=j.util.normalizeEvent(t);this.$point=void 0,this.pathEditedEventType&&(e=this.pathNode,n=this.index,o=this.controlPointIndex,r=this.segPoint,this.trigger("path:edit",e,t),this.trigger(this.pathEditedEventType,e,t,{index:n,controlPointIndex:o,segPoint:r})),this.index=void 0,this.controlPointIndex=void 0,this.segPoint=void 0,this.pathEditedEventType=void 0},createAnchorPoint:function(t){var t=j.util.normalizeEvent(t),e=j.V(t.target).attr("index"),n=this.pathNode,o=this.path,r=j.V(n).toLocalPoint(t.pageX,t.pageY),i=o.getSegment(e);switch(i.type){case"Z":var a=new j.g.Line(i.start,i.end).closestPoint(r);o.insertSegment(e,j.g.Path.createSegment("L",a.x,a.y));break;case"L":a=new j.g.Line(i.start,i.end).closestPoint(r);o.insertSegment(e,j.g.Path.createSegment("L",a.x,a.y));break;case"C":a=new j.g.Curve(i.start,i.controlPoint1,i.controlPoint2,i.end).closestPointT(r),a=i.divideAtT(a);o.insertSegment(e,a[0]),i.controlPoint1.x=a[1].controlPoint1.x,i.controlPoint1.y=a[1].controlPoint1.y,i.controlPoint2.x=a[1].controlPoint2.x,i.controlPoint2.y=a[1].controlPoint2.y}this.render(),this.pathNode.setAttribute("d",o.toString()),this.trigger("path:edit",n,t),this.trigger("path:anchor-point:create",n,t)},removeAnchorPoint:function(t){var e,n,t=j.util.normalizeEvent(t),o=parseInt(c(t.target).attr("index"),10),r=this.pathNode,i=this.path,a=i.getSegment(o);switch(a.type){case"M":e=i.getSegment(o+1),n=j.g.Path.createSegment("M",e.end.x,e.end.y),i.replaceSegment(o+1,n),i.removeSegment(o);break;case"L":i.removeSegment(o);break;case"C":o+1<=i.segments.length-1&&"C"===(e=i.getSegment(o+1)).type&&(e.controlPoint1.x=a.controlPoint1.x,e.controlPoint1.y=a.controlPoint1.y),i.removeSegment(o)}this.render(),this.pathNode.setAttribute("d",i.toString()),this.trigger("path:edit",r,t),this.trigger("path:anchor-point:remove",r,t);var s=i.segments.length;"Z"===i.getSegment(i.segments.length-1).type&&--s,s<2&&this.trigger("path:invalid",r,t)},lockControlPoint:function(t){var e,t=j.util.normalizeEvent(t),t=c(t.target),n=parseInt(t.attr("index")),o=parseInt(t.attr("attribute-index"),10),r=this.getBoundIndex(n,o),i=1===o?2:1,r=this.controlPoints[r];r&&(e=t.hasClass("locked"),t.toggleClass("locked"),r[i-1].toggleClass("locked"),this.trigger("path:interact"),e?this.trigger("path:control-point:unlock",n,o):(this.trigger("path:control-point:lock",n,o),this.adjustControlPoint(n,o,0,0,{dry:!0})))},getBoundIndex:function(t,e){var n,o,r,i,a,s=this.path,c=this.anchorPoints,u=c.length-1;return 1===e?0===(n=t-1)&&(o=s.segments.length-1,r="Z"===s.getSegment(o).type,i=c[0].attr("cx")===c[u].attr("cx"),a=c[0].attr("cy")===c[u].attr("cy"),r&&i&&a&&(n=u)):(n=t+1)===1+u&&(o=s.segments.length-1,r="Z"===s.getSegment(o).type,i=c[0].attr("cx")===c[u].attr("cx"),a=c[0].attr("cy")===c[u].attr("cy"),r&&i&&a&&(n=1)),n},getControlPointLockedStates:function(){for(var t=this.controlPoints,e=[],n=0;n<t.length;n++)if(t[n]){e[n]=[];for(var o,r=0;r<=1;r++)t[n][r]&&(o=r+1,t[n][r].hasClass("locked")?e[n][o]=!0:e[n][o]=!1)}return e},setControlPointLockedStates:function(t){for(var e=this.controlPoints,n=0;n<e.length;n++)if(t[n]&&e[n])for(var o=1;o<=2;o++)t[n][o]&&e[n][o-1]&&(!0===t[n][o]?e[n][o-1].addClass("locked"):e[n][o-1].removeClass("locked"))},convertSegmentPath:function(t){var t=j.util.normalizeEvent(t),e=j.V(t.target).attr("index"),n=this.pathNode,o=this.path,r=o.getSegment(e);switch(r.type){case"Z":o.insertSegment(e,j.g.Path.createSegment("C",r.start.x,r.start.y,r.end.x,r.end.y,r.end.x,r.end.y));break;case"L":o.replaceSegment(e,j.g.Path.createSegment("C",r.start.x,r.start.y,r.end.x,r.end.y,r.end.x,r.end.y));break;case"C":o.replaceSegment(e,j.g.Path.createSegment("L",r.end.x,r.end.y))}this.render(),this.pathNode.setAttribute("d",o.toString()),this.trigger("path:edit",n,t),this.trigger("path:segment:convert",n,t)},addClosePathSegment:function(t){var t=j.util.normalizeEvent(t),e=parseInt(c(t.target).attr("index"),10),n=this.path,o=this.pathNode;0!==e&&e!==n.segments.length-1||"Z"!==n.getSegment(n.segments.length-1).type&&(n.appendSegment(j.g.Path.createSegment("Z")),this.render(),this.pathNode.setAttribute("d",n.toString()),this.trigger("path:edit",o,t),this.trigger("path:closepath-segment:add",o,t))},removeClosePathSegment:function(t){var t=j.util.normalizeEvent(t),e=j.V(t.target).attr("index"),n=this.path,o=this.pathNode;"Z"===n.getSegment(e).type&&(n.removeSegment(e),this.render(),this.pathNode.setAttribute("d",n.toString()),this.trigger("path:edit",o,t),this.trigger("path:closepath-segment:remove",o,t))},isMoreThanFirstClick:function(){return this.clickCounter=this.clickCounter||0,this.clickCounter+=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.clickCounter=0},400),2<=this.clickCounter&&(this.clickCounter=0,clearTimeout(this.timeout),!0)},onAnchorPointPointerDown:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),1!==t.which||this.isMoreThanFirstClick()||(this.startMoving(t),this.delegateDocumentEvents())},onControlPointPointerDown:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),1!==t.which||this.isMoreThanFirstClick()||(this.startMoving(t),this.delegateDocumentEvents())},onSegmentPathPointerDown:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),1!==t.which||this.isMoreThanFirstClick()||(this.startMoving(t),this.delegateDocumentEvents())},onPointerMove:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),this.move(t)},onPointerUp:function(t){this.undelegateDocumentEvents();t=j.util.normalizeEvent(t);t.stopPropagation(),this.stopMoving(t)},onAnchorPointDoubleClick:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),t.preventDefault(),1===t.which&&this.removeAnchorPoint(t)},onControlPointDoubleClick:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),t.preventDefault(),1===t.which&&this.lockControlPoint(t)},onSegmentPathDoubleClick:function(t){t=j.util.normalizeEvent(t);t.stopPropagation(),t.preventDefault(),1===t.which&&this.createAnchorPoint(t)}}));N.PathEditor=P}(this.joint.ui=this.joint.ui||{},$,joint);