/*! JointJS+ v3.6.3 - HTML5 Diagramming Framework

Copyright (c) 2022 client IO

 2022-12-09 


This Source Code Form is subject to the terms of the JointJS+ License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(t,a,w){"use strict";a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var e=w.mvc.View.extend({className:"navigator",events:{mousedown:"startAction",touchstart:"startAction","mousedown .joint-paper":"scrollTo","touchstart .joint-paper":"scrollTo"},documentEvents:{mousemove:"doAction",touchmove:"doAction",mouseup:"stopAction",touchend:"stopAction"},options:{paperConstructor:w.dia.Paper,paperOptions:{},zoomOptions:null,zoom:{min:.5,max:2},width:300,height:200,padding:10},init:function(){this.options.zoomOptions?this.options.zoom=w.util.assign({},this.options.zoom,this.options.zoomOptions):this.options.zoom&&(this.options.zoom=w.util.defaults({},this.options.zoom,this.constructor.prototype.options.zoom)),w.util.bindAll(this,"updateCurrentView","doAction","stopAction","scrollTo"),this.updateCurrentView=w.util.debounce(this.updateCurrentView,0);var t=this.options.paperScroller,t=(t.$el.on("scroll".concat(this.getEventNamespace()),this.updateCurrentView),this.sourcePaper=t.options.paper);this.toggleUseContentBBox(this.options.useContentBBox),this.targetPaper=new this.options.paperConstructor(w.util.merge({model:t.model,interactive:!1,frozen:!0},this.options.paperOptions))},startListening:function(){var t=this,e=this.options,o=this.sourcePaper;e.useContentBBox?this.listenTo(o,"render:done",function(){return t.updatePaper()}):this.listenTo(o,"resize",function(){return t.updatePaper()})},render:function(){var t;return this.targetPaper.$el.appendTo(this.el),this.targetPaper.unfreeze(),this.$currentView=a("<div>").addClass("current-view"),this.options.zoom&&(t=a("<div>").addClass("current-view-control"),this.$currentView.append(t)),this.$el.append(this.$currentView).css({width:this.options.width,height:this.options.height,padding:this.options.padding}),this.updatePaper(),this},freeze:function(t){this.targetPaper.freeze(t)},unfreeze:function(t){this.targetPaper.unfreeze(t)},CONTENT_BBOX_CLASS_NAME:"navigator-use-content-bbox",NO_CONTENT_CLASS_NAME:"navigator-no-content",toggleUseContentBBox:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.CONTENT_BBOX_CLASS_NAME,o=this.$el,i=this.targetPaper;this.options.useContentBBox=t,this.stopListening(),this.startListening(),o.toggleClass(e,Boolean(t)),i&&this.updatePaper()},updatePaper:function(){var t=this.sourcePaper,e=this.targetPaper,o=this.options,i=this.$el,s=this.NO_CONTENT_CLASS_NAME,o=o.useContentBBox,o=o?t.getContentBBox(o):t.getComputedSize(),t=i.hasClass(s);0<o.width&&0<o.height?(t&&(i.removeClass(s),e.unfreeze({key:"navigator"})),this.updatePaperWithBBox(o),this.updateCurrentView()):t||(i.addClass(s),e.freeze({key:"navigator"}))},updatePaperWithBBox:function(t){var e,o,i,s,n,r,a,p,h=t.width,l=t.height,c=t.x,c=void 0===c?0:c,t=t.y,t=void 0===t?0:t;h&&l&&(s=this.sourcePaper,e=this.targetPaper,r=this.options,o=(s=s.matrix()).a,i=s.d,p=s.e,s=s.f,a=r.padding,n=r.width-2*a,r=r.height-2*a,h/=o,l/=i,p=(p-c)*(a=this.ratio=Math.min(n/h,r/l))/o,c=(s-t)*a/i,e.setDimensions(h*=a,l*=a),e.setOrigin(p,c),e.scale(a,a))},updateCurrentView:function(){var t=this.ratio,e=this.sourcePaper.scale(),o=this.options.paperScroller,i=o.clientToLocalPoint(0,0),s=this.targetPaper.$el.position(),n=this.targetPaper.translate();n.ty=n.ty||0,this.currentViewGeometry={top:s.top+i.y*t+n.ty,left:s.left+i.x*t+n.tx,width:o.$el.innerWidth()*t/e.sx,height:o.$el.innerHeight()*t/e.sy},this.$currentView.css(this.currentViewGeometry)},startAction:function(t){var e=t=w.util.normalizeEvent(t),o=e.clientX,e=e.clientY,i=a(t.target).hasClass("current-view-control")?"zooming":"panning",s=this.options,n=this.currentViewGeometry,r=this.sourcePaper,s=s.paperScroller;switch(this.delegateDocumentEvents(null,{action:i,startClientX:o,startClientY:e,startScrollLeft:s.el.scrollLeft,startScrollTop:s.el.scrollTop,startZoom:s.zoom(),startGeometry:n,startScale:r.scale()}),i){case"panning":this.trigger("pan:start",t);break;case"zooming":this.trigger("zoom:start",t)}},doAction:function(t){var t=t=w.util.normalizeEvent(t),e=t.clientX,o=t.clientY,i=t.data,s=this.sourcePaper,t=this.options,n=this.ratio,r=i.action,a=i.startClientX,p=i.startClientY,h=i.startScrollLeft,l=i.startScrollTop,c=i.startZoom,u=i.startGeometry,d=i.startScale,g=i.frameId,m=t.paperScroller,f=t.zoom;switch(r){case"panning":var v=s.scale(),C=v.sx,v=(o-p)*v.sy;m.el.scrollLeft=h+(e-a)*C/n,m.el.scrollTop=l+v/n;break;case"zooming":var z=1+(a-e)/u.width/d.sx;w.util.cancelFrame(g),i.frameId=w.util.nextFrame(function(){m.zoom(z*c,w.util.defaults({absolute:!0},f))})}},stopAction:function(t){switch(this.undelegateDocumentEvents(),t.data.action){case"panning":this.trigger("pan:stop",t);break;case"zooming":this.trigger("zoom:stop",t)}},scrollTo:function(t){t=w.util.normalizeEvent(t);var e,o=this.targetPaper.translate(),t=(o.ty=o.ty||0,e=void 0===t.offsetX?(e=this.targetPaper.$el.offset(),i=t.pageX-e.left,t.pageY-e.top):(i=t.offsetX,t.offsetY),(i-o.tx)/this.ratio),i=(e-o.ty)/this.ratio;this.options.paperScroller.center(t,i)},onRemove:function(){this.targetPaper.remove(),this.options.paperScroller.$el.off(this.getEventNamespace())}});t.Navigator=e}(this.joint.ui=this.joint.ui||{},$,joint);