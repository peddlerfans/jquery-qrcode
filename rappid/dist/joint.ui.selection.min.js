/*! JointJS+ v3.6.3 - HTML5 Diagramming Framework

Copyright (c) 2022 client IO

 2022-12-09 


This Source Code Form is subject to the terms of the JointJS+ License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/


this.joint=this.joint||{},function(N,o,_,L){"use strict";o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,_=_&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function k(t,e){return t(e={exports:{}},e.exports),e.exports}function G(t){return t&&t.Math==Math&&t}function s(t){try{return!!t()}catch(t){return!0}}function F(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function X(t){return ht?yt(t):function(){return vt.apply(t,arguments)}}function e(t){if("Function"===l(t))return X(t)}function Y(t){if(Tt(t))throw Et("Can't call method on "+t);return t}function $(t){return xt(Y(t))}function n(t,e){return arguments.length<2?(n=y[t],f(n)?n:void 0):y[t]&&y[t][e];var n}function H(t){return Ft(Y(t))}function U(t){return"Symbol("+(void 0===t?"":t)+")_"+Ht(++Yt+$t,36)}function r(t){var e;return S(Ut,t)&&(Ct||"string"==typeof Ut[t])||(e="Symbol."+t,Ct&&S(Vt,t)?Ut[t]=Vt[t]:Ut[t]=(Pt&&Wt?Wt:zt)(e)),Ut[t]}function V(t,e){if(!h(t)||Mt(t))return t;var n=It(t,qt);if(n){if(n=m(n,t,e=void 0===e?"default":e),!h(n)||Mt(n))return n;throw Jt("Can't convert object to primitive value")}return _t(t,e=void 0===e?"number":e)}function W(t){return t=V(t,"string"),Mt(t)?t:t+""}function z(t){return ve[t]||(ve[t]=U(t))}function J(t,e,n,r){var o=(r=r||{}).enumerable,i=void 0!==r.name?r.name:e;if(f(n)&&xe(n,i,r),r.global)o?t[e]=n:Gt(e,n);else{try{r.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=n:T.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t}function q(c){return function(t,e,n){var r,o=$(t),i=O(o),a=Pe(n,i);if(c&&e!=e){for(;a<i;)if((r=o[a++])!=r)return!0}else for(;a<i;a++)if((c||a in o)&&o[a]===e)return c||a||0;return!c&&-1}}function K(t,e){var n,r=$(t),o=0,i=[];for(n in r)!S(ye,n)&&S(r,n)&&Le(i,n);for(;e.length>o;)!S(r,n=e[o++])||~Re(i,n)||Le(i,n);return i}function Q(t,e){return(t=Ye[Xe(t)])==He||t!=$e&&(f(e)?s(e):!!e)}function i(t,e){var n,r,o,i=t.target,a=t.global,c=t.stat,s=a?y:c?y[i]||Gt(i,{}):(y[i]||{}).prototype;if(s)for(n in e){if(r=e[n],o=t.dontCallGetSet?(o=Ve(s,n))&&o.value:s[n],!Ue(a?n:i+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof r==typeof o)continue;for(var u=r,l=o,f=v=g=d=p=h=void 0,h=Ge(l),p=T.f,d=ne.f,g=0;g<h.length;g++){var v=h[g];S(u,v)||f&&S(f,v)||p(u,v,d(l,v))}}(t.sham||o&&o.sham)&&fe(r,"sham",!0),J(s,n,r,t)}}function Z(t,e){if(!delete t[e])throw We("Cannot delete property "+Lt(e)+" of "+Lt(t))}function tt(t){if("Symbol"===Ke(t))throw TypeError("Cannot convert a Symbol value to a string");return Qe(t)}function et(t,e,n){for(var r=O(t),o=Pe(e,r),i=Pe(void 0===n?r:n,r),a=tn(en(i-o,0)),c=0;o<i;o++,c++)Ze(a,c,t[o]);return a.length=c,a}function nt(t,e){var n=t.length,r=nn(n/2);if(n<8){for(var o,i,a=t,c=e,s=a.length,u=1;u<s;){for(o=a[i=u];i&&0<c(a[i-1],o);)a[i]=a[--i];i!==u++&&(a[i]=o)}return a}for(var l=t,f=nt(et(t,0,r),e),h=nt(et(t,r),e),p=e,d=f.length,g=h.length,v=0,y=0;v<d||y<g;)l[v+y]=v<d&&y<g?p(f[v],h[y])<=0?f[v++]:h[y++]:v<d?f[v++]:h[y++];return l}function rt(t,e){var n=[][t];return!!n&&s(function(){n.call(null,e||function(){return 1},1)})}function ot(t,e){return b(t),void 0===e?t:ht?hn(t,e):function(){return t.apply(e,arguments)}}function it(){}function at(t){if(!f(t))return!1;try{return gn(it,dn,t),!0}catch(t){return!1}}function ct(t){if(!f(t))return!1;switch(Ke(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return mn||!!yn(vn,ge(t))}catch(t){return!0}}function st(t,e){return new(xn(t))(0===e?0:e)}function a(h){var p=1==h,d=2==h,g=3==h,v=4==h,y=6==h,m=7==h,b=5==h||y;return function(t,e,n,r){for(var o,i,a=H(t),c=xt(a),s=ot(e,n),u=O(c),l=0,e=r||st,f=p?e(t,u):d||m?e(t,0):void 0;l<u;l++)if((b||l in c)&&(i=s(o=c[l],l,a),h))if(p)f[l]=i;else if(i)switch(h){case 3:return!0;case 5:return o;case 6:return l;case 2:Tn(f,o)}else switch(h){case 4:return!1;case 7:Tn(f,o)}return y?-1:g||v?v:f}}var ut,lt,c,ft,y=G("object"==typeof globalThis&&globalThis)||G("object"==typeof window&&window)||G("object"==typeof self&&self)||G("object"==typeof t&&t)||function(){return this}()||Function("return this")(),u=!s(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),ht=!s(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}),pt=Function.prototype.call,m=ht?pt.bind(pt):function(){return pt.apply(pt,arguments)},t={}.propertyIsEnumerable,dt=Object.getOwnPropertyDescriptor,gt={f:dt&&!t.call({1:2},1)?function(t){t=dt(this,t);return!!t&&t.enumerable}:t},t=Function.prototype,vt=t.call,yt=ht&&t.bind.bind(vt,vt),mt=X({}.toString),bt=X("".slice),l=function(t){return bt(mt(t),8,-1)},St=Object,wt=e("".split),xt=s(function(){return!St("z").propertyIsEnumerable(0)})?function(t){return"String"==l(t)?wt(t,""):St(t)}:St,Tt=function(t){return null==t},Et=TypeError,t="object"==typeof document&&document.all,t={all:t,IS_HTMLDDA:void 0===t&&void 0!==t},Ot=t.all,f=t.IS_HTMLDDA?function(t){return"function"==typeof t||t===Ot}:function(t){return"function"==typeof t},jt=t.all,h=t.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:f(t)||t===jt}:function(t){return"object"==typeof t?null!==t:f(t)},At=e({}.isPrototypeOf),t=n("navigator","userAgent")||"",p=y.process,d=y.Deno,p=p&&p.versions||d&&d.version,d=p&&p.v8,g=E=!(E=d?0<(w=d.split("."))[0]&&w[0]<4?1:+(w[0]+w[1]):E)&&t&&(!(w=t.match(/Edge\/(\d+)/))||74<=w[1])&&(w=t.match(/Chrome\/(\d+)/))?+w[1]:E,Ct=!!Object.getOwnPropertySymbols&&!s(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&g&&g<41}),Pt=Ct&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Bt=Object,Mt=Pt?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return f(e)&&At(e.prototype,Bt(t))},Rt=String,Lt=function(t){try{return Rt(t)}catch(t){return"Object"}},Dt=TypeError,b=function(t){if(f(t))return t;throw Dt(Lt(t)+" is not a function")},It=function(t,e){t=t[e];return Tt(t)?void 0:b(t)},Nt=TypeError,_t=function(t,e){var n,r;if("string"===e&&f(n=t.toString)&&!h(r=m(n,t)))return r;if(f(n=t.valueOf)&&!h(r=m(n,t)))return r;if("string"!==e&&f(n=t.toString)&&!h(r=m(n,t)))return r;throw Nt("Can't convert object to primitive value")},kt=Object.defineProperty,Gt=function(e,n){try{kt(y,e,{value:n,configurable:!0,writable:!0})}catch(t){y[e]=n}return n},p="__core-js_shared__",v=y[p]||Gt(p,{}),d=k(function(t){(t.exports=function(t,e){return v[t]||(v[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"})}),Ft=Object,Xt=e({}.hasOwnProperty),S=Object.hasOwn||function(t,e){return Xt(H(t),e)},Yt=0,$t=Math.random(),Ht=e(1..toString),Ut=d("wks"),Vt=y.Symbol,Wt=Vt&&Vt.for,zt=Pt?Vt:Vt&&Vt.withoutSetter||U,Jt=TypeError,qt=r("toPrimitive"),Kt=y.document,Qt=h(Kt)&&h(Kt.createElement),Zt=function(t){return Qt?Kt.createElement(t):{}},te=!u&&!s(function(){return 7!=Object.defineProperty(Zt("div"),"a",{get:function(){return 7}}).a}),ee=Object.getOwnPropertyDescriptor,ne={f:u?ee:function(t,e){if(t=$(t),e=W(e),te)try{return ee(t,e)}catch(t){}if(S(t,e))return F(!m(gt.f,t,e),t[e])}},w=u&&s(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),re=String,oe=TypeError,x=function(t){if(h(t))return t;throw oe(re(t)+" is not an object")},ie=TypeError,ae=Object.defineProperty,ce=Object.getOwnPropertyDescriptor,se="enumerable",ue="configurable",le="writable",T={f:u?w?function(t,e,n){var r;return x(t),e=W(e),x(n),"function"==typeof t&&"prototype"===e&&"value"in n&&le in n&&!n[le]&&((r=ce(t,e))&&r[le]&&(t[e]=n.value,n={configurable:(ue in n?n:r)[ue],enumerable:(se in n?n:r)[se],writable:!1})),ae(t,e,n)}:ae:function(t,e,n){if(x(t),e=W(e),x(n),te)try{return ae(t,e,n)}catch(t){}if("get"in n||"set"in n)throw ie("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},fe=u?function(t,e,n){return T.f(t,e,F(1,n))}:function(t,e,n){return t[e]=n,t},E=Function.prototype,p=u&&Object.getOwnPropertyDescriptor,he=S(E,"name"),pe={EXISTS:he,PROPER:he&&"something"===function(){}.name,CONFIGURABLE:he&&(!u||p(E,"name").configurable)},de=e(Function.toString),ge=(f(v.inspectSource)||(v.inspectSource=function(t){return de(t)}),v.inspectSource),he=y.WeakMap,p=f(he)&&/native code/.test(String(he)),ve=d("keys"),ye={},me="Object already initialized",be=y.TypeError,E=y.WeakMap,Se=p||v.state?((c=v.state||(v.state=new E)).get=c.get,c.has=c.has,c.set=c.set,ut=function(t,e){if(c.has(t))throw be(me);return e.facade=t,c.set(t,e),e},lt=function(t){return c.get(t)||{}},function(t){return c.has(t)}):(ft=z("state"),ye[ft]=!0,ut=function(t,e){if(S(t,ft))throw be(me);return e.facade=t,fe(t,ft,e),e},lt=function(t){return S(t,ft)?t[ft]:{}},function(t){return S(t,ft)}),we={set:ut,get:lt,has:Se,enforce:function(t){return Se(t)?lt(t):ut(t,{})},getterFor:function(e){return function(t){if(h(t)&&(t=lt(t)).type===e)return t;throw be("Incompatible receiver, "+e+" required")}}},xe=k(function(t){var r=pe.CONFIGURABLE,o=we.enforce,e=we.get,i=Object.defineProperty,a=u&&!s(function(){return 8!==i(function(){},"length",{value:8}).length}),c=String(String).split("String"),t=t.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!S(t,"name")||r&&t.name!==e)&&(u?i(t,"name",{value:e,configurable:!0}):t.name=e),a&&n&&S(n,"arity")&&t.length!==n.arity&&i(t,"length",{value:n.arity});try{n&&S(n,"constructor")&&n.constructor?u&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}n=o(t);return S(n,"source")||(n.source=c.join("string"==typeof e?e:"")),t};Function.prototype.toString=t(function(){return f(this)&&e(this).source||ge(this)},"toString")}),Te=Math.ceil,Ee=Math.floor,Oe=Math.trunc||function(t){t=+t;return(0<t?Ee:Te)(t)},je=function(t){t=+t;return t!=t||0==t?0:Oe(t)},Ae=Math.max,Ce=Math.min,Pe=function(t,e){t=je(t);return t<0?Ae(t+e,0):Ce(t,e)},Be=Math.min,Me=function(t){return 0<t?Be(je(t),9007199254740991):0},O=function(t){return Me(t.length)},he={includes:q(!0),indexOf:q(!1)},Re=he.indexOf,Le=e([].push),De=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ie=De.concat("length","prototype"),Ne={f:Object.getOwnPropertyNames||function(t){return K(t,Ie)}},_e={f:Object.getOwnPropertySymbols},ke=e([].concat),Ge=n("Reflect","ownKeys")||function(t){var e=Ne.f(x(t)),n=_e.f;return n?ke(e,n(t)):e},Fe=/#|\.prototype\./,Xe=Q.normalize=function(t){return String(t).replace(Fe,".").toLowerCase()},Ye=Q.data={},$e=Q.NATIVE="N",He=Q.POLYFILL="P",Ue=Q,Ve=ne.f,We=TypeError,d={},p=(d[r("toStringTag")]="z","[object z]"===String(d)),ze=r("toStringTag"),Je=Object,qe="Arguments"==l(function(){return arguments}()),Ke=p?l:function(t){var e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Je(t),ze))?e:qe?l(t):"Object"==(e=l(t))&&f(t.callee)?"Arguments":e},Qe=String,Ze=function(t,e,n){e=W(e);e in t?T.f(t,e,F(0,n)):t[e]=n},tn=Array,en=Math.max,nn=Math.floor,rn=nt,E=t.match(/firefox\/(\d+)/i),on=!!E&&+E[1],an=/MSIE|Trident/.test(t),d=t.match(/AppleWebKit\/(\d+)\./),cn=!!d&&+d[1],j=[],sn=e(j.sort),un=e(j.push),E=s(function(){j.sort(void 0)}),d=s(function(){j.sort(null)}),ln=rt("sort"),fn=!s(function(){if(g)return g<70;if(!(on&&3<on)){if(an)return 1;if(cn)return cn<603;for(var t,e,n,r="",o=65;o<76;o++){switch(t=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:e=3;break;case 68:case 71:e=4;break;default:e=2}for(n=0;n<47;n++)j.push({k:t+n,v:e})}for(j.sort(function(t,e){return e.v-t.v}),n=0;n<j.length;n++)t=j[n].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return"DGBEFHACIJK"!==r}}),hn=(i({target:"Array",proto:!0,forced:E||!d||!ln||!fn},{sort:function(t){void 0!==t&&b(t);var e=H(this);if(fn)return void 0===t?sn(e):sn(e,t);for(var n,r,o=[],i=O(e),a=0;a<i;a++)a in e&&un(o,e[a]);for(rn(o,(r=t,function(t,e){return void 0===e?-1:void 0===t?1:void 0!==r?+r(t,e)||0:tt(t)>tt(e)?1:-1})),n=O(o),a=0;a<n;)e[a]=o[a++];for(;a<i;)Z(e,a++);return e}}),e(e.bind)),pn=Array.isArray||function(t){return"Array"==l(t)},dn=[],gn=n("Reflect","construct"),vn=/^\s*(?:class|function)\b/,yn=e(vn.exec),mn=!vn.exec(it),bn=(ct.sham=!0,!gn||s(function(){var t;return at(at.call)||!at(Object)||!at(function(){t=!0})||t})?ct:at),Sn=r("species"),wn=Array,xn=function(t){var e;return pn(t)&&(e=t.constructor,(bn(e)&&(e===wn||pn(e.prototype))||h(e)&&null===(e=e[Sn]))&&(e=void 0)),void 0===e?wn:e},Tn=e([].push),E={forEach:a(0),map:a(1),filter:a(2),some:a(3),every:a(4),find:a(5),findIndex:a(6),filterReject:a(7)},En=E.forEach,On=rt("forEach")?[].forEach:function(t){return En(this,t,1<arguments.length?arguments[1]:void 0)};i({target:"Array",proto:!0,forced:[].forEach!=On},{forEach:On});function jn(e){if(e&&e.forEach!==On)try{fe(e,"forEach",On)}catch(t){e.forEach=On}}p||J(Object.prototype,"toString",p?{}.toString:function(){return"[object "+Ke(this)+"]"},{unsafe:!0});var An,Cn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},d=Zt("span").classList,ln=d&&d.constructor&&d.constructor.prototype,p=ln===Object.prototype?void 0:ln;for(An in Cn)Cn[An]&&jn(y[An]&&y[An].prototype);jn(p);function Pn(t,e){var n,t=x(t).constructor;if(void 0===t||Tt(n=x(t)[_n]))return e;if(bn(t=n))return t;throw Nn(Lt(t)+" is not a constructor")}var Bn,Mn,A="process"==l(y.process),Rn=String,Ln=TypeError,d=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=e(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return x(t),function(t){if("object"==typeof t||f(t))return;throw Ln("Can't set "+Rn(t)+" as a prototype")}(e),r?n(t,e):t.__proto__=e,t}}():void 0),ln=T.f,p=r("toStringTag"),Dn=r("species"),In=TypeError,Nn=TypeError,_n=r("species"),C=Function.prototype,kn=C.apply,Gn=C.call,Fn="object"==typeof Reflect&&Reflect.apply||(ht?Gn.bind(kn):function(){return Gn.apply(kn,arguments)}),Xn=n("document","documentElement"),Yn=e([].slice),$n=TypeError,C=/(?:ipad|iphone|ipod).*applewebkit/i.test(t),P=y.setImmediate,B=y.clearImmediate,Hn=y.process,Un=y.Dispatch,Vn=y.Function,M=y.MessageChannel,Wn=y.String,zn=0,Jn={},qn="onreadystatechange";try{Bn=y.location}catch(t){}function Kn(t){return function(){pr(t)}}function Qn(t){pr(t.data)}function Zn(t){y.postMessage(Wn(t),Bn.protocol+"//"+Bn.host)}function tr(){this.head=null,this.tail=null}function er(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw Or("Bad Promise constructor");n=t,r=e}),this.resolve=b(n),this.reject=b(r)}function nr(t,e){var n,r,o,i,a=e.value,c=e.state==Yr,s=c?t.ok:t.fail,u=t.resolve,l=t.reject,f=t.domain;try{s?(c||(e.rejection===Ur&&(i=e,m(Ar,y,function(){var t=i.facade;A?Nr.emit("rejectionHandled",t):zr(Xr,t,i.value)})),e.rejection=Hr),!0===s?n=a:(f&&f.enter(),n=s(a),f&&(f.exit(),o=!0)),n===t.promise?l(Dr("Promise-chain cycle")):(r=Vr(n))?m(r,n,u,l):u(n)):l(a)}catch(t){f&&!o&&f.exit(),l(t)}}var rr,or,ir,ar,cr,sr,ur,lr,fr,hr,pr=function(t){var e;S(Jn,t)&&(e=Jn[t],delete Jn[t],e())},M=(P&&B||(P=function(t){var e=arguments.length,n=1;if(e<n)throw $n("Not enough arguments");var r=f(t)?t:Vn(t),o=Yn(arguments,1);return Jn[++zn]=function(){Fn(r,void 0,o)},Mn(zn),zn},B=function(t){delete Jn[t]},A?Mn=function(t){Hn.nextTick(Kn(t))}:Un&&Un.now?Mn=function(t){Un.now(Kn(t))}:M&&!C?(R=(M=new M).port2,M.port1.onmessage=Qn,Mn=ot(R.postMessage,R)):y.addEventListener&&f(y.postMessage)&&!y.importScripts&&Bn&&"file:"!==Bn.protocol&&!s(Zn)?(Mn=Zn,y.addEventListener("message",Qn,!1)):Mn=qn in Zt("script")?function(t){Xn.appendChild(Zt("script"))[qn]=function(){Xn.removeChild(this),pr(t)}}:function(t){setTimeout(Kn(t),0)}),{set:P,clear:B}),R=/ipad|iphone|ipod/i.test(t)&&void 0!==y.Pebble,P=/web0s(?!.*chrome)/i.test(t),B=ne.f,dr=M.set,t=y.MutationObserver||y.WebKitMutationObserver,gr=y.document,vr=y.process,D=y.Promise,B=B(y,"queueMicrotask"),B=B&&B.value,yr=(B||(rr=function(){var t,e;for(A&&(t=vr.domain)&&t.exit();or;){e=or.fn,or=or.next;try{e()}catch(t){throw or?ar():ir=void 0,t}}ir=void 0,t&&t.enter()},ar=C||A||P||!t||!gr?!R&&D&&D.resolve?((C=D.resolve(void 0)).constructor=D,ur=ot(C.then,C),function(){ur(rr)}):A?function(){vr.nextTick(rr)}:(dr=ot(dr,y),function(){dr(rr)}):(cr=!0,sr=gr.createTextNode(""),new t(rr).observe(sr,{characterData:!0}),function(){sr.data=cr=!cr})),B||function(t){t={fn:t,next:void 0};ir&&(ir.next=t),or||(or=t,ar()),ir=t}),mr=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},br=(tr.prototype={add:function(t){t={item:t,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},tr),I=y.Promise,Sr="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,wr=!Sr&&!A&&"object"==typeof window&&"object"==typeof document,xr=(I&&I.prototype,r("species")),Tr=!1,Er=f(y.PromiseRejectionEvent),P={CONSTRUCTOR:Ue("Promise",function(){var t=ge(I),e=t!==String(I);if(!e&&66===g)return!0;if(!g||g<51||!/native code/.test(t)){var t=new I(function(t){t(1)}),n=function(t){t(function(){},function(){})};if((t.constructor={})[xr]=n,!(Tr=t.then(function(){})instanceof n))return!0}return!e&&(wr||Sr)&&!Er}),REJECTION_EVENT:Er,SUBCLASSING:Tr},Or=TypeError,jr={f:function(t){return new er(t)}},Ar=M.set,Cr="Promise",R=P.CONSTRUCTOR,Pr=P.REJECTION_EVENT,D=P.SUBCLASSING,Br=we.getterFor(Cr),Mr=we.set,C=I&&I.prototype,Rr=I,Lr=C,Dr=y.TypeError,Ir=y.document,Nr=y.process,_r=jr.f,kr=_r,Gr=!!(Ir&&Ir.createEvent&&y.dispatchEvent),Fr="unhandledrejection",Xr="rejectionhandled",Yr=1,$r=2,Hr=1,Ur=2,Vr=function(t){var e;return!(!h(t)||!f(e=t.then))&&e},Wr=function(n,o){n.notified||(n.notified=!0,yr(function(){for(var t,r,e=n.reactions;t=e.get();)nr(t,n);n.notified=!1,o&&!n.rejection&&(r=n,m(Ar,y,function(){var t=r.facade,e=r.value,n=Jr(r);if(n&&(n=mr(function(){A?Nr.emit("unhandledRejection",e,t):zr(Fr,t,e)}),r.rejection=A||Jr(r)?Ur:Hr,n.error))throw n.value}))}))},zr=function(t,e,n){var r;Gr?((r=Ir.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),y.dispatchEvent(r)):r={promise:e,reason:n},!Pr&&(e=y["on"+t])?e(r):t===Fr&&function(t,e){var n=y.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},Jr=function(t){return t.rejection!==Hr&&!t.parent},qr=function(e,n,r){return function(t){e(n,t,r)}},Kr=function(t,e,n){t.done||(t.done=!0,(t=n?n:t).value=e,t.state=$r,Wr(t,!0))},Qr=function(n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(n.facade===t)throw Dr("Promise can't be resolved itself");var r=Vr(t);r?yr(function(){var e={done:!1};try{m(r,t,qr(Qr,e,n),qr(Kr,e,n))}catch(t){Kr(e,t,n)}}):(n.value=t,n.state=Yr,Wr(n,!1))}catch(t){Kr({done:!1},t,n)}}};if(R&&(Lr=(Rr=function(t){!function(t,e){if(At(e,t))return;throw In("Incorrect invocation")}(this,Lr),b(t),m(lr,this);var e=Br(this);try{t(qr(Qr,e),qr(Kr,e))}catch(t){Kr(e,t)}}).prototype,(lr=function(t){Mr(this,{type:Cr,done:!1,notified:!1,parent:!1,reactions:new br,rejection:!1,state:0,value:void 0})}).prototype=J(Lr,"then",function(t,e){var n=Br(this),r=_r(Pn(this,Rr));return n.parent=!0,r.ok=!f(t)||t,r.fail=f(e)&&e,r.domain=A?Nr.domain:void 0,0==n.state?n.reactions.add(r):yr(function(){nr(r,n)}),r.promise}),fr=function(){var t=new lr,e=Br(t);this.promise=t,this.resolve=qr(Qr,e),this.reject=qr(Kr,e)},jr.f=_r=function(t){return t===Rr||void 0===t?new fr:kr(t)},f(I)&&C!==Object.prototype)){hr=C.then,D||J(C,"then",function(t,e){var n=this;return new Rr(function(t,e){m(hr,n,t,e)}).then(t,e)},{unsafe:!0});try{delete C.constructor}catch(t){}d&&d(C,Lr)}i({global:!0,constructor:!0,wrap:!0,forced:R},{Promise:Rr}),t=!(gr=Cr),(B=(B=Rr)&&!t?B.prototype:B)&&!S(B,p)&&ln(B,p,{configurable:!0,value:gr}),M=n(M=Cr),D=T.f,u&&M&&!M[Dn]&&D(M,Dn,{configurable:!0,get:function(){return this}});function Zr(t,e,n){var r,o;x(t);try{if(!(r=It(t,"return"))){if("throw"===e)throw n;return}r=m(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;x(r)}function to(t,e){this.stopped=t,this.result=e}function eo(t,e,n){function r(t){return i&&Zr(i,"normal",t),new to(!0,t)}function o(t){return h?(x(t),g?v(t[0],t[1],r):v(t[0],t[1])):g?v(t,r):v(t)}var i,a,c,s,u,l,f=n&&n.that,h=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_RECORD),d=!(!n||!n.IS_ITERATOR),g=!(!n||!n.INTERRUPTED),v=ot(e,f);if(p)i=t.iterator;else if(d)i=t;else{if(!(n=ao(t)))throw so(Lt(t)+" is not iterable");if(void 0!==(e=n)&&(no.Array===e||oo[ro]===e)){for(a=0,c=O(t);a<c;a++)if((s=o(t[a]))&&At(uo,s))return;return}i=function(t,e){e=arguments.length<2?ao(t):e;if(b(e))return x(m(e,t));throw co(Lt(t)+" is not iterable")}(t,n)}for(u=(p?t:i).next;!(l=m(u,i)).done;){try{s=o(l.value)}catch(t){Zr(i,"throw",t)}if("object"==typeof s&&s&&At(uo,s))return}}var no={},ro=r("iterator"),oo=Array.prototype,io=r("iterator"),ao=function(t){if(!Tt(t))return It(t,io)||It(t,"@@iterator")||no[Ke(t)]},co=TypeError,so=TypeError,uo=to.prototype,lo=r("iterator"),fo=!1;try{var ho=0,po={next:function(){return{done:!!ho++}},return:function(){fo=!0}};po[lo]=function(){return this},Array.from(po,function(){throw 2})}catch(t){}d=P.CONSTRUCTOR||!function(t,e){if(!e&&!fo)return!1;var n=!1;try{var r={};r[lo]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}(function(t){I.all(t).then(void 0,function(){})}),i({target:"Promise",stat:!0,forced:d},{all:function(t){var c=this,e=jr.f(c),s=e.resolve,u=e.reject,n=mr(function(){var r=b(c.resolve),o=[],i=0,a=1;eo(t,function(t){var e=i++,n=!1;a++,m(r,c,t).then(function(t){n||(n=!0,o[e]=t,--a||s(o))},u)}),--a||s(o)});return n.error&&u(n.value),e.promise}}),C=P.CONSTRUCTOR,R=I&&I.prototype;i({target:"Promise",proto:!0,forced:C,real:!0},{catch:function(t){return this.then(void 0,t)}}),f(I)&&(t=n("Promise").prototype.catch,R.catch!==t&&J(R,"catch",t,{unsafe:!0})),i({target:"Promise",stat:!0,forced:d},{race:function(t){var n=this,r=jr.f(n),o=r.reject,e=mr(function(){var e=b(n.resolve);eo(t,function(t){m(e,n,t).then(r.resolve,o)})});return e.error&&o(e.value),r.promise}});i({target:"Promise",stat:!0,forced:P.CONSTRUCTOR},{reject:function(t){var e=jr.f(this);return m(e.reject,void 0,t),e.promise}});function go(e){return 51<=g||!s(function(){var t=[];return(t.constructor={})[Mo]=function(){return{foo:1}},1!==t[e](Boolean).foo})}function vo(){}function yo(t){t.write(ko("")),t.close();var e=t.parentWindow.Object;return t=null,e}function mo(t){Xo[Fo][t]=!0}function bo(t){if(h(e=t)&&(void 0!==(n=e[$o])?!!n:"RegExp"==l(e)))throw Ho("The method doesn't accept regular expressions");var e,n;return t}function So(t){if(9007199254740991<t)throw Zo("Maximum allowed index exceeded")}function wo(e){return function(t){t=tt(Y(t));return 1&e&&(t=oi(t,ii,"")),t=2&e?oi(t,ai,""):t}}function xo(u){return function(t,e,n,r){b(e);var o=H(t),i=xt(o),a=O(o),c=u?a-1:0,s=u?-1:1;if(n<2)for(;;){if(c in i){r=i[c],c+=s;break}if(c+=s,u?c<0:a<=c)throw gi("Reduce of empty array with no initial value")}for(;u?0<=c:c<a;c+=s)c in i&&(r=e(r,i[c],c,o));return r}}var To,ln=P.CONSTRUCTOR,B=(n("Promise"),i({target:"Promise",stat:!0,forced:ln},{resolve:function(t){return t=t,x(e=this),h(t)&&t.constructor===e?t:((0,(e=jr.f(e)).resolve)(t),e.promise);var e}}),pe.EXISTS),p=T.f,gr=Function.prototype,Eo=e(gr.toString),Oo=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,jo=e(Oo.exec),Ao=(u&&!B&&p(gr,"name",{configurable:!0,get:function(){try{return jo(Oo,Eo(this))[1]}catch(t){return""}}}),Function),Co=e([].concat),Po=e([].join),Bo={},D=ht?Ao.bind:function(a){var c=b(this),t=c.prototype,s=Yn(arguments,1),u=function(){var t=Co(s,Yn(arguments));if(this instanceof u){var e=c,n=t.length,r=t;if(!S(Bo,n)){for(var o=[],i=0;i<n;i++)o[i]="a["+i+"]";Bo[n]=Ao("C,a","return new C("+Po(o,",")+")")}return Bo[n](e,r)}return c.apply(a,t)};return h(t)&&(u.prototype=t),u},Mo=(i({target:"Function",proto:!0,forced:Function.bind!==D},{bind:D}),r("species")),Ro=E.filter,Lo=(i({target:"Array",proto:!0,forced:!go("filter")},{filter:function(t){return Ro(this,t,1<arguments.length?arguments[1]:void 0)}}),i({target:"Array",stat:!0},{isArray:pn}),Object.keys||function(t){return K(t,De)}),Do={f:u&&!w?Object.defineProperties:function(t,e){x(t);for(var n,r=$(e),o=Lo(e),i=o.length,a=0;a<i;)T.f(t,n=o[a++],r[n]);return t}},Io="prototype",No="script",_o=z("IE_PROTO"),ko=function(t){return"<"+No+">"+t+"</"+No+">"},Go=function(){try{To=new ActiveXObject("htmlfile")}catch(t){}Go="undefined"==typeof document||document.domain&&To?yo(To):(t=Zt("iframe"),e="java"+No+":",t.style.display="none",Xn.appendChild(t),t.src=String(e),(e=t.contentWindow.document).open(),e.write(ko("document.F=Object")),e.close(),e.F);for(var t,e,n=De.length;n--;)delete Go[Io][De[n]];return Go()},M=(ye[_o]=!0,Object.create||function(t,e){var n;return null!==t?(vo[Io]=x(t),n=new vo,vo[Io]=null,n[_o]=t):n=Go(),void 0===e?n:Do.f(n,e)}),Dn=T.f,Fo=r("unscopables"),Xo=Array.prototype,Yo=(null==Xo[Fo]&&Dn(Xo,Fo,{configurable:!0,value:M(null)}),he.includes),$o=(i({target:"Array",proto:!0,forced:s(function(){return!Array(1).includes()})},{includes:function(t){return Yo(this,t,1<arguments.length?arguments[1]:void 0)}}),mo("includes"),r("match")),Ho=TypeError,Uo=r("match"),Vo=e("".indexOf),Wo=(i({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Uo]=!1,"/./"[e](n)}catch(t){}}return!1}("includes")},{includes:function(t){return!!~Vo(tt(Y(this)),tt(bo(t)),1<arguments.length?arguments[1]:void 0)}}),E.map),zo=(i({target:"Array",proto:!0,forced:!go("map")},{map:function(t){return Wo(this,t,1<arguments.length?arguments[1]:void 0)}}),E.findIndex),po="findIndex",Jo=!0,qo=(po in[]&&Array(1)[po](function(){Jo=!1}),i({target:"Array",proto:!0,forced:Jo},{findIndex:function(t){return zo(this,t,1<arguments.length?arguments[1]:void 0)}}),mo(po),TypeError),Ko=Object.getOwnPropertyDescriptor,Qo=u&&!function(){if(void 0!==this)return 1;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(pn(t)&&!Ko(t,"length").writable)throw qo("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},Zo=TypeError,C=go("splice"),ti=Math.max,ei=Math.min,ni=(i({target:"Array",proto:!0,forced:!C},{splice:function(t,e){var n,r,o,i,a,c,s=H(this),u=O(s),l=Pe(t,u),t=arguments.length;for(0===t?n=r=0:r=1===t?(n=0,u-l):(n=t-2,ei(ti(je(e),0),u-l)),So(u+n-r),o=st(s,r),i=0;i<r;i++)(a=l+i)in s&&Ze(o,i,s[a]);if(n<(o.length=r)){for(i=l;i<u-r;i++)c=i+n,(a=i+r)in s?s[c]=s[a]:Z(s,c);for(i=u;u-r+n<i;i--)Z(s,i-1)}else if(r<n)for(i=u-r;l<i;i--)c=i+n-1,(a=i+r-1)in s?s[c]=s[a]:Z(s,c);for(i=0;i<n;i++)s[i+l]=arguments[i+2];return Qo(s,u-r+n),o}}),E.find),R="find",ri=!0,t=(R in[]&&Array(1)[R](function(){ri=!1}),i({target:"Array",proto:!0,forced:ri},{find:function(t){return ni(this,t,1<arguments.length?arguments[1]:void 0)}}),mo(R),"\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"),oi=e("".replace),d="["+t+"]",ii=RegExp("^"+d+d+"*"),ai=RegExp(d+d+"*$"),ci={start:wo(1),end:wo(2),trim:wo(3)}.trim,si=e("".charAt),ui=y.parseFloat,P=y.Symbol,li=P&&P.iterator,ln=1/ui(t+"-0")!=-1/0||li&&!s(function(){ui(Object(li))})?function(t){var t=ci(tt(t)),e=ui(t);return 0===e&&"-"==si(t,0)?-0:e}:ui,B=(i({global:!0,forced:parseFloat!=ln},{parseFloat:ln}),go("slice")),fi=r("species"),hi=Array,pi=Math.max,di=(i({target:"Array",proto:!0,forced:!B},{slice:function(t,e){var n,r,o,i=$(this),a=O(i),c=Pe(t,a),s=Pe(void 0===e?a:e,a);if(pn(i)&&(n=i.constructor,(n=bn(n)&&(n===hi||pn(n.prototype))||h(n)&&null===(n=n[fi])?void 0:n)===hi||void 0===n))return Yn(i,c,s);for(r=new(void 0===n?hi:n)(pi(s-c,0)),o=0;c<s;c++,o++)c in i&&Ze(r,o,i[c]);return r.length=o,r}}),r("isConcatSpreadable")),p=51<=g||!s(function(){var t=[];return t[di]=!1,t.concat()[0]!==t}),gr=go("concat"),gi=(i({target:"Array",proto:!0,arity:1,forced:!p||!gr},{concat:function(t){for(var e,n,r,o,i,a=H(this),c=st(a,0),s=0,u=-1,l=arguments.length;u<l;u++)if(i=void 0,!h(o=r=-1===u?a:arguments[u])||(void 0!==(i=o[di])?!i:!pn(o)))So(s+1),Ze(c,s++,r);else for(n=O(r),So(s+n),e=0;e<n;e++,s++)e in r&&Ze(c,s,r[e]);return c.length=s,c}}),TypeError),vi={left:xo(!1),right:xo(!0)}.left;i({target:"Array",proto:!0,forced:!rt("reduce")||!A&&79<g&&g<83},{reduce:function(t){var e=arguments.length;return vi(this,t,e,1<e?arguments[1]:void 0)}});i({target:"Date",proto:!0,arity:1,forced:s(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})},{toJSON:function(t){var e=H(this),n=V(e,"number");return"number"!=typeof n||isFinite(n)?e.toISOString():null}}),i({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return m(URL.prototype.toString,this)}});var yi={NONE:"none",SUBGRAPH:"subgraph",ALL:"all"},D=L.mvc.View.extend({options:{paper:void 0,graph:void 0,boxContent:function(t){return L.util.template("<%= length %> elements selected.")({length:this.model.length})},handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElements"}},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"}},{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"}}],useModelGeometry:!1,strictSelection:!1,rotateAngleGrid:15,allowTranslate:!0,translateConnectedLinks:yi.ALL},className:"selection",events:{"mousedown .selection-box":"onSelectionBoxPointerDown","touchstart .selection-box":"onSelectionBoxPointerDown","mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown"},documentEvents:{mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},_action:null,init:function(){this.options.model&&(this.options.collection=this.options.model);var t=this.collection=this.options.collection||this.collection||new _.Collection;if(t.comparator||(t.comparator=this.constructor.depthComparator,t.sort()),this.model=t,!this.options.paper)throw new Error("Selection: paper required");L.util.defaults(this.options,{graph:this.options.paper.model}),L.util.bindAll(this,"startSelecting","stopSelecting","adjustSelection","pointerup"),this.options.paper.$el.append(this.$el),this._boxCount=0,this.$selectionWrapper=this.createSelectionWrapper(),this.handles=[],L.util.toArray(this.options.handles).forEach(this.addHandle,this),this.startListening()},startListening:function(){var t=this.options.paper,t=(this.listenTo(t,"scale translate",this.onPaperTransformation),this.options.graph),t=(this.listenTo(t,"reset",this.cancelSelection),this.listenTo(t,"change remove",this.onGraphChange),this.collection);this.listenTo(t,"remove",this.onRemoveElement),this.listenTo(t,"reset",this.onResetElements),this.listenTo(t,"add",this.onAddElement)},onPaperTransformation:function(){this.updateSelectionBoxes({async:!1})},onGraphChange:function(t,e){e.selection!==this.cid&&this.updateSelectionBoxes()},cancelSelection:function(){this.model.reset([],{ui:!0})},addHandle:function(n){this.handles.push(n);var t=o("<div/>",{class:"handle "+(n.position||"")+" "+(n.name||""),"data-action":n.name});return n.icon&&t.css("background-image","url("+n.icon+")"),t.html(n.content||""),L.util.setAttributesBySelector(t,n.attrs),this.$selectionWrapper.append(t),L.util.forIn(n.events,function(t,e){L.util.isString(t)?this.on("action:"+n.name+":"+e,this[t],this):this.on("action:"+n.name+":"+e,t)}.bind(this)),this},stopSelecting:function(t){var e=this.options.paper,n=this.eventData(t).action;switch(n){case"selecting":var r=this.$el.offset(),o=this.$el.width(),i=this.$el.height(),r=e.pageToLocalPoint(r.left,r.top),a=e.scale(),a=(o/=a.sx,i/=a.sy,L.g.rect(r.x,r.y,o,i)),o=this.getElementsInSelectedArea(a),c=this.options.filter,i=(Array.isArray(c)?o=o.filter(function(t){return!c.includes(t.model)&&!c.includes(t.model.get("type"))}):L.util.isFunction(c)&&(o=o.filter(function(t){return!c(t.model)})),o.map(function(t){return t.model}));this.model.reset(i,{ui:!0});break;case"translating":this.options.graph.stopBatch("selection-translate"),r=e.snapToGrid(t.clientX,t.clientY),this.notify("selection-box:pointerup",t,r.x,r.y);break;default:n||this.cancelSelection()}this._action=null},removeHandle:function(n){var t=L.util.toArray(this.handles).findIndex(function(t){return t.name===n}),e=this.handles[t];return e&&(L.util.forIn(e.events,function(t,e){this.off("action:"+n+":"+e)}.bind(this)),this.$(".handle."+n).remove(),this.handles.splice(t,1)),this},startSelecting:function(t){t=L.util.normalizeEvent(t),this.cancelSelection();var e=this.options.paper,e=e.localToPaperPoint(e.clientToLocalPoint({x:t.clientX,y:t.clientY}));this.$el.css({width:0,height:0,left:e.x,top:e.y}),this.showLasso(),this.eventData(t,{action:"selecting",clientX:t.clientX,clientY:t.clientY,origin:e}),this.delegateDocumentEvents(null,t.data),this._action="selecting"},changeHandle:function(e,t){var n=L.util.toArray(this.handles).find(function(t){return t&&t.name===e});return n&&(this.removeHandle(e),this.addHandle(L.util.merge({name:e},n,t))),this},onSelectionBoxPointerDown:function(t){t.stopPropagation(),t=L.util.normalizeEvent(t);var e=this.options,n=e.paper,e=e.allowTranslate,r=this.getCellView(t.target),e=(!e||r&&!r.can("elementMove")||this.startTranslatingSelection(t),this.eventData(t,{activeElementView:r}),n.snapToGrid(t.clientX,t.clientY));this.notify("selection-box:pointerdown",t,e.x,e.y),this.delegateDocumentEvents(null,t.data)},startTranslatingSelection:function(t){this.options.graph.startBatch("selection-translate");var e=this.options.paper.snapToGrid(t.clientX,t.clientY);this.eventData(t,{action:"translating",snappedClientX:e.x,snappedClientY:e.y}),this._action="translating"},adjustSelection:function(t){t=L.util.normalizeEvent(t);var e=this.eventData(t),n=e.action;switch(n){case"selecting":var r=this.options.paper,r=r.localToPaperPoint(r.clientToLocalPoint({x:t.clientX,y:t.clientY})),o=r.x-e.origin.x,i=r.y-e.origin.y,a=Math.abs(o),c=Math.abs(i),s=parseFloat(window.getComputedStyle(this.el).getPropertyValue("border-width"));this.$el.css({left:(o<0?r:e.origin).x,top:(i<0?r:e.origin).y,width:a-2*s,height:c-2*s});break;case"translating":var u,l,f,r=this.options.paper.snapToGrid(t.clientX,t.clientY),a=r.x,c=r.y,s=(o=a-e.snappedClientX,i=c-e.snappedClientY,this.options.paper.getRestrictedArea());s&&(r=this.model.toArray(),r=this.options.graph.getCellsBBox(r),l=s.x-r.x,u=s.y-r.y,(f=s.x+s.width-(r.x+r.width))<(o=o<l?l:o)&&(o=f),(l=s.y+s.height-(r.y+r.height))<(i=i<u?u:i)&&(i=l)),(o||i)&&(this.translateSelectedElements(o,i),this.boxesUpdated?1<this.model.length&&this.updateSelectionBoxes():(f=this.options.paper.scale(),this.$el.children(".selection-box").add(this.$selectionWrapper).css({left:"+="+o*f.sx,top:"+="+i*f.sy})),e.snappedClientX=a,e.snappedClientY=c),this.notify("selection-box:pointermove",t,a,c);break;default:n&&this.pointermove(t)}this.boxesUpdated=!1},translateSelectedElements:function(o,i){var e=this,a={},c=this.collection,t=this.options,n=t.graph,s=t.translateConnectedLinks;c.each(function(t){var r;a[t.id]||(r={selection:e.cid},t.translate(o,i,r),a[t.id]=!0,t.getEmbeddedCells({deep:!0}).forEach(function(t){a[t.id]=!0}),s!==yi.NONE&&n.getConnectedLinks(t).forEach(function(t){if(!a[t.id]){if(s===yi.SUBGRAPH){var e=t.getSourceCell();if(e&&!c.get(e))return;var n=t.getTargetCell();if(n&&!c.get(n))return;if(!e||!n)return}t.translate(o,i,r),a[t.id]=!0}}))})},notify:function(t,e){var e=this.eventData(e),n=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t,e.activeElementView].concat(n))},getElementsInSelectedArea:function(t){var e=this.options.paper,n={strict:this.options.strictSelection};return this.options.useModelGeometry?e.model.findModelsInArea(t,n).map(e.findViewByModel,e).filter(function(t){return!!t}):e.findViewsInArea(t,n)},pointerup:function(t){var e,n,r=this.eventData(t).action;r&&(t=L.util.normalizeEvent(t),e=(n=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY})).x,n=n.y,this.triggerAction(r,"pointerup",t,e,n),this.stopSelecting(t),this.undelegateDocumentEvents(),this._action=null)},destroySelectionBox:function(t){this.$('[data-model="'+t.get("id")+'"]').remove(),0===this.$el.children(".selection-box").length&&this.hide(),this._boxCount=Math.max(0,this._boxCount-1)},hide:function(){this.$el.removeClass("lasso selected")},showSelected:function(){this.$el.addClass("selected")},showLasso:function(){this.$el.addClass("lasso")},destroyAllSelectionBoxes:function(){this.hide(),this.$el.children(".selection-box").remove(),this._boxCount=0},createSelectionBox:function(t){var e=t.findView(this.options.paper);e&&(e=e.getBBox({useModelGeometry:this.options.useModelGeometry}),o("<div/>").addClass("selection-box").attr("data-model",t.get("id")).css({left:e.x,top:e.y,width:e.width,height:e.height}).appendTo(this.el),this.showSelected(),this._boxCount++)},createSelectionWrapper:function(){var t=o("<div/>",{class:"selection-wrapper"}),e=o("<div/>",{class:"box"});return t.append(e),t.attr("data-selection-length",this.model.length),this.$el.prepend(t),t},updateSelectionWrapper:function(){var t,e,n={x:1/0,y:1/0},r={x:0,y:0};this.model.each(function(t){var t=this.options.paper.findViewByModel(t);t&&(t=t.getBBox({useModelGeometry:this.options.useModelGeometry}),n.x=Math.min(n.x,t.x),n.y=Math.min(n.y,t.y),r.x=Math.max(r.x,t.x+t.width),r.y=Math.max(r.y,t.y+t.height))}.bind(this)),this.$selectionWrapper.css({left:n.x,top:n.y,width:r.x-n.x,height:r.y-n.y}).attr("data-selection-length",this.model.length),L.util.isFunction(this.options.boxContent)&&(t=this.$(".box"),(e=this.options.boxContent.call(this,t[0]))&&t.html(e))},updateSelectionBoxes:function(t){0!==this.collection.length&&(this.boxesUpdated=!0,this.options.paper.requestViewUpdate(this,1,this.UPDATE_PRIORITY,t))},confirmUpdate:function(){this._updateSelectionBoxes()},_updateSelectionBoxes:function(){if(this._boxCount){this.hide();for(var t=this.$el.children(".selection-box"),e=0,n=t.length;e<n;e++){var r=t[e],r=o(r).remove().attr("data-model"),r=this.model.get(r);r&&this.createSelectionBox(r)}this.updateSelectionWrapper()}},onHandlePointerDown:function(t){var e,n,r=t.currentTarget.dataset.action;r&&(t.preventDefault(),t.stopPropagation(),t=L.util.normalizeEvent(t),e=(n=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY})).x,n=n.y,"mousedown"===t.type&&2===t.button?this.triggerAction(r,"contextmenu",t,e,n):(this.triggerAction(r,"pointerdown",t,e,n),this.eventData(t,{action:r,clientX:t.clientX,clientY:t.clientY,startClientX:t.clientX,startClientY:t.clientY}),this.delegateDocumentEvents(null,t.data)),this._action=r)},getCellView:function(t){t=this.model.get(t.getAttribute("data-model"));return t&&t.findView(this.options.paper)},pointermove:function(t){var e,n,r,o,i,a,c=this.eventData(t),s=c.action;s&&(e=t.clientX,n=t.clientY,r=(o=(a=this.options.paper).snapToGrid(e,n)).x,o=o.y,i=(a=a.snapToGrid(c.clientX,c.clientY)).x,a=a.y,this.triggerAction(s,"pointermove",t,r,o,r-i,o-a),c.clientX=e,c.clientY=n)},triggerAction:function(t,e,n){var r=Array.prototype.slice.call(arguments,2);r.unshift("action:"+t+":"+e),this.trigger.apply(this,r)},onRemoveElement:function(t){this.destroySelectionBox(t),this.updateSelectionWrapper()},onResetElements:function(t){this.destroyAllSelectionBoxes(),t.each(this.createSelectionBox.bind(this)),this.updateSelectionWrapper()},onAddElement:function(t){this.createSelectionBox(t),this.updateSelectionWrapper()},removeElements:function(t){var e=this.collection.toArray();this.cancelSelection(),this.options.graph.removeCells(e,{selection:this.cid})},startRotating:function(t){var e=this.options,n=e.paper,e=e.graph,r=(e.trigger("batch:start"),this.collection.toArray()),e=e.getCellsBBox(this.model.models).center(),n=n.snapToGrid(t.clientX,t.clientY),o=r.reduce(function(t,e){return t[e.id]=e.angle(),t},{}),r=r.reduce(function(t,e){return e.isLink()&&(t[e.id]={source:e.getSourceCell()?null:e.get("source"),target:e.getTargetCell()?null:e.get("target"),vertices:e.vertices()}),t},{});this.eventData(t,{center:e,clientAngle:n.theta(e),initialAngles:o,initialPoints:r})},startResizing:function(t){var e=this.options,n=this.collection,r=e.paper,e=e.graph,o=r.options.gridSize,n=n.toArray(),i=e.getCellsBBox(n),a=i.width,i=i.height,r=r.snapToGrid(t.clientX,t.clientY),c=r.x,r=r.y,s=n.map(function(t){var e=t.angle(),t=t.getBBox(),n=t.bbox(e),r=e<=90?e/90:e<=270?Math.abs(180-e)/90:Math.abs(e-360)/90;return{angle:e,unrotatedBBox:t,bbox:n,factor:r,center:n.center()}}),u=s.reduce(function(t,e){e=e.unrotatedBBox;return e.width<t?e.width:t},1/0),l=s.reduce(function(t,e){e=e.unrotatedBBox;return e.height<t?e.height:t},1/0),f=e.getSubgraph(n),h=f.filter(function(t){return t.isLink()}),p=h.map(function(t){return{source:t.getSourceCell()?null:t.get("source"),target:t.getTargetCell()?null:t.get("target"),vertices:t.vertices()}}),f=e.getCellsBBox(f);this.eventData(t,{size:{width:a,height:i},rotatedBBox:e.getCellsBBox(n),minWidth:o*a/u,minHeight:o*i/l,x0:c,y0:r,pointerX:c,pointerY:r,elements:n,elementsRecords:s,links:h,linksRecords:p,cellsBBox:f}),e.trigger("batch:start")},doResize:function(t){var e=this.eventData(t),n=e.size,r=e.rotatedBBox,o=e.minWidth,i=e.minHeight,a=e.x0,c=e.y0,s=e.pointerX,u=e.pointerY,l=e.elements,f=e.elementsRecords,h=e.links,p=e.linksRecords,d=e.cellsBBox,t=this.options.paper.snapToGrid(t.clientX,t.clientY),g=t.x,t=t.y;if(g!==s||t!==u){e.lastX=g,e.lastY=t;for(var s=n.width,u=n.height,e=Math.max(s+g-a,o),n=Math.max(u+t-c,i),v=(this.options.preserveAspectRatio&&(e<(g=s*n/u)?n=u*e/s:e=g),Math.max(e/s,0)),y=Math.max(n/u,0),m=0,b=l.length;m<b;m++){var S=l[m],w=f[m],x=w.bbox,T=w.unrotatedBBox,E=w.factor,O=w.center,w=w.angle,E=new L.g.Point(v,y).lerp(new L.g.Point(y,v),E),T=T.clone().scale(E.x,E.y,O),E=T.bbox(w),O=E.width-x.width,w=E.height-x.height,E=(Math.abs(O)<.001&&(O=0),Math.abs(w)<.001&&(w=0),new L.g.Point(r.x,0).distance(new L.g.Point(x.x,0))),x=new L.g.Point(0,r.y).distance(new L.g.Point(0,x.y)),O=O/2+E*v-E,E=w/2+x*y-x;if(Math.abs(O)<.001&&(O=0),Math.abs(E)<.001&&(E=0),T.translate(O,E),0===m&&S.getBBox().equals(T))return;S.set({position:{x:T.x,y:T.y},size:{width:T.width,height:T.height}},{selection:this.cid})}for(var j=0,A=h.length;j<A;j++){var C=h[j],P=p[j],B=P.source,M=P.target,P=P.vertices,R={};0<P.length&&(R.vertices=P.map(function(t){t=new L.g.Point(t);return t.scale(v,y,d.origin()),t.toJSON()})),B&&((P=new L.g.Point(B)).scale(v,y,d.origin()),R.source=P.toJSON()),M&&((B=new L.g.Point(M)).scale(v,y,d.origin()),R.target=B.toJSON()),C.set(R,{selection:this.cid})}this.updateSelectionBoxes()}},doRotate:function(t){var c=this,s=this.eventData(t),u=this.options.rotateAngleGrid,t=this.options.paper.snapToGrid(t.clientX,t.clientY),l=s.clientAngle-L.g.point(t).theta(s.center);.001<Math.abs(l)&&(this.collection.each(function(t){var e,n,r,o,i,a=L.g.snapToGrid(s.initialAngles[t.id]+l,u);if(t.isLink())return e=(r=s.initialPoints[t.id]).source,n=r.target,r=r.vertices,o=function(t){return L.g.Point(t).rotate(s.center,-a)},i={},e&&(i.source=o(e)),n&&(i.target=o(n)),0<r.length&&(i.vertices=r.map(o)),t.set(i,{selection:c.cid});t.rotate(a,!0,s.center,{selection:c.cid})}),this.updateSelectionBoxes())},stopBatch:function(){this.options.graph.trigger("batch:stop")},getAction:function(){return this._action}},{depthComparator:function(t){return t.getAncestors().length},HandlePosition:{N:"n",NW:"nw",W:"w",SW:"sw",S:"s",SE:"se",E:"e",NE:"ne"},ConnectedLinksTranslation:yi}),w=D;N.Selection=D,N.SelectionView=w}(this.joint.ui=this.joint.ui||{},$,Backbone,joint);