import{d as pe,O as de,ac as ce,a5 as fe,a as b,L as _e,r as ye,M as s,N as y,b as u,S as o,Z as a,V as z,W as p,ah as C,$ as d,Q as S,R as K,a0 as ge,ae as ve,F as N,X as L,q as V,v as O,as as M,Y as g,ar as be,au as Z,ai as he,aj as we,aB as ke}from"./index.3614183b.js";/* empty css               *//* empty css              */import{P as W,a as Ce}from"./index.01976f6f.js";/* empty css               */import{_ as Te}from"./index.vue_vue_type_script_setup_true_lang.dc6c6f55.js";import"./index.5931ae8c.js";/* empty css              */import"./index.89207c6a.js";/* empty css               */import"./EditOutlined.cfe60ffa.js";import"./DeleteOutlined.a585300f.js";const $e={key:1},Se={key:1},Ne={key:1},Ie={key:1},Pe={key:0,style:{color:"red"}},Me=pe({__name:"updateAw",setup(Ve){var A;const{t:h}=de();async function Q(t){let e=await S.get(`/api/hlfs/${t}`);e&&(l.value={...e},l.value.returnType||(l.value.returnType=[]),w.value.setTableData(l.value.params),m.tags=e.tags,sessionStorage.setItem("awData"+i.params._id,JSON.stringify(e)))}let i=ce(),I=fe(),c=b(!((A=I.currentRoute.value.query)!=null&&A.canEdit)),w=b(null),k=[{title:"name",width:280},{title:"description",width:100},{title:"type",width:60,option:"1"},{title:"enum",width:100},{title:"default",width:100}];c.value&&k.push({title:"action",width:140,actionList:["edit","delete","check","up","down"]});const X=t=>{let e=w.value.getTableData();const r=e.findIndex(f=>JSON.stringify(f)===JSON.stringify(t));r!==-1&&(e.splice(r,1),w.value.setTableData(e),K.success(h("component.message.delText")))};_e(()=>{if(i.params._id){sessionStorage.setItem("awupdate_"+i.params._id,JSON.stringify(i.params._id)),sessionStorage.setItem("awupdate_"+i.params.awupdate,JSON.stringify(i.params.awupdate));let e=i.params.mbtid;localStorage.setItem("mbt"+i.params.mbtid+i.params.mbtname+"id",e),localStorage.setItem("mbt_"+i.params.mbtname+"aw",JSON.stringify(i.params.mbtname))}let t=sessionStorage.getItem("awupdate_"+i.params._id);Q(JSON.parse(t))});let v=b(""),D=b(),T=b(!1),l=b({key:0,name:"",description:"",template:"",template_en:"",validationError:"",returnType:[],_id:"",params:[],tags:[],path:""});const Y=()=>{w.value.createNewRow({required:!1,name:"",description:"",type:"",enum:[]})},R=t=>{const e=l.value.returnType.filter(r=>r!==t);l.value.returnType=e},J=()=>{let t=l.value.returnType;v.value&&(t.length>0?t.indexOf(v.value)===-1&&(l.value.returnType=[...t,v.value.toUpperCase()]):l.value.returnType=[...t,v.value.toUpperCase()]),v.value="",T.value=!1},G=()=>{T.value=!0,Z(()=>{D.value.focus()})};let F=b(),m=ye({tags:[],inputVisible:!1,inputValue:""});const q=t=>{const e=m.tags.filter(r=>r!==t);m.tags=e},H=()=>{m.inputVisible=!0,Z(()=>{F.value.focus()})},U=()=>{let t=m.tags;m.inputValue&&t.indexOf(m.inputValue)===-1&&(t=[...t,m.inputValue.toUpperCase()]),Object.assign(m,{tags:t,inputVisible:!1,inputValue:""})};let ee=sessionStorage.getItem("awupdate_"+i.params._id),j=sessionStorage.getItem("awupdate_"+i.params.awupdate),te=localStorage.getItem("mbt"+i.params.mbtid+i.params.mbtname+"id"),ae=localStorage.getItem("mbt_"+i.params.mbtname+"aw");async function le(t,e){delete e._id,await S.put(t,e)&&(c.value=!1,k=k.filter(f=>f.title!=="action"),w.value.changeColumn(k))}let B=b();const ne=()=>{B.value.validate().then(async t=>{if(l.value.tags=m.tags,l.value.params=w.value.getTableData(),l.value.params.some(e=>e.editing))return K.warning(h("component.message.tableEditingWarn"));await le(`/api/hlfs/${JSON.parse(ee)}`,l.value)}).catch(t=>{P.value=!0})},se=t=>{JSON.parse(j)=="awmodeler"?I.push("/awmodeler/index"):JSON.parse(j)=="mbtAW"&&I.push({name:"mbtmodeler",params:{_id:te,name:JSON.parse(ae)}})},re=()=>{c.value=!0,k.push({title:"action",width:140,actionList:["edit","delete","check","up","down"]}),w.value.changeColumn(k)};let P=b(!1),oe=i.params.name,ie={name:[{required:!0,validator:async(t,e)=>{let r=/^[a-zA-Z\$][a-zA-Z\d_]*$/,f=/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/;if(e){if(oe==e)return Promise.resolve();if(!r.test(e)&&!f.test(e))return Promise.reject(h("component.message.hefaName"));{let _=await S.get("/api/hlfs",{params:{q:`name:${e}`,search:""}});return _.data&&_.data.length>0&&_.data[0].name==e?Promise.reject(h("component.message.depName")):Promise.resolve()}}else return Promise.reject(h("component.message.emptyName"))},trigger:"blur"}],description:[{required:!0,validator:async(t,e)=>{if(e){if(l.value.description==e)return Promise.resolve();{let r=await S.get("/api/hlfs",{params:{search:l.value.description}});if(r.data&&r.data.length>0&&r.data[0].description==e)return P.value=!0,Promise.reject(h("component.message.dupDescription"))}return Promise.resolve()}else return Promise.reject(h("component.message.emptyDescription"))},trigger:"change"}],template:[{required:!0,validator:async(t,e)=>e?Promise.resolve():Promise.reject(h("awModeler.emptyTemp")),trigger:"change"}]};return(t,e)=>{const r=he,f=we,_=Ce,E=ke,$=ge,ue=ve;return s(),y("div",null,[u(ue,{ref_key:"refForm",ref:B,model:a(l),name:"basic",rules:a(ie),"label-col":{span:2},"wrapper-col":{span:12},autocomplete:"off"},{default:o(()=>[u(f,{label:t.$t("component.table.name"),name:"name"},{default:o(()=>[a(c)?(s(),d(r,{key:0,value:a(l).name,"onUpdate:value":e[0]||(e[0]=n=>a(l).name=n)},null,8,["value"])):(s(),y("span",$e,p(a(l).name),1))]),_:1},8,["label"]),u(f,{label:t.$t("component.table.description"),name:"description"},{default:o(()=>[a(c)?(s(),d(r,{key:0,value:a(l).description,"onUpdate:value":e[1]||(e[1]=n=>a(l).description=n)},null,8,["value"])):(s(),y("span",Se,p(a(l).description),1))]),_:1},8,["label"]),u(f,{label:t.$t("component.table.template"),name:"template"},{default:o(()=>[a(c)?(s(),d(r,{key:0,value:a(l).template,"onUpdate:value":e[2]||(e[2]=n=>a(l).template=n)},null,8,["value"])):(s(),y("span",Ne,p(a(l).template),1))]),_:1},8,["label"]),u(f,{label:t.$t("component.table.template_en"),name:"template_en"},{default:o(()=>[a(c)?(s(),d(r,{key:0,value:a(l).template_en,"onUpdate:value":e[3]||(e[3]=n=>a(l).template_en=n)},null,8,["value"])):(s(),y("span",Ie,p(a(l).template_en),1))]),_:1},8,["label"]),u(f,{label:t.$t("component.table.tags"),name:"tags"},{default:o(()=>[(s(!0),y(N,null,L(a(m).tags,(n,x)=>(s(),y(N,{key:n},[n.length>20?(s(),d(E,{key:0,title:n},{default:o(()=>[u(_,{closable:!0,onClose:me=>q(n)},{default:o(()=>[g(p(`${n.slice(0,20)}...`),1)]),_:2},1032,["onClose"])]),_:2},1032,["title"])):n.length==0?(s(),d(_,{key:1})):(s(),d(_,{key:2,closable:a(c),onClose:me=>q(n)},{default:o(()=>[g(p(n),1)]),_:2},1032,["closable","onClose"]))],64))),128)),V(u(r,{ref_key:"inputRef",ref:F,value:a(m).inputValue,"onUpdate:value":e[4]||(e[4]=n=>a(m).inputValue=n),type:"text",size:"small",style:{width:"78px"},onBlur:U,onKeyup:M(U,["enter"])},null,8,["value","onKeyup"]),[[O,a(m).inputVisible]]),V(u(_,{style:{background:"#fff","border-style":"dashed"},onClick:H},{default:o(()=>[u(a(W)),g(" "+p(t.$t("common.newTag")),1)]),_:1},512),[[O,!a(m).inputVisible&&a(c)]])]),_:1},8,["label"]),u(f,{label:t.$t("component.table.returnType"),name:"returnType"},{default:o(()=>[(s(!0),y(N,null,L(a(l).returnType,n=>(s(),y(N,{key:n},[n.length>20?(s(),d(E,{key:0,title:n},{default:o(()=>[u(_,{closable:!0,onClose:x=>R(n)},{default:o(()=>[g(p(`${n.slice(0,20)}...`),1)]),_:2},1032,["onClose"])]),_:2},1032,["title"])):n.length==0?(s(),d(_,{key:1})):(s(),d(_,{key:2,closable:!0,onClose:x=>R(n)},{default:o(()=>[g(p(n),1)]),_:2},1032,["onClose"]))],64))),128)),a(T)?(s(),d(r,{key:0,ref_key:"returnRef",ref:D,value:a(v),"onUpdate:value":e[5]||(e[5]=n=>be(v)?v.value=n:v=n),type:"text",size:"small",style:{width:"78px"},onBlur:J,onKeyup:M(J,["enter"])},null,8,["value","onKeyup"])):C("",!0),V(u(_,{style:{background:"#fff","border-style":"dashed"},onClick:G},{default:o(()=>[u(a(W)),g(" "+p(t.$t("common.newTag")),1)]),_:1},512),[[O,!a(T)&&a(c)]])]),_:1},8,["label"]),u(f,{label:t.$t("component.table.params"),name:"params"},{default:o(()=>[a(c)?(s(),d($,{key:0,onClick:Y},{default:o(()=>[g(p(t.$t("awModeler.addParams")),1)]),_:1})):C("",!0)]),_:1},8,["label"])]),_:1},8,["model","rules"]),u(a(Te),{ref_key:"awParamsTable",ref:w,columns:a(k),tableRef:"awParamsTable",onDelete:X},null,8,["columns"]),a(l).validationError?(s(),y("div",Pe,[z("p",null,p(a(l).validationError),1)])):C("",!0),z("div",null,[a(c)?C("",!0):(s(),d($,{key:0,typr:"primary",onClick:re},{default:o(()=>[g(p(t.$t("common.editText")),1)]),_:1})),a(c)?(s(),d($,{key:1,type:"primary",onClick:ne,disabled:a(P)},{default:o(()=>[g(p(t.$t("common.saveText")),1)]),_:1},8,["disabled"])):C("",!0),u($,{onClick:se},{default:o(()=>[g(p(t.$t("common.back")),1)]),_:1})])])}}});export{Me as default};
