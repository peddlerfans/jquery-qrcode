import{d as A,a as m,O as U,r as Z,w as E,M as x,N as L,V as Q,b as t,S as l,Z as n,ar as C,Q as y,az as W,$ as Y,ah as G,Y as H,W as J,au as K,ai as X,a0 as ee,ae,aj as te,aa as le}from"./index.3614183b.js";/* empty css               *//* empty css              */import{_ as ne}from"./index.c5cedc9d.js";/* empty css              *//* empty css               */import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang.dc6c6f55.js";import{_ as se}from"./index.351a724d.js";import{P as re}from"./index.01976f6f.js";import{_ as ie}from"./index.a4a12abb.js";import"./index.5931ae8c.js";import"./index.89207c6a.js";/* empty css               */import"./EditOutlined.cfe60ffa.js";import"./DeleteOutlined.a585300f.js";const ce={style:{height:"100%","overflow-x":"hidden!important"}},me={class:"block shadow",style:{width:"100%","margin-bottom":"1rem"}},ue=A({__name:"metatemplate",setup(pe){let _=m(null);const $=[{title:"name",width:40,link:"metaModeler",require:!0},{title:"description",width:120,require:!0},{title:"tags",width:100},{title:"action",width:100,actionList:["edit","delete","clone"]}],b={url:"/api/templates",searchText:"",createParams:"meta"},{t:f}=U(),s=Z({search:"",q:"category:meta"});E(()=>s.search,e=>{b.searchText=e});const q=async e=>{s.search="",_.value.query(s.search)},F=e=>{console.log(e)},M=()=>{_.value.createNewRow({name:"",description:"",category:"meta",tags:[]})};let w=m(),h=m(!1),d=m(""),g=m([{value:"tags:",label:"tags:",isLeaf:!1},{value:"name:",label:"name:"}]);const P=async e=>{console.log(e);let a=await y.get("/api/templates/_tags",{params:{q:"category:meta"}});const i=e[0];i.loading=!0,a.length>0&&(a=a.map(p=>({value:p,label:p})),i.children=a),i.loading=!1,g.value=[...g.value]},V=async e=>{if(e){let a=new RegExp(",","g");s.search+=e.toString().replace(a,"")}d.value="",h.value=!1,K(()=>{w.value.focus()})},N=e=>{s.search=="@"&&(h.value=!0)};let D=async(e,a)=>{let i=/^[a-zA-Z\$_][a-zA-Z\d_]*$/,p=/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/;if(a){if(!i.test(a)&&!p.test(a))return Promise.reject(f("templateManager.namehefa"));{let c=await y.get("/api/templates",{params:{q:"category:meta",search:`@name:${a}`}});return c.data&&c.data.length>0&&c.data[0].name==a?Promise.reject(f("templateManager.duplicate")):Promise.resolve()}}else return Promise.reject(f("templateManager.nameinput"))},v=m(),S={name:[{required:!0,validator:D,trigger:"blur"}]},r=m({name:""}),u=m(!1);const j=e=>{r.value.name=`${e.name}_clone`,r.value={...e,name:r.value.name},u.value=!0},B=()=>{n(v).validate().then(async()=>{delete r.value._id,y.post("/api/templates",r.value).then(e=>{let a=_.value.getTableData();a.unshift(e),_.value.setTableData(a),e&&e._id&&(u.value=!1)})})},I=()=>{v.value.clearValidate()};return(e,a)=>{const i=X,p=ne,c=ie,k=ee,T=ae,O=se,R=te,z=W;return x(),L("main",ce,[Q("header",me,[t(O,null,{default:l(()=>[t(c,{span:20},{default:l(()=>[t(T,{layout:"inline",class:"search_form",model:s,onFinish:q,onFinishFailed:F,"wrapper-col":{span:24}},{default:l(()=>[t(c,{span:20},{default:l(()=>[t(i,{value:s.search,"onUpdate:value":a[0]||(a[0]=o=>s.search=o),placeholder:e.$t("awModeler.inputSearch1"),onChange:N,ref_key:"searchInput",ref:w},null,8,["value","placeholder"]),n(h)?(x(),Y(p,{key:0,"load-data":P,value:n(d),"onUpdate:value":a[1]||(a[1]=o=>C(d)?d.value=o:d=o),placeholder:"Please select",options:n(g),onChange:V},null,8,["value","options"])):G("",!0)]),_:1}),t(c,{span:4},{default:l(()=>[t(k,{type:"primary","html-type":"submit"},{default:l(()=>[H(J(e.$t("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(c,{span:4},{default:l(()=>[t(k,{type:"primary",onClick:M},{icon:l(()=>[t(n(re))]),_:1})]),_:1})]),_:1})]),t(n(oe),{ref_key:"metaTable",ref:_,columns:$,tableRef:"metaTemplateTable",fetchObj:b,onClone:j},null,512),t(z,{visible:n(u),"onUpdate:visible":a[3]||(a[3]=o=>C(u)?u.value=o:u=o),title:e.$t("component.table.clone"),onOk:B,"ok-text":e.$t("common.okText"),"cancel-text":e.$t("common.cancelText"),onCancel:I},{default:l(()=>[t(T,{model:n(r),ref_key:"refCopy",ref:v,rules:n(S)},{default:l(()=>[t(R,{name:"name",label:e.$t("component.table.name")},{default:l(()=>[t(i,{value:n(r).name,"onUpdate:value":a[2]||(a[2]=o=>n(r).name=o)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["visible","title","ok-text","cancel-text"])])}}});const Fe=le(ue,[["__scopeId","data-v-0495d886"]]);export{Fe as default};
