var fk=Object.defineProperty;var gk=(c,d,v)=>d in c?fk(c,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):c[d]=v;var ae=(c,d,v)=>(gk(c,typeof d!="symbol"?d+"":d,v),v);import{c as Sd}from"./_commonjs-dynamic-modules.30ae7933.js";import{aq as ka,bT as iw,bU as Mr,Q as qv,bR as Jv,bP as vk}from"./index.3614183b.js";function pk(c,d){for(var v=0;v<d.length;v++){const f=d[v];if(typeof f!="string"&&!Array.isArray(f)){for(const b in f)if(b!=="default"&&!(b in c)){const I=Object.getOwnPropertyDescriptor(f,b);I&&Object.defineProperty(c,b,I.get?I:{enumerable:!0,get:()=>f[b]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}/*! JointJS+ v3.6.3 - HTML5 Diagramming Framework

Copyright (c) 2022 client IO

 2022-12-09 


This Source Code Form is subject to the terms of the JointJS+ License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/(function(c,d){typeof exports=="object"&&typeof module<"u"?d(exports,require("backbone"),require("lodash"),require("jquery")):typeof define=="function"&&define.amd?define(["exports","backbone","lodash","jquery"],d):(c=c||self,d(c.joint={},c.Backbone,c._,c.$))})(globalThis,function(c,d,v,f){d=d&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d,v=v&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v,f=f&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f;var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function I(t,e){return e={exports:{}},t(e,e.exports),e.exports}var P=function(t){this.ok=!1,this.alpha=1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t=t.replace(/ /g,""),t=t.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};t=e[t]||t;for(var r=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3]),parseFloat(l[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],i=0;i<r.length;i++){var n=r[i].re,a=r[i].process,o=n.exec(t);if(o){var s=a(o);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var l=this.r.toString(16),u=this.g.toString(16),g=this.b.toString(16);return l.length==1&&(l="0"+l),u.length==1&&(u="0"+u),g.length==1&&(g="0"+g),"#"+l+u+g},this.getHelpXML=function(){for(var l=new Array,u=0;u<r.length;u++)for(var g=r[u].example,h=0;h<g.length;h++)l[l.length]=g[h];for(var y in e)l[l.length]=y;var x=document.createElement("ul");x.setAttribute("id","rgbcolor-examples");for(var u=0;u<l.length;u++)try{var C=document.createElement("li"),p=new RGBColor(l[u]),E=document.createElement("div");E.style.cssText="margin: 3px; border: 1px solid black; background:"+p.toHex()+"; color:"+p.toHex(),E.appendChild(document.createTextNode("test"));var k=document.createTextNode(" "+l[u]+" -> "+p.toRGB()+" -> "+p.toHex());C.appendChild(E),C.appendChild(k),x.appendChild(C)}catch{}return x}},L=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],B=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function R(t,e,r,i){if(!(isNaN(i)||i<1)){i|=0;var n,a,o,s,l,u,g,h,y,x,C,p,E,k,w,S,T,m,A,M,N,D,z,_,j=i+i+1,V=e-1,W=r-1,Y=i+1,X=Y*(Y+1)/2,J=new O,Q=J;for(o=1;o<j;o++)if(Q=Q.next=new O,o==Y)var it=Q;Q.next=J;var st=null,gt=null;g=u=0;var nt=L[i],ut=B[i];for(a=0;a<r;a++){for(S=T=m=A=h=y=x=C=0,p=Y*(M=t[u]),E=Y*(N=t[u+1]),k=Y*(D=t[u+2]),w=Y*(z=t[u+3]),h+=X*M,y+=X*N,x+=X*D,C+=X*z,Q=J,o=0;o<Y;o++)Q.r=M,Q.g=N,Q.b=D,Q.a=z,Q=Q.next;for(o=1;o<Y;o++)s=u+((V<o?V:o)<<2),h+=(Q.r=M=t[s])*(_=Y-o),y+=(Q.g=N=t[s+1])*_,x+=(Q.b=D=t[s+2])*_,C+=(Q.a=z=t[s+3])*_,S+=M,T+=N,m+=D,A+=z,Q=Q.next;for(st=J,gt=it,n=0;n<e;n++)t[u+3]=z=C*nt>>ut,z!=0?(z=255/z,t[u]=(h*nt>>ut)*z,t[u+1]=(y*nt>>ut)*z,t[u+2]=(x*nt>>ut)*z):t[u]=t[u+1]=t[u+2]=0,h-=p,y-=E,x-=k,C-=w,p-=st.r,E-=st.g,k-=st.b,w-=st.a,s=g+((s=n+i+1)<V?s:V)<<2,S+=st.r=t[s],T+=st.g=t[s+1],m+=st.b=t[s+2],A+=st.a=t[s+3],h+=S,y+=T,x+=m,C+=A,st=st.next,p+=M=gt.r,E+=N=gt.g,k+=D=gt.b,w+=z=gt.a,S-=M,T-=N,m-=D,A-=z,gt=gt.next,u+=4;g+=e}for(n=0;n<e;n++){for(T=m=A=S=y=x=C=h=0,u=n<<2,p=Y*(M=t[u]),E=Y*(N=t[u+1]),k=Y*(D=t[u+2]),w=Y*(z=t[u+3]),h+=X*M,y+=X*N,x+=X*D,C+=X*z,Q=J,o=0;o<Y;o++)Q.r=M,Q.g=N,Q.b=D,Q.a=z,Q=Q.next;for(l=e,o=1;o<=i;o++)u=l+n<<2,h+=(Q.r=M=t[u])*(_=Y-o),y+=(Q.g=N=t[u+1])*_,x+=(Q.b=D=t[u+2])*_,C+=(Q.a=z=t[u+3])*_,S+=M,T+=N,m+=D,A+=z,Q=Q.next,o<W&&(l+=e);for(u=n,st=J,gt=it,a=0;a<r;a++)s=u<<2,t[s+3]=z=C*nt>>ut,z>0?(z=255/z,t[s]=(h*nt>>ut)*z,t[s+1]=(y*nt>>ut)*z,t[s+2]=(x*nt>>ut)*z):t[s]=t[s+1]=t[s+2]=0,h-=p,y-=E,x-=k,C-=w,p-=st.r,E-=st.g,k-=st.b,w-=st.a,s=n+((s=a+Y)<W?s:W)*e<<2,h+=S+=st.r=t[s],y+=T+=st.g=t[s+1],x+=m+=st.b=t[s+2],C+=A+=st.a=t[s+3],st=st.next,p+=M=gt.r,E+=N=gt.g,k+=D=gt.b,w+=z=gt.a,S-=M,T-=N,m-=D,A-=z,gt=gt.next,u+=e}}}function O(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var G=R;I(function(t){(function(e,r){if(t.exports){var i=P,n=G;t.exports=r(i,n)}e.canvg=r(typeof i<"u"?i:e.RGBColor,typeof statckblur<"u"?n:e.stackBlur)})(typeof window<"u"?window:b,function(e,r){if(typeof Element>"u")return;var i=function(C,p,E){if(C==null&&p==null&&E==null){for(var k=document.querySelectorAll("svg"),w=0;w<k.length;w++){var S=k[w],T=document.createElement("canvas");T.width=S.clientWidth,T.height=S.clientHeight,S.parentNode.insertBefore(T,S),S.parentNode.removeChild(S);var m=document.createElement("div");m.appendChild(S),i(T,m.innerHTML)}return}typeof C=="string"&&(C=document.getElementById(C)),C.svg!=null&&C.svg.stop();var A=x(E||{});C.childNodes.length==1&&C.childNodes[0].nodeName=="OBJECT"||(C.svg=A);var M=C.getContext("2d");typeof p.documentElement<"u"?A.loadXmlDoc(M,p):p.substr(0,1)=="<"?A.loadXml(M,p):A.load(M,p)},n;typeof Element.prototype.matches<"u"?n=function(C,p){return C.matches(p)}:typeof Element.prototype.webkitMatchesSelector<"u"?n=function(C,p){return C.webkitMatchesSelector(p)}:typeof Element.prototype.mozMatchesSelector<"u"?n=function(C,p){return C.mozMatchesSelector(p)}:typeof Element.prototype.msMatchesSelector<"u"?n=function(C,p){return C.msMatchesSelector(p)}:typeof Element.prototype.oMatchesSelector<"u"?n=function(C,p){return C.oMatchesSelector(p)}:((typeof jQuery=="function"||typeof Zepto=="function")&&(n=function(C,p){return $(C).is(p)}),typeof n>"u"&&(n=Sizzle.matchesSelector));var a=/(\[[^\]]+\])/g,o=/(#[^\s\+>~\.\[:]+)/g,s=/(\.[^\s\+>~\.\[:]+)/g,l=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,u=/(:[\w-]+\([^\)]*\))/gi,g=/(:[^\s\+>~\.\[:]+)/g,h=/([^\s\+>~\.\[:]+)/g;function y(C){var p=[0,0,0],E=function(k,w){var S=C.match(k);S!=null&&(p[w]+=S.length,C=C.replace(k," "))};return C=C.replace(/:not\(([^\)]*)\)/g,"     $1 "),C=C.replace(/{[\s\S]*/gm," "),E(a,1),E(o,0),E(s,1),E(l,2),E(u,1),E(g,1),C=C.replace(/[\*\s\+>~]/g," "),C=C.replace(/[#\.]/g," "),E(h,2),p.join("")}function x(C){var p={opts:C};p.FRAMERATE=30,p.MAX_VIRTUAL_PIXELS=3e4,p.log=function(k){},p.opts.log==!0&&typeof console<"u"&&(p.log=function(k){console.log(k)}),p.init=function(k){var w=0;p.UniqueId=function(){return w++,"canvg"+w},p.Definitions={},p.Styles={},p.StylesSpecificity={},p.Animations=[],p.Images=[],p.ctx=k,p.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(S,T){this.viewPorts.push({width:S,height:T})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(S){return S!=null&&typeof S=="number"?S:S=="x"?this.width():S=="y"?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},p.init(),p.ImagesLoaded=function(){for(var k=0;k<p.Images.length;k++)if(!p.Images[k].loaded)return!1;return!0},p.trim=function(k){return k.replace(/^\s+|\s+$/g,"")},p.compressSpaces=function(k){return k.replace(/[\s\r\t\n]+/gm," ")},p.ajax=function(k){var w;return window.XMLHttpRequest?w=new XMLHttpRequest:w=new ActiveXObject("Microsoft.XMLHTTP"),w?(w.open("GET",k,!1),w.send(null),w.responseText):null},p.parseXml=function(k){if(typeof Windows<"u"&&typeof Windows.Data<"u"&&typeof Windows.Data.Xml<"u"){var w=new Windows.Data.Xml.Dom.XmlDocument,S=new Windows.Data.Xml.Dom.XmlLoadSettings;return S.prohibitDtd=!1,w.loadXml(k,S),w}else if(window.DOMParser)try{var T=new DOMParser;return T.parseFromString(k,"image/svg+xml")}catch{return T=new DOMParser,T.parseFromString(k,"text/xml")}else{k=k.replace(/<!DOCTYPE svg[^>]*>/,"");var w=new ActiveXObject("Microsoft.XMLDOM");return w.async="false",w.loadXML(k),w}},p.Property=function(k,w){this.name=k,this.value=w},p.Property.prototype.getValue=function(){return this.value},p.Property.prototype.hasValue=function(){return this.value!=null&&this.value!==""},p.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var k=parseFloat(this.value);return(this.value+"").match(/%$/)&&(k=k/100),k},p.Property.prototype.valueOrDefault=function(k){return this.hasValue()?this.value:k},p.Property.prototype.numValueOrDefault=function(k){return this.hasValue()?this.numValue():k},p.Property.prototype.addOpacity=function(k){var w=this.value;if(k.value!=null&&k.value!=""&&typeof this.value=="string"){var S=new e(this.value);S.ok&&(w="rgba("+S.r+", "+S.g+", "+S.b+", "+k.numValue()+")")}return new p.Property(this.name,w)},p.Property.prototype.getDefinition=function(){var k=this.value.match(/#([^\)'"]+)/);return k&&(k=k[1]),k||(k=this.value),p.Definitions[k]},p.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0},p.Property.prototype.getFillStyleDefinition=function(k,w){var S=this.getDefinition();if(S!=null&&S.createGradient)return S.createGradient(p.ctx,k,w);if(S!=null&&S.createPattern){if(S.getHrefAttribute().hasValue()){var T=S.attribute("patternTransform");S=S.getHrefAttribute().getDefinition(),T.hasValue()&&(S.attribute("patternTransform",!0).value=T.value)}return S.createPattern(p.ctx,k)}return null},p.Property.prototype.getDPI=function(k){return 96},p.Property.prototype.getEM=function(k){var w=12,S=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);return S.hasValue()&&(w=S.toPixels(k)),w},p.Property.prototype.getUnits=function(){var k=this.value+"";return k.replace(/[0-9\.\-]/g,"")},p.Property.prototype.toPixels=function(k,w){if(!this.hasValue())return 0;var S=this.value+"";if(S.match(/em$/))return this.numValue()*this.getEM(k);if(S.match(/ex$/))return this.numValue()*this.getEM(k)/2;if(S.match(/px$/))return this.numValue();if(S.match(/pt$/))return this.numValue()*this.getDPI(k)*(1/72);if(S.match(/pc$/))return this.numValue()*15;if(S.match(/cm$/))return this.numValue()*this.getDPI(k)/2.54;if(S.match(/mm$/))return this.numValue()*this.getDPI(k)/25.4;if(S.match(/in$/))return this.numValue()*this.getDPI(k);if(S.match(/%$/))return this.numValue()*p.ViewPort.ComputeSize(k);var T=this.numValue();return w&&T<1?T*p.ViewPort.ComputeSize(k):T},p.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var k=this.value+"";return k.match(/s$/)?this.numValue()*1e3:k.match(/ms$/)?this.numValue():this.numValue()},p.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var k=this.value+"";return k.match(/deg$/)?this.numValue()*(Math.PI/180):k.match(/grad$/)?this.numValue()*(Math.PI/200):k.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var E={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return p.Property.prototype.toTextBaseline=function(){return this.hasValue()?E[this.value]:null},p.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(w,S,T,m,A,M){var N=M!=null?this.Parse(M):this.CreateFont("","","","","",p.ctx.font);return{fontFamily:A||N.fontFamily,fontSize:m||N.fontSize,fontStyle:w||N.fontStyle,fontWeight:T||N.fontWeight,fontVariant:S||N.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var k=this;this.Parse=function(w){for(var S={},T=p.trim(p.compressSpaces(w||"")).split(" "),m={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},A="",M=0;M<T.length;M++)!m.fontStyle&&k.Styles.indexOf(T[M])!=-1?(T[M]!="inherit"&&(S.fontStyle=T[M]),m.fontStyle=!0):!m.fontVariant&&k.Variants.indexOf(T[M])!=-1?(T[M]!="inherit"&&(S.fontVariant=T[M]),m.fontStyle=m.fontVariant=!0):!m.fontWeight&&k.Weights.indexOf(T[M])!=-1?(T[M]!="inherit"&&(S.fontWeight=T[M]),m.fontStyle=m.fontVariant=m.fontWeight=!0):m.fontSize?T[M]!="inherit"&&(A+=T[M]):(T[M]!="inherit"&&(S.fontSize=T[M].split("/")[0]),m.fontStyle=m.fontVariant=m.fontWeight=m.fontSize=!0);return A!=""&&(S.fontFamily=A),S}},p.ToNumberArray=function(k){for(var w=p.trim(p.compressSpaces((k||"").replace(/,/g," "))).split(" "),S=0;S<w.length;S++)w[S]=parseFloat(w[S]);return w},p.Point=function(k,w){this.x=k,this.y=w},p.Point.prototype.angleTo=function(k){return Math.atan2(k.y-this.y,k.x-this.x)},p.Point.prototype.applyTransform=function(k){var w=this.x*k[0]+this.y*k[2]+k[4],S=this.x*k[1]+this.y*k[3]+k[5];this.x=w,this.y=S},p.CreatePoint=function(k){var w=p.ToNumberArray(k);return new p.Point(w[0],w[1])},p.CreatePath=function(k){for(var w=p.ToNumberArray(k),S=[],T=0;T<w.length;T+=2)S.push(new p.Point(w[T],w[T+1]));return S},p.BoundingBox=function(k,w,S,T){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(m,A){m!=null&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=m,this.x2=m),m<this.x1&&(this.x1=m),m>this.x2&&(this.x2=m)),A!=null&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=A,this.y2=A),A<this.y1&&(this.y1=A),A>this.y2&&(this.y2=A))},this.addX=function(m){this.addPoint(m,null)},this.addY=function(m){this.addPoint(null,m)},this.addBoundingBox=function(m){this.addPoint(m.x1,m.y1),this.addPoint(m.x2,m.y2)},this.addQuadraticCurve=function(m,A,M,N,D,z){var _=m+.6666666666666666*(M-m),j=A+2/3*(N-A),V=_+1/3*(D-m),W=j+1/3*(z-A);this.addBezierCurve(m,A,_,V,j,W,D,z)},this.addBezierCurve=function(m,A,M,N,D,z,_,j){var V=[m,A],W=[M,N],Y=[D,z],X=[_,j];this.addPoint(V[0],V[1]),this.addPoint(X[0],X[1]);for(var J=0;J<=1;J++){var Q=function(xt){return Math.pow(1-xt,3)*V[J]+3*Math.pow(1-xt,2)*xt*W[J]+3*(1-xt)*Math.pow(xt,2)*Y[J]+Math.pow(xt,3)*X[J]},it=6*V[J]-12*W[J]+6*Y[J],st=-3*V[J]+9*W[J]-9*Y[J]+3*X[J],gt=3*W[J]-3*V[J];if(st==0){if(it==0)continue;var nt=-gt/it;0<nt&&nt<1&&(J==0&&this.addX(Q(nt)),J==1&&this.addY(Q(nt)));continue}var ut=Math.pow(it,2)-4*gt*st;if(!(ut<0)){var ft=(-it+Math.sqrt(ut))/(2*st);0<ft&&ft<1&&(J==0&&this.addX(Q(ft)),J==1&&this.addY(Q(ft)));var vt=(-it-Math.sqrt(ut))/(2*st);0<vt&&vt<1&&(J==0&&this.addX(Q(vt)),J==1&&this.addY(Q(vt)))}}},this.isPointInBox=function(m,A){return this.x1<=m&&m<=this.x2&&this.y1<=A&&A<=this.y2},this.addPoint(k,w),this.addPoint(S,T)},p.Transform=function(k){var w=this;this.Type={},this.Type.translate=function(D){this.p=p.CreatePoint(D),this.apply=function(z){z.translate(this.p.x||0,this.p.y||0)},this.unapply=function(z){z.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(z){z.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(D){var z=p.ToNumberArray(D);this.angle=new p.Property("angle",z[0]),this.cx=z[1]||0,this.cy=z[2]||0,this.apply=function(_){_.translate(this.cx,this.cy),_.rotate(this.angle.toRadians()),_.translate(-this.cx,-this.cy)},this.unapply=function(_){_.translate(this.cx,this.cy),_.rotate(-1*this.angle.toRadians()),_.translate(-this.cx,-this.cy)},this.applyToPoint=function(_){var j=this.angle.toRadians();_.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),_.applyTransform([Math.cos(j),Math.sin(j),-Math.sin(j),Math.cos(j),0,0]),_.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(D){this.p=p.CreatePoint(D),this.apply=function(z){z.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(z){z.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(z){z.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(D){this.m=p.ToNumberArray(D),this.apply=function(z){z.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(z){var _=this.m[0],j=this.m[2],V=this.m[4],W=this.m[1],Y=this.m[3],X=this.m[5],J=0,Q=0,it=1,st=1/(_*(Y*it-X*Q)-j*(W*it-X*J)+V*(W*Q-Y*J));z.transform(st*(Y*it-X*Q),st*(X*J-W*it),st*(V*Q-j*it),st*(_*it-V*J),st*(j*X-V*Y),st*(V*W-_*X))},this.applyToPoint=function(z){z.applyTransform(this.m)}},this.Type.SkewBase=function(D){this.base=w.Type.matrix,this.base(D),this.angle=new p.Property("angle",D)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(D){this.base=w.Type.SkewBase,this.base(D),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(D){this.base=w.Type.SkewBase,this.base(D),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(D){for(var z=0;z<this.transforms.length;z++)this.transforms[z].apply(D)},this.unapply=function(D){for(var z=this.transforms.length-1;z>=0;z--)this.transforms[z].unapply(D)},this.applyToPoint=function(D){for(var z=0;z<this.transforms.length;z++)this.transforms[z].applyToPoint(D)};for(var S=p.trim(p.compressSpaces(k)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),T=0;T<S.length;T++){var m=p.trim(S[T].split("(")[0]),A=S[T].split("(")[1].replace(")",""),M=this.Type[m];if(typeof M<"u"){var N=new M(A);N.type=m,this.transforms.push(N)}}},p.AspectRatio=function(k,w,S,T,m,A,M,N,D,z){w=p.compressSpaces(w),w=w.replace(/^defer\s/,"");var _=w.split(" ")[0]||"xMidYMid",j=w.split(" ")[1]||"meet",V=S/T,W=m/A,Y=Math.min(V,W),X=Math.max(V,W);j=="meet"&&(T*=Y,A*=Y),j=="slice"&&(T*=X,A*=X),D=new p.Property("refX",D),z=new p.Property("refY",z),D.hasValue()&&z.hasValue()?k.translate(-Y*D.toPixels("x"),-Y*z.toPixels("y")):(_.match(/^xMid/)&&(j=="meet"&&Y==W||j=="slice"&&X==W)&&k.translate(S/2-T/2,0),_.match(/YMid$/)&&(j=="meet"&&Y==V||j=="slice"&&X==V)&&k.translate(0,m/2-A/2),_.match(/^xMax/)&&(j=="meet"&&Y==W||j=="slice"&&X==W)&&k.translate(S-T,0),_.match(/YMax$/)&&(j=="meet"&&Y==V||j=="slice"&&X==V)&&k.translate(0,m-A)),_=="none"?k.scale(V,W):j=="meet"?k.scale(Y,Y):j=="slice"&&k.scale(X,X),k.translate(M==null?0:-M,N==null?0:-N)},p.Element={},p.EmptyProperty=new p.Property("EMPTY",""),p.Element.ElementBase=function(k){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(V,W){var Y=this.attributes[V];return Y!=null?Y:(W==!0&&(Y=new p.Property(V,""),this.attributes[V]=Y),Y||p.EmptyProperty)},this.getHrefAttribute=function(){for(var V in this.attributes)if(V=="href"||V.match(/:href$/))return this.attributes[V];return p.EmptyProperty},this.style=function(V,W,Y){var X=this.styles[V];if(X!=null)return X;var J=this.attribute(V);if(J!=null&&J.hasValue())return this.styles[V]=J,J;if(Y!=!0){var Q=this.parent;if(Q!=null){var it=Q.style(V);if(it!=null&&it.hasValue())return it}}return W==!0&&(X=new p.Property(V,""),this.styles[V]=X),X||p.EmptyProperty},this.render=function(V){if(this.style("display").value!="none"&&this.style("visibility").value!="hidden"){if(V.save(),this.style("mask").hasValue()){var W=this.style("mask").getDefinition();W!=null&&W.apply(V,this)}else if(this.style("filter").hasValue()){var Y=this.style("filter").getDefinition();Y!=null&&Y.apply(V,this)}else this.setContext(V),this.renderChildren(V),this.clearContext(V);V.restore()}},this.setContext=function(V){},this.clearContext=function(V){},this.renderChildren=function(V){for(var W=0;W<this.children.length;W++)this.children[W].render(V)},this.addChild=function(V,W){var Y=V;W&&(Y=p.CreateElement(V)),Y.parent=this,Y.type!="title"&&this.children.push(Y)},this.addStylesFromStyleDefinition=function(){for(var V in p.Styles)if(V[0]!="@"&&n(k,V)){var W=p.Styles[V],Y=p.StylesSpecificity[V];if(W!=null)for(var X in W){var J=this.stylesSpecificity[X];typeof J>"u"&&(J="000"),Y>J&&(this.styles[X]=W[X],this.stylesSpecificity[X]=Y)}}};var w=new RegExp("^[A-Z-]+$"),S=function(V){return w.test(V)?V.toLowerCase():V};if(k!=null&&k.nodeType==1){for(var T=0;T<k.attributes.length;T++){var m=k.attributes[T],A=S(m.nodeName);this.attributes[A]=new p.Property(A,m.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){for(var M=this.attribute("style").value.split(";"),T=0;T<M.length;T++)if(p.trim(M[T])!=""){var N=M[T].split(":"),D=p.trim(N[0]),z=p.trim(N[1]);this.styles[D]=new p.Property(D,z)}}this.attribute("id").hasValue()&&p.Definitions[this.attribute("id").value]==null&&(p.Definitions[this.attribute("id").value]=this);for(var T=0;T<k.childNodes.length;T++){var _=k.childNodes[T];if(_.nodeType==1&&this.addChild(_,!0),this.captureTextNodes&&(_.nodeType==3||_.nodeType==4)){var j=_.value||_.text||_.textContent||"";p.compressSpaces(j)!=""&&this.addChild(new p.Element.tspan(_),!1)}}}},p.Element.RenderedElementBase=function(k){this.base=p.Element.ElementBase,this.base(k),this.setContext=function(w){if(this.style("fill").isUrlDefinition()){var S=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));S!=null&&(w.fillStyle=S)}else if(this.style("fill").hasValue()){var T=this.style("fill");T.value=="currentColor"&&(T.value=this.style("color").value),T.value!="inherit"&&(w.fillStyle=T.value=="none"?"rgba(0,0,0,0)":T.value)}if(this.style("fill-opacity").hasValue()){var T=new p.Property("fill",w.fillStyle);T=T.addOpacity(this.style("fill-opacity")),w.fillStyle=T.value}if(this.style("stroke").isUrlDefinition()){var S=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));S!=null&&(w.strokeStyle=S)}else if(this.style("stroke").hasValue()){var m=this.style("stroke");m.value=="currentColor"&&(m.value=this.style("color").value),m.value!="inherit"&&(w.strokeStyle=m.value=="none"?"rgba(0,0,0,0)":m.value)}if(this.style("stroke-opacity").hasValue()){var m=new p.Property("stroke",w.strokeStyle);m=m.addOpacity(this.style("stroke-opacity")),w.strokeStyle=m.value}if(this.style("stroke-width").hasValue()){var A=this.style("stroke-width").toPixels();w.lineWidth=A==0?.001:A}if(this.style("stroke-linecap").hasValue()&&(w.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(w.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(w.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var M=p.ToNumberArray(this.style("stroke-dasharray").value);typeof w.setLineDash<"u"?w.setLineDash(M):typeof w.webkitLineDash<"u"?w.webkitLineDash=M:typeof w.mozDash<"u"&&!(M.length==1&&M[0]==0)&&(w.mozDash=M);var N=this.style("stroke-dashoffset").numValueOrDefault(1);typeof w.lineDashOffset<"u"?w.lineDashOffset=N:typeof w.webkitLineDashOffset<"u"?w.webkitLineDashOffset=N:typeof w.mozDashOffset<"u"&&(w.mozDashOffset=N)}if(typeof w.font<"u"&&(w.font=p.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){var D=new p.Transform(this.style("transform",!1,!0).value);D.apply(w)}if(this.style("clip-path",!1,!0).hasValue()){var z=this.style("clip-path",!1,!0).getDefinition();z!=null&&z.apply(w)}this.style("opacity").hasValue()&&(w.globalAlpha=this.style("opacity").numValue())}},p.Element.RenderedElementBase.prototype=new p.Element.ElementBase,p.Element.PathElementBase=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.path=function(w){return w!=null&&w.beginPath(),new p.BoundingBox},this.renderChildren=function(w){this.path(w),p.Mouse.checkPath(this,w),w.fillStyle!=""&&(this.style("fill-rule").valueOrDefault("inherit")!="inherit"?w.fill(this.style("fill-rule").value):w.fill()),w.strokeStyle!=""&&w.stroke();var S=this.getMarkers();if(S!=null){if(this.style("marker-start").isUrlDefinition()){var T=this.style("marker-start").getDefinition();T.render(w,S[0][0],S[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var T=this.style("marker-mid").getDefinition(),m=1;m<S.length-1;m++)T.render(w,S[m][0],S[m][1]);if(this.style("marker-end").isUrlDefinition()){var T=this.style("marker-end").getDefinition();T.render(w,S[S.length-1][0],S[S.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},p.Element.PathElementBase.prototype=new p.Element.RenderedElementBase,p.Element.svg=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.baseClearContext=this.clearContext,this.clearContext=function(w){this.baseClearContext(w),p.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(w){w.strokeStyle="rgba(0,0,0,0)",w.lineCap="butt",w.lineJoin="miter",w.miterLimit=4,typeof w.font<"u"&&typeof window.getComputedStyle<"u"&&(w.font=window.getComputedStyle(w.canvas).getPropertyValue("font")),this.baseSetContext(w),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),w.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var S=p.ViewPort.width(),T=p.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),typeof this.root>"u"){S=this.attribute("width").toPixels("x"),T=this.attribute("height").toPixels("y");var m=0,A=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(m=-this.attribute("refX").toPixels("x"),A=-this.attribute("refY").toPixels("y")),this.attribute("overflow").valueOrDefault("hidden")!="visible"&&(w.beginPath(),w.moveTo(m,A),w.lineTo(S,A),w.lineTo(S,T),w.lineTo(m,T),w.closePath(),w.clip())}if(p.ViewPort.SetCurrent(S,T),this.attribute("viewBox").hasValue()){var M=p.ToNumberArray(this.attribute("viewBox").value),N=M[0],D=M[1];S=M[2],T=M[3],p.AspectRatio(w,this.attribute("preserveAspectRatio").value,p.ViewPort.width(),S,p.ViewPort.height(),T,N,D,this.attribute("refX").value,this.attribute("refY").value),p.ViewPort.RemoveCurrent(),p.ViewPort.SetCurrent(M[2],M[3])}}},p.Element.svg.prototype=new p.Element.RenderedElementBase,p.Element.rect=function(k){this.base=p.Element.PathElementBase,this.base(k),this.path=function(w){var S=this.attribute("x").toPixels("x"),T=this.attribute("y").toPixels("y"),m=this.attribute("width").toPixels("x"),A=this.attribute("height").toPixels("y"),M=this.attribute("rx").toPixels("x"),N=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(N=M),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(M=N),M=Math.min(M,m/2),N=Math.min(N,A/2),w!=null&&(w.beginPath(),w.moveTo(S+M,T),w.lineTo(S+m-M,T),w.quadraticCurveTo(S+m,T,S+m,T+N),w.lineTo(S+m,T+A-N),w.quadraticCurveTo(S+m,T+A,S+m-M,T+A),w.lineTo(S+M,T+A),w.quadraticCurveTo(S,T+A,S,T+A-N),w.lineTo(S,T+N),w.quadraticCurveTo(S,T,S+M,T),w.closePath()),new p.BoundingBox(S,T,S+m,T+A)}},p.Element.rect.prototype=new p.Element.PathElementBase,p.Element.circle=function(k){this.base=p.Element.PathElementBase,this.base(k),this.path=function(w){var S=this.attribute("cx").toPixels("x"),T=this.attribute("cy").toPixels("y"),m=this.attribute("r").toPixels();return w!=null&&(w.beginPath(),w.arc(S,T,m,0,Math.PI*2,!0),w.closePath()),new p.BoundingBox(S-m,T-m,S+m,T+m)}},p.Element.circle.prototype=new p.Element.PathElementBase,p.Element.ellipse=function(k){this.base=p.Element.PathElementBase,this.base(k),this.path=function(w){var S=4*((Math.sqrt(2)-1)/3),T=this.attribute("rx").toPixels("x"),m=this.attribute("ry").toPixels("y"),A=this.attribute("cx").toPixels("x"),M=this.attribute("cy").toPixels("y");return w!=null&&(w.beginPath(),w.moveTo(A,M-m),w.bezierCurveTo(A+S*T,M-m,A+T,M-S*m,A+T,M),w.bezierCurveTo(A+T,M+S*m,A+S*T,M+m,A,M+m),w.bezierCurveTo(A-S*T,M+m,A-T,M+S*m,A-T,M),w.bezierCurveTo(A-T,M-S*m,A-S*T,M-m,A,M-m),w.closePath()),new p.BoundingBox(A-T,M-m,A+T,M+m)}},p.Element.ellipse.prototype=new p.Element.PathElementBase,p.Element.line=function(k){this.base=p.Element.PathElementBase,this.base(k),this.getPoints=function(){return[new p.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new p.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(w){var S=this.getPoints();return w!=null&&(w.beginPath(),w.moveTo(S[0].x,S[0].y),w.lineTo(S[1].x,S[1].y)),new p.BoundingBox(S[0].x,S[0].y,S[1].x,S[1].y)},this.getMarkers=function(){var w=this.getPoints(),S=w[0].angleTo(w[1]);return[[w[0],S],[w[1],S]]}},p.Element.line.prototype=new p.Element.PathElementBase,p.Element.polyline=function(k){this.base=p.Element.PathElementBase,this.base(k),this.points=p.CreatePath(this.attribute("points").value),this.path=function(w){var S=new p.BoundingBox(this.points[0].x,this.points[0].y);w!=null&&(w.beginPath(),w.moveTo(this.points[0].x,this.points[0].y));for(var T=1;T<this.points.length;T++)S.addPoint(this.points[T].x,this.points[T].y),w!=null&&w.lineTo(this.points[T].x,this.points[T].y);return S},this.getMarkers=function(){for(var w=[],S=0;S<this.points.length-1;S++)w.push([this.points[S],this.points[S].angleTo(this.points[S+1])]);return w.length>0&&w.push([this.points[this.points.length-1],w[w.length-1][1]]),w}},p.Element.polyline.prototype=new p.Element.PathElementBase,p.Element.polygon=function(k){this.base=p.Element.polyline,this.base(k),this.basePath=this.path,this.path=function(w){var S=this.basePath(w);return w!=null&&(w.lineTo(this.points[0].x,this.points[0].y),w.closePath()),S}},p.Element.polygon.prototype=new p.Element.polyline,p.Element.path=function(k){this.base=p.Element.PathElementBase,this.base(k);var w=this.attribute("d").value;w=w.replace(/,/gm," ");for(var S=0;S<2;S++)w=w.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");w=w.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),w=w.replace(/([0-9])([+\-])/gm,"$1 $2");for(var S=0;S<2;S++)w=w.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");w=w.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),w=p.compressSpaces(w),w=p.trim(w),this.PathParser=new function(T){this.tokens=T.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new p.Point(0,0),this.control=new p.Point(0,0),this.current=new p.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var m=new p.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(m)},this.getAsControlPoint=function(){var m=this.getPoint();return this.control=m,m},this.getAsCurrentPoint=function(){var m=this.getPoint();return this.current=m,m},this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t")return this.current;var m=new p.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return m},this.makeAbsolute=function(m){return this.isRelativeCommand()&&(m.x+=this.current.x,m.y+=this.current.y),m},this.addMarker=function(m,A,M){M!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(M)),this.addMarkerAngle(m,A==null?null:A.angleTo(m))},this.addMarkerAngle=function(m,A){this.points.push(m),this.angles.push(A)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var m=0;m<this.angles.length;m++)if(this.angles[m]==null){for(var A=m+1;A<this.angles.length;A++)if(this.angles[A]!=null){this.angles[m]=this.angles[A];break}}return this.angles}}(w),this.path=function(T){var m=this.PathParser;m.reset();var A=new p.BoundingBox;for(T!=null&&T.beginPath();!m.isEnd();)switch(m.nextCommand(),m.command){case"M":case"m":var M=m.getAsCurrentPoint();for(m.addMarker(M),A.addPoint(M.x,M.y),T!=null&&T.moveTo(M.x,M.y),m.start=m.current;!m.isCommandOrEnd();){var M=m.getAsCurrentPoint();m.addMarker(M,m.start),A.addPoint(M.x,M.y),T!=null&&T.lineTo(M.x,M.y)}break;case"L":case"l":for(;!m.isCommandOrEnd();){var N=m.current,M=m.getAsCurrentPoint();m.addMarker(M,N),A.addPoint(M.x,M.y),T!=null&&T.lineTo(M.x,M.y)}break;case"H":case"h":for(;!m.isCommandOrEnd();){var D=new p.Point((m.isRelativeCommand()?m.current.x:0)+m.getScalar(),m.current.y);m.addMarker(D,m.current),m.current=D,A.addPoint(m.current.x,m.current.y),T!=null&&T.lineTo(m.current.x,m.current.y)}break;case"V":case"v":for(;!m.isCommandOrEnd();){var D=new p.Point(m.current.x,(m.isRelativeCommand()?m.current.y:0)+m.getScalar());m.addMarker(D,m.current),m.current=D,A.addPoint(m.current.x,m.current.y),T!=null&&T.lineTo(m.current.x,m.current.y)}break;case"C":case"c":for(;!m.isCommandOrEnd();){var z=m.current,_=m.getPoint(),j=m.getAsControlPoint(),V=m.getAsCurrentPoint();m.addMarker(V,j,_),A.addBezierCurve(z.x,z.y,_.x,_.y,j.x,j.y,V.x,V.y),T!=null&&T.bezierCurveTo(_.x,_.y,j.x,j.y,V.x,V.y)}break;case"S":case"s":for(;!m.isCommandOrEnd();){var z=m.current,_=m.getReflectedControlPoint(),j=m.getAsControlPoint(),V=m.getAsCurrentPoint();m.addMarker(V,j,_),A.addBezierCurve(z.x,z.y,_.x,_.y,j.x,j.y,V.x,V.y),T!=null&&T.bezierCurveTo(_.x,_.y,j.x,j.y,V.x,V.y)}break;case"Q":case"q":for(;!m.isCommandOrEnd();){var z=m.current,j=m.getAsControlPoint(),V=m.getAsCurrentPoint();m.addMarker(V,j,j),A.addQuadraticCurve(z.x,z.y,j.x,j.y,V.x,V.y),T!=null&&T.quadraticCurveTo(j.x,j.y,V.x,V.y)}break;case"T":case"t":for(;!m.isCommandOrEnd();){var z=m.current,j=m.getReflectedControlPoint();m.control=j;var V=m.getAsCurrentPoint();m.addMarker(V,j,j),A.addQuadraticCurve(z.x,z.y,j.x,j.y,V.x,V.y),T!=null&&T.quadraticCurveTo(j.x,j.y,V.x,V.y)}break;case"A":case"a":for(;!m.isCommandOrEnd();){var z=m.current,W=m.getScalar(),Y=m.getScalar(),X=m.getScalar()*(Math.PI/180),J=m.getScalar(),Q=m.getScalar(),V=m.getAsCurrentPoint(),it=new p.Point(Math.cos(X)*(z.x-V.x)/2+Math.sin(X)*(z.y-V.y)/2,-Math.sin(X)*(z.x-V.x)/2+Math.cos(X)*(z.y-V.y)/2),st=Math.pow(it.x,2)/Math.pow(W,2)+Math.pow(it.y,2)/Math.pow(Y,2);st>1&&(W*=Math.sqrt(st),Y*=Math.sqrt(st));var gt=(J==Q?-1:1)*Math.sqrt((Math.pow(W,2)*Math.pow(Y,2)-Math.pow(W,2)*Math.pow(it.y,2)-Math.pow(Y,2)*Math.pow(it.x,2))/(Math.pow(W,2)*Math.pow(it.y,2)+Math.pow(Y,2)*Math.pow(it.x,2)));isNaN(gt)&&(gt=0);var nt=new p.Point(gt*W*it.y/Y,gt*-Y*it.x/W),ut=new p.Point((z.x+V.x)/2+Math.cos(X)*nt.x-Math.sin(X)*nt.y,(z.y+V.y)/2+Math.sin(X)*nt.x+Math.cos(X)*nt.y),ft=function(ce){return Math.sqrt(Math.pow(ce[0],2)+Math.pow(ce[1],2))},vt=function(ce,Se){return(ce[0]*Se[0]+ce[1]*Se[1])/(ft(ce)*ft(Se))},xt=function(ce,Se){return(ce[0]*Se[1]<ce[1]*Se[0]?-1:1)*Math.acos(vt(ce,Se))},Et=xt([1,0],[(it.x-nt.x)/W,(it.y-nt.y)/Y]),Rt=[(it.x-nt.x)/W,(it.y-nt.y)/Y],It=[(-it.x-nt.x)/W,(-it.y-nt.y)/Y],Wt=xt(Rt,It);vt(Rt,It)<=-1&&(Wt=Math.PI),vt(Rt,It)>=1&&(Wt=0);var St=1-Q?1:-1,Ct=Et+St*(Wt/2),jt=new p.Point(ut.x+W*Math.cos(Ct),ut.y+Y*Math.sin(Ct));if(m.addMarkerAngle(jt,Ct-St*Math.PI/2),m.addMarkerAngle(V,Ct-St*Math.PI),A.addPoint(V.x,V.y),T!=null){var vt=W>Y?W:Y,wt=W>Y?1:W/Y,pt=W>Y?Y/W:1;T.translate(ut.x,ut.y),T.rotate(X),T.scale(wt,pt),T.arc(0,0,vt,Et,Et+Wt,1-Q),T.scale(1/wt,1/pt),T.rotate(-X),T.translate(-ut.x,-ut.y)}}break;case"Z":case"z":T!=null&&T.closePath(),m.current=m.start}return A},this.getMarkers=function(){for(var T=this.PathParser.getMarkerPoints(),m=this.PathParser.getMarkerAngles(),A=[],M=0;M<T.length;M++)A.push([T[M],m[M]]);return A}},p.Element.path.prototype=new p.Element.PathElementBase,p.Element.pattern=function(k){this.base=p.Element.ElementBase,this.base(k),this.createPattern=function(w,S){var T=this.attribute("width").toPixels("x",!0),m=this.attribute("height").toPixels("y",!0),A=new p.Element.svg;A.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value),A.attributes.width=new p.Property("width",T+"px"),A.attributes.height=new p.Property("height",m+"px"),A.attributes.transform=new p.Property("transform",this.attribute("patternTransform").value),A.children=this.children;var M=document.createElement("canvas");M.width=T,M.height=m;var N=M.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&N.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var D=-1;D<=1;D++)for(var z=-1;z<=1;z++)N.save(),A.attributes.x=new p.Property("x",D*M.width),A.attributes.y=new p.Property("y",z*M.height),A.render(N),N.restore();var _=w.createPattern(M,"repeat");return _}},p.Element.pattern.prototype=new p.Element.ElementBase,p.Element.marker=function(k){this.base=p.Element.ElementBase,this.base(k),this.baseRender=this.render,this.render=function(w,S,T){w.translate(S.x,S.y),this.attribute("orient").valueOrDefault("auto")=="auto"&&w.rotate(T),this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"&&w.scale(w.lineWidth,w.lineWidth),w.save();var m=new p.Element.svg;m.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value),m.attributes.refX=new p.Property("refX",this.attribute("refX").value),m.attributes.refY=new p.Property("refY",this.attribute("refY").value),m.attributes.width=new p.Property("width",this.attribute("markerWidth").value),m.attributes.height=new p.Property("height",this.attribute("markerHeight").value),m.attributes.fill=new p.Property("fill",this.attribute("fill").valueOrDefault("black")),m.attributes.stroke=new p.Property("stroke",this.attribute("stroke").valueOrDefault("none")),m.children=this.children,m.render(w),w.restore(),this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"&&w.scale(1/w.lineWidth,1/w.lineWidth),this.attribute("orient").valueOrDefault("auto")=="auto"&&w.rotate(-T),w.translate(-S.x,-S.y)}},p.Element.marker.prototype=new p.Element.ElementBase,p.Element.defs=function(k){this.base=p.Element.ElementBase,this.base(k),this.render=function(w){}},p.Element.defs.prototype=new p.Element.ElementBase,p.Element.GradientBase=function(k){this.base=p.Element.ElementBase,this.base(k),this.stops=[];for(var w=0;w<this.children.length;w++){var S=this.children[w];S.type=="stop"&&this.stops.push(S)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(T){for(var m=0;m<this.attributesToInherit.length;m++){var A=this.attributesToInherit[m];!this.attribute(A).hasValue()&&T.attribute(A).hasValue()&&(this.attribute(A,!0).value=T.attribute(A).value)}},this.createGradient=function(T,m,A){var M=this;this.getHrefAttribute().hasValue()&&(M=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(M));var N=function(J){if(A.hasValue()){var Q=new p.Property("color",J);return Q.addOpacity(A).value}return J},D=this.getGradient(T,m);if(D==null)return N(M.stops[M.stops.length-1].color);for(var z=0;z<M.stops.length;z++)D.addColorStop(M.stops[z].offset,N(M.stops[z].color));if(this.attribute("gradientTransform").hasValue()){var _=p.ViewPort.viewPorts[0],j=new p.Element.rect;j.attributes.x=new p.Property("x",-p.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new p.Property("y",-p.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new p.Property("width",p.MAX_VIRTUAL_PIXELS),j.attributes.height=new p.Property("height",p.MAX_VIRTUAL_PIXELS);var V=new p.Element.g;V.attributes.transform=new p.Property("transform",this.attribute("gradientTransform").value),V.children=[j];var W=new p.Element.svg;W.attributes.x=new p.Property("x",0),W.attributes.y=new p.Property("y",0),W.attributes.width=new p.Property("width",_.width),W.attributes.height=new p.Property("height",_.height),W.children=[V];var Y=document.createElement("canvas");Y.width=_.width,Y.height=_.height;var X=Y.getContext("2d");return X.fillStyle=D,W.render(X),X.createPattern(Y,"no-repeat")}return D}},p.Element.GradientBase.prototype=new p.Element.ElementBase,p.Element.linearGradient=function(k){this.base=p.Element.GradientBase,this.base(k),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(w,S){var T=this.gradientUnits()=="objectBoundingBox"?S.getBoundingBox():null;!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()&&(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var m=this.gradientUnits()=="objectBoundingBox"?T.x()+T.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),A=this.gradientUnits()=="objectBoundingBox"?T.y()+T.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),M=this.gradientUnits()=="objectBoundingBox"?T.x()+T.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),N=this.gradientUnits()=="objectBoundingBox"?T.y()+T.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return m==M&&A==N?null:w.createLinearGradient(m,A,M,N)}},p.Element.linearGradient.prototype=new p.Element.GradientBase,p.Element.radialGradient=function(k){this.base=p.Element.GradientBase,this.base(k),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(w,S){var T=S.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var m=this.gradientUnits()=="objectBoundingBox"?T.x()+T.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),A=this.gradientUnits()=="objectBoundingBox"?T.y()+T.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),M=m,N=A;this.attribute("fx").hasValue()&&(M=this.gradientUnits()=="objectBoundingBox"?T.x()+T.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(N=this.gradientUnits()=="objectBoundingBox"?T.y()+T.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var D=this.gradientUnits()=="objectBoundingBox"?(T.width()+T.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return w.createRadialGradient(M,N,0,m,A,D)}},p.Element.radialGradient.prototype=new p.Element.GradientBase,p.Element.stop=function(k){this.base=p.Element.ElementBase,this.base(k),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var w=this.style("stop-color",!0);w.value===""&&(w.value="#000"),this.style("stop-opacity").hasValue()&&(w=w.addOpacity(this.style("stop-opacity"))),this.color=w.value},p.Element.stop.prototype=new p.Element.ElementBase,p.Element.AnimateBase=function(k){this.base=p.Element.ElementBase,this.base(k),p.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var w=this.attribute("attributeType").value,S=this.attribute("attributeName").value;return w=="CSS"?this.parent.style(S,!0):this.parent.attribute(S,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(w){if(this.initialValue==null&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite")this.duration=0;else if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration=this.duration+w;var S=!1;if(this.begin<this.duration){var T=this.calcValue();if(this.attribute("type").hasValue()){var m=this.attribute("type").value;T=m+"("+T+")"}this.getProperty().value=T,S=!0}return S},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var w={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var S=w.progress*(this.values.value.length-1),T=Math.floor(S),m=Math.ceil(S);w.from=new p.Property("from",parseFloat(this.values.value[T])),w.to=new p.Property("to",parseFloat(this.values.value[m])),w.progress=(S-T)/(m-T)}else w.from=this.from,w.to=this.to;return w}},p.Element.AnimateBase.prototype=new p.Element.ElementBase,p.Element.animate=function(k){this.base=p.Element.AnimateBase,this.base(k),this.calcValue=function(){var w=this.progress(),S=w.from.numValue()+(w.to.numValue()-w.from.numValue())*w.progress;return S+this.initialUnits}},p.Element.animate.prototype=new p.Element.AnimateBase,p.Element.animateColor=function(k){this.base=p.Element.AnimateBase,this.base(k),this.calcValue=function(){var w=this.progress(),S=new e(w.from.value),T=new e(w.to.value);if(S.ok&&T.ok){var m=S.r+(T.r-S.r)*w.progress,A=S.g+(T.g-S.g)*w.progress,M=S.b+(T.b-S.b)*w.progress;return"rgb("+parseInt(m,10)+","+parseInt(A,10)+","+parseInt(M,10)+")"}return this.attribute("from").value}},p.Element.animateColor.prototype=new p.Element.AnimateBase,p.Element.animateTransform=function(k){this.base=p.Element.AnimateBase,this.base(k),this.calcValue=function(){for(var w=this.progress(),S=p.ToNumberArray(w.from.value),T=p.ToNumberArray(w.to.value),m="",A=0;A<S.length;A++)m+=S[A]+(T[A]-S[A])*w.progress+" ";return m}},p.Element.animateTransform.prototype=new p.Element.animate,p.Element.font=function(k){this.base=p.Element.ElementBase,this.base(k),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var w=0;w<this.children.length;w++){var S=this.children[w];S.type=="font-face"?(this.fontFace=S,S.style("font-family").hasValue()&&(p.Definitions[S.style("font-family").value]=this)):S.type=="missing-glyph"?this.missingGlyph=S:S.type=="glyph"&&(S.arabicForm!=""?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[S.unicode]>"u"&&(this.glyphs[S.unicode]=[]),this.glyphs[S.unicode][S.arabicForm]=S):this.glyphs[S.unicode]=S)}},p.Element.font.prototype=new p.Element.ElementBase,p.Element.fontface=function(k){this.base=p.Element.ElementBase,this.base(k),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},p.Element.fontface.prototype=new p.Element.ElementBase,p.Element.missingglyph=function(k){this.base=p.Element.path,this.base(k),this.horizAdvX=0},p.Element.missingglyph.prototype=new p.Element.path,p.Element.glyph=function(k){this.base=p.Element.path,this.base(k),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},p.Element.glyph.prototype=new p.Element.path,p.Element.text=function(k){this.captureTextNodes=!0,this.base=p.Element.RenderedElementBase,this.base(k),this.baseSetContext=this.setContext,this.setContext=function(w){this.baseSetContext(w);var S=this.style("dominant-baseline").toTextBaseline();S==null&&(S=this.style("alignment-baseline").toTextBaseline()),S!=null&&(w.textBaseline=S)},this.getBoundingBox=function(){var w=this.attribute("x").toPixels("x"),S=this.attribute("y").toPixels("y"),T=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);return new p.BoundingBox(w,S-T,w+Math.floor(T*2/3)*this.children[0].getText().length,S)},this.renderChildren=function(w){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(w,this,0);for(var S=0;S<this.children.length;S++)this.renderChild(w,this,this,S)},this.getAnchorDelta=function(w,S,T){var m=this.style("text-anchor").valueOrDefault("start");if(m!="start"){for(var A=0,M=T;M<S.children.length;M++){var N=S.children[M];if(M>T&&N.attribute("x").hasValue())break;A+=N.measureTextRecursive(w)}return-1*(m=="end"?A:A/2)}return 0},this.renderChild=function(w,S,T,m){var A=T.children[m];A.attribute("x").hasValue()?(A.x=A.attribute("x").toPixels("x")+S.getAnchorDelta(w,T,m),A.attribute("dx").hasValue()&&(A.x+=A.attribute("dx").toPixels("x"))):(A.attribute("dx").hasValue()&&(S.x+=A.attribute("dx").toPixels("x")),A.x=S.x),S.x=A.x+A.measureText(w),A.attribute("y").hasValue()?(A.y=A.attribute("y").toPixels("y"),A.attribute("dy").hasValue()&&(A.y+=A.attribute("dy").toPixels("y"))):(A.attribute("dy").hasValue()&&(S.y+=A.attribute("dy").toPixels("y")),A.y=S.y),S.y=A.y,A.render(w);for(var m=0;m<A.children.length;m++)S.renderChild(w,S,A,m)}},p.Element.text.prototype=new p.Element.RenderedElementBase,p.Element.TextElementBase=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.getGlyph=function(w,S,T){var m=S[T],A=null;if(w.isArabic){var M="isolated";(T==0||S[T-1]==" ")&&T<S.length-2&&S[T+1]!=" "&&(M="terminal"),T>0&&S[T-1]!=" "&&T<S.length-2&&S[T+1]!=" "&&(M="medial"),T>0&&S[T-1]!=" "&&(T==S.length-1||S[T+1]==" ")&&(M="initial"),typeof w.glyphs[m]<"u"&&(A=w.glyphs[m][M],A==null&&w.glyphs[m].type=="glyph"&&(A=w.glyphs[m]))}else A=w.glyphs[m];return A==null&&(A=w.missingGlyph),A},this.renderChildren=function(w){var S=this.parent.style("font-family").getDefinition();if(S!=null){var T=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize),m=this.parent.style("font-style").valueOrDefault(p.Font.Parse(p.ctx.font).fontStyle),A=this.getText();S.isRTL&&(A=A.split("").reverse().join(""));for(var M=p.ToNumberArray(this.parent.attribute("dx").value),N=0;N<A.length;N++){var D=this.getGlyph(S,A,N),z=T/S.fontFace.unitsPerEm;w.translate(this.x,this.y),w.scale(z,-z);var _=w.lineWidth;w.lineWidth=w.lineWidth*S.fontFace.unitsPerEm/T,m=="italic"&&w.transform(1,0,.4,1,0,0),D.render(w),m=="italic"&&w.transform(1,0,-.4,1,0,0),w.lineWidth=_,w.scale(1/z,-1/z),w.translate(-this.x,-this.y),this.x+=T*(D.horizAdvX||S.horizAdvX)/S.fontFace.unitsPerEm,typeof M[N]<"u"&&!isNaN(M[N])&&(this.x+=M[N])}return}w.fillStyle!=""&&w.fillText(p.compressSpaces(this.getText()),this.x,this.y),w.strokeStyle!=""&&w.strokeText(p.compressSpaces(this.getText()),this.x,this.y)},this.getText=function(){},this.measureTextRecursive=function(w){for(var S=this.measureText(w),T=0;T<this.children.length;T++)S+=this.children[T].measureTextRecursive(w);return S},this.measureText=function(w){var S=this.parent.style("font-family").getDefinition();if(S!=null){var T=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize),m=0,A=this.getText();S.isRTL&&(A=A.split("").reverse().join(""));for(var M=p.ToNumberArray(this.parent.attribute("dx").value),N=0;N<A.length;N++){var D=this.getGlyph(S,A,N);m+=(D.horizAdvX||S.horizAdvX)*T/S.fontFace.unitsPerEm,typeof M[N]<"u"&&!isNaN(M[N])&&(m+=M[N])}return m}var z=p.compressSpaces(this.getText());if(!w.measureText)return z.length*10;w.save(),this.setContext(w);var _=w.measureText(z).width;return w.restore(),_}},p.Element.TextElementBase.prototype=new p.Element.RenderedElementBase,p.Element.tspan=function(k){this.captureTextNodes=!0,this.base=p.Element.TextElementBase,this.base(k),this.text=p.compressSpaces(k.value||k.text||k.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},p.Element.tspan.prototype=new p.Element.TextElementBase,p.Element.tref=function(k){this.base=p.Element.TextElementBase,this.base(k),this.getText=function(){var w=this.getHrefAttribute().getDefinition();if(w!=null)return w.children[0].getText()}},p.Element.tref.prototype=new p.Element.TextElementBase,p.Element.a=function(k){this.base=p.Element.TextElementBase,this.base(k),this.hasText=k.childNodes.length>0;for(var w=0;w<k.childNodes.length;w++)k.childNodes[w].nodeType!=3&&(this.hasText=!1);this.text=this.hasText?k.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(S){if(this.hasText){this.baseRenderChildren(S);var T=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);p.Mouse.checkBoundingBox(this,new p.BoundingBox(this.x,this.y-T.toPixels("y"),this.x+this.measureText(S),this.y))}else if(this.children.length>0){var m=new p.Element.g;m.children=this.children,m.parent=this,m.render(S)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){p.ctx.canvas.style.cursor="pointer"}},p.Element.a.prototype=new p.Element.TextElementBase,p.Element.image=function(k){this.base=p.Element.RenderedElementBase,this.base(k);var w=this.getHrefAttribute().value;if(w!=""){var S=w.match(/\.svg$/);if(p.Images.push(this),this.loaded=!1,S)this.img=p.ajax(w),this.loaded=!0;else{this.img=document.createElement("img"),p.opts.useCORS==!0&&(this.img.crossOrigin="Anonymous");var T=this;this.img.onload=function(){T.loaded=!0},this.img.onerror=function(){p.log('ERROR: image "'+w+'" not found'),T.loaded=!0},this.img.src=w}this.renderChildren=function(m){var A=this.attribute("x").toPixels("x"),M=this.attribute("y").toPixels("y"),N=this.attribute("width").toPixels("x"),D=this.attribute("height").toPixels("y");N==0||D==0||(m.save(),S?m.drawSvg(this.img,A,M,N,D):(m.translate(A,M),p.AspectRatio(m,this.attribute("preserveAspectRatio").value,N,this.img.width,D,this.img.height,0,0),m.drawImage(this.img,0,0)),m.restore())},this.getBoundingBox=function(){var m=this.attribute("x").toPixels("x"),A=this.attribute("y").toPixels("y"),M=this.attribute("width").toPixels("x"),N=this.attribute("height").toPixels("y");return new p.BoundingBox(m,A,m+M,A+N)}}},p.Element.image.prototype=new p.Element.RenderedElementBase,p.Element.g=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.getBoundingBox=function(){for(var w=new p.BoundingBox,S=0;S<this.children.length;S++)w.addBoundingBox(this.children[S].getBoundingBox());return w}},p.Element.g.prototype=new p.Element.RenderedElementBase,p.Element.symbol=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.render=function(w){}},p.Element.symbol.prototype=new p.Element.RenderedElementBase,p.Element.style=function(k){this.base=p.Element.ElementBase,this.base(k);for(var w="",S=0;S<k.childNodes.length;S++)w+=k.childNodes[S].data;w=w.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),w=p.compressSpaces(w);for(var T=w.split("}"),S=0;S<T.length;S++)if(p.trim(T[S])!="")for(var m=T[S].split("{"),A=m[0].split(","),M=m[1].split(";"),N=0;N<A.length;N++){var D=p.trim(A[N]);if(D!=""){for(var z=p.Styles[D]||{},_=0;_<M.length;_++){var j=M[_].indexOf(":"),V=M[_].substr(0,j),W=M[_].substr(j+1,M[_].length-j);V!=null&&W!=null&&(z[p.trim(V)]=new p.Property(p.trim(V),p.trim(W)))}if(p.Styles[D]=z,p.StylesSpecificity[D]=y(D),D=="@font-face"){for(var Y=z["font-family"].value.replace(/"/g,""),X=z.src.value.split(","),J=0;J<X.length;J++)if(X[J].indexOf('format("svg")')>0)for(var Q=X[J].indexOf("url"),it=X[J].indexOf(")",Q),st=X[J].substr(Q+5,it-Q-6),gt=p.parseXml(p.ajax(st)),nt=gt.getElementsByTagName("font"),ut=0;ut<nt.length;ut++){var ft=p.CreateElement(nt[ut]);p.Definitions[Y]=ft}}}}},p.Element.style.prototype=new p.Element.ElementBase,p.Element.use=function(k){this.base=p.Element.RenderedElementBase,this.base(k),this.baseSetContext=this.setContext,this.setContext=function(S){this.baseSetContext(S),this.attribute("x").hasValue()&&S.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&S.translate(0,this.attribute("y").toPixels("y"))};var w=this.getHrefAttribute().getDefinition();this.path=function(S){w!=null&&w.path(S)},this.getBoundingBox=function(){if(w!=null)return w.getBoundingBox()},this.renderChildren=function(S){if(w!=null){var T=w;w.type=="symbol"&&(T=new p.Element.svg,T.type="svg",T.attributes.viewBox=new p.Property("viewBox",w.attribute("viewBox").value),T.attributes.preserveAspectRatio=new p.Property("preserveAspectRatio",w.attribute("preserveAspectRatio").value),T.attributes.overflow=new p.Property("overflow",w.attribute("overflow").value),T.children=w.children),T.type=="svg"&&(this.attribute("width").hasValue()&&(T.attributes.width=new p.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(T.attributes.height=new p.Property("height",this.attribute("height").value)));var m=T.parent;T.parent=null,T.render(S),T.parent=m}}},p.Element.use.prototype=new p.Element.RenderedElementBase,p.Element.mask=function(k){this.base=p.Element.ElementBase,this.base(k),this.apply=function(w,S){var T=this.attribute("x").toPixels("x"),m=this.attribute("y").toPixels("y"),A=this.attribute("width").toPixels("x"),M=this.attribute("height").toPixels("y");if(A==0&&M==0){for(var N=new p.BoundingBox,D=0;D<this.children.length;D++)N.addBoundingBox(this.children[D].getBoundingBox());var T=Math.floor(N.x1),m=Math.floor(N.y1),A=Math.floor(N.width()),M=Math.floor(N.height())}var z=S.attribute("mask").value;S.attribute("mask").value="";var _=document.createElement("canvas");_.width=T+A,_.height=m+M;var j=_.getContext("2d");this.renderChildren(j);var V=document.createElement("canvas");V.width=T+A,V.height=m+M;var W=V.getContext("2d");S.render(W),W.globalCompositeOperation="destination-in",W.fillStyle=j.createPattern(_,"no-repeat"),W.fillRect(0,0,T+A,m+M),w.fillStyle=W.createPattern(V,"no-repeat"),w.fillRect(0,0,T+A,m+M),S.attribute("mask").value=z},this.render=function(w){}},p.Element.mask.prototype=new p.Element.ElementBase,p.Element.clipPath=function(k){this.base=p.Element.ElementBase,this.base(k),this.apply=function(w){var S=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var T=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},S.call(w);for(var m=0;m<this.children.length;m++){var A=this.children[m];if(typeof A.path<"u"){var M=null;A.style("transform",!1,!0).hasValue()&&(M=new p.Transform(A.style("transform",!1,!0).value),M.apply(w)),A.path(w),CanvasRenderingContext2D.prototype.closePath=T,M&&M.unapply(w)}}T.call(w),w.clip(),CanvasRenderingContext2D.prototype.beginPath=S,CanvasRenderingContext2D.prototype.closePath=T},this.render=function(w){}},p.Element.clipPath.prototype=new p.Element.ElementBase,p.Element.filter=function(k){this.base=p.Element.ElementBase,this.base(k),this.apply=function(w,S){var T=S.getBoundingBox(),m=Math.floor(T.x1),A=Math.floor(T.y1),M=Math.floor(T.width()),N=Math.floor(T.height()),D=S.style("filter").value;S.style("filter").value="";for(var z=0,_=0,j=0;j<this.children.length;j++){var V=this.children[j].extraFilterDistance||0;z=Math.max(z,V),_=Math.max(_,V)}var W=document.createElement("canvas");W.width=M+2*z,W.height=N+2*_;var Y=W.getContext("2d");Y.translate(-m+z,-A+_),S.render(Y);for(var j=0;j<this.children.length;j++)typeof this.children[j].apply=="function"&&this.children[j].apply(Y,0,0,M+2*z,N+2*_);w.drawImage(W,0,0,M+2*z,N+2*_,m-z,A-_,M+2*z,N+2*_),S.style("filter",!0).value=D},this.render=function(w){}},p.Element.filter.prototype=new p.Element.ElementBase,p.Element.feDropShadow=function(k){this.base=p.Element.ElementBase,this.base(k),this.addStylesFromStyleDefinition(),this.apply=function(w,S,T,m,A){}},p.Element.feDropShadow.prototype=new p.Element.ElementBase,p.Element.feMorphology=function(k){this.base=p.Element.ElementBase,this.base(k),this.apply=function(w,S,T,m,A){}},p.Element.feMorphology.prototype=new p.Element.ElementBase,p.Element.feComposite=function(k){this.base=p.Element.ElementBase,this.base(k),this.apply=function(w,S,T,m,A){}},p.Element.feComposite.prototype=new p.Element.ElementBase,p.Element.feColorMatrix=function(k){this.base=p.Element.ElementBase,this.base(k);var w=p.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var S=w[0];w=[.213+.787*S,.715-.715*S,.072-.072*S,0,0,.213-.213*S,.715+.285*S,.072-.072*S,0,0,.213-.213*S,.715-.715*S,.072+.928*S,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var T=w[0]*Math.PI/180,m=function(D,z,_){return D+Math.cos(T)*z+Math.sin(T)*_};w=[m(.213,.787,-.213),m(.715,-.715,-.715),m(.072,-.072,.928),0,0,m(.213,-.213,.143),m(.715,.285,.14),m(.072,-.072,-.283),0,0,m(.213,-.213,-.787),m(.715,-.715,.715),m(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}function A(D,z,_,j,V,W){return D[_*j*4+z*4+W]}function M(D,z,_,j,V,W,Y){D[_*j*4+z*4+W]=Y}function N(D,z){var _=w[D];return _*(_<0?z-255:z)}this.apply=function(D,z,_,j,V){for(var W=D.getImageData(0,0,j,V),_=0;_<V;_++)for(var z=0;z<j;z++){var Y=A(W.data,z,_,j,V,0),X=A(W.data,z,_,j,V,1),J=A(W.data,z,_,j,V,2),Q=A(W.data,z,_,j,V,3);M(W.data,z,_,j,V,0,N(0,Y)+N(1,X)+N(2,J)+N(3,Q)+N(4,1)),M(W.data,z,_,j,V,1,N(5,Y)+N(6,X)+N(7,J)+N(8,Q)+N(9,1)),M(W.data,z,_,j,V,2,N(10,Y)+N(11,X)+N(12,J)+N(13,Q)+N(14,1)),M(W.data,z,_,j,V,3,N(15,Y)+N(16,X)+N(17,J)+N(18,Q)+N(19,1))}D.clearRect(0,0,j,V),D.putImageData(W,0,0)}},p.Element.feColorMatrix.prototype=new p.Element.ElementBase,p.Element.feGaussianBlur=function(k){this.base=p.Element.ElementBase,this.base(k),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(w,S,T,m,A){if(typeof r.canvasRGBA>"u"){p.log("ERROR: StackBlur.js must be included for blur to work");return}w.canvas.id=p.UniqueId(),w.canvas.style.display="none",document.body.appendChild(w.canvas),r.canvasRGBA(w.canvas.id,S,T,m,A,this.blurRadius),document.body.removeChild(w.canvas)}},p.Element.feGaussianBlur.prototype=new p.Element.ElementBase,p.Element.title=function(k){},p.Element.title.prototype=new p.Element.ElementBase,p.Element.desc=function(k){},p.Element.desc.prototype=new p.Element.ElementBase,p.Element.MISSING=function(k){p.log("ERROR: Element '"+k.nodeName+"' not yet implemented.")},p.Element.MISSING.prototype=new p.Element.ElementBase,p.CreateElement=function(k){var w=k.nodeName.replace(/^[^:]+:/,"");w=w.replace(/\-/g,"");var S=null;return typeof p.Element[w]<"u"?S=new p.Element[w](k):S=new p.Element.MISSING(k),S.type=k.nodeName,S},p.load=function(k,w){p.loadXml(k,p.ajax(w))},p.loadXml=function(k,w){p.loadXmlDoc(k,p.parseXml(w))},p.loadXmlDoc=function(k,w){p.init(k);var S=function(N){for(var D=k.canvas;D;)N.x-=D.offsetLeft,N.y-=D.offsetTop,D=D.offsetParent;return window.scrollX&&(N.x+=window.scrollX),window.scrollY&&(N.y+=window.scrollY),N};p.opts.ignoreMouse!=!0&&(k.canvas.onclick=function(N){var D=S(new p.Point(N!=null?N.clientX:event.clientX,N!=null?N.clientY:event.clientY));p.Mouse.onclick(D.x,D.y)},k.canvas.onmousemove=function(N){var D=S(new p.Point(N!=null?N.clientX:event.clientX,N!=null?N.clientY:event.clientY));p.Mouse.onmousemove(D.x,D.y)});var T=p.CreateElement(w.documentElement);T.root=!0,T.addStylesFromStyleDefinition();var m=!0,A=function(){p.ViewPort.Clear(),k.canvas.parentNode&&p.ViewPort.SetCurrent(k.canvas.parentNode.clientWidth,k.canvas.parentNode.clientHeight),p.opts.ignoreDimensions!=!0&&(T.style("width").hasValue()&&(k.canvas.width=T.style("width").toPixels("x"),k.canvas.style.width=k.canvas.width+"px"),T.style("height").hasValue()&&(k.canvas.height=T.style("height").toPixels("y"),k.canvas.style.height=k.canvas.height+"px"));var N=k.canvas.clientWidth||k.canvas.width,D=k.canvas.clientHeight||k.canvas.height;if(p.opts.ignoreDimensions==!0&&T.style("width").hasValue()&&T.style("height").hasValue()&&(N=T.style("width").toPixels("x"),D=T.style("height").toPixels("y")),p.ViewPort.SetCurrent(N,D),p.opts.offsetX!=null&&(T.attribute("x",!0).value=p.opts.offsetX),p.opts.offsetY!=null&&(T.attribute("y",!0).value=p.opts.offsetY),p.opts.scaleWidth!=null||p.opts.scaleHeight!=null){var z=null,_=null,j=p.ToNumberArray(T.attribute("viewBox").value);p.opts.scaleWidth!=null&&(T.attribute("width").hasValue()?z=T.attribute("width").toPixels("x")/p.opts.scaleWidth:isNaN(j[2])||(z=j[2]/p.opts.scaleWidth)),p.opts.scaleHeight!=null&&(T.attribute("height").hasValue()?_=T.attribute("height").toPixels("y")/p.opts.scaleHeight:isNaN(j[3])||(_=j[3]/p.opts.scaleHeight)),z==null&&(z=_),_==null&&(_=z),T.attribute("width",!0).value=p.opts.scaleWidth,T.attribute("height",!0).value=p.opts.scaleHeight,T.style("transform",!0,!0).value+=" scale("+1/z+","+1/_+")"}p.opts.ignoreClear!=!0&&k.clearRect(0,0,N,D),T.render(k),m&&(m=!1,typeof p.opts.renderCallback=="function"&&p.opts.renderCallback(w))},M=!0;p.ImagesLoaded()&&(M=!1,A()),p.intervalID=setInterval(function(){var N=!1;if(M&&p.ImagesLoaded()&&(M=!1,N=!0),p.opts.ignoreMouse!=!0&&(N=N|p.Mouse.hasEvents()),p.opts.ignoreAnimation!=!0)for(var D=0;D<p.Animations.length;D++)N=N|p.Animations[D].update(1e3/p.FRAMERATE);typeof p.opts.forceRedraw=="function"&&p.opts.forceRedraw()==!0&&(N=!0),N&&(A(),p.Mouse.runEvents())},1e3/p.FRAMERATE)},p.stop=function(){p.intervalID&&clearInterval(p.intervalID)},p.Mouse=new function(){this.events=[],this.hasEvents=function(){return this.events.length!=0},this.onclick=function(k,w){this.events.push({type:"onclick",x:k,y:w,run:function(S){S.onclick&&S.onclick()}})},this.onmousemove=function(k,w){this.events.push({type:"onmousemove",x:k,y:w,run:function(S){S.onmousemove&&S.onmousemove()}})},this.eventElements=[],this.checkPath=function(k,w){for(var S=0;S<this.events.length;S++){var T=this.events[S];w.isPointInPath&&w.isPointInPath(T.x,T.y)&&(this.eventElements[S]=k)}},this.checkBoundingBox=function(k,w){for(var S=0;S<this.events.length;S++){var T=this.events[S];w.isPointInBox(T.x,T.y)&&(this.eventElements[S]=k)}},this.runEvents=function(){p.ctx.canvas.style.cursor="";for(var k=0;k<this.events.length;k++)for(var w=this.events[k],S=this.eventElements[k];S;)w.run(S),S=S.parent;this.events=[],this.eventElements=[]}},p}return typeof CanvasRenderingContext2D<"u"&&(CanvasRenderingContext2D.prototype.drawSvg=function(C,p,E,k,w,S){var T={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:p,offsetY:E,scaleWidth:k,scaleHeight:w};for(var m in S)S.hasOwnProperty(m)&&(T[m]=S[m]);i(this.canvas,C,T)}),i})});var U=Math.round,H=Math.floor,K=Math.PI,q={linear:function(t,e,r){var i=t[1]-t[0],n=e[1]-e[0];return(r-t[0])/i*n+e[0]||0}},et=function(t){return t%360+(t<0?360:0)},ht=function(t,e){return e*U(t/e)},mt=function(t){return 180*t/K%360},bt=function(t,e){return e=e||!1,t=e?t:t%360,t*K/180},Pt=function(t,e){if(e===void 0)e=t===void 0?1:t,t=0;else if(e<t){var r=t;t=e,e=r}return H(Math.random()*(e-t+1)+t)},qt=Math.cos,Tt=Math.sin,Mt=Math.atan2,Ft=function(t,e){var r=bt(t.y),i=bt(e.y),n=t.x,a=e.x,o=bt(a-n),s=Tt(o)*qt(i),l=qt(r)*Tt(i)-Tt(r)*qt(i)*qt(o),u=mt(Mt(s,l)),g=["NE","E","SE","S","SW","W","NW","N"],h=u-22.5;return h<0&&(h+=360),h=parseInt(h/45),g[h]},Jt=function(t,e){var r=t.x,i=t.y,n=e.x,a=e.y;return(r-=n)*r+(i-=a)*i},te=function(t,e){return Math.sqrt(Jt(t,e))},ct={Point:1,Line:2,Ellipse:3,Rect:4,Polyline:5,Polygon:6,Curve:7,Path:8},ue=Math.abs,Ae=Math.cos,ir=Math.sin,Pr=Math.sqrt,Ci=Math.min,Bn=Math.max,On=Math.atan2,Rn=Math.round,co=Math.pow,_n=Math.PI,Z=function(t,e){if(!(this instanceof Z))return new Z(t,e);if(typeof t=="string"){var r=t.split(t.indexOf("@")===-1?" ":"@");t=parseFloat(r[0]),e=parseFloat(r[1])}else Object(t)===t&&(e=t.y,t=t.x);this.x=t===void 0?0:t,this.y=e===void 0?0:e};Z.fromPolar=function(t,e,r){r=new Z(r);var i=ue(t*Ae(e)),n=ue(t*ir(e)),a=et(mt(e));return a<90?n=-n:a<180?(i=-i,n=-n):a<270&&(i=-i),new Z(r.x+i,r.y+n)},Z.random=function(t,e,r,i){return new Z(Pt(t,e),Pt(r,i))},Z.prototype={type:ct.Point,chooseClosest:function(t){var e=t.length;if(e===1)return new Z(t[0]);for(var r=null,i=1/0,n=0;n<e;n++){var a=new Z(t[n]),o=this.squaredDistance(a);o<i&&(r=a,i=o)}return r},adhereToRect:function(t){return t.containsPoint(this)?this:(this.x=Ci(Bn(this.x,t.x),t.x+t.width),this.y=Ci(Bn(this.y,t.y),t.y+t.height),this)},angleBetween:function(t,e){var r=this.equals(t)||this.equals(e)?NaN:this.theta(e)-this.theta(t);return r<0&&(r+=360),r},bearing:function(t){return Ft(this,t)},changeInAngle:function(t,e,r){return this.clone().offset(-t,-e).theta(r)-this.theta(r)},clone:function(){return new Z(this)},cross:function(t,e){return t&&e?(e.x-this.x)*(t.y-this.y)-(e.y-this.y)*(t.x-this.x):NaN},difference:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),new Z(this.x-(t||0),this.y-(e||0))},distance:function(t){return te(this,t)},dot:function(t){return t?this.x*t.x+this.y*t.y:NaN},equals:function(t){return!!t&&this.x===t.x&&this.y===t.y},lerp:function(t,e){var r=this.x,i=this.y;return new Z((1-e)*r+e*t.x,(1-e)*i+e*t.y)},magnitude:function(){return Pr(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(t){return ue(t.x-this.x)+ue(t.y-this.y)},move:function(t,e){var r=bt(new Z(t).theta(this)),i=this.offset(Ae(r)*e,-ir(r)*e);return i},normalize:function(t){var e=(t||1)/this.magnitude();return this.scale(e,e)},offset:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x+=t||0,this.y+=e||0,this},reflection:function(t){return new Z(t).move(this,this.distance(t))},rotate:function(t,e){if(e===0)return this;t=t||new Z(0,0),e=bt(et(-e));var r=Ae(e),i=ir(e),n=r*(this.x-t.x)-i*(this.y-t.y)+t.x,a=i*(this.x-t.x)+r*(this.y-t.y)+t.y;return this.x=n,this.y=a,this},round:function(t){var e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=co(10,t);break}return this.x=Rn(this.x*e)/e,this.y=Rn(this.y*e)/e,this},scale:function(t,e,r){return r=r&&new Z(r)||new Z(0,0),this.x=r.x+t*(this.x-r.x),this.y=r.y+e*(this.y-r.y),this},snapToGrid:function(t,e){return this.x=ht(this.x,t),this.y=ht(this.y,e||t),this},squaredDistance:function(t){return Jt(this,t)},theta:function(t){t=new Z(t);var e=-(t.y-this.y),r=t.x-this.x,i=On(e,r);return i<0&&(i=2*_n+i),180*i/_n},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(t){t=t&&new Z(t)||new Z(0,0);var e=this.x,r=this.y;return this.x=Pr((e-t.x)*(e-t.x)+(r-t.y)*(r-t.y)),this.y=bt(t.theta(new Z(e,r))),this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0,this},vectorAngle:function(t){var e=new Z(0,0);return e.angleBetween(this,t)}},Z.prototype.translate=Z.prototype.offset;var Bt=Z,Qi=Math.max,$i=Math.min,dt=function(t,e){if(!(this instanceof dt))return new dt(t,e);if(t instanceof dt)return new dt(t.start,t.end);this.start=new Z(t),this.end=new Z(e)};dt.prototype={type:ct.Line,angle:function(){var t=new Z(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)},bbox:function(){var t=$i(this.start.x,this.end.x),e=$i(this.start.y,this.end.y),r=Qi(this.start.x,this.end.x),i=Qi(this.start.y,this.end.y);return new at(t,e,r-t,i-e)},bearing:function(){return Ft(this.start,this.end)},clone:function(){return new dt(this.start,this.end)},closestPoint:function(t){return this.pointAt(this.closestPointNormalizedLength(t))},closestPointLength:function(t){return this.closestPointNormalizedLength(t)*this.length()},closestPointNormalizedLength:function(t){var e=this.vector().dot(new dt(this.start,t).vector()),r=$i(1,Qi(0,e/this.squaredLength()));return r!==r?0:r},closestPointTangent:function(t){return this.tangentAt(this.closestPointNormalizedLength(t))},containsPoint:function(t){var e=this.start,r=this.end;if(e.cross(t,r)!==0)return!1;var i=this.length();return!(new dt(e,t).length()>i||new dt(t,r).length()>i)},divideAt:function(t){var e=this.pointAt(t);return[new dt(this.start,e),new dt(e,this.end)]},divideAtLength:function(t){var e=this.pointAtLength(t);return[new dt(this.start,e),new dt(e,this.end)]},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y},intersect:function(t,e){if(t&&t.intersectionWithLine){var r=t.intersectionWithLine(this,e);return r&&t instanceof dt&&(r=r[0]),r}return null},intersectionWithLine:function(t){var e=new Z(this.end.x-this.start.x,this.end.y-this.start.y),r=new Z(t.end.x-t.start.x,t.end.y-t.start.y),i=e.x*r.y-e.y*r.x,n=new Z(t.start.x-this.start.x,t.start.y-this.start.y),a=n.x*r.y-n.y*r.x,o=n.x*e.y-n.y*e.x;if(i===0||a*i<0||o*i<0)return null;if(i>0){if(a>i||o>i)return null}else if(a<i||o<i)return null;return[new Z(this.start.x+a*e.x/i,this.start.y+a*e.y/i)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return te(this.start,this.end)},midpoint:function(){return new Z((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(t){var e=this.clone();if(!this.isDifferentiable())return e;var r=e.start,i=e.end,n=r.clone().rotate(i,270),a=i.clone().rotate(r,90);return r.move(a,t),i.move(n,t),e},pointAt:function(t){var e=this.start,r=this.end;return t<=0?e.clone():t>=1?r.clone():e.lerp(r,t)},pointAtLength:function(t){var e=this.start,r=this.end,i=!0;t<0&&(i=!1,t=-t);var n=this.length();return t>=n?i?r.clone():e.clone():this.pointAt((i?t:n-t)/n)},pointOffset:function(t){t=new Z(t);var e=this.start,r=this.end,i=(r.x-e.x)*(t.y-e.y)-(r.y-e.y)*(t.x-e.x);return i/this.length()},rotate:function(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this},round:function(t){return this.start.round(t),this.end.round(t),this},scale:function(t,e,r){return this.start.scale(t,e,r),this.end.scale(t,e,r),this},setLength:function(t){var e=this.length();if(!e)return this;var r=t/e;return this.scale(r,r,this.start)},squaredLength:function(){return Jt(this.start,this.end)},tangentAt:function(t){if(!this.isDifferentiable())return null;var e=this.start,r=this.end,i=this.pointAt(t),n=new dt(e,r);return n.translate(i.x-e.x,i.y-e.y),n},tangentAtLength:function(t){if(!this.isDifferentiable())return null;var e=this.start,r=this.end,i=this.pointAtLength(t),n=new dt(e,r);return n.translate(i.x-e.x,i.y-e.y),n},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(t,e){return this.start.translate(t,e),this.end.translate(t,e),this},vector:function(){return new Z(this.end.x-this.start.x,this.end.y-this.start.y)}},dt.prototype.intersection=dt.prototype.intersect;var Tr=dt,Gn=Math.sqrt,Ii=Math.round,fo=Math.pow,Re=function(t,e,r){if(!(this instanceof Re))return new Re(t,e,r);if(t instanceof Re)return new Re(new Z(t.x,t.y),t.a,t.b);t=new Z(t),this.x=t.x,this.y=t.y,this.a=e,this.b=r};Re.fromRect=function(t){return t=new at(t),new Re(t.center(),t.width/2,t.height/2)},Re.prototype={type:ct.Ellipse,bbox:function(){return new at(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},center:function(){return new Z(this.x,this.y)},clone:function(){return new Re(this)},containsPoint:function(t){return this.normalizedDistance(t)<=1},equals:function(t){return!!t&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.a+=2*t,this.b+=2*e,this},intersectionWithLine:function(t){var e=[],r=t.start,i=t.end,n=this.a,a=this.b,o=t.vector(),s=r.difference(new Z(this)),l=new Z(o.x/(n*n),o.y/(a*a)),u=new Z(s.x/(n*n),s.y/(a*a)),g=o.dot(l),h=o.dot(u),y=s.dot(u)-1,x=h*h-g*y;if(x<0)return null;if(x>0){var C=Gn(x),p=(-h-C)/g,E=(-h+C)/g;if((p<0||1<p)&&(E<0||1<E))return null;0<=p&&p<=1&&e.push(r.lerp(i,p)),0<=E&&E<=1&&e.push(r.lerp(i,E))}else{var k=-h/g;if(0<=k&&k<=1)e.push(r.lerp(i,k));else return null}return e},intersectionWithLineFromCenterToPoint:function(t,e){t=new Z(t),e&&t.rotate(new Z(this.x,this.y),e);var r=t.x-this.x,i=t.y-this.y,n;if(r===0)return n=this.bbox().pointNearestToPoint(t),e?n.rotate(new Z(this.x,this.y),-e):n;var a=i/r,o=a*a,s=this.a*this.a,l=this.b*this.b,u=Gn(1/(1/s+o/l));u=r<0?-u:u;var g=a*u;return n=new Z(this.x+u,this.y+g),e?n.rotate(new Z(this.x,this.y),-e):n},normalizedDistance:function(t){var e=t.x,r=t.y,i=this.a,n=this.b,a=this.x,o=this.y;return(e-a)*(e-a)/(i*i)+(r-o)*(r-o)/(n*n)},round:function(t){var e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=fo(10,t);break}return this.x=Ii(this.x*e)/e,this.y=Ii(this.y*e)/e,this.a=Ii(this.a*e)/e,this.b=Ii(this.b*e)/e,this},tangentTheta:function(t){var e=30,r=t.x,i=t.y,n=this.a,a=this.b,o=this.bbox().center(),s=o.x,l=o.y,u=r>o.x+n/2,g=r<o.x-n/2,h,y;return u||g?(h=r>o.x?i-e:i+e,y=n*n/(r-s)-n*n*(i-l)*(h-l)/(a*a*(r-s))+s):(y=i>o.y?r+e:r-e,h=a*a/(i-l)-a*a*(r-s)*(y-s)/(n*n*(i-l))+l),new Z(y,h).theta(t)},toString:function(){return new Z(this.x,this.y).toString()+" "+this.a+" "+this.b}};var go=Re,jn=Math.abs,vo=Math.cos,oe=Math.sin,Ar=Math.min,Kt=Math.max,vr=Math.round,Vr=Math.pow,at=function(t,e,r,i){if(!(this instanceof at))return new at(t,e,r,i);Object(t)===t&&(e=t.y,r=t.width,i=t.height,t=t.x),this.x=t===void 0?0:t,this.y=e===void 0?0:e,this.width=r===void 0?0:r,this.height=i===void 0?0:i};at.fromEllipse=function(t){return t=new Re(t),new at(t.x-t.a,t.y-t.b,2*t.a,2*t.b)},at.fromPointUnion=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t.length===0)return null;var r=new Z,i,n,a,o;i=n=1/0,a=o=-1/0;for(var s=0;s<t.length;s++){r.update(t[s]);var l=r.x,u=r.y;l<i&&(i=l),l>a&&(a=l),u<n&&(n=u),u>o&&(o=u)}return new at(i,n,a-i,o-n)},at.fromRectUnion=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(t.length===0)return null;var r=new at,i,n,a,o;i=n=1/0,a=o=-1/0;for(var s=0;s<t.length;s++){r.update(t[s]);var l=r.x,u=r.y,g=l+r.width,h=u+r.height;l<i&&(i=l),g>a&&(a=g),u<n&&(n=u),h>o&&(o=h)}return new at(i,n,a-i,o-n)},at.prototype={type:ct.Rect,bbox:function(t){return this.clone().rotateAroundCenter(t)},rotateAroundCenter:function(t){if(!t)return this;var e=this,r=e.width,i=e.height,n=bt(t),a=jn(oe(n)),o=jn(vo(n)),s=r*o+i*a,l=r*a+i*o;return this.x+=(r-s)/2,this.y+=(i-l)/2,this.width=s,this.height=l,this},bottomLeft:function(){return new Z(this.x,this.y+this.height)},bottomLine:function(){return new dt(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new Z(this.x+this.width/2,this.y+this.height)},center:function(){return new Z(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new at(this)},containsPoint:function(t){return t=new Z(t),t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},containsRect:function(t){var e=new at(this).normalize(),r=new at(t).normalize(),i=e.width,n=e.height,a=r.width,o=r.height;if(!i||!n||!a||!o)return!1;var s=e.x,l=e.y,u=r.x,g=r.y;return a+=u,i+=s,o+=g,n+=l,s<=u&&a<=i&&l<=g&&o<=n},corner:function(){return new Z(this.x+this.width,this.y+this.height)},equals:function(t){var e=new at(this).normalize(),r=new at(t).normalize();return e.x===r.x&&e.y===r.y&&e.width===r.width&&e.height===r.height},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},intersect:function(t){var e=this.origin(),r=this.corner(),i=t.origin(),n=t.corner();if(n.x<=e.x||n.y<=e.y||i.x>=r.x||i.y>=r.y)return null;var a=Kt(e.x,i.x),o=Kt(e.y,i.y);return new at(a,o,Ar(r.x,n.x)-a,Ar(r.y,n.y)-o)},intersectionWithLine:function(t){var e=this,r=[e.topLine(),e.rightLine(),e.bottomLine(),e.leftLine()],i=[],n=[],a,o,s=r.length;for(o=0;o<s;o++)a=t.intersect(r[o]),a!==null&&n.indexOf(a.toString())<0&&(i.push(a),n.push(a.toString()));return i.length>0?i:null},intersectionWithLineFromCenterToPoint:function(t,e){t=new Z(t);var r=new Z(this.x+this.width/2,this.y+this.height/2),i;e&&t.rotate(r,e);for(var n=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()],a=new dt(r,t),o=n.length-1;o>=0;--o){var s=n[o].intersection(a);if(s!==null){i=s;break}}return i&&e&&i.rotate(r,-e),i},leftLine:function(){return new dt(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new Z(this.x,this.y+this.height/2)},maxRectScaleToFit:function(t,e){t=new at(t),e||(e=t.center());var r,i,n,a,o,s,l,u,g=e.x,h=e.y;r=i=n=a=o=s=l=u=1/0;var y=t.topLeft();y.x<g&&(r=(this.x-g)/(y.x-g)),y.y<h&&(o=(this.y-h)/(y.y-h));var x=t.bottomRight();x.x>g&&(i=(this.x+this.width-g)/(x.x-g)),x.y>h&&(s=(this.y+this.height-h)/(x.y-h));var C=t.topRight();C.x>g&&(n=(this.x+this.width-g)/(C.x-g)),C.y<h&&(l=(this.y-h)/(C.y-h));var p=t.bottomLeft();return p.x<g&&(a=(this.x-g)/(p.x-g)),p.y>h&&(u=(this.y+this.height-h)/(p.y-h)),{sx:Ar(r,i,n,a),sy:Ar(o,s,l,u)}},maxRectUniformScaleToFit:function(t,e){var r=this.maxRectScaleToFit(t,e);return Ar(r.sx,r.sy)},moveAndExpand:function(t){return this.x+=t.x||0,this.y+=t.y||0,this.width+=t.width||0,this.height+=t.height||0,this},normalize:function(){var t=this.x,e=this.y,r=this.width,i=this.height;return this.width<0&&(t=this.x+this.width,r=-this.width),this.height<0&&(e=this.y+this.height,i=-this.height),this.x=t,this.y=e,this.width=r,this.height=i,this},offset:function(t,e){return Z.prototype.offset.call(this,t,e)},origin:function(){return new Z(this.x,this.y)},pointNearestToPoint:function(t){if(t=new Z(t),this.containsPoint(t)){var e=this.sideNearestToPoint(t);switch(e){case"right":return new Z(this.x+this.width,t.y);case"left":return new Z(this.x,t.y);case"bottom":return new Z(t.x,this.y+this.height);case"top":return new Z(t.x,this.y)}}return t.adhereToRect(this)},rightLine:function(){return new dt(this.topRight(),this.bottomRight())},rightMiddle:function(){return new Z(this.x+this.width,this.y+this.height/2)},round:function(t){var e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Vr(10,t);break}return this.x=vr(this.x*e)/e,this.y=vr(this.y*e)/e,this.width=vr(this.width*e)/e,this.height=vr(this.height*e)/e,this},scale:function(t,e,r){return r=this.origin().scale(t,e,r),this.x=r.x,this.y=r.y,this.width*=t,this.height*=e,this},sideNearestToPoint:function(t){t=new Z(t);var e=t.x-this.x,r=this.x+this.width-t.x,i=t.y-this.y,n=this.y+this.height-t.y,a=e,o="left";return r<a&&(a=r,o="right"),i<a&&(a=i,o="top"),n<a&&(o="bottom"),o},snapToGrid:function(t,e){var r=this.origin().snapToGrid(t,e),i=this.corner().snapToGrid(t,e);return this.x=r.x,this.y=r.y,this.width=i.x-r.x,this.height=i.y-r.y,this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new dt(this.topLeft(),this.topRight())},topMiddle:function(){return new Z(this.x+this.width/2,this.y)},topRight:function(){return new Z(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(t){return at.fromRectUnion(this,t)},update:function(t,e,r,i){return Object(t)===t&&(e=t.y,r=t.width,i=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=r||0,this.height=i||0,this}},at.prototype.bottomRight=at.prototype.corner,at.prototype.topLeft=at.prototype.origin,at.prototype.translate=at.prototype.offset;var We=at;function pr(t){var e=t.trim();if(e==="")return[];for(var r=[],i=e.split(/\b\s*,\s*|,\s*|\s+/),n=i.length,a=0;a<n;a+=2)r.push({x:+i[a],y:+i[a+1]});return r}function _e(t){var e=t.length;if(e===0)return[];for(var r=[],i=0;i<e;i++){var n=t[i].clone();r.push(n)}return r}function ni(t){var e=Math.abs,r,i,n=t.length;if(n===0)return[];var a;for(r=0;r<n;r++)(a===void 0||t[r].y<a.y||t[r].y===a.y&&t[r].x>a.x)&&(a=t[r]);var o=[];for(r=0;r<n;r++){var s=a.theta(t[r]);s===0&&(s=360);var l=[t[r],r,s];o.push(l)}if(o.sort(function(V,W){var Y=V[2]-W[2];return Y===0&&(Y=W[1]-V[1]),Y}),o.length>2){var u=o[o.length-1];o.unshift(u)}for(var g={},h=[],y,x,C,p,E,k;o.length!==0;)if(y=o.pop(),x=y[0],!g.hasOwnProperty(y[0]+"@@"+y[1]))for(var w=!1;!w;)if(h.length<2)h.push(y),w=!0;else{C=h.pop(),p=C[0],E=h.pop(),k=E[0];var S=k.cross(p,x);if(S<0)h.push(E),h.push(C),h.push(y),w=!0;else if(S===0){var T=1e-10,m=p.angleBetween(k,x);e(m-180)<T||p.equals(x)||k.equals(p)?(g[C[0]+"@@"+C[1]]=p,h.push(E)):e((m+1)%360-1)<T&&(h.push(E),o.push(C))}else g[C[0]+"@@"+C[1]]=p,h.push(E)}h.length>2&&h.pop();var A,M=-1;for(i=h.length,r=0;r<i;r++){var N=h[r][1];(A===void 0||N<A)&&(A=N,M=r)}var D=[];if(M>0){var z=h.slice(M),_=h.slice(0,M);D=z.concat(_)}else D=h;var j=[];for(i=D.length,r=0;r<i;r++)j.push(D[r][0]);return j}var Qt=function(t){if(!(this instanceof Qt))return new Qt(t);if(typeof t=="string")return new Qt.parse(t);this.points=Array.isArray(t)?t.map(Z):[]};Qt.parse=function(t){return new Qt(pr(t))},Qt.fromRect=function(t){return new Qt([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft(),t.topLeft()])},Qt.prototype={type:ct.Polyline,bbox:function(){var t=1/0,e=-1/0,r=1/0,i=-1/0,n=this.points,a=n.length;if(a===0)return null;for(var o=0;o<a;o++){var s=n[o],l=s.x,u=s.y;l<t&&(t=l),l>e&&(e=l),u<r&&(r=u),u>i&&(i=u)}return new at(t,r,e-t,i-r)},clone:function(){return new Qt(_e(this.points))},closestPoint:function(t){var e=this.closestPointLength(t);return this.pointAtLength(e)},closestPointLength:function(t){var e=this.lengthPoints(),r=e.length;if(r===0||r===1)return 0;for(var i,n=1/0,a=0,o=r-1,s=0;s<o;s++){var l=new dt(e[s],e[s+1]),u=l.length(),g=l.closestPointNormalizedLength(t),h=l.pointAt(g),y=h.squaredDistance(t);y<n&&(n=y,i=a+g*u),a+=u}return i},closestPointNormalizedLength:function(t){var e=this.closestPointLength(t);if(e===0)return 0;var r=this.length();return r===0?0:e/r},closestPointTangent:function(t){var e=this.closestPointLength(t);return this.tangentAtLength(e)},containsPoint:function(t){var e=this.points,r=e.length;if(r===0)return!1;for(var i=t.x,n=t.y,a=r-1,o=0,s=0,l=new dt,u=new dt,g=new Z;o<r;o++){var h=e[a],y=e[o];if(t.equals(h)||(l.start=h,l.end=y,l.containsPoint(t)))return!0;if(n<=h.y&&n>y.y||n>h.y&&n<=y.y){var x=h.x-i>y.x-i?h.x-i:y.x-i;x>=0&&(g.x=i+x,g.y=n,u.start=t,u.end=g,l.intersect(u)&&s++)}a=o}return s%2===1},close:function(){var t=this,e=t.start,r=t.end,i=t.points;return e&&r&&!e.equals(r)&&i.push(e.clone()),this},lengthPoints:function(){return this.points},convexHull:function(){return new Qt(ni(this.points))},equals:function(t){if(!t)return!1;var e=this.points,r=t.points,i=e.length;if(r.length!==i)return!1;for(var n=0;n<i;n++){var a=e[n],o=t.points[n];if(!a.equals(o))return!1}return!0},intersectionWithLine:function(t){for(var e=new dt(t),r=[],i=this.lengthPoints(),n=new dt,a=0,o=i.length-1;a<o;a++){n.start=i[a],n.end=i[a+1];var s=e.intersectionWithLine(n);s&&r.push(s[0])}return r.length>0?r:null},isDifferentiable:function(){var t=this.points,e=t.length;if(e===0)return!1;for(var r=new dt,i=e-1,n=0;n<i;n++)if(r.start=t[n],r.end=t[n+1],r.isDifferentiable())return!0;return!1},length:function(){var t=this.lengthPoints(),e=t.length;if(e===0)return 0;for(var r=0,i=e-1,n=0;n<i;n++)r+=t[n].distance(t[n+1]);return r},pointAt:function(t){var e=this.lengthPoints(),r=e.length;if(r===0)return null;if(r===1||t<=0)return e[0].clone();if(t>=1)return e[r-1].clone();var i=this.length(),n=i*t;return this.pointAtLength(n)},pointAtLength:function(t){var e=this.lengthPoints(),r=e.length;if(r===0)return null;if(r===1)return e[0].clone();var i=!0;t<0&&(i=!1,t=-t);for(var n=0,a=r-1,o=0;o<a;o++){var s=i?o:a-1-o,l=e[s],u=e[s+1],g=new dt(l,u),h=l.distance(u);if(t<=n+h)return g.pointAtLength((i?1:-1)*(t-n));n+=h}var y=i?e[r-1]:e[0];return y.clone()},round:function(t){for(var e=this.points,r=e.length,i=0;i<r;i++)e[i].round(t);return this},scale:function(t,e,r){for(var i=this.points,n=i.length,a=0;a<n;a++)i[a].scale(t,e,r);return this},simplify:function(t){t===void 0&&(t={});var e=this.points;if(e.length<3)return this;for(var r=t.threshold||0,i=0;e[i+2];){var n=i,a=i+1,o=i+2,s=e[n],l=e[a],u=e[o],g=new dt(s,u),h=g.closestPoint(l),y=h.distance(l);y<=r?e.splice(a,1):i+=1}return this},tangentAt:function(t){var e=this.lengthPoints(),r=e.length;if(r===0||r===1)return null;t<0&&(t=0),t>1&&(t=1);var i=this.length(),n=i*t;return this.tangentAtLength(n)},tangentAtLength:function(t){var e=this.lengthPoints(),r=e.length;if(r===0||r===1)return null;var i=!0;t<0&&(i=!1,t=-t);for(var n,a=0,o=r-1,s=0;s<o;s++){var l=i?s:o-1-s,u=e[l],g=e[l+1],h=new dt(u,g),y=u.distance(g);if(h.isDifferentiable()){if(t<=a+y)return h.tangentAtLength((i?1:-1)*(t-a));n=h}a+=y}if(n){var x=i?1:0;return n.tangentAt(x)}return null},toString:function(){return this.points+""},translate:function(t,e){for(var r=this.points,i=r.length,n=0;n<i;n++)r[n].translate(t,e);return this},serialize:function(){var t=this.points,e=t.length;if(e===0)return"";for(var r="",i=0;i<e;i++){var n=t[i];r+=n.x+","+n.y+" "}return r.trim()}},Object.defineProperty(Qt.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[0]}}),Object.defineProperty(Qt.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[e-1]}});var Si=Math.abs,Fn=Math.sqrt,Nr=Math.min,tn=Math.max,Mi=Math.pow,Zt=function(t,e,r,i){if(!(this instanceof Zt))return new Zt(t,e,r,i);if(t instanceof Zt)return new Zt(t.start,t.controlPoint1,t.controlPoint2,t.end);this.start=new Z(t),this.controlPoint1=new Z(e),this.controlPoint2=new Z(r),this.end=new Z(i)};Zt.throughPoints=function(){function t(r){var i=[],n=[],a=r.length-1,o;if(a==1)return i[0]=new Z((2*r[0].x+r[1].x)/3,(2*r[0].y+r[1].y)/3),n[0]=new Z(2*i[0].x-r[0].x,2*i[0].y-r[0].y),[i,n];var s=[];for(o=1;o<a-1;o++)s[o]=4*r[o].x+2*r[o+1].x;s[0]=r[0].x+2*r[1].x,s[a-1]=(8*r[a-1].x+r[a].x)/2;var l=e(s);for(o=1;o<a-1;++o)s[o]=4*r[o].y+2*r[o+1].y;s[0]=r[0].y+2*r[1].y,s[a-1]=(8*r[a-1].y+r[a].y)/2;var u=e(s);for(o=0;o<a;o++)i.push(new Z(l[o],u[o])),o<a-1?n.push(new Z(2*r[o+1].x-l[o+1],2*r[o+1].y-u[o+1])):n.push(new Z((r[a].x+l[a-1])/2,(r[a].y+u[a-1])/2));return[i,n]}function e(r){var i=r.length,n=[],a=[],o=2;n[0]=r[0]/o;for(var s=1;s<i;s++)a[s]=1/o,o=(s<i-1?4:3.5)-a[s],n[s]=(r[s]-n[s-1])/o;for(s=1;s<i;s++)n[i-s-1]-=a[i-s]*n[i-s];return n}return function(r){if(!r||Array.isArray(r)&&r.length<2)throw new Error("At least 2 points are required");for(var i=t(r),n=[],a=i[0].length,o=0;o<a;o++){var s=new Z(i[0][o].x,i[0][o].y),l=new Z(i[1][o].x,i[1][o].y);n.push(new Zt(r[o],s,l,r[o+1]))}return n}}(),Zt.prototype={type:ct.Curve,bbox:function(){for(var t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end,n=t.x,a=t.y,o=e.x,s=e.y,l=r.x,u=r.y,g=i.x,h=i.y,y=new Array,x=new Array,C=[new Array,new Array],p,E,k,w,S,T,m,A,M=0;M<2;++M){if(M===0?(E=6*n-12*o+6*l,p=-3*n+9*o-9*l+3*g,k=3*o-3*n):(E=6*a-12*s+6*u,p=-3*a+9*s-9*u+3*h,k=3*s-3*a),Si(p)<1e-12){if(Si(E)<1e-12)continue;w=-k/E,0<w&&w<1&&x.push(w);continue}m=E*E-4*k*p,A=Fn(m),!(m<0)&&(S=(-E+A)/(2*p),0<S&&S<1&&x.push(S),T=(-E-A)/(2*p),0<T&&T<1&&x.push(T))}for(var N=x.length,D=N,z,_,j;N--;)w=x[N],z=1-w,_=z*z*z*n+3*z*z*w*o+3*z*w*w*l+w*w*w*g,C[0][N]=_,j=z*z*z*a+3*z*z*w*s+3*z*w*w*u+w*w*w*h,C[1][N]=j,y[N]={X:_,Y:j};x[D]=0,x[D+1]=1,y[D]={X:n,Y:a},y[D+1]={X:g,Y:h},C[0][D]=n,C[1][D]=a,C[0][D+1]=g,C[1][D+1]=h,x.length=D+2,C[0].length=D+2,C[1].length=D+2,y.length=D+2;var V=Nr.apply(null,C[0]),W=Nr.apply(null,C[1]),Y=tn.apply(null,C[0]),X=tn.apply(null,C[1]);return new at(V,W,Y-V,X-W)},clone:function(){return new Zt(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(t,e){return this.pointAtT(this.closestPointT(t,e))},closestPointLength:function(t,e){e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,n={precision:r,subdivisions:i};return this.lengthAtT(this.closestPointT(t,n),n)},closestPointNormalizedLength:function(t,e){e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,n={precision:r,subdivisions:i},a=this.closestPointLength(t,n);if(!a)return 0;var o=this.length(n);return o===0?0:a/o},closestPointT:function(t,e){e=e||{};for(var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,n,a,o,s,l,u,g,h=i.length,y=h?1/h:0,x=0;x<h;x++){var C=i[x],p=C.start.distance(t),E=C.end.distance(t),k=p+E;(!g||k<g)&&(n=C,a=x*y,o=(x+1)*y,s=p,l=E,u=C.start.distance(C.end),g=k)}for(var w=Mi(10,-r);;){var S=s?Si(s-l)/s:0,T=l?Si(s-l)/l:0,m=S<w||T<w,A=s?s<u*w:!0,M=l?l<u*w:!0,N=A||M;if(m||N)return s<=l?a:o;var D=n.divide(.5);y/=2;var z=D[0].start.distance(t),_=D[0].end.distance(t),j=z+_,V=D[1].start.distance(t),W=D[1].end.distance(t),Y=V+W;j<=Y?(n=D[0],o-=y,s=z,l=_):(n=D[1],a+=y,s=V,l=W)}},closestPointTangent:function(t,e){return this.tangentAtT(this.closestPointT(t,e))},containsPoint:function(t,e){var r=this.toPolyline(e);return r.containsPoint(t)},divideAt:function(t,e){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);var r=this.tAt(t,e);return this.divideAtT(r)},divideAtLength:function(t,e){var r=this.tAtLength(t,e);return this.divideAtT(r)},divideAtT:function(t){var e=this.start,r=this.controlPoint1,i=this.controlPoint2,n=this.end;if(t<=0)return[new Zt(e,e,e,e),new Zt(e,r,i,n)];if(t>=1)return[new Zt(e,r,i,n),new Zt(n,n,n,n)];var a=this.getSkeletonPoints(t),o=a.startControlPoint1,s=a.startControlPoint2,l=a.divider,u=a.dividerControlPoint1,g=a.dividerControlPoint2;return[new Zt(e,o,s,l),new Zt(l,u,g,n)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.controlPoint1.x===t.controlPoint1.x&&this.controlPoint1.y===t.controlPoint1.y&&this.controlPoint2.x===t.controlPoint2.x&&this.controlPoint2.y===t.controlPoint2.y&&this.end.x===t.end.x&&this.end.y===t.end.y},getSkeletonPoints:function(t){var e=this.start,r=this.controlPoint1,i=this.controlPoint2,n=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:r.clone(),dividerControlPoint2:i.clone()};if(t>=1)return{startControlPoint1:r.clone(),startControlPoint2:i.clone(),divider:n.clone(),dividerControlPoint1:n.clone(),dividerControlPoint2:n.clone()};var a=new dt(e,r).pointAt(t),o=new dt(r,i).pointAt(t),s=new dt(i,n).pointAt(t),l=new dt(a,o).pointAt(t),u=new dt(o,s).pointAt(t),g=new dt(l,u).pointAt(t),h={startControlPoint1:a,startControlPoint2:l,divider:g,dividerControlPoint1:u,dividerControlPoint2:s};return h},getSubdivisions:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision,r=[new Zt(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(e===0)return r;for(var i=this.endpointDistance(),n=Mi(10,-e),a=0;;){a+=1;for(var o=[],s=r.length,l=0;l<s;l++){var u=r[l],g=u.divide(.5);o.push(g[0],g[1])}for(var h=0,y=o.length,x=0;x<y;x++){var C=o[x];h+=C.endpointDistance()}var p=h!==0?(h-i)/h:0;if(a>1&&p<n)return o;r=o,i=h}},isDifferentiable:function(){var t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end;return!(t.equals(e)&&e.equals(r)&&r.equals(i))},length:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,r=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,i=0,n=r.length,a=0;a<n;a++){var o=r[a];i+=o.endpointDistance()}return i},lengthAtT:function(t,e){if(t<=0)return 0;e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=this.divide(t)[0],n=i.length({precision:r});return n},pointAt:function(t,e){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();var r=this.tAt(t,e);return this.pointAtT(r)},pointAtLength:function(t,e){var r=this.tAtLength(t,e);return this.pointAtT(r)},pointAtT:function(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider},PRECISION:3,round:function(t){return this.start.round(t),this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,r){return this.start.scale(t,e,r),this.controlPoint1.scale(t,e,r),this.controlPoint2.scale(t,e,r),this.end.scale(t,e,r),this},tangentAt:function(t,e){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var r=this.tAt(t,e);return this.tangentAtT(r)},tangentAtLength:function(t,e){if(!this.isDifferentiable())return null;var r=this.tAtLength(t,e);return this.tangentAtT(r)},tangentAtT:function(t){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var e=this.getSkeletonPoints(t),r=e.startControlPoint2,i=e.dividerControlPoint1,n=e.divider,a=new dt(r,i);return a.translate(n.x-r.x,n.y-r.y),a},tAt:function(t,e){if(t<=0)return 0;if(t>=1)return 1;e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,n={precision:r,subdivisions:i},a=this.length(n),o=a*t;return this.tAtLength(o,n)},tAtLength:function(t,e){var r=!0;t<0&&(r=!1,t=-t),e=e||{};for(var i=e.precision===void 0?this.PRECISION:e.precision,n=e.subdivisions===void 0?this.getSubdivisions({precision:i}):e.subdivisions,a={precision:i,subdivisions:n},o,s,l,u,g,h=0,y=n.length,x=1/y,C=0;C<y;C++){var p=r?C:y-1-C,E=n[C],k=E.endpointDistance();if(t<=h+k){o=E,s=p*x,l=(p+1)*x,u=r?t-h:k+h-t,g=r?k+h-t:t-h;break}h+=k}if(!o)return r?1:0;for(var w=this.length(a),S=Mi(10,-i);;){var T;if(T=w!==0?u/w:0,T<S)return s;if(T=w!==0?g/w:0,T<S)return l;var m,A,M=o.divide(.5);x/=2;var N=M[0].endpointDistance(),D=M[1].endpointDistance();u<=N?(o=M[0],l-=x,m=u,A=N-m):(o=M[1],s+=x,m=u-N,A=D-m),u=m,g=A}},toPoints:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,r=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,i=[r[0].start.clone()],n=r.length,a=0;a<n;a++){var o=r[a];i.push(o.end.clone())}return i},toPolyline:function(t){return new Qt(this.toPoints(t))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}},Zt.prototype.divide=Zt.prototype.divideAtT;function Wr(t){var e=arguments,r,i,n=[];for(i=arguments.length,r=1;r<i;r++)n.push(e[r]);if(!t)throw new Error("Missing a parent object.");var a=Object.create(t);for(i=n.length,r=0;r<i;r++){var o=n[r],s,l;for(l in o)o.hasOwnProperty(l)&&(delete a[l],s=Object.getOwnPropertyDescriptor(o,l),Object.defineProperty(a,l,s))}return a}var rt=function(t){if(!(this instanceof rt))return new rt(t);if(typeof t=="string")return new rt.parse(t);this.segments=[];var e,r;if(t)if(Array.isArray(t)&&t.length!==0)if(t=t.reduce(function(s,l){return s.concat(l)},[]),r=t.length,t[0].isSegment)for(e=0;e<r;e++){var i=t[e];this.appendSegment(i)}else{var n=null;for(e=0;e<r;e++){var a=t[e];if(!(a instanceof dt||a instanceof Zt))throw new Error("Cannot construct a path segment from the provided object.");e===0&&this.appendSegment(rt.createSegment("M",a.start)),n&&!n.end.equals(a.start)&&this.appendSegment(rt.createSegment("M",a.start)),a instanceof dt?this.appendSegment(rt.createSegment("L",a.end)):a instanceof Zt&&this.appendSegment(rt.createSegment("C",a.controlPoint1,a.controlPoint2,a.end)),n=a}}else if(t.isSegment)this.appendSegment(t);else if(t instanceof dt)this.appendSegment(rt.createSegment("M",t.start)),this.appendSegment(rt.createSegment("L",t.end));else if(t instanceof Zt)this.appendSegment(rt.createSegment("M",t.start)),this.appendSegment(rt.createSegment("C",t.controlPoint1,t.controlPoint2,t.end));else if(t instanceof Qt){if(!(t.points&&t.points.length!==0))return;for(r=t.points.length,e=0;e<r;e++){var o=t.points[e];e===0?this.appendSegment(rt.createSegment("M",o)):this.appendSegment(rt.createSegment("L",o))}}else throw new Error("Cannot construct a path from the provided object.")};rt.parse=function(t){if(!t)return new rt;for(var e=new rt,r=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,i=t.match(r),n=i.length,a=0;a<n;a++){var o=i[a],s=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,l=o.match(s),u=rt.createSegment.apply(this,l);e.appendSegment(u)}return e},rt.createSegment=function(t){var e=arguments;if(!t)throw new Error("Type must be provided.");var r=rt.segmentTypes[t];if(!r)throw new Error(t+" is not a recognized path segment type.");for(var i=[],n=arguments.length,a=1;a<n;a++)i.push(e[a]);return Ee(r,i)},rt.prototype={type:ct.Path,appendSegment:function(t){var e=this.segments,r=e.length,i,n=r!==0?e[r-1]:null,a=null;if(Array.isArray(t)){if(t=t.reduce(function(u,g){return u.concat(g)},[]),!t[0].isSegment)throw new Error("Segments required.");for(var o=t.length,s=0;s<o;s++){var l=t[s];i=this.prepareSegment(l,n,a),e.push(i),n=i}}else{if(!t||!t.isSegment)throw new Error("Segment required.");i=this.prepareSegment(t,n,a),e.push(i)}},bbox:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var r,i=0;i<e;i++){var n=t[i];if(n.isVisible){var a=n.bbox();r=r?r.union(a):a}}if(r)return r;var o=t[e-1];return new at(o.end.x,o.end.y,0,0)},clone:function(){for(var t=this.segments,e=t.length,r=new rt,i=0;i<e;i++){var n=t[i].clone();r.appendSegment(n)}return r},closestPoint:function(t,e){var r=this.closestPointT(t,e);return r?this.pointAtT(r):null},closestPointLength:function(t,e){e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):e.segmentSubdivisions,n={precision:r,segmentSubdivisions:i},a=this.closestPointT(t,n);return a?this.lengthAtT(a,n):0},closestPointNormalizedLength:function(t,e){e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision,i=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):e.segmentSubdivisions,n={precision:r,segmentSubdivisions:i},a=this.closestPointLength(t,n);if(a===0)return 0;var o=this.length(n);return o===0?0:a/o},closestPointT:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;e=e||{};for(var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o,s=1/0,l=0;l<i;l++){var u=r[l],g=a[l];if(u.isVisible){var h=u.closestPointT(t,{precision:n,subdivisions:g}),y=u.pointAtT(h),x=new dt(y,t).squaredLength();x<s&&(o={segmentIndex:l,value:h},s=x)}}return o||{segmentIndex:i-1,value:1}},closestPointTangent:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;e=e||{};for(var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o,s=1/0,l=0;l<i;l++){var u=r[l],g=a[l];if(u.isDifferentiable()){var h=u.closestPointT(t,{precision:n,subdivisions:g}),y=u.pointAtT(h),x=new dt(y,t).squaredLength();x<s&&(o=u.tangentAtT(h),s=x)}}return o||null},containsPoint:function(t,e){var r=this.toPolylines(e);if(!r)return!1;for(var i=r.length,n=0,a=0;a<i;a++){var o=r[a];o.containsPoint(t)&&n++}return n%2===1},divideAt:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o={precision:n,segmentSubdivisions:a},s=this.length(o),l=s*t;return this.divideAtLength(l,o)},divideAtLength:function(t,e){var r=this.segments.length;if(r===0)return null;var i=!0;t<0&&(i=!1,t=-t),e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o,s,l=0,u,g,h,y,x;for(o=0;o<r;o++){var C=i?o:r-1-o;s=this.getSegment(C);var p=a[C],E=s.length({precision:n,subdivisions:p});if(s.isDifferentiable()&&(h=s,y=C,t<=l+E)){g=C,u=s.divideAtLength((i?1:-1)*(t-l),{precision:n,subdivisions:p});break}l+=E}if(!h)return null;u||(g=y,x=i?1:0,u=h.divideAtT(x));var k=this.clone();k.replaceSegment(g,u);var w=g,S=g+1,T=g+2;u[0].isDifferentiable()||(k.removeSegment(w),S-=1,T-=1);var m=k.getSegment(S).start;k.insertSegment(S,rt.createSegment("M",m)),T+=1,u[1].isDifferentiable()||(k.removeSegment(T-1),T-=1);var A=T-w-1;for(o=T;o<k.segments.length;o++){var M=this.getSegment(o-A);if(s=k.getSegment(o),s.type==="Z"&&!M.subpathStartSegment.end.equals(s.subpathStartSegment.end)){var N=rt.createSegment("L",M.end);k.replaceSegment(o,N)}}var D=new rt(k.segments.slice(0,S)),z=new rt(k.segments.slice(S));return[D,z]},equals:function(t){if(!t)return!1;var e=this.segments,r=t.segments,i=e.length;if(r.length!==i)return!1;for(var n=0;n<i;n++){var a=e[n],o=r[n];if(a.type!==o.type||!a.equals(o))return!1}return!0},getSegment:function(t){var e=this.segments,r=e.length;if(r===0)throw new Error("Path has no segments.");if(t<0&&(t=r+t),t>=r||t<0)throw new Error("Index out of range.");return e[t]},getSegmentSubdivisions:function(t){var e=this.segments,r=e.length;t=t||{};for(var i=t.precision===void 0?this.PRECISION:t.precision,n=[],a=0;a<r;a++){var o=e[a],s=o.getSubdivisions({precision:i});n.push(s)}return n},getSubpaths:function(){for(var t=this.clone().validate(),e=t.segments,r=e.length,i=[],n=0;n<r;n++){var a=e[n];a.isSubpathStart?i.push(new rt(a)):i[i.length-1].appendSegment(a)}return i},insertSegment:function(t,e){var r=this.segments,i=r.length;if(t<0&&(t=i+t+1),t>i||t<0)throw new Error("Index out of range.");var n,a=null,o=null;if(i!==0&&(t>=1?(a=r[t-1],o=a.nextSegment):o=r[0]),Array.isArray(e)){if(e=e.reduce(function(g,h){return g.concat(h)},[]),!e[0].isSegment)throw new Error("Segments required.");for(var s=e.length,l=0;l<s;l++){var u=e[l];n=this.prepareSegment(u,a,o),r.splice(t+l,0,n),a=n}}else{if(!e||!e.isSegment)throw new Error("Segment required.");n=this.prepareSegment(e,a,o),r.splice(t,0,n)}},intersectionWithLine:function(t,e){var r=null,i=this.toPolylines(e);if(!i)return null;for(var n=0,a=i.length;n<a;n++){var o=i[n],s=t.intersect(o);s&&(r||(r=[]),Array.isArray(s)?Array.prototype.push.apply(r,s):r.push(s))}return r},isDifferentiable:function(){for(var t=this.segments,e=t.length,r=0;r<e;r++){var i=t[r];if(i.isDifferentiable())return!0}return!1},isValid:function(){var t=this.segments,e=t.length===0||t[0].type==="M";return e},length:function(t){var e=this.segments,r=e.length;if(r===0)return 0;t=t||{};for(var i=t.precision===void 0?this.PRECISION:t.precision,n=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):t.segmentSubdivisions,a=0,o=0;o<r;o++){var s=e[o],l=n[o];a+=s.length({subdivisions:l})}return a},lengthAtT:function(t,e){var r=this.segments,i=r.length;if(i===0)return 0;var n=t.segmentIndex;if(n<0)return 0;var a=t.value;n>=i?(n=i-1,a=1):a<0?a=0:a>1&&(a=1),e=e||{};for(var o=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions,l,u=0,g=0;g<n;g++){var h=r[g];l=s[g],u+=h.length({precisison:o,subdivisions:l})}return h=r[n],l=s[n],u+=h.lengthAtT(a,{precisison:o,subdivisions:l}),u},pointAt:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o={precision:n,segmentSubdivisions:a},s=this.length(o),l=s*t;return this.pointAtLength(l,o)},pointAtLength:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;if(t===0)return this.start.clone();var n=!0;t<0&&(n=!1,t=-t),e=e||{};for(var a=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:a}):e.segmentSubdivisions,s,l=0,u=0;u<i;u++){var g=n?u:i-1-u,h=r[g],y=o[g],x=h.length({precision:a,subdivisions:y});if(h.isVisible){if(t<=l+x)return h.pointAtLength((n?1:-1)*(t-l),{precision:a,subdivisions:y});s=h}l+=x}if(s)return n?s.end:s.start;var C=r[i-1];return C.end.clone()},pointAtT:function(t){var e=this.segments,r=e.length;if(r===0)return null;var i=t.segmentIndex;if(i<0)return e[0].pointAtT(0);if(i>=r)return e[r-1].pointAtT(1);var n=t.value;return n<0?n=0:n>1&&(n=1),e[i].pointAtT(n)},PRECISION:3,prepareSegment:function(t,e,r){t.previousSegment=e,t.nextSegment=r,e&&(e.nextSegment=t),r&&(r.previousSegment=t);var i=t;return t.isSubpathStart&&(t.subpathStartSegment=t,i=r),i&&this.updateSubpathStartSegment(i),t},removeSegment:function(t){var e=this.segments,r=e.length;if(r===0)throw new Error("Path has no segments.");if(t<0&&(t=r+t),t>=r||t<0)throw new Error("Index out of range.");var i=e.splice(t,1)[0],n=i.previousSegment,a=i.nextSegment;n&&(n.nextSegment=a),a&&(a.previousSegment=n),i.isSubpathStart&&a&&this.updateSubpathStartSegment(a)},replaceSegment:function(t,e){var r=this.segments,i=r.length;if(i===0)throw new Error("Path has no segments.");if(t<0&&(t=i+t),t>=i||t<0)throw new Error("Index out of range.");var n,a=r[t],o=a.previousSegment,s=a.nextSegment,l=a.isSubpathStart;if(Array.isArray(e)){if(e=e.reduce(function(y,x){return y.concat(x)},[]),!e[0].isSegment)throw new Error("Segments required.");r.splice(t,1);for(var u=e.length,g=0;g<u;g++){var h=e[g];n=this.prepareSegment(h,o,s),r.splice(t+g,0,n),o=n,l&&n.isSubpathStart&&(l=!1)}}else{if(!e||!e.isSegment)throw new Error("Segment required.");n=this.prepareSegment(e,o,s),r.splice(t,1,n),l&&n.isSubpathStart&&(l=!1)}l&&s&&this.updateSubpathStartSegment(s)},round:function(t){for(var e=this.segments,r=e.length,i=0;i<r;i++){var n=e[i];n.round(t)}return this},scale:function(t,e,r){for(var i=this.segments,n=i.length,a=0;a<n;a++){var o=i[a];o.scale(t,e,r)}return this},segmentAt:function(t,e){var r=this.segmentIndexAt(t,e);return r?this.getSegment(r):null},segmentAtLength:function(t,e){var r=this.segmentIndexAtLength(t,e);return r?this.getSegment(r):null},segmentIndexAt:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o={precision:n,segmentSubdivisions:a},s=this.length(o),l=s*t;return this.segmentIndexAtLength(l,o)},segmentIndexAtLength:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;var n=!0;t<0&&(n=!1,t=-t),e=e||{};for(var a=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:a}):e.segmentSubdivisions,s=null,l=0,u=0;u<i;u++){var g=n?u:i-1-u,h=r[g],y=o[g],x=h.length({precision:a,subdivisions:y});if(h.isVisible){if(t<=l+x)return g;s=g}l+=x}return s},serialize:function(){if(!this.isValid())throw new Error("Invalid path segments.");return this.toString()},tangentAt:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,o={precision:n,segmentSubdivisions:a},s=this.length(o),l=s*t;return this.tangentAtLength(l,o)},tangentAtLength:function(t,e){var r=this.segments,i=r.length;if(i===0)return null;var n=!0;t<0&&(n=!1,t=-t),e=e||{};for(var a=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:a}):e.segmentSubdivisions,s,l=0,u=0;u<i;u++){var g=n?u:i-1-u,h=r[g],y=o[g],x=h.length({precision:a,subdivisions:y});if(h.isDifferentiable()){if(t<=l+x)return h.tangentAtLength((n?1:-1)*(t-l),{precision:a,subdivisions:y});s=h}l+=x}if(s){var C=n?1:0;return s.tangentAtT(C)}return null},tangentAtT:function(t){var e=this.segments,r=e.length;if(r===0)return null;var i=t.segmentIndex;if(i<0)return e[0].tangentAtT(0);if(i>=r)return e[r-1].tangentAtT(1);var n=t.value;return n<0?n=0:n>1&&(n=1),e[i].tangentAtT(n)},toPoints:function(t){var e=this.segments,r=e.length;if(r===0)return null;t=t||{};for(var i=t.precision===void 0?this.PRECISION:t.precision,n=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):t.segmentSubdivisions,a=[],o=[],s=0;s<r;s++){var l=e[s];if(l.isVisible){var u=n[s];if(u.length>0){var g=u.map(function(h){return h.start});Array.prototype.push.apply(o,g)}else o.push(l.start)}else o.length>0&&(o.push(e[s-1].end),a.push(o),o=[])}return o.length>0&&(o.push(this.end),a.push(o)),a},toPolylines:function(t){var e=[],r=this.toPoints(t);if(!r)return null;for(var i=0,n=r.length;i<n;i++)e.push(new Qt(r[i]));return e},toString:function(){for(var t=this.segments,e=t.length,r="",i=0;i<e;i++){var n=t[i];r+=n.serialize()+" "}return r.trim()},translate:function(t,e){for(var r=this.segments,i=r.length,n=0;n<i;n++){var a=r[n];a.translate(t,e)}return this},updateSubpathStartSegment:function(t){for(var e=t.previousSegment;t&&!t.isSubpathStart;)e?t.subpathStartSegment=e.subpathStartSegment:t.subpathStartSegment=null,e=t,t=t.nextSegment},validate:function(){return this.isValid()||this.insertSegment(0,rt.createSegment("M",0,0)),this}},Object.defineProperty(rt.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var r=0;r<e;r++){var i=t[r];if(i.isVisible)return i.start}return t[e-1].end}}),Object.defineProperty(rt.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var r=e-1;r>=0;r--){var i=t[r];if(i.isVisible)return i.end}return t[e-1].end}});function Ee(t,e){return e.unshift(null),new(Function.prototype.bind.apply(t,e))}var ai={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:!0,isSubpathStart:!1,isVisible:!0,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0)return 0;var e=this.length();return t>=1?e:e*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,round:function(){throw new Error("Declaration missing for virtual function.")},subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(ai,"end",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(ai,"start",{configurable:!0,enumerable:!0,get:function(){if(!this.previousSegment)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)");return this.previousSegment.end}}),Object.defineProperty(ai,"type",{configurable:!0,enumerable:!0,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var Ge=function(){for(var t=arguments,e=[],r=arguments.length,i=0;i<r;i++)e.push(t[i]);if(!(this instanceof Ge))return Ee(Ge,e);if(r===0)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).");var n;if(e[0]instanceof dt){if(r===1)return this.end=e[0].end.clone(),this;throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+r+" lines provided).")}else if(typeof e[0]=="string"||typeof e[0]=="number"){if(r===2)return this.end=new Z(+e[0],+e[1]),this;if(r<2)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+r+" coordinates provided).");var a;for(n=[],i=0;i<r;i+=2)a=e.slice(i,i+2),n.push(Ee(Ge,a));return n}else{if(r===1)return this.end=new Z(e[0]),this;var o;for(n=[],i=0;i<r;i+=1)o=e[i],n.push(new Ge(o));return n}},Xd={clone:function(){return new Ge(this.end)},divideAt:function(t){var e=new dt(this.start,this.end),r=e.divideAt(t);return[new Ge(r[0]),new Ge(r[1])]},divideAtLength:function(t){var e=new dt(this.start,this.end),r=e.divideAtLength(t);return[new Ge(r[0]),new Ge(r[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return this.previousSegment?!this.start.equals(this.end):!1},round:function(t){return this.end.round(t),this},scale:function(t,e,r){return this.end.scale(t,e,r),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(Xd,"type",{configurable:!0,enumerable:!0,value:"L"}),Ge.prototype=Wr(ai,dt.prototype,Xd);var nr=function(){for(var t=arguments,e=[],r=arguments.length,i=0;i<r;i++)e.push(t[i]);if(!(this instanceof nr))return Ee(nr,e);if(r===0)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).");var n;if(e[0]instanceof Zt){if(r===1)return this.controlPoint1=e[0].controlPoint1.clone(),this.controlPoint2=e[0].controlPoint2.clone(),this.end=e[0].end.clone(),this;throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+r+" curves provided).")}else if(typeof e[0]=="string"||typeof e[0]=="number"){if(r===6)return this.controlPoint1=new Z(+e[0],+e[1]),this.controlPoint2=new Z(+e[2],+e[3]),this.end=new Z(+e[4],+e[5]),this;if(r<6)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+r+" coordinates provided).");var a;for(n=[],i=0;i<r;i+=6)a=e.slice(i,i+6),n.push(Ee(nr,a));return n}else{if(r===3)return this.controlPoint1=new Z(e[0]),this.controlPoint2=new Z(e[1]),this.end=new Z(e[2]),this;if(r<3)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+r+" points provided).");var o;for(n=[],i=0;i<r;i+=3)o=e.slice(i,i+3),n.push(Ee(nr,o));return n}},Hd={clone:function(){return new nr(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(t,e){var r=new Zt(this.start,this.controlPoint1,this.controlPoint2,this.end),i=r.divideAt(t,e);return[new nr(i[0]),new nr(i[1])]},divideAtLength:function(t,e){var r=new Zt(this.start,this.controlPoint1,this.controlPoint2,this.end),i=r.divideAtLength(t,e);return[new nr(i[0]),new nr(i[1])]},divideAtT:function(t){var e=new Zt(this.start,this.controlPoint1,this.controlPoint2,this.end),r=e.divideAtT(t);return[new nr(r[0]),new nr(r[1])]},isDifferentiable:function(){if(!this.previousSegment)return!1;var t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end;return!(t.equals(e)&&e.equals(r)&&r.equals(i))},round:function(t){return this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,r){return this.controlPoint1.scale(t,e,r),this.controlPoint2.scale(t,e,r),this.end.scale(t,e,r),this},serialize:function(){var t=this.controlPoint1,e=this.controlPoint2,r=this.end;return this.type+" "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+r.x+" "+r.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}};Object.defineProperty(Hd,"type",{configurable:!0,enumerable:!0,value:"C"}),nr.prototype=Wr(ai,Zt.prototype,Hd);var oi=function(){for(var t=arguments,e=[],r=arguments.length,i=0;i<r;i++)e.push(t[i]);if(!(this instanceof oi))return Ee(oi,e);if(r===0)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).");var n;if(e[0]instanceof dt){if(r===1)return this.end=e[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+r+" lines provided).")}else if(e[0]instanceof Zt){if(r===1)return this.end=e[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+r+" curves provided).")}else if(typeof e[0]=="string"||typeof e[0]=="number"){if(r===2)return this.end=new Z(+e[0],+e[1]),this;if(r<2)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+r+" coordinates provided).");var a;for(n=[],i=0;i<r;i+=2)a=e.slice(i,i+2),i===0?n.push(Ee(oi,a)):n.push(Ee(Ge,a));return n}else{if(r===1)return this.end=new Z(e[0]),this;var o;for(n=[],i=0;i<r;i+=1)o=e[i],i===0?n.push(new oi(o)):n.push(new Ge(o));return n}},po={bbox:function(){return null},clone:function(){return new oi(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(t){return this.end.equals(t.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return!1},isSubpathStart:!0,isVisible:!1,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},round:function(t){return this.end.round(t),this},scale:function(t,e,r){return this.end.scale(t,e,r),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(po,"start",{configurable:!0,enumerable:!0,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}}),Object.defineProperty(po,"type",{configurable:!0,enumerable:!0,value:"M"}),oi.prototype=Wr(ai,po);var ki=function(){for(var t=arguments,e=[],r=arguments.length,i=0;i<r;i++)e.push(t[i]);if(!(this instanceof ki))return Ee(ki,e);if(r>0)throw new Error("Closepath constructor expects no arguments.");return this},mo={clone:function(){return new ki},divideAt:function(t){var e=new dt(this.start,this.end),r=e.divideAt(t);return[r[1].isDifferentiable()?new Ge(r[0]):this.clone(),new Ge(r[1])]},divideAtLength:function(t){var e=new dt(this.start,this.end),r=e.divideAtLength(t);return[r[1].isDifferentiable()?new Ge(r[0]):this.clone(),new Ge(r[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)},round:function(){return this},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(mo,"end",{configurable:!0,enumerable:!0,get:function(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)");return this.subpathStartSegment.end}}),Object.defineProperty(mo,"type",{configurable:!0,enumerable:!0,value:"Z"}),ki.prototype=Wr(ai,dt.prototype,mo);var Nx=rt.segmentTypes={L:Ge,C:nr,M:oi,Z:ki,z:ki};rt.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(Nx).join("")+",.]*$"),rt.isDataSupported=function(t){return typeof t!="string"?!1:this.regexSupportedData.test(t)};var Lx={curveThroughPoints:function(t){return console.warn("deprecated"),new rt(Zt.throughPoints(t)).serialize()},getCurveControlPoints:function(t){console.warn("deprecated");var e=[],r=[],i=t.length-1,n;if(i==1)return e[0]=new Z((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3),r[0]=new Z(2*e[0].x-t[0].x,2*e[0].y-t[0].y),[e,r];var a=[];for(n=1;n<i-1;n++)a[n]=4*t[n].x+2*t[n+1].x;a[0]=t[0].x+2*t[1].x,a[i-1]=(8*t[i-1].x+t[i].x)/2;var o=this.getFirstControlPoints(a);for(n=1;n<i-1;++n)a[n]=4*t[n].y+2*t[n+1].y;a[0]=t[0].y+2*t[1].y,a[i-1]=(8*t[i-1].y+t[i].y)/2;var s=this.getFirstControlPoints(a);for(n=0;n<i;n++)e.push(new Z(o[n],s[n])),n<i-1?r.push(new Z(2*t[n+1].x-o[n+1],2*t[n+1].y-s[n+1])):r.push(new Z((t[i].x+o[i-1])/2,(t[i].y+s[i-1])/2));return[e,r]},getCurveDivider:function(t,e,r,i){console.warn("deprecated");var n=new Zt(t,e,r,i);return function(o){var s=n.divide(o);return[{p0:s[0].start,p1:s[0].controlPoint1,p2:s[0].controlPoint2,p3:s[0].end},{p0:s[1].start,p1:s[1].controlPoint1,p2:s[1].controlPoint2,p3:s[1].end}]}},getFirstControlPoints:function(t){console.warn("deprecated");var e=t.length,r=[],i=[],n=2;r[0]=t[0]/n;for(var a=1;a<e;a++)i[a]=1/n,n=(a<e-1?4:3.5)-i[a],r[a]=(t[a]-r[a-1])/n;for(a=1;a<e;a++)r[e-a-1]-=i[e-a]*r[e-a];return r},getInversionSolver:function(t,e,r,i){console.warn("deprecated");var n=new Zt(t,e,r,i);return function(o){return n.closestPointT(o)}}},Qe=function(t){if(!(this instanceof Qe))return new Qe(t);if(typeof t=="string")return new Qe.parse(t);this.points=Array.isArray(t)?t.map(Z):[]};Qe.parse=function(t){return new Qe(pr(t))},Qe.fromRect=function(t){return new Qe([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft()])},Qe.prototype=Wr(Qt.prototype,{type:ct.Polygon,clone:function(){return new Qe(_e(this.points))},convexHull:function(){return new Qe(ni(this.points))},lengthPoints:function(){var t=this,e=t.start,r=t.end,i=t.points;return i.length<=1||e.equals(r)?i:i.concat([e.clone()])}});function qd(t,e,r,i){switch(t.type){case ct.Line:{switch(e.type){case ct.Line:return si(t,e)}break}case ct.Ellipse:{switch(e.type){case ct.Line:return yo(t,e);case ct.Ellipse:return Jd(t,e)}break}case ct.Rect:{switch(e.type){case ct.Line:return Kd(t,e);case ct.Ellipse:return Qd(t,e);case ct.Rect:return bo(t,e)}break}case ct.Polyline:{switch(e.type){case ct.Line:return Vn(t,e);case ct.Ellipse:return wo(t,e);case ct.Rect:return $d(t,e);case ct.Polyline:return tf(t,e)}break}case ct.Polygon:{switch(e.type){case ct.Line:return xo(t,e);case ct.Ellipse:return Wn(t,e);case ct.Rect:return ef(t,e);case ct.Polyline:return rf(t,e);case ct.Polygon:return nf(t,e)}break}case ct.Path:{switch(e.type){case ct.Line:return af(t,e,r);case ct.Ellipse:return of(t,e,r);case ct.Rect:return sf(t,e,r);case ct.Polyline:return Ao(t,e,r);case ct.Polygon:return Zn(t,e,r);case ct.Path:return lf(t,e,r,i)}break}}switch(e.type){case ct.Ellipse:case ct.Rect:case ct.Polyline:case ct.Polygon:case ct.Path:return qd(e,t,i,r);default:throw Error("The intersection for "+t+" and "+e+" could not be found.")}}function si(t,e){var r=t.start.x,i=t.start.y,n=t.end.x,a=t.end.y,o=e.start.x,s=e.start.y,l=e.end.x,u=e.end.y,g=n-r,h=a-i,y=l-o,x=u-s,C=r-o,p=i-s,E=g*x-y*h,k=(g*p-h*C)/E,w=(y*p-x*C)/E;return k>=0&&k<=1&&w>=0&&w<=1}function yo(t,e){var r=t.a,i=t.b,n=t.x,a=t.y,o=e.start.x-n,s=e.end.x-n,l=e.start.y-a,u=e.end.y-a,g=r*r,h=i*i,y=s-o,x=u-l,C=y*y/g+x*x/h,p=2*o*y/g+2*l*x/h,E=o*o/g+l*l/h-1,k=p*p-4*C*E;if(k===0){var w=-p/2/C;return w>=0&&w<=1}else if(k>0){var S=Math.sqrt(k),T=(-p+S)/2/C,m=(-p-S)/2/C;return T>=0&&T<=1||m>=0&&m<=1}return!1}function Jd(t,e){return Ex(t,0,e,0)}function Kd(t,e){var r=e.start,i=e.end,n=t.x,a=t.y,o=t.width,s=t.height;return r.x>n+o&&i.x>n+o||r.x<n&&i.x<n||r.y>a+s&&i.y>a+s||r.y<a&&i.y<a?!1:t.containsPoint(e.start)||t.containsPoint(e.end)?!0:si(t.topLine(),e)||si(t.rightLine(),e)||si(t.bottomLine(),e)||si(t.leftLine(),e)}function Qd(t,e){return bo(t,at.fromEllipse(e))?Wn(Qe.fromRect(t),e):!1}function bo(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function Vn(t,e){return uf(t,e,{interior:!1})}function wo(t,e){return hf(t,e,{interior:!1})}function $d(t,e){return cf(t,e,{interior:!1})}function tf(t,e){return Yn(t,e,{interior:!1})}function xo(t,e){return uf(t,e,{interior:!0})}function Wn(t,e){return hf(t,e,{interior:!0})}function ef(t,e){return cf(t,e,{interior:!0})}function rf(t,e){return Yn(t,e,{interior:!0})}function nf(t,e){return Co(t,e,{interior:!0})}function af(t,e,r){return t.getSubpaths().some(function(i){var n=i.toPolylines(r),a=n[0],o=i.getSegment(-1),s=o.type;return s==="Z"?xo(a,e):Vn(a,e)})}function of(t,e,r){return t.getSubpaths().some(function(i){var n=i.toPolylines(r),a=n[0],o=i.getSegment(-1),s=o.type;return s==="Z"?Wn(a,e):wo(a,e)})}function sf(t,e,r){return Zn(t,Qe.fromRect(e),r)}function Ao(t,e,r){return df(t,e,r,{interior:!1})}function Zn(t,e,r){return df(t,e,r,{interior:!0})}function lf(t,e,r,i){return t.getSubpaths().some(function(n){var a=n.toPolylines(r),o=a[0],s=n.getSegment(-1),l=s.type;return l==="Z"?Zn(e,o,i):Ao(e,o,i)})}function uf(t,e,r){r===void 0&&(r={});var i=r.interior;i===void 0&&(i=!1);var n;if(i){if(t.containsPoint(e.start))return!0;var a=t.start,o=t.end,s=t.points;n=o.equals(a)?s:s.concat([a])}else n=t.points;for(var l=n.length,u=new dt,g=0;g<l-1;g++)if(u.start=n[g],u.end=n[g+1],si(e,u))return!0;return!1}function hf(t,e,r){r===void 0&&(r={});var i=t.start,n=t.end,a=t.points;if(e.containsPoint(i))return!0;var o,s=r.interior;if(s===void 0&&(s=!1),s){if(t.containsPoint(e.center()))return!0;o=n.equals(i)?a:a.concat([i])}else o=a;for(var l=o.length,u=new dt,g=0;g<l-1;g++)if(u.start=o[g],u.end=o[g+1],yo(e,u))return!0;return!1}function cf(t,e,r){var i=Qe.fromRect(e);return Co(t,i,r)}function df(t,e,r,i){return t.getSubpaths().some(function(n){var a=n.toPolylines(r),o=a[0],s=n.getSegment(-1),l=s.type;return l==="Z"?Co(e,o,i):Yn(e,o,i)})}function Yn(t,e,r){r===void 0&&(r={});var i=r.interior;i===void 0&&(i=!1);var n;if(i){var a=e.start;if(t.containsPoint(a))return!0;n=t.clone().close()}else n=t;for(var o=e.points,s=o.length,l=new dt,u=0;u<s-1;u++)if(l.start=o[u],l.end=o[u+1],Vn(n,l))return!0;return!1}function Co(t,e,r){return e.containsPoint(t.start)||Yn(t,e.clone().close(),r)}function Ex(t,e,r,i){var n=Math.cos,a=Math.sin,o=a(e),s=n(e),l=a(i),u=n(i),g=o*o,h=s*s,y=o*s,x=l*l,C=u*u,p=l*u,E=t.a*t.a,k=t.b*t.b,w=r.a*r.a,S=r.b*r.b,T=E*g+k*h,m=w*x+S*C,A=E*h+k*g,M=w*C+S*x,N=2*(k-E)*y,D=2*(S-w)*p,z=-2*T*t.x-N*t.y,_=-2*m*r.x-D*r.y,j=-N*t.x-2*A*t.y,V=-D*r.x-2*M*r.y,W=T*t.x*t.x+A*t.y*t.y+N*t.x*t.y-E*k,Y=m*r.x*r.x+M*r.y*r.y+D*r.x*r.y-w*S;N=N/2,D=D/2,z=z/2,_=_/2,j=j/2,V=V/2;var X=Zr([[T,N,z],[N,A,j],[z,j,W]]),J=Zr([[m,D,_],[D,M,V],[_,V,Y]]),Q=.33333333*(Zr([[m,N,z],[D,A,j],[_,j,W]])+Zr([[T,D,z],[N,M,j],[z,V,W]])+Zr([[T,N,_],[N,A,V],[z,j,Y]])),it=.33333333*(Zr([[T,D,_],[N,M,V],[z,V,Y]])+Zr([[m,N,_],[D,A,V],[_,j,Y]])+Zr([[m,D,z],[D,M,j],[_,V,W]])),st=Un([[X,Q],[Q,it]]),gt=Un([[X,it],[Q,J]]),nt=Un([[Q,it],[it,J]]),ut=Un([[2*st,gt],[gt,2*nt]]);return!(ut>0&&(it>0||Q>0))}function Un(t){return t[0][0]*t[1][1]-t[0][1]*t[1][0]}function Zr(t){return t[0][0]*t[1][1]*t[2][2]-t[0][0]*t[1][2]*t[2][1]-t[0][1]*t[1][0]*t[2][2]+t[0][1]*t[1][2]*t[2][0]+t[0][2]*t[1][0]*t[2][1]-t[0][2]*t[1][1]*t[2][0]}var Dx={__proto__:null,exists:qd,lineWithLine:si,ellipseWithLine:yo,ellipseWithEllipse:Jd,rectWithLine:Kd,rectWithEllipse:Qd,rectWithRect:bo,polylineWithLine:Vn,polylineWithEllipse:wo,polylineWithRect:$d,polylineWithPolyline:tf,polygonWithLine:xo,polygonWithEllipse:Wn,polygonWithRect:ef,polygonWithPolyline:rf,polygonWithPolygon:nf,pathWithLine:af,pathWithEllipse:of,pathWithRect:sf,pathWithPolyline:Ao,pathWithPolygon:Zn,pathWithPath:lf},zx=Dx,ff={__proto__:null,intersection:zx,scale:q,normalizeAngle:et,snapToGrid:ht,toDeg:mt,toRad:bt,random:Pt,bezier:Lx,Curve:Zt,Ellipse:Re,ellipse:go,Line:dt,line:Tr,Path:rt,Point:Z,point:Bt,Polyline:Qt,Polygon:Qe,Rect:at,rect:We,types:ct},F=function(){var t=typeof window=="object"&&!!window.SVGAngle;if(!t)return function(){throw new Error("SVG is required to use Vectorizer.")};var e={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"},r="1.1",i=Math,n=i.PI,a=i.atan2,o=i.sqrt,s=i.min,l=i.max,u=i.cos,g=i.sin,h=function(m,A,M){if(!(this instanceof h))return h.apply(Object.create(h.prototype),arguments);if(!!m){if(h.isV(m)&&(m=m.node),A=A||{},h.isString(m)){if(m=m.trim(),m.toLowerCase()==="svg")m=h.createSvgDocument();else if(m[0]==="<"){var N=h.createSvgDocument(m);if(N.childNodes.length>1){var D=[],z,_;for(z=0,_=N.childNodes.length;z<_;z++){var j=N.childNodes[z];D.push(new h(document.importNode(j,!0)))}return D}m=document.importNode(N.firstChild,!0)}else m=document.createElementNS(e.svg,m);h.ensureId(m)}return this.node=m,this.setAttributes(A),M&&this.append(M),this}},y=h.prototype;Object.defineProperty(y,"id",{enumerable:!0,get:function(){return this.node.id},set:function(m){this.node.id=m}}),y.getTransformToElement=function(m){var A=this.node;if(h.isSVGGraphicsElement(m)&&h.isSVGGraphicsElement(A)){var M=h.toNode(m).getScreenCTM(),N=A.getScreenCTM();if(M&&N)return M.inverse().multiply(N)}return h.createSVGMatrix()},y.transform=function(m,A){var M=this.node;if(h.isUndefined(m))return h.transformStringToMatrix(this.attr("transform"));if(A&&A.absolute)return this.attr("transform",h.matrixToTransformString(m));var N=h.createSVGTransform(m);return M.transform.baseVal.appendItem(N),this},y.translate=function(m,A,M){M=M||{},A=A||0;var N=this.attr("transform")||"",D=h.parseTransformString(N);if(N=D.value,h.isUndefined(m))return D.translate;N=N.replace(/translate\([^)]*\)/g,"").trim();var z=M.absolute?m:D.translate.tx+m,_=M.absolute?A:D.translate.ty+A,j="translate("+z+","+_+")";return this.attr("transform",(j+" "+N).trim()),this},y.rotate=function(m,A,M,N){N=N||{};var D=this.attr("transform")||"",z=h.parseTransformString(D);if(D=z.value,h.isUndefined(m))return z.rotate;D=D.replace(/rotate\([^)]*\)/g,"").trim(),m%=360;var _=N.absolute?m:z.rotate.angle+m,j=A!==void 0&&M!==void 0?","+A+","+M:"",V="rotate("+_+j+")";return this.attr("transform",(D+" "+V).trim()),this},y.scale=function(m,A){A=h.isUndefined(A)?m:A;var M=this.attr("transform")||"",N=h.parseTransformString(M);if(M=N.value,h.isUndefined(m))return N.scale;M=M.replace(/scale\([^)]*\)/g,"").trim();var D="scale("+m+","+A+")";return this.attr("transform",(M+" "+D).trim()),this},y.bbox=function(m,A){var M,N=this.node,D=N.ownerSVGElement;if(!D)return new at(0,0,0,0);try{M=N.getBBox()}catch{M={x:N.clientLeft,y:N.clientTop,width:N.clientWidth,height:N.clientHeight}}if(m)return new at(M);var z=this.getTransformToElement(A||D);return h.transformRect(M,z)},y.getBBox=function(m){var A={},M,N=this.node,D=N.ownerSVGElement;if(!D||!h.isSVGGraphicsElement(N))return new at(0,0,0,0);if(m&&(m.target&&(A.target=h.toNode(m.target)),m.recursive&&(A.recursive=m.recursive)),A.recursive){var _=this.children(),j=_.length;if(j===0)return this.getBBox({target:A.target,recursive:!1});A.target||(A.target=this);for(var V=0;V<j;V++){var W=_[V],Y;W.children().length===0?Y=W.getBBox({target:A.target,recursive:!1}):Y=W.getBBox({target:A.target,recursive:!0}),M?M=M.union(Y):M=Y}return M}else{try{M=N.getBBox()}catch{M={x:N.clientLeft,y:N.clientTop,width:N.clientWidth,height:N.clientHeight}}if(A.target){var z=this.getTransformToElement(A.target);return h.transformRect(M,z)}else return new at(M)}};function x(m,A){m||(m={});var M=h("textPath"),N=m.d;if(N&&m["xlink:href"]===void 0){var D=h("path").attr("d",N).appendTo(A.defs());M.attr("xlink:href","#"+D.id)}return h.isObject(m)&&M.attr(m),M.node}function C(m,A,M){M||(M={});for(var N=M.includeAnnotationIndices,D=M.eol,z=M.lineHeight,_=M.baseSize,j=0,V={},W=A.length-1,Y=0;Y<=W;Y++){var X=A[Y],J=null;if(h.isObject(X)){var Q=X.attrs,it=h("tspan",Q),st=it.node,gt=X.t;D&&Y===W&&(gt+=D),st.textContent=gt;var nt=Q.class;nt&&it.addClass(nt),N&&it.attr("annotations",X.annotations),J=parseFloat(Q["font-size"]),isFinite(J)||(J=_),J&&J>j&&(j=J)}else D&&Y===W&&(X+=D),st=document.createTextNode(X||" "),_&&_>j&&(j=_);m.appendChild(st)}return j&&(V.maxFontSize=j),z?V.lineHeight=z:j&&(V.lineHeight=j*1.2),V}var p=/em$/;function E(m,A){var M=parseFloat(m);return p.test(m)?M*A:M}function k(m,A,M,N){if(!Array.isArray(A))return 0;var D=A.length;if(!D)return 0;for(var z=A[0],_=E(z.maxFontSize,M)||M,j=0,V=E(N,M),W=1;W<D;W++){z=A[W];var Y=E(z.lineHeight,M)||V;j+=Y}var X=E(z.maxFontSize,M)||M,J;switch(m){case"middle":J=_/2-.15*X-j/2;break;case"bottom":J=-(.25*X)-j;break;default:case"top":J=.8*_;break}return J}y.text=function(m,A){if(m&&typeof m!="string")throw new Error("Vectorizer: text() expects the first argument to be a string.");m=h.sanitizeText(m),A||(A={});var M=A.displayEmpty,N=A.eol,D=A.textPath,z=A.textVerticalAnchor,_=z==="middle"||z==="bottom"||z==="top",j=A.x;j===void 0&&(j=this.attr("x")||0);var V=A.includeAnnotationIndices,W=A.annotations;W&&!h.isArray(W)&&(W=[W]);var Y=A.lineHeight,X=Y==="auto",J=X?"1.5em":Y||"1em";this.empty(),this.attr({"xml:space":"preserve",display:m||M?null:"none"});var Q=parseFloat(this.attr("font-size"));Q||(Q=16,(_||W)&&this.attr("font-size",Q));var it=document,st;D?(typeof D=="string"&&(D={d:D}),st=x(D,this)):st=it.createDocumentFragment();for(var gt=0,nt=m.split(`
`),ut=[],ft,vt=0,xt=nt.length-1;vt<=xt;vt++){var Et=J,Rt="v-line",It=it.createElementNS(e.svg,"tspan"),Wt=nt[vt],St;if(Wt)if(W){var Ct=h.annotateString(Wt,W,{offset:-gt,includeAnnotationIndices:V});St=C(It,Ct,{includeAnnotationIndices:V,eol:vt!==xt&&N,lineHeight:X?null:J,baseSize:Q});var jt=St.lineHeight;jt&&X&&vt!==0&&(Et=jt),vt===0&&(ft=St.maxFontSize*.8)}else N&&vt!==xt&&(Wt+=N),It.textContent=Wt;else{It.textContent="-",Rt+=" v-empty-line";var wt=It.style;if(wt.fillOpacity=0,wt.strokeOpacity=0,W){St={},Ct=h.findAnnotationsAtIndex(W,gt);for(var pt=Q,ge=Ct.length;ge>0;ge--){var ye=Ct[ge-1].attrs;if(!(!ye||!("font-size"in ye))){var ce=parseFloat(ye["font-size"]);if(isFinite(ce)){pt=ce;break}}}X&&(vt>0?Et=pt*1.2:ft=pt*.8),It.setAttribute("font-size",pt),St.maxFontSize=pt}}St&&ut.push(St),vt>0&&It.setAttribute("dy",Et),(vt>0||D)&&It.setAttribute("x",j),It.className.baseVal=Rt,st.appendChild(It),gt+=Wt.length+1}if(_)if(W)Et=k(z,ut,Q,J);else if(z==="top")Et="0.8em";else{var Se;switch(xt>0?(Se=parseFloat(J)||1,Se*=xt,p.test(J)||(Se/=Q)):Se=0,z){case"middle":Et=.3-Se/2+"em";break;case"bottom":Et=-Se-.3+"em";break}}else z===0?Et="0em":z?Et=z:(Et=0,this.attr("y")===null&&this.attr("y",ft||"0.8em"));return st.firstChild.setAttribute("dy",Et),this.append(st),this},y.removeAttr=function(m){var A=h.qualifyAttr(m),M=this.node;return A.ns?M.hasAttributeNS(A.ns,A.local)&&M.removeAttributeNS(A.ns,A.local):M.hasAttribute(m)&&M.removeAttribute(m),this},y.attr=function(m,A){if(h.isUndefined(m)){for(var M=this.node.attributes,N={},D=0;D<M.length;D++)N[M[D].name]=M[D].value;return N}if(h.isString(m)&&h.isUndefined(A))return this.node.getAttribute(m);if(typeof m=="object")for(var z in m)m.hasOwnProperty(z)&&this.setAttribute(z,m[z]);else this.setAttribute(m,A);return this},y.normalizePath=function(){var m=this.tagName();return m==="PATH"&&this.attr("d",h.normalizePathData(this.attr("d"))),this},y.remove=function(){return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this},y.empty=function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);return this},y.setAttributes=function(m){for(var A in m)m.hasOwnProperty(A)&&this.setAttribute(A,m[A]);return this},y.append=function(m){h.isArray(m)||(m=[m]);for(var A=0,M=m.length;A<M;A++)this.node.appendChild(h.toNode(m[A]));return this},y.prepend=function(m){var A=this.node.firstChild;return A?h(A).before(m):this.append(m)},y.before=function(m){var A=this.node,M=A.parentNode;if(M){h.isArray(m)||(m=[m]);for(var N=0,D=m.length;N<D;N++)M.insertBefore(h.toNode(m[N]),A)}return this},y.appendTo=function(m){return h.toNode(m).appendChild(this.node),this},y.svg=function(){return this.node instanceof window.SVGSVGElement?this:h(this.node.ownerSVGElement)},y.tagName=function(){return this.node.tagName.toUpperCase()},y.defs=function(){var m=this.svg()||this,A=m.node.getElementsByTagName("defs")[0];return A?h(A):h("defs").appendTo(m)},y.clone=function(){var m=h(this.node.cloneNode(!0));return m.node.id=h.uniqueId(),m},y.findOne=function(m){var A=this.node.querySelector(m);return A?h(A):void 0},y.find=function(m){var A=[],M=this.node.querySelectorAll(m);if(M)for(var N=0;N<M.length;N++)A.push(h(M[N]));return A},y.children=function(){for(var m=this.node.childNodes,A=[],M=0;M<m.length;M++){var N=m[M];N.nodeType===1&&A.push(h(m[M]))}return A},y.parent=function(){return h(this.node.parentNode)||null},y.index=function(){for(var m=0,A=this.node.previousSibling;A;)A.nodeType===1&&m++,A=A.previousSibling;return m},y.findParentByClass=function(m,A){for(var M=this.node.ownerSVGElement,N=this.node.parentNode;N&&N!==A&&N!==M;){var D=h(N);if(D.hasClass(m))return D;N=N.parentNode}return null},y.contains=function(m){var A=this.node,M=h.toNode(m),N=M&&M.parentNode;return A===N||!!(N&&N.nodeType===1&&A.compareDocumentPosition(N)&16)},y.toLocalPoint=function(m,A){var M=this.svg().node,N=M.createSVGPoint();N.x=m,N.y=A;try{var D=N.matrixTransform(M.getScreenCTM().inverse()),z=this.getTransformToElement(M).inverse()}catch{return N}return D.matrixTransform(z)},y.translateCenterToPoint=function(m){var A=this.getBBox({target:this.svg()}),M=A.center();return this.translate(m.x-M.x,m.y-M.y),this},y.translateAndAutoOrient=function(m,A,M){m=new Z(m),A=new Z(A),M||(M=this.svg());var N=this.scale();this.attr("transform","");var D=this.getBBox({target:M}).scale(N.sx,N.sy),z=h.createSVGTransform();z.setTranslate(-D.x-D.width/2,-D.y-D.height/2);var _=h.createSVGTransform(),j=m.angleBetween(A,m.clone().offset(1,0));j&&_.setRotate(j,0,0);var V=h.createSVGTransform(),W=m.clone().move(A,D.width/2);V.setTranslate(2*m.x-W.x,2*m.y-W.y);var Y=this.getTransformToElement(M),X=h.createSVGTransform();return X.setMatrix(V.matrix.multiply(_.matrix.multiply(z.matrix.multiply(Y.scale(N.sx,N.sy))))),this.attr("transform",h.matrixToTransformString(X.matrix)),this},y.animateAlongPath=function(m,A){A=h.toNode(A);var M=h.ensureId(A),N=h("animateMotion",m),D=h("mpath",{"xlink:href":"#"+M});N.append(D),this.append(N);try{N.node.beginElement()}catch{if(document.documentElement.getAttribute("smiling")==="fake"){var z=N.node;z.animators=[];var _=z.getAttribute("id");_&&(id2anim[_]=z);for(var j=getTargets(z),V=0,W=j.length;V<W;V++){var Y=j[V],X=new Animator(z,Y,V);animators.push(X),z.animators[V]=X,X.register()}}}return this};var w=/[^\x20\t\r\n\f]+/g;function S(m){return h.isString(m)?m.trim().match(w)||[]:[]}y.hasClass=function(m){return h.isString(m)?this.node.classList.contains(m.trim()):!1},y.addClass=function(m){var A;return(A=this.node.classList).add.apply(A,S(m)),this},y.removeClass=function(m){var A;return(A=this.node.classList).remove.apply(A,S(m)),this},y.toggleClass=function(m,A){for(var M=S(m),N=0;N<M.length;N++)this.node.classList.toggle(M[N],A);return this},y.sample=function(m){m=m||1;for(var A=this.node,M=A.getTotalLength(),N=[],D=0,z;D<M;)z=A.getPointAtLength(D),N.push({x:z.x,y:z.y,distance:D}),D+=m;return N},y.convertToPath=function(){var m=h("path");m.attr(this.attr());var A=this.convertToPathData();return A&&m.attr("d",A),m},y.convertToPathData=function(){var m=this.tagName();switch(m){case"PATH":return this.attr("d");case"LINE":return h.convertLineToPathData(this.node);case"POLYGON":return h.convertPolygonToPathData(this.node);case"POLYLINE":return h.convertPolylineToPathData(this.node);case"ELLIPSE":return h.convertEllipseToPathData(this.node);case"CIRCLE":return h.convertCircleToPathData(this.node);case"RECT":return h.convertRectToPathData(this.node)}throw new Error(m+" cannot be converted to PATH.")},h.prototype.toGeometryShape=function(){var m,A,M,N,D,z,_,j,V,W,Y,X,J,Q,it;switch(this.tagName()){case"RECT":return m=parseFloat(this.attr("x"))||0,A=parseFloat(this.attr("y"))||0,M=parseFloat(this.attr("width"))||0,N=parseFloat(this.attr("height"))||0,new at(m,A,M,N);case"CIRCLE":return D=parseFloat(this.attr("cx"))||0,z=parseFloat(this.attr("cy"))||0,_=parseFloat(this.attr("r"))||0,new Re({x:D,y:z},_,_);case"ELLIPSE":return D=parseFloat(this.attr("cx"))||0,z=parseFloat(this.attr("cy"))||0,j=parseFloat(this.attr("rx"))||0,V=parseFloat(this.attr("ry"))||0,new Re({x:D,y:z},j,V);case"POLYLINE":return W=h.getPointsFromSvgNode(this),new Qt(W);case"POLYGON":return W=h.getPointsFromSvgNode(this),W.length>1&&W.push(W[0]),new Qt(W);case"PATH":return Y=this.attr("d"),rt.isDataSupported(Y)||(Y=h.normalizePathData(Y)),new rt(Y);case"LINE":return X=parseFloat(this.attr("x1"))||0,Q=parseFloat(this.attr("y1"))||0,J=parseFloat(this.attr("x2"))||0,it=parseFloat(this.attr("y2"))||0,new dt({x:X,y:Q},{x:J,y:it})}return this.getBBox()},y.findIntersection=function(m,A){var M=this.svg().node;A=A||M;var N=this.getBBox({target:A}),D=N.center();if(!!N.intersectionWithLineFromCenterToPoint(m)){var z,_=this.tagName();if(_==="RECT"){var j=new at(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height"))),V=this.getTransformToElement(A),W=h.decomposeMatrix(V),Y=M.createSVGTransform();Y.setRotate(-W.rotation,D.x,D.y);var X=h.transformRect(j,Y.matrix.multiply(V));z=new at(X).intersectionWithLineFromCenterToPoint(m,W.rotation)}else if(_==="PATH"||_==="POLYGON"||_==="POLYLINE"||_==="CIRCLE"||_==="ELLIPSE"){var J=_==="PATH"?this:this.convertToPath(),Q=J.sample(),it=1/0,st=[],gt,nt,ut,ft,vt,xt;for(gt=0;gt<Q.length;gt++)nt=Q[gt],ut=h.createSVGPoint(nt.x,nt.y),ut=ut.matrixTransform(this.getTransformToElement(A)),nt=new Z(ut),ft=nt.distance(D),vt=nt.distance(m)*1.1,xt=ft+vt,xt<it?(it=xt,st=[{sample:nt,refDistance:vt}]):xt<it+1&&st.push({sample:nt,refDistance:vt});st.sort(function(Et,Rt){return Et.refDistance-Rt.refDistance}),st[0]&&(z=st[0].sample)}return z}},y.setAttribute=function(m,A){var M=this.node;if(A===null)return this.removeAttr(m),this;var N=h.qualifyAttr(m);return N.ns?M.setAttributeNS(N.ns,m,A):m==="id"?M.id=A:M.setAttribute(m,A),this},h.createSvgDocument=function(m){if(m){var A='<svg xmlns="'+e.svg+'" xmlns:xlink="'+e.xlink+'" version="'+r+'">'+m+"</svg>",M=h.parseXML(A,{async:!1}),N=M.documentElement;return N}var D=document.createElementNS(e.svg,"svg");return D.setAttributeNS(e.xmlns,"xmlns:xlink",e.xlink),D.setAttribute("version",r),D},h.createSVGStyle=function(m){var A=h("style",{type:"text/css"},[h.createCDATASection(m)]),M=A.node;return M},h.createCDATASection=function(m){m===void 0&&(m="");var A=document.implementation.createDocument(null,"xml",null);return A.createCDATASection(m)},h.idCounter=0,h.uniqueId=function(){return"v-"+ ++h.idCounter},h.toNode=function(m){return h.isV(m)?m.node:m.nodeName&&m||m[0]},h.ensureId=function(m){return m=h.toNode(m),m.id||(m.id=h.uniqueId())},h.sanitizeText=function(m){return(m||"").replace(/ /g,"\xA0")},h.isUndefined=function(m){return typeof m>"u"},h.isString=function(m){return typeof m=="string"},h.isObject=function(m){return m&&typeof m=="object"},h.isArray=Array.isArray,h.parseXML=function(m,A){A=A||{};var M;try{var N=new DOMParser;h.isUndefined(A.async)||(N.async=A.async),M=N.parseFromString(m,"text/xml")}catch{M=void 0}if(!M||M.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+m);return M},h.qualifyAttr=function(m){if(m.indexOf(":")!==-1){var A=m.split(":");return{ns:e[A[0]],local:A[1]}}return{ns:null,local:m}},h.transformSeparatorRegex=/[ ,]+/,h.transformRegex=/\b\w+\([^()]+\)/g,h.transformFunctionRegex=/\b(\w+)\(([^()]+)\)/,h.transformTranslateRegex=/\btranslate\(([^()]+)\)/,h.transformRotateRegex=/\brotate\(([^()]+)\)/,h.transformScaleRegex=/\bscale\(([^()]+)\)/,h.transformStringToMatrix=function(m){var A=h.createSVGMatrix(),M=m&&m.match(h.transformRegex);if(!M)return A;for(var N=M.length,D=0;D<N;D++){var z=M[D],_=z.match(h.transformFunctionRegex);if(_){var j=void 0,V=void 0,W=void 0,Y=void 0,X=void 0,J=h.createSVGMatrix(),Q=_[1].toLowerCase(),it=_[2].split(h.transformSeparatorRegex);switch(Q){case"scale":j=parseFloat(it[0]),V=it[1]===void 0?j:parseFloat(it[1]),J=J.scaleNonUniform(j,V);break;case"translate":W=parseFloat(it[0]),Y=parseFloat(it[1]),J=J.translate(W,Y);break;case"rotate":X=parseFloat(it[0]),W=parseFloat(it[1])||0,Y=parseFloat(it[2])||0,W!==0||Y!==0?J=J.translate(W,Y).rotate(X).translate(-W,-Y):J=J.rotate(X);break;case"skewx":X=parseFloat(it[0]),J=J.skewX(X);break;case"skewy":X=parseFloat(it[0]),J=J.skewY(X);break;case"matrix":J.a=parseFloat(it[0]),J.b=parseFloat(it[1]),J.c=parseFloat(it[2]),J.d=parseFloat(it[3]),J.e=parseFloat(it[4]),J.f=parseFloat(it[5]);break;default:continue}A=A.multiply(J)}}return A},h.matrixToTransformString=function(m){return m||(m=!0),"matrix("+(m.a!==void 0?m.a:1)+","+(m.b!==void 0?m.b:0)+","+(m.c!==void 0?m.c:0)+","+(m.d!==void 0?m.d:1)+","+(m.e!==void 0?m.e:0)+","+(m.f!==void 0?m.f:0)+")"},h.parseTransformString=function(m){var A,M,N;if(m){var D=h.transformSeparatorRegex;if(m.trim().indexOf("matrix")>=0){var z=h.transformStringToMatrix(m),_=h.decomposeMatrix(z);A=[_.translateX,_.translateY],N=[_.scaleX,_.scaleY],M=[_.rotation];var j=[];(A[0]!==0||A[1]!==0)&&j.push("translate("+A+")"),(N[0]!==1||N[1]!==1)&&j.push("scale("+N+")"),M[0]!==0&&j.push("rotate("+M+")"),m=j.join(" ")}else{var V=m.match(h.transformTranslateRegex);V&&(A=V[1].split(D));var W=m.match(h.transformRotateRegex);W&&(M=W[1].split(D));var Y=m.match(h.transformScaleRegex);Y&&(N=Y[1].split(D))}}var X=N&&N[0]?parseFloat(N[0]):1;return{value:m,translate:{tx:A&&A[0]?parseInt(A[0],10):0,ty:A&&A[1]?parseInt(A[1],10):0},rotate:{angle:M&&M[0]?parseInt(M[0],10):0,cx:M&&M[1]?parseInt(M[1],10):void 0,cy:M&&M[2]?parseInt(M[2],10):void 0},scale:{sx:X,sy:N&&N[1]?parseFloat(N[1]):X}}},h.deltaTransformPoint=function(m,A){var M=A.x*m.a+A.y*m.c+0,N=A.x*m.b+A.y*m.d+0;return{x:M,y:N}},h.decomposeMatrix=function(m){var A=h.deltaTransformPoint(m,{x:0,y:1}),M=h.deltaTransformPoint(m,{x:1,y:0}),N=180/n*a(A.y,A.x)-90,D=180/n*a(M.y,M.x);return{translateX:m.e,translateY:m.f,scaleX:o(m.a*m.a+m.b*m.b),scaleY:o(m.c*m.c+m.d*m.d),skewX:N,skewY:D,rotation:N}},h.matrixToScale=function(m){var A,M,N,D;return m?(A=h.isUndefined(m.a)?1:m.a,D=h.isUndefined(m.d)?1:m.d,M=m.b,N=m.c):A=D=1,{sx:M?o(A*A+M*M):A,sy:N?o(N*N+D*D):D}},h.matrixToRotate=function(m){var A={x:0,y:1};return m&&(A=h.deltaTransformPoint(m,A)),{angle:et(mt(a(A.y,A.x))-90)}},h.matrixToTranslate=function(m){return{tx:m&&m.e||0,ty:m&&m.f||0}},h.isV=function(m){return m instanceof h},h.isVElement=h.isV,h.isSVGGraphicsElement=function(m){return m?(m=h.toNode(m),m instanceof SVGElement&&typeof m.getScreenCTM=="function"):!1};var T=h("svg").node;return h.createSVGMatrix=function(m){var A=T.createSVGMatrix();for(var M in m)A[M]=m[M];return A},h.createSVGTransform=function(m){return h.isUndefined(m)?T.createSVGTransform():(m instanceof SVGMatrix||(m=h.createSVGMatrix(m)),T.createSVGTransformFromMatrix(m))},h.createSVGPoint=function(m,A){var M=T.createSVGPoint();return M.x=m,M.y=A,M},h.transformRect=function(m,A){var M=T.createSVGPoint();M.x=m.x,M.y=m.y;var N=M.matrixTransform(A);M.x=m.x+m.width,M.y=m.y;var D=M.matrixTransform(A);M.x=m.x+m.width,M.y=m.y+m.height;var z=M.matrixTransform(A);M.x=m.x,M.y=m.y+m.height;var _=M.matrixTransform(A),j=s(N.x,D.x,z.x,_.x),V=l(N.x,D.x,z.x,_.x),W=s(N.y,D.y,z.y,_.y),Y=l(N.y,D.y,z.y,_.y);return new at(j,W,V-j,Y-W)},h.transformPoint=function(m,A){return new Z(h.createSVGPoint(m.x,m.y).matrixTransform(A))},h.transformLine=function(m,A){return new dt(h.transformPoint(m.start,A),h.transformPoint(m.end,A))},h.transformPolyline=function(m,A){var M=m instanceof Qt?m.points:m;h.isArray(M)||(M=[]);for(var N=[],D=0,z=M.length;D<z;D++)N[D]=h.transformPoint(M[D],A);return new Qt(N)},h.styleToObject=function(m){for(var A={},M=m.split(";"),N=0;N<M.length;N++){var D=M[N],z=D.split("=");A[z[0].trim()]=z[1].trim()}return A},h.createSlicePathData=function(m,A,M,N){var D=2*n-1e-6,z=m,_=A,j=M,V=N,W=(V<j&&(W=j,j=V,V=W),V-j),Y=W<n?"0":"1",X=u(j),J=g(j),Q=u(V),it=g(V);return W>=D?z?"M0,"+_+"A"+_+","+_+" 0 1,1 0,"+-_+"A"+_+","+_+" 0 1,1 0,"+_+"M0,"+z+"A"+z+","+z+" 0 1,0 0,"+-z+"A"+z+","+z+" 0 1,0 0,"+z+"Z":"M0,"+_+"A"+_+","+_+" 0 1,1 0,"+-_+"A"+_+","+_+" 0 1,1 0,"+_+"Z":z?"M"+_*X+","+_*J+"A"+_+","+_+" 0 "+Y+",1 "+_*Q+","+_*it+"L"+z*Q+","+z*it+"A"+z+","+z+" 0 "+Y+",0 "+z*X+","+z*J+"Z":"M"+_*X+","+_*J+"A"+_+","+_+" 0 "+Y+",1 "+_*Q+","+_*it+"L0,0Z"},h.mergeAttrs=function(m,A){for(var M in A)M==="class"?m[M]=m[M]?m[M]+" "+A[M]:A[M]:M==="style"?h.isObject(m[M])&&h.isObject(A[M])?m[M]=h.mergeAttrs(m[M],A[M]):h.isObject(m[M])?m[M]=h.mergeAttrs(m[M],h.styleToObject(A[M])):h.isObject(A[M])?m[M]=h.mergeAttrs(h.styleToObject(m[M]),A[M]):m[M]=h.mergeAttrs(h.styleToObject(m[M]),h.styleToObject(A[M])):m[M]=A[M];return m},h.annotateString=function(m,A,M){A=A||[],M=M||{};for(var N=M.offset||0,D=[],z,_=[],j,V,W=0;W<m.length;W++){j=_[W]=m[W];for(var Y=0;Y<A.length;Y++){var X=A[Y],J=X.start+N,Q=X.end+N;W>=J&&W<Q&&(h.isObject(j)?j.attrs=h.mergeAttrs(h.mergeAttrs({},j.attrs),X.attrs):j=_[W]={t:m[W],attrs:X.attrs},M.includeAnnotationIndices&&(j.annotations||(j.annotations=[])).push(Y))}V=_[W-1],V?h.isObject(j)&&h.isObject(V)?JSON.stringify(j.attrs)===JSON.stringify(V.attrs)?z.t+=j.t:(D.push(z),z=j):h.isObject(j)||h.isObject(V)?(D.push(z),z=j):z=(z||"")+j:z=j}return z&&D.push(z),D},h.findAnnotationsAtIndex=function(m,A){var M=[];return m&&m.forEach(function(N){N.start<A&&A<=N.end&&M.push(N)}),M},h.findAnnotationsBetweenIndexes=function(m,A,M){var N=[];return m&&m.forEach(function(D){(A>=D.start&&A<D.end||M>D.start&&M<=D.end||D.start>=A&&D.end<M)&&N.push(D)}),N},h.shiftAnnotations=function(m,A,M){return m&&m.forEach(function(N){N.start<A&&N.end>=A?N.end+=M:N.start>=A&&(N.start+=M,N.end+=M)}),m},h.convertLineToPathData=function(m){m=h(m);var A=["M",m.attr("x1"),m.attr("y1"),"L",m.attr("x2"),m.attr("y2")].join(" ");return A},h.convertPolygonToPathData=function(m){var A=h.getPointsFromSvgNode(m);return A.length===0?null:h.svgPointsToPath(A)+" Z"},h.convertPolylineToPathData=function(m){var A=h.getPointsFromSvgNode(m);return A.length===0?null:h.svgPointsToPath(A)},h.svgPointsToPath=function(m){for(var A=0,M=m.length;A<M;A++)m[A]=m[A].x+" "+m[A].y;return"M "+m.join(" L")},h.getPointsFromSvgNode=function(m){m=h.toNode(m);var A=[],M=m.points;if(M)for(var N=0,D=M.numberOfItems;N<D;N++)A.push(M.getItem(N));return A},h.KAPPA=.551784,h.convertCircleToPathData=function(m){m=h(m);var A=parseFloat(m.attr("cx"))||0,M=parseFloat(m.attr("cy"))||0,N=parseFloat(m.attr("r")),D=N*h.KAPPA,z=["M",A,M-N,"C",A+D,M-N,A+N,M-D,A+N,M,"C",A+N,M+D,A+D,M+N,A,M+N,"C",A-D,M+N,A-N,M+D,A-N,M,"C",A-N,M-D,A-D,M-N,A,M-N,"Z"].join(" ");return z},h.convertEllipseToPathData=function(m){m=h(m);var A=parseFloat(m.attr("cx"))||0,M=parseFloat(m.attr("cy"))||0,N=parseFloat(m.attr("rx")),D=parseFloat(m.attr("ry"))||N,z=N*h.KAPPA,_=D*h.KAPPA,j=["M",A,M-D,"C",A+z,M-D,A+N,M-_,A+N,M,"C",A+N,M+_,A+z,M+D,A,M+D,"C",A-z,M+D,A-N,M+_,A-N,M,"C",A-N,M-_,A-z,M-D,A,M-D,"Z"].join(" ");return j},h.convertRectToPathData=function(m){return m=h(m),h.rectToPath({x:parseFloat(m.attr("x"))||0,y:parseFloat(m.attr("y"))||0,width:parseFloat(m.attr("width"))||0,height:parseFloat(m.attr("height"))||0,rx:parseFloat(m.attr("rx"))||0,ry:parseFloat(m.attr("ry"))||0})},h.rectToPath=function(m){var A,M=m.x,N=m.y,D=m.width,z=m.height,_=s(m.rx||m["top-rx"]||0,D/2),j=s(m.rx||m["bottom-rx"]||0,D/2),V=s(m.ry||m["top-ry"]||0,z/2),W=s(m.ry||m["bottom-ry"]||0,z/2);return _||j||V||W?A=["M",M,N+V,"v",z-V-W,"a",j,W,0,0,0,j,W,"h",D-2*j,"a",j,W,0,0,0,j,-W,"v",-(z-W-V),"a",_,V,0,0,0,-_,-V,"h",-(D-2*_),"a",_,V,0,0,0,-_,V,"Z"]:A=["M",M,N,"H",M+D,"V",N+z,"H",M,"V",N,"Z"],A.join(" ")},h.normalizePathData=function(){var m=`	
\v\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029`,A=new RegExp("([a-z])["+m+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+m+"]*,?["+m+"]*)+)","ig"),M=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+m+"]*,?["+m+"]*","ig"),N=Math,D=N.PI,z=N.sin,_=N.cos,j=N.tan,V=N.asin,W=N.sqrt,Y=N.abs;function X(nt,ut,ft,vt,xt,Et){var Rt=.3333333333333333,It=2/3;return[Rt*nt+It*ft,Rt*ut+It*vt,Rt*xt+It*ft,Rt*Et+It*vt,xt,Et]}function J(nt,ut,ft){var vt=nt*_(ft)-ut*z(ft),xt=nt*z(ft)+ut*_(ft);return{x:vt,y:xt}}function Q(nt,ut,ft,vt,xt,Et,Rt,It,Wt,St){var Ct=D*120/180,jt=D/180*(+xt||0),wt=[],pt;if(St)Ve=St[0],Me=St[1],In=St[2],Sn=St[3];else{pt=J(nt,ut,-jt),nt=pt.x,ut=pt.y,pt=J(It,Wt,-jt),It=pt.x,Wt=pt.y;var ge=(nt-It)/2,ye=(ut-Wt)/2,ce=ge*ge/(ft*ft)+ye*ye/(vt*vt);ce>1&&(ce=W(ce),ft=ce*ft,vt=ce*vt);var Se=ft*ft,Is=vt*vt,Fv=(Et==Rt?-1:1)*W(Y((Se*Is-Se*ye*ye-Is*ge*ge)/(Se*ye*ye+Is*ge*ge))),In=Fv*ft*ye/vt+(nt+It)/2,Sn=Fv*-vt*ge/ft+(ut+Wt)/2,Ve=V(((ut-Sn)/vt).toFixed(9)),Me=V(((Wt-Sn)/vt).toFixed(9));Ve=nt<In?D-Ve:Ve,Me=It<In?D-Me:Me,Ve<0&&(Ve=D*2+Ve),Me<0&&(Me=D*2+Me),Rt&&Ve>Me&&(Ve=Ve-D*2),!Rt&&Me>Ve&&(Me=Me-D*2)}var Ss=Me-Ve;if(Y(Ss)>Ct){var ak=Me,ok=It,sk=Wt;Me=Ve+Ct*(Rt&&Me>Ve?1:-1),It=In+ft*_(Me),Wt=Sn+vt*z(Me),wt=Q(It,Wt,ft,vt,xt,0,Rt,ok,sk,[Me,ak,In,Sn])}Ss=Me-Ve;var lk=_(Ve),uk=z(Ve),hk=_(Me),ck=z(Me),Vv=j(Ss/4),Wv=4/3*(ft*Vv),Zv=4/3*(vt*Vv),Yv=[nt,ut],Yi=[nt+Wv*uk,ut-Zv*lk],Uv=[It+Wv*ck,Wt-Zv*hk],Xv=[It,Wt];if(Yi[0]=2*Yv[0]-Yi[0],Yi[1]=2*Yv[1]-Yi[1],St)return[Yi,Uv,Xv].concat(wt);wt=[Yi,Uv,Xv].concat(wt).join().split(",");for(var Hv=[],dk=wt.length,Qr=0;Qr<dk;Qr++)Hv[Qr]=Qr%2?J(wt[Qr-1],wt[Qr],jt).y:J(wt[Qr],wt[Qr+1],jt).x;return Hv}function it(nt){if(!nt)return null;var ut={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},ft=[];return String(nt).replace(A,function(vt,xt,Et){var Rt=[],It=xt.toLowerCase();for(Et.replace(M,function(Wt,St){St&&Rt.push(+St)}),It==="m"&&Rt.length>2&&(ft.push([xt].concat(Rt.splice(0,2))),It="l",xt=xt==="m"?"l":"L");Rt.length>=ut[It]&&(ft.push([xt].concat(Rt.splice(0,ut[It]))),!!ut[It]););}),ft}function st(nt){if((!Array.isArray(nt)||!Array.isArray(nt&&nt[0]))&&(nt=it(nt)),!nt||!nt.length)return[["M",0,0]];for(var ut=[],ft=0,vt=0,xt=0,Et=0,Rt=0,It,Wt=nt.length,St=Rt;St<Wt;St++){var Ct=[];ut.push(Ct);var jt=nt[St];if(It=jt[0],It!=It.toUpperCase()){Ct[0]=It.toUpperCase();var wt,pt;switch(Ct[0]){case"A":Ct[1]=jt[1],Ct[2]=jt[2],Ct[3]=jt[3],Ct[4]=jt[4],Ct[5]=jt[5],Ct[6]=+jt[6]+ft,Ct[7]=+jt[7]+vt;break;case"V":Ct[1]=+jt[1]+vt;break;case"H":Ct[1]=+jt[1]+ft;break;case"M":for(xt=+jt[1]+ft,Et=+jt[2]+vt,wt=jt.length,pt=1;pt<wt;pt++)Ct[pt]=+jt[pt]+(pt%2?ft:vt);break;default:for(wt=jt.length,pt=1;pt<wt;pt++)Ct[pt]=+jt[pt]+(pt%2?ft:vt);break}}else for(var ge=jt.length,ye=0;ye<ge;ye++)Ct[ye]=jt[ye];switch(Ct[0]){case"Z":ft=+xt,vt=+Et;break;case"H":ft=Ct[1];break;case"V":vt=Ct[1];break;case"M":xt=Ct[Ct.length-2],Et=Ct[Ct.length-1],ft=Ct[Ct.length-2],vt=Ct[Ct.length-1];break;default:ft=Ct[Ct.length-2],vt=Ct[Ct.length-1];break}}return ut}function gt(nt){var ut=st(nt),ft={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function vt(wt,pt,ge){var ye,ce;if(!wt)return["C",pt.x,pt.y,pt.x,pt.y,pt.x,pt.y];switch(wt[0]in{T:1,Q:1}||(pt.qx=null,pt.qy=null),wt[0]){case"M":pt.X=wt[1],pt.Y=wt[2];break;case"A":parseFloat(wt[1])===0||parseFloat(wt[2])===0?wt=["L",wt[6],wt[7]]:wt=["C"].concat(Q.apply(0,[pt.x,pt.y].concat(wt.slice(1))));break;case"S":ge==="C"||ge==="S"?(ye=pt.x*2-pt.bx,ce=pt.y*2-pt.by):(ye=pt.x,ce=pt.y),wt=["C",ye,ce].concat(wt.slice(1));break;case"T":ge==="Q"||ge==="T"?(pt.qx=pt.x*2-pt.qx,pt.qy=pt.y*2-pt.qy):(pt.qx=pt.x,pt.qy=pt.y),wt=["C"].concat(X(pt.x,pt.y,pt.qx,pt.qy,wt[1],wt[2]));break;case"Q":pt.qx=wt[1],pt.qy=wt[2],wt=["C"].concat(X(pt.x,pt.y,wt[1],wt[2],wt[3],wt[4]));break;case"H":wt=["L"].concat(wt[1],pt.y);break;case"V":wt=["L"].concat(pt.x,wt[1]);break}return wt}function xt(wt,pt){if(wt[pt].length>7){wt[pt].shift();for(var ge=wt[pt];ge.length;)Et[pt]="A",wt.splice(pt++,0,["C"].concat(ge.splice(0,6)));wt.splice(pt,1),Wt=ut.length}}for(var Et=[],Rt="",It="",Wt=ut.length,St=0;St<Wt;St++){ut[St]&&(Rt=ut[St][0]),Rt!=="C"&&(Et[St]=Rt,St>0&&(It=Et[St-1])),ut[St]=vt(ut[St],ft,It),Et[St]!=="A"&&Rt==="C"&&(Et[St]="C"),xt(ut,St);var Ct=ut[St],jt=Ct.length;ft.x=Ct[jt-2],ft.y=Ct[jt-1],ft.bx=parseFloat(Ct[jt-4])||ft.x,ft.by=parseFloat(Ct[jt-3])||ft.y}return(!ut[0][0]||ut[0][0]!=="M")&&ut.unshift(["M",0,0]),ut}return function(nt){return gt(nt).join(",").split(",").join(" ")}}(),h.namespace=e,h.g=ff,h}(),ar={useCSSSelectors:!0,classNamePrefix:"joint-",defaultTheme:"default",doubleTapInterval:300},Ze=function(t){return t&&t.toString().split(" ").map(function(e){return e.substr(0,ar.classNamePrefix.length)!==ar.classNamePrefix&&(e=ar.classNamePrefix+e),e}).join(" ")},gf=function(t){return t&&t.toString().split(" ").map(function(e){return e.substr(0,ar.classNamePrefix.length)===ar.classNamePrefix&&(e=e.substr(ar.classNamePrefix.length)),e}).join(" ")},en=function(t,e){for(var r={},i={},n=F.namespace.svg,a=e||n,o=document.createDocumentFragment(),s=[t,o,a];s.length>0;){a=s.pop();for(var l=s.pop(),u=s.pop(),g=0,h=u.length;g<h;g++){var y=u[g];if(!y.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");var x=y.tagName;y.hasOwnProperty("namespaceURI")&&(a=y.namespaceURI);var C=document.createElementNS(a,x),p=a===n,E=p?F:f,k=y.attributes;k&&E(C).attr(k);var w=y.style;if(w&&f(C).css(w),y.hasOwnProperty("className")){var S=y.className;p?C.className.baseVal=S:C.className=S}if(y.hasOwnProperty("textContent")&&(C.textContent=y.textContent),y.hasOwnProperty("selector")){var T=y.selector;if(r[T])throw new Error("json-dom-parser: selector must be unique");r[T]=C,E(C).attr("joint-selector",T)}if(y.hasOwnProperty("groupSelector")){var m=y.groupSelector;Array.isArray(m)||(m=[m]);for(var A=0,M=m.length;A<M;A++){var N=m[A],D=i[N];D||(D=i[N]=[]),D.push(C)}}l.appendChild(C);var z=y.children;Array.isArray(z)&&s.push(z,C,a)}}return{fragment:o,selectors:r,groupSelectors:i}},rn=function(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return e},Ye=function(t,e,r){for(var i=Array.isArray(e)?e:e.split(r||"/"),n,a=0,o=i.length;a<o;)if(n=i[a++],Object(t)===t&&n in t)t=t[n];else return;return t},vf=function(t,e){return typeof e!="string"&&typeof e!="number"&&(e=String(e)),!(e==="constructor"&&typeof t[e]=="function"||e==="__proto__")},Yr=function(t,e,r,i){for(var n=Array.isArray(e)?e:e.split(i||"/"),a=n.length-1,o=t,s=0;s<a;s++){var l=n[s];if(!vf(o,l))return t;var u=o[l];o=u||(o[l]={})}return o[n[a]]=r,t},nn=function(t,e,r){for(var i=Array.isArray(e)?e:e.split(r||"/"),n=i.length-1,a=t,o=0;o<n;o++){var s=i[o];if(!vf(a,s))return t;var l=a[s];if(!l)return t;a=l}return delete a[i[n]],t},Xn=function(t,e,r){e=e||"/";var i={};for(var n in t)if(!!t.hasOwnProperty(n)){var a=typeof t[n]=="object";if(a&&r&&r(t[n])&&(a=!1),a){var o=Xn(t[n],e,r);for(var s in o)!o.hasOwnProperty(s)||(i[n+e+s]=o[s])}else i[n]=t[n]}return i},Hn=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,r=t==="x"?e:e&3|8;return r.toString(16)})},Ur=function(t){return Ur.id=Ur.id||1,t===void 0?"j_"+Ur.id++:(t.id=t.id===void 0?"j_"+Ur.id++:t.id,t.id)},Io=function(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()},ot=function(t){var e=t,r=t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0];if(r){for(var i in t)r[i]===void 0&&(r[i]=t[i]);e=r}var n=e.target;if(n){var a=n.correspondingUseElement;a&&(e.target=a)}return e},pf=function(t){var e=10,r=40,i=800,n=0,a=0,o=0,s=0;return"detail"in t&&(a=t.detail),"wheelDelta"in t&&(a=-t.wheelDelta/120),"wheelDeltaY"in t&&(a=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(n=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(n=a,a=0),o="deltaX"in t?t.deltaX:n*e,s="deltaY"in t?t.deltaY:a*e,(o||s)&&t.deltaMode&&(t.deltaMode==1?(o*=r,s*=r):(o*=i,s*=i)),t.deltaX===0&&t.deltaY!==0&&t.shiftKey&&(o=s,s=0,n=a,a=0),o&&!n&&(n=o<1?-1:1),s&&!a&&(a=s<1?-1:1),{spinX:n,spinY:a,deltaX:o,deltaY:s}},mf=function(t,e){return t>e?e:t<-e?-e:t},Pi=function(){var t;if(typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!t){var e=0;t=function(r){var i=new Date().getTime(),n=Math.max(0,16-(i-e)),a=setTimeout(function(){r(i+n)},n);return e=i+n,a}}return function(r,i){for(var n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];return t(i!==void 0?r.bind.apply(r,[i].concat(n)):r)}}(),Ti=function(){var t,e=typeof window<"u";return e&&(t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),t=t||clearTimeout,e?t.bind(window):t}(),Bx=function(t,e,r,i){var n,a;if(!r){var o=e.$(".scalable")[0],s=e.$(".rotatable")[0];o&&o.firstChild?r=o.firstChild:s&&s.firstChild&&(r=s.firstChild)}return r?(a=F(r).findIntersection(i,t.paper.cells),a||(n=F(r).getBBox({target:t.paper.cells}))):(n=e.model.getBBox(),a=n.intersectionWithLineFromCenterToPoint(i)),a||n.center()},pe=function(t){return $t(t)&&t.slice(-1)==="%"},yf=function(t,e){function r(s){var l=new RegExp("(?:\\d+(?:\\.\\d+)*)("+s+")$").exec(t);return l?l[1]:null}var i=parseFloat(t);if(Number.isNaN(i))return null;var n={};n.value=i;var a;if(e==null)a="[A-Za-z]*";else if(Array.isArray(e)){if(e.length===0)return null;a=e.join("|")}else $t(e)&&(a=e);var o=r(a);return o===null?null:(n.unit=o,n)},qn=0;function Ox(t,e){for(var r=t.split(e),i=1,n=0,a=r.length-1;n<a;n++){var o=[];(n>0||r[0]!=="")&&o.push(qn),o.push(e),(n<a-1||r[a]!=="")&&o.push(qn),r.splice.apply(r,[i,0].concat(o)),i+=o.length+1}return r.filter(function(s){return s!==""})}var So=function(t,e,r,i){r===void 0&&(r={}),i===void 0&&(i={});var n=e.width,a=e.height,o=i.svgDocument||F("svg").node,s=F("tspan").node,l=F("text").attr(r).append(s).node,u=document.createTextNode("");l.style.opacity=0,l.style.display="block",s.style.display="block",s.appendChild(u),o.appendChild(l),i.svgDocument||document.body.appendChild(o);var g=i.preserveSpaces,h=" ",y=i.separator||h,x=i.eol||`
`,C=i.hyphen?new RegExp(i.hyphen):/[^\w\d]/,p=i.maxLineCount;Nt(p)||(p=1/0);var E=t.split(y),k=[],w=[],S,T,m;g&&F(s).attr("xml:space","preserve");for(var A=0,M=0,N=E.length;A<N;A++){var D=E[A];if(!(!D&&!g)&&typeof D=="string"){var z=!1;if(x&&D.indexOf(x)>=0)if(D.length>1){var _=Ox(E[A],x);E.splice.apply(E,[A,1].concat(_)),A--,N=E.length;continue}else{if(g&&typeof E[A-1]=="string"){E.splice(A,qn,"",qn),N+=2,A--;continue}w[++M]=!g||typeof E[A+1]=="string"?"":void 0,z=!0}if(!z){var j=void 0;if(g?j=w[M]!==void 0?w[M]+h+D:D:j=w[M]?w[M]+h+D:D,u.data=j,s.getComputedTextLength()<=n)w[M]=j,(S||T)&&(k[M++]=!0,S=0,T=0);else{if(!w[M]||S){var V=!!S;if(S=D.length-1,V||!S){if(!S){if(!w[M]){w=[];break}E.splice(A,2,D+E[A+1]),N--,k[M++]=!0,A--;continue}E[A]=D.substring(0,S),E[A+1]=D.substring(S)+(E[A+1]===void 0?"":E[A+1])}else{if(T)E.splice(A,2,E[A]+E[A+1]),T=0;else{var W=D.search(C);W>-1&&W!==D.length-1&&W!==0&&(T=W+1,S=0),E.splice(A,1,D.substring(0,T||S),D.substring(T||S)),N++}M&&!k[M-1]&&M--}(!g||w[M]!=="")&&A--;continue}M++,A--}}var Y=null;if(w.length>p)Y=p-1;else if(a!==void 0){if(m===void 0&&u.data!==""){var X;r.lineHeight==="auto"?X={value:1.5,unit:"em"}:X=yf(r.lineHeight,["em"])||{value:1,unit:"em"},m=X.value,X.unit==="em"&&(m*=l.getBBox().height)}m*w.length>a&&(Y=Math.floor(a/m)-1)}if(Y!==null){w.splice(Y+1);var J=i.ellipsis;if(!J||Y<0)break;typeof J!="string"&&(J="\u2026");var Q=w[Y];if(!Q&&!z)break;var it=Q.length,st,gt,nt;do{if(gt=Q[it],st=Q.substring(0,it),gt?gt.match(y)&&(st+=gt):(nt=typeof y=="string"?y:" ",st+=nt),st+=J,u.data=st,s.getComputedTextLength()<=n){w[Y]=st;break}it--}while(it>=0);break}}}return i.svgDocument?o.removeChild(l):document.body.removeChild(o),w.join(x)},Mo=function(t){var e=f(f.parseHTML("<div>"+t+"</div>",null,!1));return e.find("*").each(function(){var r=this;f.each(r.attributes,function(){var i=this,n=i.name,a=i.value;(n.startsWith("on")||a.startsWith("javascript:")||a.startsWith("data:")||a.startsWith("vbscript:"))&&f(r).removeAttr(n)})}),e.html()},bf=function(t,e){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,e);else{var r=window.URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}},wf=function(t,e){var r=xf(t);bf(r,e)},xf=function(t){t=t.replace(/\s/g,""),t=decodeURIComponent(t);var e=t.indexOf(","),r=t.slice(0,e),i=r.split(":")[1].split(";")[0],n=t.slice(e+1),a;r.indexOf("base64")>=0?a=atob(n):a=unescape(encodeURIComponent(n));for(var o=new Uint8Array(a.length),s=0;s<a.length;s++)o[s]=a.charCodeAt(s);return new Blob([o],{type:i})},ko=function(t,e){if(!t||t.substr(0,5)==="data:")return setTimeout(function(){e(null,t)},0);var r=function(a,o){if(a.status===200){var s=new FileReader;s.onload=function(l){var u=l.target.result;o(null,u)},s.onerror=function(){o(new Error("Failed to load image "+t))},s.readAsDataURL(a.response)}else o(new Error("Failed to load image "+t))},i=function(a,o){var s=function(x){for(var C=32768,p=[],E=0;E<x.length;E+=C)p.push(String.fromCharCode.apply(null,x.subarray(E,E+C)));return p.join("")};if(a.status===200){var l=new Uint8Array(a.response),u=t.split(".").pop()||"png",g={svg:"svg+xml"},h="data:image/"+(g[u]||u)+";base64,",y=h+btoa(s(l));o(null,y)}else o(new Error("Failed to load image "+t))},n=new XMLHttpRequest;n.open("GET",t,!0),n.addEventListener("error",function(){e(new Error("Failed to load image "+t))}),n.responseType=window.FileReader?"blob":"arraybuffer",n.addEventListener("load",function(){window.FileReader?r(n,e):i(n,e)}),n.send()},li=function(t){var e=f(t);if(e.length===0)throw new Error("Element not found");var r=e[0],i=r.ownerDocument,n=r.getBoundingClientRect(),a=0,o=0;if(r.ownerSVGElement){var s=F(r),l=s.getBBox({target:s.svg()});a=n.width-l.width,o=n.height-l.height}return{x:n.left+window.pageXOffset-i.documentElement.offsetLeft+a/2,y:n.top+window.pageYOffset-i.documentElement.offsetTop+o/2,width:n.width-a,height:n.height-o}},Af=function(t,e){var r=f(t),i=r.map(function(){var n=this,a=n.parentNode,o=a.insertBefore(document.createTextNode(""),n.nextSibling);return function(){if(a===this)throw new Error("You can't sort elements if any one is a descendant of another.");a.insertBefore(this,o),a.removeChild(o)}});return Array.prototype.sort.call(r,e).each(function(n){i[n].call(this)})},ui=function(t,e){var r=f(t);Ut(e,function(i,n){var a=r.find(n).addBack().filter(n);hr(i,"class")&&(a.addClass(i.class),i=Ce(i,"class")),a.attr(i)})},he=function(t){if(Object(t)!==t){var e=0;return isFinite(t)&&(e=+t),{top:e,right:e,bottom:e,left:e}}var r,i,n,a;return r=i=n=a=0,isFinite(t.vertical)&&(r=n=+t.vertical),isFinite(t.horizontal)&&(i=a=+t.horizontal),isFinite(t.top)&&(r=+t.top),isFinite(t.right)&&(i=+t.right),isFinite(t.bottom)&&(n=+t.bottom),isFinite(t.left)&&(a=+t.left),{top:r,right:i,bottom:n,left:a}},Cf={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,r=1;;e+=r,r/=2)if(t>=(7-4*e)/11){var i=(11-6*e-11*t)/4;return-i*i+r*r}},reverse:function(t){return function(e){return 1-t(1-e)}},reflect:function(t){return function(e){return .5*(e<.5?t(2*e):2-t(2-2*e))}},clamp:function(t,e,r){return e=e||0,r=r||1,function(i){var n=t(i);return n<e?e:n>r?r:n}},back:function(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}},elastic:function(t){return t||(t=1.5),function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}},Po={number:function(t,e){var r=e-t;return function(i){return t+r*i}},object:function(t,e){var r=Object.keys(t);return function(i){var n,a,o={};for(n=r.length-1;n!=-1;n--)a=r[n],o[a]=t[a]+(e[a]-t[a])*i;return o}},hexColor:function(t,e){var r=parseInt(t.slice(1),16),i=parseInt(e.slice(1),16),n=r&255,a=(i&255)-n,o=r&65280,s=(i&65280)-o,l=r&16711680,u=(i&16711680)-l;return function(g){var h=n+a*g&255,y=o+s*g&65280,x=l+u*g&16711680;return"#"+(1<<24|h|y|x).toString(16).slice(1)}},unit:function(t,e){var r=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,i=r.exec(t),n=r.exec(e),a=n[1].indexOf("."),o=a>0?n[1].length-a-1:0;t=+i[1];var s=+n[1]-t,l=i[2];return function(u){return(t+s*u).toFixed(o)+l}}},If={outline:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>',r=Number.isFinite(t.margin)?t.margin:2,i=Number.isFinite(t.width)?t.width:1;return De(e)({color:t.color||"blue",opacity:Number.isFinite(t.opacity)?t.opacity:1,outerRadius:r+i,innerRadius:r})},highlight:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return De(e)({color:t.color||"red",width:Number.isFinite(t.width)?t.width:1,blur:Number.isFinite(t.blur)?t.blur:0,opacity:Number.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=Number.isFinite(t.x)?t.x:2;return De('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return De(e)({dx:t.dx||0,dy:t.dy||0,opacity:Number.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:Number.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return De('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return De('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return De('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return De('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return De('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return De('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return De('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}},an={number:function(t,e,r){r=r||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var i=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,n=i.exec(t),a=n[1]||" ",o=n[2]||">",s=n[3]||"",l=n[4]||"",u=n[5],g=+n[6],h=n[7],y=n[8],x=n[9],C=1,p="",E="",k=!1;switch(y&&(y=+y.substring(1)),(u||a==="0"&&o==="=")&&(u=a="0",o="=",h&&(g-=Math.floor((g-1)/4))),x){case"n":h=!0,x="g";break;case"%":C=100,E="%",x="f";break;case"p":C=100,E="%",x="r";break;case"b":case"o":case"x":case"X":l==="#"&&(p="0"+x.toLowerCase());break;case"c":case"d":k=!0,y=0;break;case"s":C=-1,x="r";break}l==="$"&&(p=r.currency[0],E=r.currency[1]),x=="r"&&!y&&(x="g"),y!=null&&(x=="g"?y=Math.max(1,Math.min(21,y)):(x=="e"||x=="f")&&(y=Math.max(0,Math.min(20,y))));var w=u&&h;if(k&&e%1)return"";var S=e<0||e===0&&1/e<0?(e=-e,"-"):s,T=E;if(C<0){var m=this.prefix(e,y);e=m.scale(e),T=m.symbol+E}else e*=C;e=this.convert(x,e,y);var A=e.lastIndexOf("."),M=A<0?e:e.substring(0,A),N=A<0?"":r.decimal+e.substring(A+1);function D(j){for(var V=j.length,W=[],Y=0,X=r.grouping[0];V>0&&X>0;)W.push(j.substring(V-=X,V+X)),X=r.grouping[Y=(Y+1)%r.grouping.length];return W.reverse().join(r.thousands)}!u&&h&&r.grouping&&(M=D(M));var z=p.length+M.length+N.length+(w?0:S.length),_=z<g?new Array(z=g-z+1).join(a):"";return w&&(M=D(_+M)),S+=p,e=M+N,(o==="<"?S+e+_:o===">"?_+S+e:o==="^"?_.substring(0,z>>=1)+S+e+_.substring(z):S+(w?e:_+e))+T},string:function(t,e){for(var r,i="{",n=!1,a=[];(r=t.indexOf(i))!==-1;){var o,s,l;if(o=t.slice(0,r),n){s=o.split(":"),l=s.shift().split("."),o=e;for(var u=0;u<l.length;u++)o=o[l[u]];s.length&&(o=this.number(s,o))}a.push(o),t=t.slice(r+1),n=!n,i=n?"}":"{"}return a.push(t),a.join("")},convert:function(t,e,r){switch(t){case"b":return e.toString(2);case"c":return String.fromCharCode(e);case"o":return e.toString(8);case"x":return e.toString(16);case"X":return e.toString(16).toUpperCase();case"g":return e.toPrecision(r);case"e":return e.toExponential(r);case"f":return e.toFixed(r);case"r":return(e=this.round(e,this.precision(e,r))).toFixed(Math.max(0,Math.min(20,this.precision(e*(1+1e-15),r))));default:return e+""}},round:function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},precision:function(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)},prefix:function(t,e){var r=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"].map(function(n,a){var o=Math.pow(10,Math.abs(8-a)*3);return{scale:a>8?function(s){return s/o}:function(s){return s*o},symbol:n}}),i=0;return t&&(t<0&&(t*=-1),e&&(t=this.round(t,this.precision(t,e))),i=1+Math.floor(1e-12+Math.log(t)/Math.LN10),i=Math.max(-24,Math.min(24,Math.floor((i<=0?i+1:i-1)/3)*3))),r[8+i/3]}},De=function(t){var e=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(r){return r=r||{},t.replace(e,function(i){for(var n=Array.from(arguments),a=n.slice(1,4).find(function(l){return!!l}),o=a.split("."),s=r[o.shift()];s!==void 0&&o.length;)s=s[o.shift()];return s!==void 0?s:""})}},Sf=function(t){var e=window.top.document;t=t||e.body;function r(i,n){for(var a=["webkit","moz","ms","o",""],o=0;o<a.length;o++){var s=a[o],l=s?s+n:n.substr(0,1).toLowerCase()+n.substr(1);if(i[l]!==void 0)return yt(i[l])?i[l]():i[l]}}r(e,"FullscreenElement")||r(e,"FullScreenElement")?r(e,"ExitFullscreen")||r(e,"CancelFullScreen"):r(t,"RequestFullscreen")||r(t,"RequestFullScreen")},Mf=v.assign,Rx=v.defaults,_x=Mf,Ue=v.defaultsDeep,tt=v.assign,ne=v.defaults,on=v.defaultsDeep,me=v.invokeMap||v.invoke,Jn=v.sortedIndexBy||v.sortedIndex,mr=v.uniqBy||v.uniq,be=v.clone,de=v.cloneDeep,je=v.isEmpty,ze=v.isEqual,yt=v.isFunction,fe=v.isPlainObject,lt=v.toArray,sn=v.debounce,To=v.groupBy,Fe=v.sortBy,kf=v.flattenDeep,hi=v.without,No=v.difference,Lo=v.intersection,Kn=v.union,hr=v.has,re=v.result,Ce=v.omit,ln=v.pick,ke=v.bindAll,Ut=v.forIn,un=v.camelCase,Qn=v.uniqueId,ie=function(){if(v.mergeWith){var t=Array.from(arguments),e=t[t.length-1],r=yt(e)?e:Xr;return t.push(function(i,n){var a=r(i,n);if(a!==void 0)return a;if(Array.isArray(i)&&!Array.isArray(n))return n}),v.mergeWith.apply(this,t)}return v.merge.apply(this,arguments)},Eo=function(t){var e=Object.prototype.toString;return t===!0||t===!1||!!t&&typeof t=="object"&&e.call(t)==="[object Boolean]"},Yt=function(t){return!!t&&(typeof t=="object"||typeof t=="function")},Nt=function(t){var e=Object.prototype.toString;return typeof t=="number"||!!t&&typeof t=="object"&&e.call(t)==="[object Number]"},$t=function(t){var e=Object.prototype.toString;return typeof t=="string"||!!t&&typeof t=="object"&&e.call(t)==="[object String]"},Xr=function(){};function Do(t){t=mr(t);var e=lt(t).reduce(function(r,i){return r[i.id]=i.clone(),r},{});return lt(t).forEach(function(r){var i=e[r.id];if(i.isLink()){var n=i.source(),a=i.target();n.id&&e[n.id]&&i.prop("source/id",e[n.id].id),a.id&&e[a.id]&&i.prop("target/id",e[a.id].id)}var o=r.get("parent");o&&e[o]&&i.set("parent",e[o].id);var s=lt(r.get("embeds")).reduce(function(l,u){return e[u]&&l.push(e[u].id),l},[]);je(s)||i.set("embeds",s)}),e}var Lr={x:"x",y:"y",width:"w",height:"h",minimum:"s",maximum:"l",diagonal:"d"},Gx=Object.keys(Lr).map(function(t){return Lr[t]}).join(""),zo="[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?",jx=/\s/g,Pf=new RegExp("^("+zo+"\\*)?(["+Gx+"])(/"+zo+")?([-+]{1,2}"+zo+")?$","g");function Tf(t){throw new Error("Invalid calc() expression: "+t)}function Fx(t,e){var r=Pf.exec(t.replace(jx,""));r||Tf(t),Pf.lastIndex=0;var i=r[1],n=r[2],a=r[3],o=r[4],s=e.x,l=e.y,u=e.width,g=e.height,h=0;switch(n){case Lr.width:{h=u;break}case Lr.height:{h=g;break}case Lr.x:{h=s;break}case Lr.y:{h=l;break}case Lr.minimum:{h=Math.min(g,u);break}case Lr.maximum:{h=Math.max(g,u);break}case Lr.diagonal:{h=Math.sqrt(g*g+u*u);break}}return i&&(h*=parseFloat(i)),a&&(h/=parseFloat(a.slice(1))),o&&(h+=Vx(o)),h}function Vx(t){if(!t)return 0;var e=t[0];switch(e){case"+":return parseFloat(t.substr(1));case"-":return-parseFloat(t.substr(1))}return parseFloat(t)}function or(t){return typeof t=="string"&&t.includes("calc")}var Nf="calc(",Lf=Nf.length;function sr(t,e){var r=t,i=0;do{var n=r.indexOf(Nf,i);if(n===-1)return r;var a=n+Lf,o=1;t:do{switch(r[a]){case"(":{o++;break}case")":{if(o--,o===0)break t;break}case void 0:Tf(r)}a++}while(!0);var s=r.slice(n+Lf,a);or(s)&&(s=sr(s,e));var l=String(Fx(s,e));r=r.slice(0,n)+l+r.slice(a+1),i=n+l.length}while(!0)}function Hr(t,e){return function(r,i){var n=pe(r);r=parseFloat(r),n&&(r/=100);var a={};if(isFinite(r)){var o=n||r>=0&&r<=1?r*i[e]:Math.max(r+i[e],0);a[t]=o}return a}}function $n(t,e,r){return function(i,n){var a=pe(i);i=parseFloat(i),a&&(i/=100);var o;if(isFinite(i)){var s=n[r]();a||i>0&&i<1?o=s[t]+n[e]*i:o=s[t]+i}var l=Z();return l[t]=o||0,l}}function Ef(t,e,r){return function(i,n){var a;i==="middle"?a=n[e]/2:i===r?a=n[e]:isFinite(i)?a=i>-1&&i<1?-n[e]*i:-i:pe(i)?a=n[e]*parseFloat(i)/100:a=0;var o=Z();return o[t]=-(n[t]+a),o}}function Df(t,e){var r="joint-shape",i=e&&e.resetOffset;return function(n,a,o){var s=f(o),l=s.data(r);if(!l||l.value!==n){var u=t(n);l={value:n,shape:u,shapeBBox:u.bbox()},s.data(r,l)}var g=l.shape.clone(),h=l.shapeBBox.clone(),y=h.origin(),x=a.origin();h.x=x.x,h.y=x.y;var C=a.maxRectScaleToFit(h,x),p=h.width===0||a.width===0?1:C.sx,E=h.height===0||a.height===0?1:C.sy;return g.scale(p,E,y),i&&g.translate(-y.x,-y.y),g}}function zf(t){function e(i){return new rt(F.normalizePathData(i))}var r=Df(e,t);return function(i,n,a){var o=r(i,n,a);return{d:o.serialize()}}}function Bf(t){var e=Df(Qt,t);return function(r,i,n){var a=e(r,i,n);return{points:a.serialize()}}}function ta(t,e){var r=new Z(1,0);return function(i){var n,a,o=this[t](i);return o?(a=e.rotate?o.vector().vectorAngle(r):0,n=o.start):(n=this.path.start,a=0),a===0?{transform:"translate("+n.x+","+n.y+")"}:{transform:"translate("+n.x+","+n.y+") rotate("+a+")"}}}function Of(t){return function(r,i,n){var a=F(n);a.attr(t)!==r&&a.attr(t,r)}}function Ni(t,e,r){return r.text!==void 0}function hn(){return this.model.isLink()}function Bo(t){var e={},r=t.stroke;typeof r=="string"&&(e.stroke=r,e.fill=r);var i=t.strokeOpacity;return i===void 0&&(i=t["stroke-opacity"]),i===void 0&&(i=t.opacity),i!==void 0&&(e["stroke-opacity"]=i,e["fill-opacity"]=i),e}function Rf(t){var e=this,r=e.paper,i=t.type==="pattern"?r.definePattern(t):r.defineGradient(t);return"url(#"+i+")"}var Dt={xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},href:{set:Of("href")},xlinkHref:{set:Of("xlink:href")},filter:{qualify:fe,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}},fill:{qualify:fe,set:Rf},stroke:{qualify:fe,set:Rf},sourceMarker:{qualify:fe,set:function(t,e,r,i){return t=tt(Bo(i),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},targetMarker:{qualify:fe,set:function(t,e,r,i){return t=tt(Bo(i),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},vertexMarker:{qualify:fe,set:function(t,e,r,i){return t=tt(Bo(i),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},text:{qualify:function(t,e,r){return!r.textWrap||!fe(r.textWrap)},set:function(t,e,r,i){var n=f(r),a="joint-text",o=n.data(a),s=ln(i,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol","displayEmpty"),l=s.x;or(l)&&(s.x=sr(l,e));var u=i["font-size"]||i.fontSize;or(u)&&(u=sr(u,e));var g=s.fontSize=u,h=JSON.stringify([t,s]);if(o===void 0||o!==h){g&&r.setAttribute("font-size",g);var y=s.textPath;if(Yt(y)){var x=y.selector;if(typeof x=="string"){var C=this.findBySelector(x)[0];C instanceof SVGPathElement&&(s.textPath=tt({"xlink:href":"#"+C.id},y))}}F(r).text(""+t,s),n.data(a,h)}}},textWrap:{qualify:fe,set:function(t,e,r,i){var n={},a=t.width||0;pe(a)?n.width=e.width*parseFloat(a)/100:or(a)?n.width=Number(sr(a,e)):t.width===null?n.width=1/0:a<=0?n.width=e.width+a:n.width=a;var o=t.height||0;pe(o)?n.height=e.height*parseFloat(o)/100:or(o)?n.height=Number(sr(o,e)):t.height===null||(o<=0?n.height=e.height+o:n.height=o);var s,l=t.text;if(l===void 0&&(l=i.text),l!==void 0){var u=t.breakText||So,g=i["font-size"]||i.fontSize;s=u(""+l,n,{"font-weight":i["font-weight"]||i.fontWeight,"font-size":or(g)?sr(g,e):g,"font-family":i["font-family"]||i.fontFamily,lineHeight:i.lineHeight,"letter-spacing":"letter-spacing"in i?i["letter-spacing"]:i.letterSpacing},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen,maxLineCount:t.maxLineCount,preserveSpaces:t.preserveSpaces})}else s="";Dt.text.set.call(this,s,e,r,i)}},title:{qualify:function(t,e){return e instanceof SVGElement},set:function(t,e,r){var i=f(r),n="joint-title",a=i.data(n);if(a===void 0||a!==t){i.data(n,t);var o=r.firstChild;if(o&&o.tagName.toUpperCase()==="TITLE")o.textContent=t;else{var s=document.createElementNS(r.namespaceURI,"title");s.textContent=t,r.insertBefore(s,o)}}}},lineHeight:{qualify:Ni},textVerticalAnchor:{qualify:Ni},textPath:{qualify:Ni},annotations:{qualify:Ni},eol:{qualify:Ni},displayEmpty:{qualify:Ni},port:{set:function(t){return t===null||t.id===void 0?t:t.id}},style:{qualify:fe,set:function(t,e,r){f(r).css(t)}},html:{set:function(t,e,r){f(r).html(t+"")}},ref:{},refX:{position:$n("x","width","origin")},refY:{position:$n("y","height","origin")},refDx:{position:$n("x","width","corner")},refDy:{position:$n("y","height","corner")},refWidth:{set:Hr("width","width")},refHeight:{set:Hr("height","height")},refRx:{set:Hr("rx","width")},refRy:{set:Hr("ry","height")},refRInscribed:{set:function(t){var e=Hr(t,"width"),r=Hr(t,"height");return function(i,n){var a=n.height>n.width?e:r;return a(i,n)}}("r")},refRCircumscribed:{set:function(t,e){var r=pe(t);t=parseFloat(t),r&&(t/=100);var i=Math.sqrt(e.height*e.height+e.width*e.width),n;return isFinite(t)&&(r||t>=0&&t<=1?n=t*i:n=Math.max(t+i,0)),{r:n}}},refCx:{set:Hr("cx","width")},refCy:{set:Hr("cy","height")},xAlignment:{offset:Ef("x","width","right")},yAlignment:{offset:Ef("y","height","bottom")},resetOffset:{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}},refDResetOffset:{set:zf({resetOffset:!0})},refDKeepOffset:{set:zf({resetOffset:!1})},refPointsResetOffset:{set:Bf({resetOffset:!0})},refPointsKeepOffset:{set:Bf({resetOffset:!1})},connection:{qualify:hn,set:function(t){var e=t.stubs;e===void 0&&(e=0);var r;if(isFinite(e)&&e!==0){var i;e<0?i=(this.getConnectionLength()+e)/2:i=e;var n=this.getConnection(),a=this.getConnectionSubdivisions(),o=n.divideAtLength(i,{segmentSubdivisions:a}),s=n.divideAtLength(-i,{segmentSubdivisions:a});o&&s&&(r=o[0].serialize()+" "+s[1].serialize())}return{d:r||this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:hn,set:ta("getTangentAtLength",{rotate:!0})},atConnectionLengthIgnoreGradient:{qualify:hn,set:ta("getTangentAtLength",{rotate:!1})},atConnectionRatioKeepGradient:{qualify:hn,set:ta("getTangentAtRatio",{rotate:!0})},atConnectionRatioIgnoreGradient:{qualify:hn,set:ta("getTangentAtRatio",{rotate:!1})}};Dt["xlink:href"]=Dt.xlinkHref,["transform","d","points","cx","cy","x1","x2","y1","y2","x","y","dx","dy"].forEach(function(t){Dt[t]={qualify:or,set:function(r,i){var n;return n={},n[t]=sr(r,i),n}}}),["width","height","r","rx","ry","font-size","stroke-width"].forEach(function(t){Dt[t]={qualify:or,set:function(r,i){var n;return n={},n[t]=Math.max(0,sr(r,i)),n}}}),Dt.refR=Dt.refRInscribed,Dt.refD=Dt.refDResetOffset,Dt.refPoints=Dt.refPointsResetOffset,Dt.atConnectionLength=Dt.atConnectionLengthKeepGradient,Dt.atConnectionRatio=Dt.atConnectionRatioKeepGradient,Dt.fontSize=Dt["font-size"],Dt.strokeWidth=Dt["stroke-width"],Dt.refX2=Dt.refX,Dt.refY2=Dt.refY,Dt.refWidth2=Dt.refWidth,Dt.refHeight2=Dt.refHeight,Dt["ref-x"]=Dt.refX,Dt["ref-y"]=Dt.refY,Dt["ref-dy"]=Dt.refDy,Dt["ref-dx"]=Dt.refDx,Dt["ref-width"]=Dt.refWidth,Dt["ref-height"]=Dt.refHeight,Dt["x-alignment"]=Dt.xAlignment,Dt["y-alignment"]=Dt.yAlignment;var ci=Dt,Be=d.Model.extend({constructor:function(t,e){var r,i=t||{};typeof this.preinitialize=="function"&&this.preinitialize.apply(this,arguments),this.cid=Qn("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(i=this.parse(i,e)||{}),(r=re(this,"defaults"))&&(i=ie({},r,i)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,r){throw new Error("Must define a translate() method.")},toJSON:function(){var t=re(this.constructor.prototype,"defaults"),e=t.attrs||{},r=this.attributes.attrs,i={};Ut(r,function(a,o){var s=e[o];Ut(a,function(l,u){Yt(l)&&!Array.isArray(l)?Ut(l,function(g,h){(!s||!s[u]||!ze(s[u][h],g))&&(i[o]=i[o]||{},(i[o][u]||(i[o][u]={}))[h]=g)}):(!s||!ze(s[u],l))&&(i[o]=i[o]||{},i[o][u]=l)})});var n=de(Ce(this.attributes,"attrs"));return n.attrs=i,n},initialize:function(t){var e=this.getIdAttribute();(!t||!(e in t))&&this.set(e,this.generateId(),{silent:!0}),this._transitionIds={},this._scheduledTransitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},getIdAttribute:function(){return this.idAttribute||"id"},generateId:function(){return Hn()},processPorts:function(){var t=this.ports,e={};Ut(this.get("attrs"),function(a,o){a&&a.port&&(a.port.id!==void 0?e[a.port.id]=a.port:e[a.port]={id:a.port})});var r={};if(Ut(t,function(a,o){e[o]||(r[o]=!0)}),this.graph&&!je(r)){var i=this.graph.getConnectedLinks(this,{inbound:!0});i.forEach(function(a){r[a.get("target").port]&&a.remove()});var n=this.graph.getConnectedLinks(this,{outbound:!0});n.forEach(function(a){r[a.get("source").port]&&a.remove()})}this.ports=e},remove:function(t){t===void 0&&(t={});var e=this,r=e.graph,i=e.collection;if(!r)return i&&i.remove(this,t),this;r.startBatch("remove");var n=this.getParentCell();n&&n.unembed(this,t);for(var a=this.getEmbeddedCells(),o=0,s=a.length;o<s;o++){var l=a[o];l&&l.remove(t)}return this.trigger("remove",this,r.attributes.cells,t),r.stopBatch("remove"),this},toFront:function(t){var e=this.graph;if(e){t=t||{};var r=e.maxZIndex(),i;t.deep?(i=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1}),i.unshift(this)):i=[this],r=r-i.length+1;var n=e.get("cells"),a=n.indexOf(this)!==n.length-i.length;a||(a=i.some(function(o,s){return o.get("z")!==r+s})),a&&(this.startBatch("to-front"),r=r+i.length,i.forEach(function(o,s){o.set("z",r+s,t)}),this.stopBatch("to-front"))}return this},toBack:function(t){var e=this.graph;if(e){t=t||{};var r=e.minZIndex(),i;t.deep?(i=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1}),i.unshift(this)):i=[this];var n=e.get("cells"),a=n.indexOf(this)!==0;a||(a=i.some(function(o,s){return o.get("z")!==r+s})),a&&(this.startBatch("to-back"),r-=i.length,i.forEach(function(o,s){o.set("z",r+s,t)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return t===void 0?this.get("parent"):this.set("parent",t,e)},embed:function(t,e){var r=this,i=Array.isArray(t)?t:[t];if(!this.canEmbed(i))throw new Error("Recursive embedding not allowed.");if(i.some(function(n){return n.isEmbedded()&&r.id!==n.parent()}))throw new Error("Embedding of already embedded cells is not allowed.");return this._embedCells(i,e),this},unembed:function(t,e){var r=Array.isArray(t)?t:[t];return this._unembedCells(r,e),this},canEmbed:function(t){var e=this,r=Array.isArray(t)?t:[t];return r.every(function(i){return e!==i&&!e.isEmbeddedIn(i)})},_embedCells:function(t,e){var r=this,i="embed";this.startBatch(i);var n=tt([],this.get("embeds"));t.forEach(function(a){n[a.isLink()?"unshift":"push"](a.id),a.parent(r.id,e)}),this.set("embeds",mr(n),e),this.stopBatch(i)},_unembedCells:function(t,e){var r="unembed";this.startBatch(r),t.forEach(function(i){return i.unset("parent",e)}),this.set("embeds",hi.apply(void 0,[this.get("embeds")].concat(t.map(function(i){return i.id}))),e),this.stopBatch(r)},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(t){if(t=t||{},this.graph){var e;if(t.deep)if(t.breadthFirst){e=[];for(var r=this.getEmbeddedCells();r.length>0;){var i=r.shift();e.push(i),r.push.apply(r,i.getEmbeddedCells())}}else e=this.getEmbeddedCells(),e.forEach(function(n){e.push.apply(e,n.getEmbeddedCells(t))});else e=lt(this.get("embeds")).map(this.graph.getCell,this.graph);return e}return[]},isEmbeddedIn:function(t,e){var r=$t(t)?t:t.id,i=this.parent();if(e=tt({deep:!0},e),this.graph&&e.deep){for(;i;){if(i===r)return!0;i=this.graph.getCell(i).parent()}return!1}else return i===r},isEmbedded:function(){return!!this.parent()},clone:function(t){if(t=t||{},t.deep)return lt(Do([this].concat(this.getEmbeddedCells({deep:!0}))));var e=d.Model.prototype.clone.apply(this,arguments);return e.set(this.getIdAttribute(),this.generateId()),e.unset("embeds"),e.unset("parent"),e},prop:function(t,e,r){var i="/",n=$t(t);if(n||Array.isArray(t))if(arguments.length>1){var a,o;n?(a=t,o=a.split("/")):(a=t.join(i),o=t.slice());var s=o[0],l=o.length;if(r=r||{},r.propertyPath=a,r.propertyValue=e,r.propertyPathArray=o,l===1)return this.set(s,e,r);for(var u={},g=u,h=s,y=1;y<l;y++){var x=o[y],C=Number.isFinite(n?Number(x):x);g=g[h]=C?[]:{},h=x}u=Yr(u,o,e,"/");var p=ie({},this.attributes);r.rewrite&&nn(p,a,"/");var E=ie(p,u);return this.set(s,E[s],r)}else return Ye(this.attributes,t,i);return this.set(ie({},this.attributes,t),e)},removeProp:function(t,e){e=e||{};var r=Array.isArray(t)?t:t.split("/"),i=r[0];if(i==="attrs"&&(e.dirty=!0),r.length===1)return this.unset(t,e);var n=r.slice(1),a=this.get(i);return a==null?this:(a=de(a),nn(a,n,"/"),this.set(i,a,e))},attr:function(t,e,r){var i=Array.from(arguments);return i.length===0?this.get("attrs"):(Array.isArray(t)?i[0]=["attrs"].concat(t):$t(t)?i[0]="attrs/"+t:i[0]={attrs:t},this.prop.apply(this,i))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(t,e,r,i){var n=this;i=i||"/";var a={duration:100,delay:10,timingFunction:Cf.linear,valueFunction:Po.number};r=tt(a,r);var o=0,s,l=function(x){var C,p,E;o=o||x,x-=o,p=x/r.duration,p<1?this._transitionIds[t]=C=Pi(l):(p=1,delete this._transitionIds[t]),E=s(r.timingFunction(p)),r.transitionId=C,this.prop(t,E,r),C||this.trigger("transition:end",this,t)}.bind(this),u=this,g=u._scheduledTransitionIds,h,y=function(x){g[t]&&(g[t]=hi(g[t],h),g[t].length===0&&delete g[t]),n.stopPendingTransitions(t,i),s=r.valueFunction(Ye(n.attributes,t,i),e),n._transitionIds[t]=Pi(x),n.trigger("transition:start",n,t)};return h=setTimeout(y,r.delay,l),g[t]||(g[t]=[]),g[t].push(h),h},getTransitions:function(){return Kn(Object.keys(this._transitionIds),Object.keys(this._scheduledTransitionIds))},stopScheduledTransitions:function(t,e){e===void 0&&(e="/");var r=this,i=r._scheduledTransitionIds;i===void 0&&(i={});var n=Object.keys(i);if(t){var a=t.split(e);n=n.filter(function(o){return ze(a,o.split(e).slice(0,a.length))})}return n.forEach(function(o){var s=i[o];s.forEach(function(l){return clearTimeout(l)}),delete i[o]}),this},stopPendingTransitions:function(e,r){var i=this;r===void 0&&(r="/");var n=this,a=n._transitionIds;a===void 0&&(a={});var o=Object.keys(a);if(e){var s=e.split(r);o=o.filter(function(l){return ze(s,l.split(r).slice(0,s.length))})}o.forEach(function(l){var u=a[l];Ti(u),delete a[l],i.trigger("transition:end",i,l)})},stopTransitions:function(t,e){return e===void 0&&(e="/"),this.stopScheduledTransitions(t,e),this.stopPendingTransitions(t,e),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,tt({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,tt({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var r in t)!t.hasOwnProperty(r)||!this.hasChanged(r)||(e|=t[r]);return e},angle:function(){return 0},position:function(){return new Z(0,0)},getPointFromConnectedLink:function(){return new Z},getBBox:function(){return new at(0,0,0,0)},getPointRotatedAroundCenter:function(e,r,i){var n=new Z(r,i);return e&&n.rotate(this.getBBox().center(),e),n},getAbsolutePointFromRelative:function(e,r){return this.getPointRotatedAroundCenter(-this.angle(),this.position().offset(e,r))},getRelativePointFromAbsolute:function(e,r){return this.getPointRotatedAroundCenter(this.angle(),e,r).difference(this.position())}},{getAttributeDefinition:function(t){var e=this.attributes,r=ci;return e&&e[t]||r[t]},define:function(t,e,r,i){r=tt({defaults:on({type:t},e,this.prototype.defaults)},r);var n=this.extend(r,i);return typeof joint<"u"&&hr(joint,"shapes")&&Yr(joint.shapes,t,n,"."),n}}),_f=function(t,e,r){if($t(r)){if(!ea[r])throw new Error('Unknown wrapper: "'+r+'"');r=ea[r]}if(!yt(r))throw new Error("Wrapper must be a function.");lt(e).forEach(function(i){t[i]=r(t[i])})},ea={cells:function(t){return function(){var e=Array.from(arguments),r=e.length,i=r>0&&e[0]||[],n=r>1&&e[r-1]||{};return Array.isArray(i)||(n instanceof Be?i=e:i instanceof Be&&(e.length>1&&e.pop(),i=e)),n instanceof Be&&(n={}),t.call(this,i,n)}}};function Wx(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i=[];t.forEach(function(a,o){i.push(a),o in e&&i.push(e[o])});var n=Zx(i.join(""));return n}function Zx(t){var e=new DOMParser,r="<svg>"+t.trim()+"</svg>",i=e.parseFromString(r.replace(/@/g,""),"application/xml");if(i.getElementsByTagName("parsererror")[0])throw new Error("Invalid SVG markup");var n=e.parseFromString(r,"text/html"),a=n.querySelector("svg");return Gf(a)}function Gf(t){var e=[];return Array.from(t.children).forEach(function(r){var i={},n=r.tagName,a=r.attributes,o=r.textContent,s=r.namespaceURI,l=r.style;i.tagName=n,i.namespaceURI=s;for(var u={},g=l.length;g--;){var h=l[g];u[h]=l.getPropertyValue(h)}i.style=u;var y=a.getNamedItem("@selector");y&&(i.selector=y.value,a.removeNamedItem("@selector"));var x=a.getNamedItem("@group-selector");if(x){var C=x.value.split(",");i.groupSelector=C.map(function(k){return k.trim()}),a.removeNamedItem("@group-selector")}var p=a.getNamedItem("class");p&&(i.className=p.value),o&&(i.textContent=o);var E={};Array.from(a).forEach(function(k){var w=k.name,S=k.value;E[w]=S}),Object.keys(E).length>0&&(i.attributes=E),r.childElementCount>0&&(i.children=Gf(r)),e.push(i)}),e}var we={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",CENTER:"center"};function di(t,e){var r=new at(t);switch(e){case void 0:throw new Error("Position required");case we.LEFT:case"leftMiddle":return r.leftMiddle();case we.RIGHT:case"rightMiddle":return r.rightMiddle();case we.TOP:case"topMiddle":return r.topMiddle();case we.BOTTOM:case"bottomMiddle":return r.bottomMiddle();case we.TOP_LEFT:case"topLeft":case"origin":return r.topLeft();case we.TOP_RIGHT:case"topRight":return r.topRight();case we.BOTTOM_LEFT:case"bottomLeft":return r.bottomLeft();case we.BOTTOM_RIGHT:case"bottomRight":case"corner":return r.bottomRight();case we.CENTER:return r.center();default:throw new Error("Unknown position: "+e)}}var Yx={__proto__:null,getRectPoint:di,wrapWith:_f,wrappers:ea,addClassNamePrefix:Ze,removeClassNamePrefix:gf,parseDOMJSON:en,hashCode:rn,getByPath:Ye,setByPath:Yr,unsetByPath:nn,flattenObject:Xn,uuid:Hn,guid:Ur,toKebabCase:Io,normalizeEvent:ot,normalizeWheel:pf,cap:mf,nextFrame:Pi,cancelFrame:Ti,shapePerimeterConnectionPoint:Bx,isPercentage:pe,parseCssNumeric:yf,breakText:So,sanitizeHTML:Mo,downloadBlob:bf,downloadDataUri:wf,dataUriToBlob:xf,imageToDataUri:ko,getElementBBox:li,sortElements:Af,setAttributesBySelector:ui,normalizeSides:he,timing:Cf,interpolate:Po,filter:If,format:an,template:De,toggleFullScreen:Sf,mixin:Mf,supplement:Rx,deepMixin:_x,deepSupplement:Ue,assign:tt,defaults:ne,defaultsDeep:on,invoke:me,sortedIndex:Jn,uniq:mr,clone:be,cloneDeep:de,isEmpty:je,isEqual:ze,isFunction:yt,isPlainObject:fe,toArray:lt,debounce:sn,groupBy:To,sortBy:Fe,flattenDeep:kf,without:hi,difference:No,intersection:Lo,union:Kn,has:hr,result:re,omit:Ce,pick:ln,bindAll:ke,forIn:Ut,camelCase:un,uniqueId:Qn,merge:ie,isBoolean:Eo,isObject:Yt,isNumber:Nt,isString:$t,noop:Xr,cloneCells:Do,svg:Wx};function jf(t,e,r){var i=t.toJSON();return i.angle=e||0,ne({},r,i)}function cn(t,e,r,i){return t.map(function(n,a,o){var s=this.pointAt((a+.5)/o.length);return(n.dx||n.dy)&&s.offset(n.dx||0,n.dy||0),jf(s.round(),0,Oo(i,n))},Tr(e,r))}function Ff(t,e,r,i){var n=e.center(),a=e.width/e.height,o=e.topMiddle(),s=Re.fromRect(e);return t.map(function(l,u,g){var h=r+i(u,g.length),y=o.clone().rotate(n,-h).scale(a,1,n),x=l.compensateRotation?-s.tangentTheta(y):0;return(l.dx||l.dy)&&y.offset(l.dx||0,l.dy||0),l.dr&&y.move(n,l.dr),jf(y.round(),x,Oo(e,l))})}function Oo(t,e){var r=e.x,i=e.y,n=e.angle;return pe(r)?r=parseFloat(r)/100*t.width:or(r)&&(r=Number(sr(r,t))),pe(i)?i=parseFloat(i)/100*t.height:or(i)&&(i=Number(sr(i,t))),{x:r,y:i,angle:n}}function Ro(t,e){var r=Oo(t,e),i=r.x,n=r.y;return new Z(i||0,n||0)}var Ux=function(t,e){return t.map(function(r){var i=Ro(e,r).round().toJSON();return i.angle=r.angle||0,i})},Xx=function(t,e,r){return r.fn(t,e,r)},Hx=function(t,e,r){var i=Ro(e,r.start||e.origin()),n=Ro(e,r.end||e.corner());return cn(t,i,n,e)},qx=function(t,e,r){return cn(t,e.origin(),e.bottomLeft(),e)},Jx=function(t,e,r){return cn(t,e.topRight(),e.corner(),e)},Kx=function(t,e,r){return cn(t,e.origin(),e.topRight(),e)},Qx=function(t,e,r){return cn(t,e.bottomLeft(),e.corner(),e)},$x=function(t,e,r){var i=r.startAngle||0,n=r.step||360/t.length;return Ff(t,e,i,function(a){return a*n})},tA=function(t,e,r){var i=r.startAngle||0,n=r.step||20;return Ff(t,e,i,function(a,o){return(a+.5-o/2)*n})},Vf={__proto__:null,absolute:Ux,fn:Xx,line:Hx,left:qx,right:Jx,top:Kx,bottom:Qx,ellipseSpread:$x,ellipse:tA};function qr(t,e){return on({},t,e,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function Wf(t,e,r,i){i=ne({},i,{offset:15});var n=e.center().theta(t),a=Zf(e),o,s,l,u,g=i.offset,h=0;n<a[1]||n>a[2]?(l=".3em",o=g,s=0,u="start"):n<a[0]?(l="0",o=0,s=-g,r?(h=-90,u="start"):u="middle"):n<a[3]?(l=".3em",o=-g,s=0,u="end"):(l=".6em",o=0,s=g,r?(h=90,u="start"):u="middle");var y=Math.round;return qr({x:y(o),y:y(s),angle:h,attrs:{".":{y:l,"text-anchor":u}}})}function Zf(t){var e=t.center(),r=e.theta(t.origin()),i=e.theta(t.bottomLeft()),n=e.theta(t.corner()),a=e.theta(t.topRight());return[r,a,n,i]}function Yf(t,e,r,i){var n=e.center().theta(t);i=ne({},i,{offset:15});var a,o,s,l,u=i.offset,g=0,h=Zf(e);n<h[1]||n>h[2]?(s=".3em",a=-u,o=0,l="end"):n<h[0]?(s=".6em",a=0,o=u,r?(g=90,l="start"):l="middle"):n<h[3]?(s=".3em",a=u,o=0,l="start"):(s="0em",a=0,o=-u,r?(g=-90,l="start"):l="middle");var y=Math.round;return qr({x:y(a),y:y(o),angle:g,attrs:{".":{y:s,"text-anchor":l}}})}function Uf(t,e,r){r=ne({},r,{offset:20});var i=Bt(0,0),n=-t.theta(i),a=n,o=t.clone().move(i,r.offset).difference(t).round(),s=".3em",l;(n+90)%180===0?(l=e?"end":"middle",!e&&n===-270&&(s="0em")):n>-270&&n<-90?(l="start",a=n-180):l="end";var u=Math.round;return qr({x:u(o.x),y:u(o.y),angle:e?a:0,attrs:{".":{y:s,"text-anchor":l}}})}var eA=function(t,e,r){return qr(r,e)},rA=function(t,e,r){return qr(r,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})},iA=function(t,e,r){return qr(r,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})},nA=function(t,e,r){return qr(r,{y:-15,attrs:{".":{"text-anchor":"middle"}}})},aA=function(t,e,r){return qr(r,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})},oA=function(t,e,r){return Wf(t,e,!0,r)},sA=function(t,e,r){return Wf(t,e,!1,r)},lA=function(t,e,r){return Yf(t,e,!0,r)},uA=function(t,e,r){return Yf(t,e,!1,r)},hA=function(t,e,r){return Uf(t.difference(e.center()),!1,r)},cA=function(t,e,r){return Uf(t.difference(e.center()),!0,r)},Xf={__proto__:null,manual:eA,left:rA,right:iA,top:nA,bottom:aA,outsideOriented:oA,outside:sA,insideOriented:lA,inside:uA,radial:hA,radialOriented:cA},Hf=function(t){var e=de(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=Vf,this.portLabelLayoutNamespace=Xf,this._init(e)};Hf.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(t){return this.ports.filter(function(e){return e.group===t})},getGroupPortsMetrics:function(t,e){var r=this.getGroup(t),i=this.getPortsByGroup(t),n=r.position||{},a=n.name,o=this.portLayoutNamespace;o[a]||(a="left");var s=n.args||{},l=i.map(function(h){return h&&h.position&&h.position.args}),u=o[a](l,e,s),g={ports:i,result:[]};return lt(u).reduce(function(h,y,x){var C=h.ports[x];return h.result.push({portId:C.id,portTransformation:y,labelTransformation:this._getPortLabelLayout(C,Z(y),e),portAttrs:C.attrs,portSize:C.size,labelSize:C.label.size}),h}.bind(this),g),g.result},_getPortLabelLayout:function(t,e,r){var i=this.portLabelLayoutNamespace,n=t.label.position.name||"left";return i[n]?i[n](e,r,t.label.position.args):null},_init:function(t){if(Yt(t.groups))for(var e=Object.keys(t.groups),r=0,i=e.length;r<i;r++){var n=e[r];this.groups[n]=this._evaluateGroup(t.groups[n])}for(var a=lt(t.items),o=0,s=a.length;o<s;o++)this.ports.push(this._evaluatePort(a[o]))},_evaluateGroup:function(t){return ie(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=tt({},t),r=this.getGroup(t.group);return e.markup=e.markup||r.markup,e.attrs=ie({},r.attrs,e.attrs),e.position=this._createPositionNode(r,e),e.label=ie({},r.label,this._getLabel(e)),e.z=this._getZIndex(r,e),e.size=tt({},r.size,e.size),e},_getZIndex:function(t,e){return Nt(e.z)?e.z:Nt(t.z)||t.z==="auto"?t.z:"auto"},_createPositionNode:function(t,e){return ie({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var r={},i;yt(t)?(i="fn",r.fn=t):$t(t)?i=t:t===void 0?i=e?"left":null:Array.isArray(t)?(i="absolute",r.x=t[0],r.y=t[1]):Yt(t)&&(i=t.name,tt(r,t.args));var n={args:r};return i&&(n.name=i),n},_getLabel:function(t,e){var r=t.label||{},i=r;return i.position=this._getPosition(r.position,e),i}};var dA={_initializePorts:function(){this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};lt(t.items).forEach(function(s){e[s.id]=!0});var r=this.previous("ports")||{},i={};lt(r.items).forEach(function(s){e[s.id]||(i[s.id]=!0)});var n=this.graph;if(n&&!je(i)){var a=n.getConnectedLinks(this,{inbound:!0});a.forEach(function(s){i[s.get("target").port]&&s.remove()});var o=n.getConnectedLinks(this,{outbound:!0});o.forEach(function(s){i[s.get("source").port]&&s.remove()})}},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&t.length>0},hasPort:function(t){return this.getPortIndex(t)!==-1},getPorts:function(){return de(this.prop("ports/items"))||[]},getGroupPorts:function(t){var e=lt(this.prop(["ports","items"])).filter(function(r){return r.group===t});return de(e)},getPort:function(t){return de(lt(this.prop("ports/items")).find(function(e){return e.id&&e.id===t}))},getPortsPositions:function(t){var e=this._portSettingsData.getGroupPortsMetrics(t,at(this.size()));return e.reduce(function(r,i){var n=i.portTransformation;return r[i.portId]={x:n.x,y:n.y,angle:n.angle},r},{})},getPortIndex:function(t){var e=Yt(t)?t.id:t;return this._isValidPortId(e)?lt(this.prop("ports/items")).findIndex(function(r){return r.id===e}):-1},addPort:function(t,e){if(!Yt(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var r=tt([],this.prop("ports/items"));return r.push(t),this.prop("ports/items",r,e),this},insertPort:function(t,e,r){var i=typeof t=="number"?t:this.getPortIndex(t);if(!Yt(e)||Array.isArray(e))throw new Error("dia.Element: insertPort requires an object.");var n=tt([],this.prop("ports/items"));return n.splice(i,0,e),this.prop("ports/items",n,r),this},portProp:function(t,e,r,i){var n=this.getPortIndex(t);if(n===-1)throw new Error("Element: unable to find port with id "+t);var a=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?a[0]=["ports","items",n].concat(e):$t(e)?a[0]=["ports/items/",n,"/",e].join(""):(a=["ports/items/"+n],fe(e)&&(a.push(e),a.push(r))),this.prop.apply(this,a)},_validatePorts:function(){var t=this.get("ports")||{},e=[];t=t||{};var r=lt(t.items);return r.forEach(function(i){typeof i!="object"&&e.push("Element: invalid port ",i),this._isValidPortId(i.id)||(i.id=this.generatePortId())},this),mr(r,"id").length!==r.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return t!=null&&!Yt(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",tt([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){var r=e||{},i=this.getPortIndex(t);if(i!==-1){var n=tt([],this.prop(["ports","items"]));n.splice(i,1),r.rewrite=!0,this.startBatch("port-remove"),this.prop(["ports","items"],n,r),this.stopBatch("port-remove")}return this},removePorts:function(t,e){var r,i;if(Array.isArray(t)){if(r=e||{},t.length===0)return this.this;var n=tt([],this.prop(["ports","items"]));i=n.filter(function(a){return!t.some(function(o){var s=Yt(o)?o.id:o;return a.id===s})})}else r=t||{},i=[];return this.startBatch("port-remove"),r.rewrite=!0,this.prop(["ports","items"],i,r),this.stopBatch("port-remove"),this},_createPortData:function(){var t=this._validatePorts();if(t.length>0)throw this.set("ports",this.previous("ports")),new Error(t.join(" "));var e;this._portSettingsData&&(e=this._portSettingsData.getPorts()),this._portSettingsData=new Hf(this.get("ports"));var r=this._portSettingsData.getPorts();if(e){var i=r.filter(function(a){if(!e.find(function(o){return o.id===a.id}))return a}),n=e.filter(function(a){if(!r.find(function(o){return o.id===a.id}))return a});n.length>0&&this.trigger("ports:remove",this,n),i.length>0&&this.trigger("ports:add",this,i)}}},fA={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},_refreshPorts:function(){this._removePorts(),this._cleanPortsCache(),this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){for(var t=[],e=this._getContainerElement(),r=0,i=e.node.childNodes.length;r<i;r++)t.push(e.node.childNodes[r]);var n=To(this.model._portSettingsData.getPorts(),"z"),a="auto";lt(n[a]).forEach(function(g){var h=this._getPortElement(g);e.append(h),t.push(h)},this);for(var o=Object.keys(n),s=0;s<o.length;s++){var l=o[s];if(l!==a){var u=parseInt(l,10);this._appendPorts(n[l],u,t)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,r){var i=this._getContainerElement(),n=lt(t).map(this._getPortElement,this);r[e]||e<0?F(r[Math.max(e,0)]).before(n):i.append(n)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNode:function(t,e){var r=this._portElementsCache[t];if(!r)return null;if(!e)return r.portContentElement.node;var i=r.portElement.node,n=r.portSelectors,a=this.findBySelector(e,i,n),o=a[0];return o===void 0&&(o=null),o},_updatePorts:function(){this._updatePortGroup(void 0);var t=Object.keys(this.model._portSettingsData.groups);t.forEach(this._updatePortGroup,this)},_removePorts:function(){me(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){var e,r,i,n,a=F(this.portContainerMarkup).addClass("joint-port"),o=this._getPortMarkup(t);if(Array.isArray(o)){var s=this.parseDOMJSON(o,a.node),l=s.fragment;l.childNodes.length>1?e=F("g").append(l):e=F(l.firstChild),n=s.selectors}else e=F(o),Array.isArray(e)&&(e=F("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group});var u=this._getPortLabelMarkup(t.label);if(Array.isArray(u)){var g=this.parseDOMJSON(u,a.node),h=g.fragment,y=g.selectors,x=h.childNodes.length;x>0&&(i=y,r=x===1?F(h.firstChild):F("g").append(h))}else r=F(u),Array.isArray(r)&&(r=F("g").append(r));var C;if(n&&i){for(var p in i)if(n[p]&&p!==this.selector)throw new Error("ElementView: selectors within port must be unique.");C=tt({},n,i)}else C=n||i||{};var E="portRoot";E in C||(C[E]=e.node);var k="labelRoot";return r&&!(k in C)&&(C[k]=r.node),a.append(e.addClass("joint-port-body")),r&&a.append(r.addClass("joint-port-label")),this._portElementsCache[t.id]={portElement:a,portLabelElement:r,portSelectors:C,portLabelSelectors:i,portContentElement:e,portContentSelectors:n},a},_updatePortGroup:function(t){for(var e=at(this.model.size()),r=this.model._portSettingsData.getGroupPortsMetrics(t,e),i=0,n=r.length;i<n;i++){var a=r[i],o=a.portId,s=this._portElementsCache[o]||{},l=a.portTransformation;this.applyPortTransform(s.portElement,l),this.updateDOMSubtreeAttributes(s.portElement.node,a.portAttrs,{rootBBox:new at(a.portSize),selectors:s.portSelectors});var u=a.labelTransformation;u&&s.portLabelElement&&(this.applyPortTransform(s.portLabelElement,u,-l.angle||0),this.updateDOMSubtreeAttributes(s.portLabelElement.node,u.attrs,{rootBBox:new at(a.labelSize),selectors:s.portLabelSelectors}))}},applyPortTransform:function(t,e,r){var i=F.createSVGMatrix().rotate(r||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(i,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},At=Be.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),Be.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,r){var i=Nt(e);r=(i?r:t)||{};var n=r.parentRelative,a=r.deep,o=r.restrictedArea,s;if(n){if(!this.graph)throw new Error("Element must be part of a graph.");var l=this.getParentCell();l&&!l.isLink()&&(s=l.get("position"))}if(i){if(s&&(t+=s.x,e+=s.y),a||o){var u=this.get("position"),g=u.x,h=u.y;this.translate(t-g,e-h,r)}else this.set("position",{x:t,y:e},r);return this}else{var y=Z(this.get("position"));return n?y.difference(s):y}},translate:function(t,e,r){if(t=t||0,e=e||0,t===0&&e===0)return this;r=r||{},r.translateBy=r.translateBy||this.id;var i=this.get("position")||{x:0,y:0},n=r.restrictedArea;if(n&&r.translateBy===this.id)if(typeof n=="function"){var a=n.call(this,i.x+t,i.y+e,r);t=a.x-i.x,e=a.y-i.y}else{var o=this.getBBox({deep:!0}),s=i.x-o.x,l=i.y-o.y,u=Math.max(n.x+s,Math.min(n.x+n.width+s-o.width,i.x+t)),g=Math.max(n.y+l,Math.min(n.y+n.height+l-o.height,i.y+e));t=u-i.x,e=g-i.y}var h={x:i.x+t,y:i.y+e};return r.tx=t,r.ty=e,r.transition?(Yt(r.transition)||(r.transition={}),this.transition("position",h,tt({},r.transition,{valueFunction:Po.object})),me(this.getEmbeddedCells(),"translate",t,e,r)):(this.startBatch("translate",r),this.set("position",h,r),me(this.getEmbeddedCells(),"translate",t,e,r),this.stopBatch("translate",r)),this},size:function(t,e,r){var i=this.get("size");return t===void 0?{width:i.width,height:i.height}:(Yt(t)&&(r=e,e=Nt(t.height)?t.height:i.height,t=Nt(t.width)?t.width:i.width),this.resize(t,e,r))},resize:function(t,e,r){if(r=r||{},this.startBatch("resize",r),r.direction){var i=this.get("size");switch(r.direction){case"left":case"right":e=i.height;break;case"top":case"bottom":t=i.width;break}var n=et(this.get("angle")||0),a=this.getBBox(),o;if(n){var s={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[r.direction];r.absolute&&(s+=Math.floor((n+45)/90),s%=4);var l=a[["bottomLeft","corner","topRight","origin"][s]](),u=Z(l).rotate(a.center(),-n),g=Math.sqrt(t*t+e*e)/2,h=s*Math.PI/2;h+=Math.atan(s%2==0?e/t:t/e),h-=bt(n);var y=Z.fromPolar(g,h,u);o=Z(y).offset(t/-2,e/-2)}else switch(o=a.topLeft(),r.direction){case"top":case"top-right":o.offset(0,a.height-e);break;case"left":case"bottom-left":o.offset(a.width-t,0);break;case"top-left":o.offset(a.width-t,a.height-e);break}this.set("size",{width:t,height:e},r),this.position(o.x,o.y,r)}else this.set("size",{width:t,height:e},r);return this.stopBatch("resize",r),this},scale:function(t,e,r,i){var n=this.getBBox().scale(t,e,r);return this.startBatch("scale",i),this.position(n.x,n.y,i),this.resize(n.width,n.height,i),this.stopBatch("scale"),this},fitEmbeds:function(t){t===void 0&&(t={});var e=this,r=e.graph;if(!r)throw new Error("Element must be part of a graph.");var i=this.getEmbeddedCells().filter(function(C){return C.isElement()});if(i.length===0)return this;this.startBatch("fit-embeds",t),t.deep&&me(i,"fitEmbeds",t);var n=he(t.padding),a=n.left,o=n.right,s=n.top,l=n.bottom,u=r.getCellsBBox(i),g=u.x,h=u.y,y=u.width,x=u.height;return g-=a,h-=s,y+=a+o,x+=l+s,this.set({position:{x:g,y:h},size:{width:y,height:x}},t),this.stopBatch("fit-embeds"),this},rotate:function(t,e,r,i){if(r){var n=this.getBBox().center(),a=this.get("size"),o=this.get("position");n.rotate(r,this.get("angle")-t);var s=n.x-a.width/2-o.x,l=n.y-a.height/2-o.y;this.startBatch("rotate",{angle:t,absolute:e,origin:r}),this.position(o.x+s,o.y+l,i),this.rotate(t,e,null,i),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,i);return this},angle:function(){return et(this.get("angle")||0)},getBBox:function(t){t===void 0&&(t={});var e=this,r=e.graph,i=e.attributes,n=t.deep,a=t.rotate;if(n&&r){var o=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return o.push(this),r.getCellsBBox(o,t)}var s=i.angle;s===void 0&&(s=0);var l=i.position,u=l.x,g=l.y,h=i.size,y=h.width,x=h.height,C=new at(u,g,y,x);return a&&C.rotateAroundCenter(s),C},getPointFromConnectedLink:function(t,e){var r=this.getBBox(),i=r.center(),n=t.get(e);if(!n)return i;var a=n.port;if(!a||!this.hasPort(a))return i;var o=this.portProp(a,["group"]),s=this.getPortsPositions(o),l=new Z(s[a]).offset(r.origin()),u=this.angle();return u&&l.rotate(i,-u),l}});tt(At.prototype,dA);var Er={},Xt=d.View.extend({options:{},theme:null,themeClassNamePrefix:Ze("theme-"),requireSetThemeOverride:!1,defaultTheme:ar.defaultTheme,children:null,childNodes:null,DETACHABLE:!0,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=tt({},this.options,t),d.View.call(this,t)},initialize:function(){Er[this.cid]=this,this.setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},renderChildren:function(t){if(t||(t=re(this,"children")),t){var e=this.svgElement,r=F.namespace[e?"svg":"xhtml"],i=en(t,r);(e?this.vel:this.$el).empty().append(i.fragment),this.childNodes=i.selectors}return this},findAttribute:function(t,e){for(var r=e;r&&r.nodeType===1;){var i=r.getAttribute(t);if(i)return i;if(r===this.el)return null;r=r.parentNode}return null},_ensureElement:function(){if(this.el)this.setElement(re(this,"el"));else{var t=re(this,"tagName"),e=tt({},re(this,"attributes")),r=tt({},re(this,"style"));this.id&&(e.id=re(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(r)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(F.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof d.$?t:d.$(t),this.el=this.$el[0],this.svgElement&&(this.vel=F(this.el))},_ensureElClassName:function(){var t=re(this,"className");if(!!t){var e=Ze(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override?this:(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t,this)},addThemeClassName:function(t){if(t=t||this.theme,!t)return this;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),Er[this.cid]=null,d.View.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,r){if(!e)return this;r||(r={});var i=this.getEventNamespace();for(var n in e){var a=e[n];typeof a!="function"&&(a=this[a]),a&&f(t).on(n+i,r,a.bind(this))}return this},undelegateElementEvents:function(t){return f(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=re(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var r=t.data,i="__"+this.cid+"__";return e===void 0?r?r[i]||{}:{}:(r||(r=t.data={}),r[i]||(r[i]={}),tt(r[i],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),e=t[0]&&tt({},t[0])||{},r=t[1]&&tt({},t[1])||{},i=e.render||this.prototype&&this.prototype.render||null;return e.render=function(){return typeof i=="function"&&i.apply(this,arguments),this.render.__render__===i&&this.onRender(),this},e.render.__render__=i,d.View.extend.call(this,e,r)}}),qf="dbltap";if(f.event&&!(qf in f.event.special)){var gA=ar.doubleTapInterval,vA=30;f.event.special[qf]={bindType:"touchend",delegateType:"touchend",handle:function(t){for(var e,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];var n=t.handleObj,a=t.target,o=f.data(a),s=new Date().getTime(),l="lastTouch"in o?s-o.lastTouch:0;l<gA&&l>vA?(o.lastTouch=null,t.type=n.origType,(e=n.handler).call.apply(e,[this,t].concat(r))):o.lastTouch=s}}}var _o=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];this.callbackArguments=e};_o.prototype.listenTo=function(e,r){for(var i=this,n=[],a=arguments.length-2;a-- >0;)n[a]=arguments[a+2];var o=this,s=o.callbackArguments;if(F.isObject(r)){var l=n[0];l===void 0&&(l=null),Object.entries(r).forEach(function(h){var y=h[0],x=h[1];typeof x=="function"&&((l||s.length>0)&&(x=x.bind.apply(x,[l].concat(s))),d.Events.listenTo.call(i,e,y,x))})}else if(typeof r=="string"&&typeof n[0]=="function"){var u=n[0],g=n[1];g===void 0&&(g=null),(g||s.length>0)&&(u=u.bind.apply(u,[g].concat(s))),d.Events.listenTo.call(this,e,r,u)}},_o.prototype.stopListening=function(){d.Events.stopListening.call(this)};var pA={__proto__:null,views:Er,View:Xt,Listener:_o};function Go(t){return t?Array.isArray(t)?t:[t]:[]}var Cr=Xt.extend({tagName:"g",svgElement:!0,className:"highlight",HIGHLIGHT_FLAG:1,UPDATE_PRIORITY:3,DETACHABLE:!1,UPDATABLE:!0,MOUNTABLE:!0,cellView:null,nodeSelector:null,node:null,updateRequested:!1,transformGroup:null,requestUpdate:function(e,r){var i=e.paper;this.cellView=e,this.nodeSelector=r,i&&(this.updateRequested=!0,i.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY))},confirmUpdate:function(){this.updateRequested=!1;var e=this,r=e.cellView,i=e.nodeSelector;return this.update(r,i),this.mount(),this.transform(),0},findNode:function(e,r){var i,n;r===void 0&&(r=null);var a;if(typeof r=="string")i=e.findBySelector(r),a=i[0];else if(fe(r)){var o=e.model.isLink(),s=r.label;s===void 0&&(s=null);var l=r.port,u=r.selector;o&&s!==null?a=e.findLabelNode(s,u):!o&&l?a=e.findPortNode(l,u):(n=e.findBySelector(u),a=n[0])}else r&&(a=F.toNode(r),a instanceof SVGElement||(a=null));return a||null},getNodeMatrix:function(e,r){var i=this,n=i.options,a=n.layer,o=e.rotatableNode,s=e.getNodeMatrix(r);return o?a?o.contains(r)?s:e.getRootRotateMatrix().inverse().multiply(s):e.getNodeRotateMatrix(r).multiply(s):s},mount:function(){var e=this,r=e.MOUNTABLE,i=e.cellView,n=e.el,a=e.options,o=e.transformGroup;if(!(!r||o)){var s=i.vel,l=i.paper,u=a.layer;if(u){var g=this.transformGroup=F("g").addClass("highlight-transform").append(n);l.getLayerView(u).insertSortedNode(g.node,a.z)}else(!n.parentNode||n.nextSibling)&&s.append(n)}},unmount:function(){var e=this,r=e.MOUNTABLE,i=e.transformGroup,n=e.vel;!r||(i?(this.transformGroup=null,i.remove()):n.remove())},transform:function(){var e=this,r=e.transformGroup,i=e.cellView,n=e.updateRequested;if(!(!r||i.model.isLink()||n)){var a=i.getRootTranslateMatrix(),o=i.getRootRotateMatrix(),s=a.multiply(o);r.attr("transform",F.matrixToTransformString(s))}},update:function(){var e=this,r=e.node,i=e.cellView,n=e.nodeSelector,a=e.updateRequested,o=e.id;if(!a){var s=this.node=this.findNode(i,n);r&&this.unhighlight(i,r),s?(this.highlight(i,s),this.mount()):(this.unmount(),i.notify("cell:highlight:invalid",o,this))}},onRemove:function(){var e=this,r=e.node,i=e.cellView,n=e.id,a=e.constructor;r&&this.unhighlight(i,r),this.unmount(),a._removeRef(i,n)},highlight:function(e,r){},unhighlight:function(e,r){},listenToUpdateAttributes:function(e){var r=re(this,"UPDATE_ATTRIBUTES");!Array.isArray(r)||r.length===0||this.listenTo(e.model,"change",this.onCellAttributeChange)},onCellAttributeChange:function(){var e=this,r=e.cellView;if(!!r){var i=r.model,n=r.paper,a=re(this,"UPDATE_ATTRIBUTES");!a.some(function(o){return i.hasChanged(o)})||n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}}},{_views:{},highlight:function(t,e,r){var i=this.uniqueId(e,r);this.add(t,e,i,r)},unhighlight:function(t,e,r){var i=this.uniqueId(e,r);this.remove(t,i)},get:function(e,r){r===void 0&&(r=null);var i=e.cid,n=this,a=n._views,o=a[i];if(r===null){var s=[];if(!o)return s;for(var l in o){var u=o[l];u instanceof this&&s.push(u)}return s}else{if(!o)return null;if(r in o){var g=o[r];if(g instanceof this)return g}return null}},add:function(e,r,i,n){if(n===void 0&&(n={}),!i)throw new Error("dia.HighlighterView: An ID required.");var a=Cr.get(e,i);a&&a.remove();var o=new this(n);return o.id=i,this._addRef(e,i,o),o.requestUpdate(e,r),o.listenToUpdateAttributes(e),o},_addRef:function(e,r,i){var n=e.cid,a=this,o=a._views,s=o[n];s||(s=o[n]={}),s[r]=i},_removeRef:function(e,r){var i=e.cid,n=this,a=n._views,o=a[i];if(!!o){r&&delete o[r];for(var s in o)return;delete a[i]}},remove:function(e,r){r===void 0&&(r=null),Go(this.get(e,r)).forEach(function(i){i.remove()})},removeAll:function(e,r){r===void 0&&(r=null);var i=this,n=i._views;for(var a in n)for(var o in n[a]){var s=n[a][o];s.cellView.paper===e&&s instanceof this&&(r===null||o===r)&&s.remove()}},update:function(e,r,i){r===void 0&&(r=null),i===void 0&&(i=!1),Go(this.get(e,r)).forEach(function(n){(i||n.UPDATABLE)&&n.update()})},transform:function(e,r){r===void 0&&(r=null),Go(this.get(e,r)).forEach(function(i){i.UPDATABLE&&i.transform()})},uniqueId:function(e,r){return r===void 0&&(r=""),F.ensureId(e)+JSON.stringify(r)}}),Li={DEFAULT:"default",EMBEDDING:"embedding",CONNECTING:"connecting",MAGNET_AVAILABILITY:"magnetAvailability",ELEMENT_AVAILABILITY:"elementAvailability"},Vt=Xt.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var t=["cell"],e=this.model.get("type");return e&&e.toLowerCase().split(".").forEach(function(r,i,n){t.push("type-"+n.slice(0,i+1).join("-"))}),t.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t={},e={},r=0,i,n,a,o=re(this,"presentationAttributes");for(var s in o)if(!!o.hasOwnProperty(s)){var l=o[s];for(Array.isArray(l)||(l=[l]),i=0,n=l.length;i<n;i++){a=l[i];var u=t[a];u||(u=t[a]=1<<r++),e[s]|=u}}var g=re(this,"initFlag");for(Array.isArray(g)||(g=[g]),i=0,n=g.length;i<n;i++)a=g[i],t[a]||(t[a]=1<<r++);if(r>25)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=t,this._presentationAttributes=e},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var r=0;if(Array.isArray(t))for(var i=0,n=t.length;i<n;i++)r|=e[t[i]];else r|=e[t];return r},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||Ur(this),Xt.call(this,t)},initialize:function(){this.setFlags(),Xt.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.$el.data("view",this),this.startListening()},onMount:function(){},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var r=t.getChangeFlag(this._presentationAttributes);e.updateHandled||!r||(e.dirty&&this.hasFlag(r,"UPDATE")&&(r|=this.getFlag("RENDER")),e.tool&&(e.async=!1),this.requestUpdate(r,e))},requestUpdate:function(t,e){var r=this,i=r.paper;i&&t>0&&i.requestViewUpdate(this,t,this.UPDATE_PRIORITY,e)},parseDOMJSON:function(t,e){var r=en(t),i=r.selectors,n=r.groupSelectors;for(var a in n){if(i[a])throw new Error("dia.CellView: ambiguous group selector");i[a]=n[a]}if(e){var o=this.selector;if(i[o])throw new Error("dia.CellView: ambiguous root selector.");i[o]=e}return{fragment:r.fragment,selectors:i}},can:function(t){var e=yt(this.options.interactive)?this.options.interactive(this):this.options.interactive;return Yt(e)&&e[t]!==!1||Eo(e)&&e!==!1},findBySelector:function(t,e,r){if(e||(e=this.el),r||(r=this.selectors),!t||t===".")return[e];if(r){var i=r[t];if(i)return Array.isArray(i)?i:[i]}return ar.useCSSSelectors?f(e).find(t).toArray():[]},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var r=this.model;e=r.getBBox().bbox(r.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){var e=this.getNodeBoundingRect(t),r=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(t)),i=this.getNodeMatrix(t);return F.transformRect(e,r.multiply(i))},getNodeRotateMatrix:function(e){return!this.rotatableNode||this.rotatableNode.contains(e)?this.getRootRotateMatrix():F.createSVGMatrix()},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),r=this.getNodeMatrix(t),i=this.getRootTranslateMatrix();return F.transformRect(e,i.multiply(r))},getRootTranslateMatrix:function(){var t=this.model,e=t.position(),r=F.createSVGMatrix().translate(e.x,e.y);return r},getRootRotateMatrix:function(){var t=F.createSVGMatrix(),e=this.model,r=e.angle();if(r){var i=e.getBBox(),n=i.width/2,a=i.height/2;t=t.translate(n,a).rotate(r).translate(-n,-a)}return t},_notifyHighlight:function(t,e,r){var i,n;r===void 0&&(r={});var a=this,o=a.el,s;if(typeof e=="string"?(i=this.findBySelector(e),s=i[0],s=s===void 0?o:s):(n=this.$(e),s=n[0],s=s===void 0?o:s),r.partial=s!==o,r.type===void 0){var l;switch(!0){case r.embedding:l=Li.EMBEDDING;break;case r.connecting:l=Li.CONNECTING;break;case r.magnetAvailability:l=Li.MAGNET_AVAILABILITY;break;case r.elementAvailability:l=Li.ELEMENT_AVAILABILITY;break;default:l=Li.DEFAULT;break}r.type=l}return this.notify(t,s,r),this},highlight:function(t,e){return this._notifyHighlight("cell:highlight",t,e)},unhighlight:function(t,e){return e===void 0&&(e={}),this._notifyHighlight("cell:unhighlight",t,e)},findMagnet:function(t){var e=this.el,r=this.$(t)[0];r||(r=e);do{var i=r.getAttribute("magnet"),n=r===e;if((i||n)&&i!=="false")return r;if(n)return;r=r.parentNode}while(r)},findProxyNode:function(t,e){t||(t=this.el);var r=t.getAttribute(e+"-selector");if(r){var i=this.findBySelector(r),n=i[0];if(n)return n}return t},getSelector:function(t,e){var r;if(t===this.el)return typeof e=="string"&&(r="> "+e),r;if(t){var i=F(t).index()+1;r=t.tagName+":nth-child("+i+")",e&&(r+=" > "+e),r=this.getSelector(t.parentNode,r)}return r},addLinkFromMagnet:function(t,e,r){var i=this.paper,n=i.model,a=i.getDefaultLink(this,t);return a.set({source:this.getLinkEnd(t,e,r,a,"source"),target:{x:e,y:r}}).addTo(n,{async:!1,ui:!0}),a.findView(i)},getLinkEnd:function(t){for(var e,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];var n=this.model,a=n.id,o=this.findAttribute("port",t),s=t.getAttribute("joint-selector"),l={id:a};return s!=null&&(l.magnet=s),o!=null?(l.port=o,!n.hasPort(o)&&!s&&(l.selector=this.getSelector(t))):s==null&&this.el!==t&&(l.selector=this.getSelector(t)),(e=this).customizeLinkEnd.apply(e,[l,t].concat(r))},customizeLinkEnd:function(t,e,r,i,n,a){var o=this,s=o.paper,l=s.options,u=l.connectionStrategy;if(typeof u=="function"){var g=u.call(s,t,this,e,new Z(r,i),n,a,s);if(g)return g}return t},getMagnetFromLinkEnd:function(t){var e=this.el,r=t.port,i=t.magnet,n=this.model,a;return r!=null&&n.isElement()&&n.hasPort(r)?a=this.findPortNode(r,i)||e:(i||(i=t.selector),!i&&r!=null&&(i='[port="'+r+'"]'),a=this.findBySelector(i,e,this.selectors)[0]),this.findProxyNode(a,"magnet")},dragLinkStart:function(t,e,r,i){this.model.startBatch("add-link");var n=this.addLinkFromMagnet(e,r,i);n.notifyPointerdown(t,r,i),n.eventData(t,n.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:n})},dragLink:function(t,e,r){var i=this.eventData(t),n=i.linkView;if(n)n.pointermove(t,e,r);else{var a=this.paper,o=a.options.magnetThreshold,s=this.getEventTarget(t),l=i.targetMagnet;if(o==="onleave"){if(l===s||F(l).contains(s))return}else if(a.eventData(t).mousemoved<=o)return;this.dragLinkStart(t,l,e,r)}},dragLinkEnd:function(t,e,r){var i=this.eventData(t),n=i.linkView;!n||(n.pointerup(t,e,r),this.model.stopBatch("add-link"))},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){je(e)||(t instanceof SVGElement?F(t).attr(e):f(t).attr(e))},processNodeAttributes:function(t,e){var r,i,n,a,o,s,l,u,g,h=[];for(r in e)!e.hasOwnProperty(r)||(i=e[r],n=this.getAttributeDefinition(r),n&&(!yt(n.qualify)||n.qualify.call(this,i,t,e,this))?($t(n.set)&&(s||(s={}),s[n.set]=i),i!==null&&h.push(r,n)):(s||(s={}),s[Io(r)]=i));for(a=0,o=h.length;a<o;a+=2)r=h[a],n=h[a+1],i=e[r],yt(n.set)&&(l||(l={}),l[r]=i),yt(n.position)&&(u||(u={}),u[r]=i),yt(n.offset)&&(g||(g={}),g[r]=i);return{raw:e,normal:s,set:l,position:u,offset:g}},updateRelativeAttributes:function(t,e,r,i){i||(i={});var n,a,o,s=e.raw||{},l=e.normal||{},u=e.set,g=e.position,h=e.offset;for(n in u){a=u[n],o=this.getAttributeDefinition(n);var y=o.set.call(this,a,r.clone(),t,s,this);Yt(y)?tt(l,y):y!==void 0&&(l[n]=y)}if(t instanceof HTMLElement){this.setNodeAttributes(t,l);return}var x=l.transform,C=F.transformStringToMatrix(x),p=Z(C.e,C.f);x&&(l=Ce(l,"transform"),C.e=C.f=0);var E,k,w;if(g||h){var S=this.getNodeScale(t,i.scalableNode);E=S.sx,k=S.sy}var T=!1;for(n in g)a=g[n],o=this.getAttributeDefinition(n),w=o.position.call(this,a,r.clone(),t,s,this),w&&(p.offset(Z(w).scale(E,k)),T||(T=!0));this.setNodeAttributes(t,l);var m=!1;if(h){var A=this.getNodeBoundingRect(t);if(A.width>0&&A.height>0){var M=F.transformRect(A,C).scale(1/E,1/k);for(n in h)a=h[n],o=this.getAttributeDefinition(n),w=o.offset.call(this,a,M,t,s,this),w&&(p.offset(Z(w).scale(E,k)),m||(m=!0))}}(x!==void 0||T||m)&&(p.round(1),C.e=p.x,C.f=p.y,t.setAttribute("transform",F.matrixToTransformString(C)))},getNodeScale:function(t,e){var r,i;if(e&&e.contains(t)){var n=e.scale();r=1/n.sx,i=1/n.sy}else r=1,i=1;return{sx:r,sy:i}},cleanNodesCache:function(){this.metrics={}},nodeCache:function(t){var e=this.metrics;if(!e)return{};var r=F.ensureId(t),i=e[r];return i||(i=e[r]={}),i},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);return e.boundingRect===void 0&&(e.boundingRect=F(t).getBBox()),new at(e.boundingRect)},getNodeMatrix:function(t){var e=this.nodeCache(t);if(e.magnetMatrix===void 0){var r=this,i=r.rotatableNode,n=r.el,a;i&&i.contains(t)?a=i:a=n,e.magnetMatrix=F(t).getTransformToElement(a)}return F.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return e.geometryShape===void 0&&(e.geometryShape=F(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,r,i){var n,a,o,s,l={},u=[];for(var g in t)if(!!t.hasOwnProperty(g)&&(o=t[g],!!fe(o))){var h=r[g]=this.findBySelector(g,e,i);for(n=0,a=h.length;n<a;n++){var y=h[n];s=F.ensureId(y);var x=i&&i[g]===y,C=l[s];if(C){C.array||(u.push(s),C.array=!0,C.attributes=[C.attributes],C.selectedLength=[C.selectedLength]);var p=C.attributes,E=C.selectedLength;if(x)p.unshift(o),E.unshift(-1);else{var k=Jn(E,a);p.splice(k,0,o),E.splice(k,0,a)}}else l[s]={attributes:o,selectedLength:x?-1:a,node:y,array:!1}}}for(n=0,a=u.length;n<a;n++)s=u[n],o=l[s],o.attributes=ie.apply(void 0,[{}].concat(o.attributes.reverse()));return l},getEventTarget:function(t,e){e===void 0&&(e={});var r=t.target,i=t.type,n=t.clientX;n===void 0&&(n=0);var a=t.clientY;return a===void 0&&(a=0),e.fromPoint||i==="touchmove"||i==="touchend"?document.elementFromPoint(n,a):r},updateDOMSubtreeAttributes:function(t,e,r){r||(r={}),r.rootBBox||(r.rootBBox=at()),r.selectors||(r.selectors=this.selectors);var i={},n={},a=[],o=[],s,l,u,g,h,y=r.roAttributes,x=this.findNodesAttributes(y||e,t,i,r.selectors),C=y?this.findNodesAttributes(e,t,i,r.selectors):x;for(var p in x)if(g=x[p],u=g.attributes,l=g.node,h=this.processNodeAttributes(l,u),!h.set&&!h.position&&!h.offset)this.setNodeAttributes(l,h.normal);else{var E=C[p]&&C[p].attributes,k=E&&u.ref===void 0?E.ref:u.ref,w;if(k){if(w=(i[k]||this.findBySelector(k,t,r.selectors))[0],!w)throw new Error('dia.CellView: "'+k+'" reference does not exist.')}else w=null;if(s={node:l,refNode:w,processedAttributes:h,allAttributes:E},w){var S=o.findIndex(function(V){return V.refNode===l});S>-1?o.splice(S,0,s):o.push(s)}else a.push(s)}a.push.apply(a,o);for(var T,m=0,A=a.length;m<A;m++){s=a[m],l=s.node,w=s.refNode;var M=F(r.rotatableNode),N=w?F.ensureId(w):"",D=!!M&&!!w&&M.contains(w),z=n[N];if(!z){var _=D?M:t;z=n[N]=w?F(w).getBBox({target:_}):r.rootBBox}y?(h=this.processNodeAttributes(l,s.allAttributes),this.mergeProcessedAttributes(h,s.processedAttributes)):h=s.processedAttributes;var j=z;D&&!M.contains(l)&&(T||(T=F.transformStringToMatrix(M.attr("transform"))),j=F.transformRect(z,T)),this.updateRelativeAttributes(l,h,j,r)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),tt(t.set,e.set),tt(t.position,e.position),tt(t.offset,e.offset);var r=t.normal&&t.normal.transform;r!==void 0&&e.normal&&(e.normal.transform=r),t.normal=e.normal},onRemove:function(){this.removeTools(),this.removeHighlighters()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return e?t?e.getName()===t:!0:!1},addTools:function(t){return this.removeTools(),t&&(this._toolsView=t,t.configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this))),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools();break}},removeHighlighters:function(){Cr.remove(this)},updateHighlighters:function(t){t===void 0&&(t=!1),Cr.update(this,null,t)},transformHighlighters:function(){Cr.transform(this)},pointerdblclick:function(t,e,r){this.notify("cell:pointerdblclick",t,e,r)},pointerclick:function(t,e,r){this.notify("cell:pointerclick",t,e,r)},contextmenu:function(t,e,r){this.notify("cell:contextmenu",t,e,r)},pointerdown:function(t,e,r){var i=this,n=i.model,a=n.graph;a&&(n.startBatch("pointer"),this.eventData(t,{graph:a})),this.notify("cell:pointerdown",t,e,r)},pointermove:function(t,e,r){this.notify("cell:pointermove",t,e,r)},pointerup:function(t,e,r){var i=this.eventData(t),n=i.graph;this.notify("cell:pointerup",t,e,r),n&&n.stopBatch("pointer",{cell:this.model})},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,r,i){this.notify("cell:mousewheel",t,e,r,i)},onevent:function(t,e,r,i){this.notify(e,t,r,i)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave:function(e){var r=this,i=r.paper;i.isAsync()&&i.dumpView(this);var n=this.getEventTarget(e,{fromPoint:!0}),a=i.findView(n);a!==this&&(this.mouseleave(e),a&&a.mouseenter(e))},setInteractivity:function(t){this.options.interactive=t}},{Highlighting:Li,addPresentationAttributes:function(t){return ie({},re(this.prototype,"presentationAttributes"),t,function(e,r){if(!(!e||!r)&&(typeof e=="string"&&(e=[e]),typeof r=="string"&&(r=[r]),Array.isArray(e)&&Array.isArray(r)))return mr(e.concat(r))})}}),Ht={UPDATE:"UPDATE",TRANSLATE:"TRANSLATE",TOOLS:"TOOLS",RESIZE:"RESIZE",PORTS:"PORTS",ROTATE:"ROTATE",RENDER:"RENDER"},kt=Vt.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=Vt.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){Vt.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:[Ht.UPDATE],position:[Ht.TRANSLATE,Ht.TOOLS],size:[Ht.RESIZE,Ht.PORTS,Ht.TOOLS],angle:[Ht.ROTATE,Ht.TOOLS],markup:[Ht.RENDER],ports:[Ht.PORTS]},initFlag:[Ht.RENDER],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){var r=ar.useCSSSelectors;this.hasFlag(t,Ht.PORTS)&&(this._removePorts(),this._cleanPortsCache());var i=!1;if(this.hasFlag(t,Ht.RENDER))this.render(),this.updateTools(e),this.updateHighlighters(!0),i=!0,t=this.removeFlag(t,[Ht.RENDER,Ht.UPDATE,Ht.RESIZE,Ht.TRANSLATE,Ht.ROTATE,Ht.PORTS,Ht.TOOLS]);else{var n=!1;this.hasFlag(t,Ht.RESIZE)&&(this.resize(e),n=!0,t=this.removeFlag(t,[Ht.RESIZE,Ht.UPDATE])),this.hasFlag(t,Ht.UPDATE)&&(this.update(this.model,null,e),t=this.removeFlag(t,Ht.UPDATE),n=!0,r&&(t=this.removeFlag(t,Ht.PORTS))),this.hasFlag(t,Ht.TRANSLATE)&&(this.translate(),t=this.removeFlag(t,Ht.TRANSLATE),i=!0),this.hasFlag(t,Ht.ROTATE)&&(this.rotate(),t=this.removeFlag(t,Ht.ROTATE),i=!0),this.hasFlag(t,Ht.PORTS)&&(this._renderPorts(),n=!0,t=this.removeFlag(t,Ht.PORTS)),n&&this.updateHighlighters(!1)}return i&&this.transformHighlighters(),this.hasFlag(t,Ht.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,Ht.TOOLS)),t},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();var r=ar.useCSSSelectors;r&&this._removePorts();var i=this.model,n=i.attr();this.updateDOMSubtreeAttributes(this.el,n,{rootBBox:new at(i.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===n?null:e}),r&&this._renderPorts()},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),r=this.selectors=e.selectors;this.rotatableNode=F(r[this.rotatableSelector])||null,this.scalableNode=F(r[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(F(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable");var r=this.selectors={};r[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),ar.useCSSSelectors||this._renderPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode){this.rgRotate(),this.update();return}this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){var t=this.model.attributes.position;return"translate("+t.x+","+t.y+")"},getRotateString:function(){var t=this.model.attributes,e=t.angle;if(!e)return null;var r=t.size;return"rotate("+e+","+r.width/2+","+r.height/2+")"},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,r=e.angle(),i=e.size(),n=this.scalableNode,a=!1;n.node.getElementsByTagName("path").length>0&&(a=!0);var o=n.getBBox({recursive:a}),s=i.width/(o.width||1),l=i.height/(o.height||1);n.attr("transform","scale("+s+","+l+")");var u=this.rotatableNode,g=u&&u.attr("transform");if(g){u.attr("transform",g+" rotate("+-r+","+i.width/2+","+i.height/2+")");var h=n.getBBox({target:this.paper.cells});e.set("position",{x:h.x,y:h.y},tt({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t){t===void 0&&(t={});var e=t.model||this.model,r=t.paper||this.paper,i=r.model,n=t.initialZIndices={},a=e.getEmbeddedCells({deep:!0}),o=i.getConnectedLinks(e,{deep:!0,includeEnclosed:!0});[e].concat(a,o).forEach(function(g){return n[g.id]=g.attributes.z}),e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});var s=i.getElements().reduce(function(g,h){return Math.max(g,h.attributes.z||0)},0);o.forEach(function(g){g.attributes.z<=s&&g.set("z",s+1,{ui:!0})}),e.stopBatch("to-front");var l=e.parent();if(l){var u=i.getCell(l);u.unembed(e,{ui:!0}),t.initialParentId=l}else t.initialParentId=null},processEmbedding:function(t,e,r,i){t===void 0&&(t={});var n=t.model||this.model,a=t.paper||this.paper,o=a.model,s=a.options,l=s.findParentBy,u=s.frontParentOnly,g=s.validateEmbedding,h;yt(l)?h=lt(l.call(o,this,e,r,i)):l==="pointer"?h=lt(o.findModelsFromPoint({x:r,y:i})):h=o.findModelsUnderElement(n,{searchBy:l}),h=h.filter(function(k){return k instanceof Be&&n.id!==k.id&&!k.isEmbeddedIn(n)}),u&&(h=h.slice(-1));for(var y=null,x=t.candidateEmbedView,C=h.length-1;C>=0;C--){var p=h[C];if(x&&x.model.id==p.id){y=x;break}else{var E=p.findView(a);if(!yt(g)||g.call(a,this,E)){y=E;break}}}y&&y!=x&&(this.clearEmbedding(t),t.candidateEmbedView=y.highlight(y.findProxyNode(null,"container"),{embedding:!0})),!y&&x&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t){t===void 0&&(t={});var e=t.candidateEmbedView,r=t.model||this.model,i=t.paper||this.paper;if(e)e.model.embed(r,{ui:!0}),e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null;else{var n=i.options,a=n.validateUnembedding,o=t.initialParentId;if(o&&typeof a=="function"&&!a.call(i,this)){this._disallowUnembed(t);return}}i.model.getConnectedLinks(r,{deep:!0}).forEach(function(s){s.reparent({ui:!0})})},_disallowUnembed:function(t){var e=t.model,r=t.whenNotAllowed;r===void 0&&(r="revert");var i=e||this.model,n=t.paper||this.paper,a=n.model;switch(r){case"remove":{i.remove({ui:!0});break}case"revert":{var o=t.initialParentId,s=t.initialPosition,l=t.initialZIndices;if(s){var u=s.x,g=s.y;i.position(u,g,{deep:!0,ui:!0})}l&&Object.keys(l).forEach(function(y){var x=a.getCell(y);x&&x.set("z",l[y],{ui:!0})});var h=a.getCell(o);h&&h.embed(i,{ui:!0});break}}},getDelegatedView:function(){for(var t=this,e=t.model,r=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=r.findViewByModel(e)}return null},findProxyNode:function(t,e){t||(t=this.el);var r=t.getAttribute(e+"-selector");if(r){var i=this.findAttribute("port",t);if(i){var n=this.findPortNode(i,r);if(n)return n}else{var a=this.findBySelector(r),o=a[0];if(o)return o}}return t},notifyPointerdown:function(e,r,i){Vt.prototype.pointerdown.call(this,e,r,i),this.notify("element:pointerdown",e,r,i)},notifyPointermove:function(e,r,i){Vt.prototype.pointermove.call(this,e,r,i),this.notify("element:pointermove",e,r,i)},notifyPointerup:function(e,r,i){this.notify("element:pointerup",e,r,i),Vt.prototype.pointerup.call(this,e,r,i)},pointerdblclick:function(t,e,r){Vt.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,r)},pointerclick:function(t,e,r){Vt.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,r)},contextmenu:function(t,e,r){Vt.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,r)},pointerdown:function(t,e,r){this.isPropagationStopped(t)||(this.notifyPointerdown(t,e,r),this.dragStart(t,e,r))},pointermove:function(t,e,r){var i=this.eventData(t);switch(i.action){case"magnet":this.dragMagnet(t,e,r);break;case"move":(i.delegatedView||this).drag(t,e,r);default:this.notifyPointermove(t,e,r);break}this.eventData(t,i)},pointerup:function(t,e,r){var i=this.eventData(t);switch(i.action){case"magnet":this.dragMagnetEnd(t,e,r);break;case"move":(i.delegatedView||this).dragEnd(t,e,r);default:this.notifyPointerup(t,e,r)}var n=i.targetMagnet;n&&this.magnetpointerclick(t,n,e,r),this.checkMouseleave(t)},mouseover:function(t){Vt.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){Vt.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){Vt.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){Vt.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,r,i){Vt.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,r,i)},onmagnet:function(t,e,r){this.dragMagnetStart(t,e,r)},magnetpointerdblclick:function(t,e,r,i){this.notify("element:magnet:pointerdblclick",t,e,r,i)},magnetcontextmenu:function(t,e,r,i){this.notify("element:magnet:contextmenu",t,e,r,i)},dragStart:function(t,e,r){var i=this.getDelegatedView();if(!(!i||!i.can("elementMove"))){this.eventData(t,{action:"move",delegatedView:i});var n=i.model.position();i.eventData(t,{initialPosition:n,pointerOffset:n.difference(e,r),restrictedArea:this.paper.getRestrictedArea(i,e,r)})}},dragMagnetStart:function(t,e,r){if(!!this.can("addLinkFromMagnet")){var i=t.currentTarget,n=this.paper;this.eventData(t,{targetMagnet:i}),t.stopPropagation(),n.options.validateMagnet(this,i,t)?(n.options.magnetThreshold<=0&&this.dragLinkStart(t,i,e,r),this.eventData(t,{action:"magnet"}),this.stopPropagation(t)):this.pointerdown(t,e,r),n.delegateDragEvents(this,t.data)}},drag:function(t,e,r){var i=this.paper,n=i.options.gridSize,a=this.model,o=this.eventData(t),s=o.pointerOffset,l=o.restrictedArea,u=o.embedding,g=ht(e+s.x,n),h=ht(r+s.y,n);a.position(g,h,{restrictedArea:l,deep:!0,ui:!0}),i.options.embeddingMode&&(u||(this.prepareEmbedding(o),u=!0),this.processEmbedding(o,t,e,r)),this.eventData(t,{embedding:u})},dragMagnet:function(t,e,r){this.dragLink(t,e,r)},dragEnd:function(t,e,r){var i=this.eventData(t);i.embedding&&this.finalizeEmbedding(i)},dragMagnetEnd:function(t,e,r){this.dragLinkEnd(t,e,r)},magnetpointerclick:function(t,e,r,i){var n=this.paper;n.eventData(t).mousemoved>n.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,r,i)}},{Flags:Ht});tt(kt.prototype,fA);var cr={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var r=this._results[t];if(typeof r<"u")return r;try{r=e()}catch{r=!1}return this._results[t]=r,r}},_t=At.define("basic.Generic",{attrs:{".":{fill:"#ffffff",stroke:"none"}}}),mA=_t.define("basic.Rect",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>'}),yA=kt.extend({presentationAttributes:kt.addPresentationAttributes({attrs:["SCALE"]}),confirmUpdate:function(){var t=kt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"SCALE")&&(this.resize(),t=this.removeFlag(t,"SCALE")),t}}),bA=_t.define("basic.Text",{attrs:{text:{"font-size":18,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><text/></g></g>'}),jo=_t.define("basic.Circle",{size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>'}),wA=_t.define("basic.Ellipse",{size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>'}),xA=_t.define("basic.Polygon",{size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),AA=_t.define("basic.Polyline",{size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>'}),CA=_t.define("basic.Image",{attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>'}),Jf=_t.define("basic.Path",{size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>'}),IA=Jf.define("basic.Rhombus",{attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"ref-dy":null,"y-alignment":"middle"}}}),ra=cr.test("svgforeignobject"),Dr=_t.define("basic.TextBlock",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},{markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',ra?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),initialize:function(){this.listenTo(this,"change:size",this.updateSize),this.listenTo(this,"change:content",this.updateContent),this.updateSize(this,this.get("size")),this.updateContent(this,this.get("content")),_t.prototype.initialize.apply(this,arguments)},updateSize:function(t,e){this.attr({".fobj":tt({},e),div:{style:tt({},e)}})},updateContent:function(t,e){ra?this.attr({".content":{html:Mo(e)}}):this.attr({".content":{text:e}})},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}}),Jr=kt.extend({presentationAttributes:ra?kt.prototype.presentationAttributes:kt.addPresentationAttributes({content:["CONTENT"],size:["CONTENT"]}),initFlag:["RENDER","CONTENT"],confirmUpdate:function(){var t=kt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"CONTENT")&&(this.updateContent(this.model),t=this.removeFlag(t,"CONTENT")),t},update:function(t,e){var r=this.model;if(ra)kt.prototype.update.call(this,r,e);else{var i=Ce(e||r.get("attrs"),".content");kt.prototype.update.call(this,r,i),(!e||hr(e,".content"))&&this.updateContent(r,e)}},updateContent:function(t,e){var r=ie({},(e||t.get("attrs"))[".content"]);r=Ce(r,"text");var i=So(t.get("content"),t.get("size"),r,{svgDocument:this.paper.svg}),n=Yr({},".content",r,"/");n[".content"].text=i,kt.prototype.update.call(this,t,n)}}),SA={__proto__:null,Generic:_t,Rect:mA,TextView:yA,Text:bA,Circle:jo,Ellipse:wA,Polygon:xA,Polyline:AA,Image:CA,Path:Jf,Rhombus:IA,TextBlock:Dr,TextBlockView:Jr},le=Be.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),doubleToolMarkup:void 0,vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}}},defaults:{type:"link",source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,r){if(t===void 0)return be(this.get("source"));var i,n,a=t instanceof Be;if(a)return i=be(e)||{},i.id=t.id,n=r,this.set("source",i,n);var o=!fe(t);return o?(i=be(e)||{},i.x=t.x,i.y=t.y,n=r,this.set("source",i,n)):(i=t,n=e,this.set("source",i,n))},target:function(t,e,r){if(t===void 0)return be(this.get("target"));var i,n,a=t instanceof Be;if(a)return i=be(e)||{},i.id=t.id,n=r,this.set("target",i,n);var o=!fe(t);return o?(i=be(e)||{},i.x=t.x,i.y=t.y,n=r,this.set("target",i,n)):(i=t,n=e,this.set("target",i,n))},router:function(t,e,r){if(t===void 0){var i=this.get("router");return i?typeof i=="object"?be(i):i:this.get("manhattan")?{name:"orthogonal"}:null}var n=typeof t=="object"||typeof t=="function",a=n?t:{name:t,args:e},o=n?e:r;return this.set("router",a,o)},connector:function(t,e,r){if(t===void 0){var i=this.get("connector");return i?typeof i=="object"?be(i):i:this.get("smooth")?{name:"smooth"}:null}var n=typeof t=="object"||typeof t=="function",a=n?t:{name:t,args:e},o=n?e:r;return this.set("connector",a,o)},label:function(t,e,r){var i=this.labels();return t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=i.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,r)},labels:function(t,e){return arguments.length===0?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},hasLabels:function(){var t=this.attributes,e=t.labels;return Array.isArray(e)&&e.length>0},insertLabel:function(t,e,r){if(!e)throw new Error("dia.Link: no label provided");var i=this.labels(),n=i.length;return t=isFinite(t)&&t!==null?t|0:n,t<0&&(t=n+t+1),i.splice(t,0,e),this.labels(i,r)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var r=this.labels();return t=isFinite(t)&&t!==null?t|0:-1,r.splice(t,1),this.labels(r,e)},vertex:function(t,e,r){var i=this.vertices();if(t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=i.length+t),arguments.length<=1)return this.prop(["vertices",t]);var n=this._normalizeVertex(e);return this.prop(["vertices",t],n,r)},vertices:function(t,e){if(arguments.length===0)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var r=[],i=0;i<t.length;i++){var n=t[i],a=this._normalizeVertex(n);r.push(a)}return this.set("vertices",r,e)},insertVertex:function(t,e,r){if(!e)throw new Error("dia.Link: no vertex provided");var i=this.vertices(),n=i.length;t=isFinite(t)&&t!==null?t|0:n,t<0&&(t=n+t+1);var a=this._normalizeVertex(e);return i.splice(t,0,a),this.vertices(i,r)},removeVertex:function(t,e){var r=this.vertices();return t=isFinite(t)&&t!==null?t|0:-1,r.splice(t,1),this.vertices(r,e)},_normalizeVertex:function(t){var e=!fe(t);return e?{x:t.x,y:t.y}:t},translate:function(t,e,r){return r=r||{},r.translateBy=r.translateBy||this.id,r.tx=t,r.ty=e,this.applyToPoints(function(i){return{x:(i.x||0)+t,y:(i.y||0)+e}},r)},scale:function(t,e,r,i){return this.applyToPoints(function(n){return Z(n).scale(t,e,r).toJSON()},i)},applyToPoints:function(t,e){if(!yt(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var r={},i=this.attributes,n=i.source,a=i.target;n.id||(r.source=t(n)),a.id||(r.target=t(a));var o=this.vertices();return o.length>0&&(r.vertices=o.map(t)),this.set(r,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new Z(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new Z(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){var t=[this.getSourcePoint()].concat(this.vertices().map(Z),[this.getTargetPoint()]);return new Qt(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var r=this.getSourceElement(),i=this.getTargetElement(),n=this.getParentCell();r&&i&&(r===i||r.isEmbeddedIn(i)?e=i:i.isEmbeddedIn(r)?e=r:e=this.graph.getCommonAncestor(r,i)),n&&(!e||e.id!==n.id)&&n.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var e=this.attributes,r=e.source,i=e.target,n=r.id,a=i.id;if(!n||!a)return!1;var o=n===a;if(!o&&t.deep&&this.graph){var s=this.getSourceCell(),l=this.getTargetCell();o=s.isEmbeddedIn(l)||l.isEmbeddedIn(s)}return o},getSourceCell:function(){var t=this,e=t.graph,r=t.attributes,i=r.source;return i&&i.id&&e&&e.getCell(i.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){var t=this,e=t.graph,r=t.attributes,i=r.target;return i&&i.id&&e&&e.getCell(i.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter(function(r){return!!r});t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=$t(t)||Nt(t)?t:t.id,r=this.getRelationshipAncestor();return!!r&&(r.id===e||r.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var r=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&r}}),MA=At.define("standard.Rectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]}),kA=At.define("standard.Circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]}),PA=At.define("standard.Ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]}),TA=At.define("standard.Path",{attrs:{body:{refD:"M 0 0 L 10 0 10 10 0 10 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]}),NA=At.define("standard.Polygon",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]}),LA=At.define("standard.Polyline",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10 0 0",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]}),EA=At.define("standard.Image",{attrs:{image:{refWidth:"100%",refHeight:"100%"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),DA=At.define("standard.BorderedImage",{attrs:{border:{refWidth:"100%",refHeight:"100%",stroke:"#333333",strokeWidth:2},background:{refWidth:-1,refHeight:-1,x:.5,y:.5,fill:"#FFFFFF"},image:{refWidth:-1,refHeight:-1,x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),zA=At.define("standard.EmbeddedImage",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{refWidth:"30%",refHeight:-20,x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",refX:"30%",refX2:20,refY:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),BA=At.define("standard.InscribedImage",{attrs:{border:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",stroke:"#333333",strokeWidth:2},background:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",fill:"#FFFFFF"},image:{refWidth:"68%",refHeight:"68%",refX:"16%",refY:"16%",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),OA=At.define("standard.HeaderedRectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{refWidth:"100%",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]}),Fo=10,RA=At.define("standard.Cylinder",{attrs:{body:{lateralArea:Fo,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{refCx:"50%",cy:Fo,refRx:"50%",ry:Fo,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"100%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(t===void 0)return this.attr("body/lateralArea");var r=pe(t),i={lateralArea:t},n=r?{refCy:t,refRy:t,cy:null,ry:null}:{refCy:null,refRy:null,cy:t,ry:t};return this.attr({body:i,top:n},e)}},{attributes:{lateralArea:{set:function(t,e){var r=pe(t);r&&(t=parseFloat(t)/100);var i=e.x,n=e.y,a=e.width,o=e.height,s=a/2,l=r?o*t:t,u=F.KAPPA,g=u*s,h=u*(r?o*t:t),y=i,x=i+a/2,C=i+a,p=n+l,E=p-l,k=n+o-l,w=n+o,S=["M",y,p,"L",y,k,"C",i,k+h,x-g,w,x,w,"C",x+g,w,C,k+h,C,k,"L",C,p,"C",C,p-h,x+g,E,x,E,"C",x-g,E,y,p-h,y,p,"Z"];return{d:S.join(" ")}}}}}),_A={tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]},GA={tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}},jA=cr.test("svgforeignobject")?_A:GA,FA=At.define("standard.TextBlock",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},jA]},{attributes:{text:{set:function(t,e,r,i){if(r instanceof HTMLElement)r.textContent=t;else{var n=i.style||{},a={text:t,width:-5,height:"100%"},o=tt({textVerticalAnchor:"middle"},n);return ci.textWrap.set.call(this,a,e,r,o),{fill:n.color||null}}},position:function(t,e,r){if(r instanceof SVGElement)return e.center()}}}}),VA=le.define("standard.Link",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),WA=le.define("standard.DoubleLink",{attrs:{line:{connection:!0,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:!0,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]}),ZA=le.define("standard.ShadowLink",{attrs:{line:{connection:!0,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:!0,refX:3,refY:6,stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]}),YA={__proto__:null,Rectangle:MA,Circle:kA,Ellipse:PA,Path:TA,Polygon:NA,Polyline:LA,Image:EA,BorderedImage:DA,EmbeddedImage:zA,InscribedImage:BA,HeaderedRectangle:OA,Cylinder:RA,TextBlock:FA,Link:VA,DoubleLink:WA,ShadowLink:ZA},Vo=_t.define("devs.Model",{inPorts:[],outPorts:[],size:{width:80,height:80},attrs:{".":{magnet:!1},".label":{text:"Model","ref-x":.5,"ref-y":10,"font-size":18,"text-anchor":"middle",fill:"#000"},".body":{"ref-width":"100%","ref-height":"100%",stroke:"#000"}},ports:{groups:{in:{position:{name:"left"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:!0}},label:{position:{name:"left",args:{y:10}}}},out:{position:{name:"right"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:!0}},label:{position:{name:"right",args:{y:10}}}}}}},{markup:'<g class="rotatable"><rect class="body"/><text class="label"/></g>',portMarkup:'<circle class="port-body"/>',portLabelMarkup:'<text class="port-label"/>',initialize:function(){_t.prototype.initialize.apply(this,arguments),this.on("change:inPorts change:outPorts",this.updatePortItems,this),this.updatePortItems()},updatePortItems:function(t,e,r){var i=mr(this.get("inPorts")),n=No(mr(this.get("outPorts")),i),a=this.createPortItems("in",i),o=this.createPortItems("out",n);this.prop("ports/items",a.concat(o),tt({rewrite:!0},r))},createPortItem:function(t,e){return{id:e,group:t,attrs:{".port-label":{text:e}}}},createPortItems:function(t,e){return lt(e).map(this.createPortItem.bind(this,t))},_addGroupPort:function(t,e,r){var i=this.get(e);return this.set(e,Array.isArray(i)?i.concat(t):[t],r)},addOutPort:function(t,e){return this._addGroupPort(t,"outPorts",e)},addInPort:function(t,e){return this._addGroupPort(t,"inPorts",e)},_removeGroupPort:function(t,e,r){return this.set(e,hi(this.get(e),t),r)},removeOutPort:function(t,e){return this._removeGroupPort(t,"outPorts",e)},removeInPort:function(t,e){return this._removeGroupPort(t,"inPorts",e)},_changeGroup:function(t,e,r){return this.prop("ports/groups/"+t,Yt(e)?e:{},r)},changeInGroup:function(t,e){return this._changeGroup("in",t,e)},changeOutGroup:function(t,e){return this._changeGroup("out",t,e)}}),UA=Vo.define("devs.Atomic",{size:{width:80,height:80},attrs:{".label":{text:"Atomic"}}}),XA=Vo.define("devs.Coupled",{size:{width:200,height:300},attrs:{".label":{text:"Coupled"}}}),HA=le.define("devs.Link",{attrs:{".connection":{"stroke-width":2}}}),qA={__proto__:null,Model:Vo,Atomic:UA,Coupled:XA,Link:HA},ia=_t.define("logic.Gate",{size:{width:80,height:40},attrs:{".":{magnet:!1},".body":{width:100,height:50},circle:{r:7,stroke:"black",fill:"transparent","stroke-width":2}}},{operation:function(){return!0}}),Wo=ia.define("logic.IO",{size:{width:60,height:30},attrs:{".body":{fill:"white",stroke:"black","stroke-width":2},".wire":{ref:".body","ref-y":.5,stroke:"black"},text:{fill:"black",ref:".body","ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle","font-weight":"bold","font-variant":"small-caps","text-transform":"capitalize","font-size":"14px"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><path class="wire"/><circle/><text/></g>'}),JA=Wo.define("logic.Input",{attrs:{".wire":{"ref-dx":0,d:"M 0 0 L 23 0"},circle:{ref:".body","ref-dx":30,"ref-y":.5,magnet:!0,class:"output",port:"out"},text:{text:"input"}}}),KA=Wo.define("logic.Output",{attrs:{".wire":{"ref-x":0,d:"M 0 0 L -23 0"},circle:{ref:".body","ref-x":-30,"ref-y":.5,magnet:"passive",class:"input",port:"in"},text:{text:"output"}}}),Zo=ia.define("logic.Gate11",{attrs:{".input":{ref:".body","ref-x":-2,"ref-y":.5,magnet:"passive",port:"in"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input"/><circle class="output"/></g>'}),fi=ia.define("logic.Gate21",{attrs:{".input1":{ref:".body","ref-x":-2,"ref-y":.3,magnet:"passive",port:"in1"},".input2":{ref:".body","ref-x":-2,"ref-y":.7,magnet:"passive",port:"in2"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle class="output"/></g>'}),QA=Zo.define("logic.Repeater",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(t){return t}}),$A=Zo.define("logic.Not",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t){return!t}}),t1=fi.define("logic.Or",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(t,e){return t||e}}),e1=fi.define("logic.And",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return t&&e}}),r1=fi.define("logic.Nor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t,e){return!(t||e)}}),i1=fi.define("logic.Nand",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return!(t&&e)}}),n1=fi.define("logic.Xor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t,e){return(!t||e)&&(t||!e)}}),a1=fi.define("logic.Xnor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return(!t||!e)&&(t||e)}}),o1=le.define("logic.Wire",{attrs:{".connection":{"stroke-width":2},".marker-vertex":{r:7}},router:{name:"orthogonal"},connector:{name:"rounded",args:{radius:10}}},{arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',"</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<g class="marker-vertex-remove-group">','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>","</g>"].join("")}),s1={__proto__:null,Gate:ia,IO:Wo,Input:JA,Output:KA,Gate11:Zo,Gate21:fi,Repeater:QA,Not:$A,Or:t1,And:e1,Nor:r1,Nand:i1,Xor:n1,Xnor:a1,Wire:o1},l1=_t.define("chess.KingWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>'}),u1=_t.define("chess.KingBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),h1=_t.define("chess.QueenWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>'}),c1=_t.define("chess.QueenBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),d1=_t.define("chess.RookWhite",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),f1=_t.define("chess.RookBlack",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>'}),g1=_t.define("chess.BishopWhite",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),v1=_t.define("chess.BishopBlack",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>'}),p1=_t.define("chess.KnightWhite",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>'}),m1=_t.define("chess.KnightBlack",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>'}),y1=_t.define("chess.PawnWhite",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'}),b1=_t.define("chess.PawnBlack",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'}),w1={__proto__:null,KingWhite:l1,KingBlack:u1,QueenWhite:h1,QueenBlack:c1,RookWhite:d1,RookBlack:f1,BishopWhite:g1,BishopBlack:v1,KnightWhite:p1,KnightBlack:m1,PawnWhite:y1,PawnBlack:b1},Kf=At.define("erd.Entity",{size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),x1=Kf.define("erd.WeakEntity",{attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}}),Qf=At.define("erd.Relationship",{size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),A1=Qf.define("erd.IdentifyingRelationship",{attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}}),dn=At.define("erd.Attribute",{size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>'}),C1=dn.define("erd.Multivalued",{attrs:{".inner":{display:"block"},text:{text:"multivalued"}}}),I1=dn.define("erd.Derived",{attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}}),S1=dn.define("erd.Key",{attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}}),M1=dn.define("erd.Normal",{attrs:{text:{text:"Normal"}}}),k1=At.define("erd.ISA",{type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,"ref-x":.5,"ref-y":.3,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),P1=le.define("erd.Line",{},{cardinality:function(t){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:t}}}])}}),T1={__proto__:null,Entity:Kf,WeakEntity:x1,Relationship:Qf,IdentifyingRelationship:A1,Attribute:dn,Multivalued:C1,Derived:I1,Key:S1,Normal:M1,ISA:k1,Line:P1},N1=jo.define("fsa.State",{attrs:{circle:{"stroke-width":3},text:{"font-weight":"800"}}}),L1=At.define("fsa.StartState",{size:{width:20,height:20},attrs:{circle:{transform:"translate(10, 10)",r:10,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g></g>'}),E1=At.define("fsa.EndState",{size:{width:20,height:20},attrs:{".outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#000000"},".inner":{transform:"translate(10, 10)",r:6,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'}),D1=le.define("fsa.Arrow",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}},smooth:!0}),z1={__proto__:null,State:N1,StartState:L1,EndState:E1,Arrow:D1},B1=At.define("org.Member",{size:{width:180,height:70},attrs:{rect:{width:170,height:60},".card":{fill:"#FFFFFF",stroke:"#000000","stroke-width":2,"pointer-events":"visiblePainted",rx:10,ry:10},image:{width:48,height:48,ref:".card","ref-x":10,"ref-y":5},".rank":{"text-decoration":"underline",ref:".card","ref-x":.9,"ref-y":.2,"font-family":"Courier New","font-size":14,"text-anchor":"end"},".name":{"font-weight":"800",ref:".card","ref-x":.9,"ref-y":.6,"font-family":"Courier New","font-size":14,"text-anchor":"end"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="card"/><image/></g><text class="rank"/><text class="name"/></g>'}),O1=le.define("org.Arrow",{source:{selector:".card"},target:{selector:".card"},attrs:{".connection":{stroke:"#585858","stroke-width":3}},z:-1}),R1={__proto__:null,Member:B1,Arrow:O1},_1=_t.define("pn.Place",{size:{width:50,height:50},attrs:{".root":{r:25,fill:"#ffffff",stroke:"#000000",transform:"translate(25, 25)"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:".root",fill:"#000000","font-size":12},".tokens > circle":{fill:"#000000",r:5},".tokens.one > circle":{transform:"translate(25, 25)"},".tokens.two > circle:nth-child(1)":{transform:"translate(19, 25)"},".tokens.two > circle:nth-child(2)":{transform:"translate(31, 25)"},".tokens.three > circle:nth-child(1)":{transform:"translate(18, 29)"},".tokens.three > circle:nth-child(2)":{transform:"translate(25, 19)"},".tokens.three > circle:nth-child(3)":{transform:"translate(32, 29)"},".tokens.alot > text":{transform:"translate(25, 18)","text-anchor":"middle",fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="root"/><g class="tokens" /></g><text class="label"/></g>'}),G1=kt.extend({presentationAttributes:kt.addPresentationAttributes({tokens:["TOKENS"]}),initFlag:kt.prototype.initFlag.concat(["TOKENS"]),confirmUpdate:function(){for(var t,e=[],r=arguments.length;r--;)e[r]=arguments[r];var i=(t=kt.prototype.confirmUpdate).call.apply(t,[this].concat(e));return this.hasFlag(i,"TOKENS")&&(this.renderTokens(),this.update(),i=this.removeFlag(i,"TOKENS")),i},renderTokens:function(){var t=this.vel.findOne(".tokens").empty();["one","two","three","alot"].forEach(function(r){t.removeClass(r)});var e=this.model.get("tokens");if(!!e)switch(e){case 1:t.addClass("one"),t.append(F("circle"));break;case 2:t.addClass("two"),t.append([F("circle"),F("circle")]);break;case 3:t.addClass("three"),t.append([F("circle"),F("circle"),F("circle")]);break;default:t.addClass("alot"),t.append(F("text").text(e+""));break}}}),j1=_t.define("pn.Transition",{size:{width:12,height:50},attrs:{rect:{width:12,height:50,fill:"#000000",stroke:"#000000"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:"rect",fill:"#000000","font-size":12}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="root"/></g></g><text class="label"/>'}),F1=le.define("pn.Link",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}}),V1={__proto__:null,Place:_1,PlaceView:G1,Transition:j1,Link:F1},Yo=_t.define("uml.Class",{attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles(),this.trigger("uml-update")},this),this.updateRectangles(),_t.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var t=this.get("attrs"),e=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}],r=0;e.forEach(function(i){var n=Array.isArray(i.text)?i.text:[i.text],a=n.length*20+20;t[".uml-class-"+i.type+"-text"].text=n.join(`
`),t[".uml-class-"+i.type+"-rect"].height=a,t[".uml-class-"+i.type+"-rect"].transform="translate(0,"+r+")",r+=a})}}),Uo=kt.extend({initialize:function(){kt.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"uml-update",function(){this.update(),this.resize()})}}),W1=Yo.define("uml.Abstract",{attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},{getClassName:function(){return["<<Abstract>>",this.get("name")]}}),Z1=Uo,Y1=Yo.define("uml.Interface",{attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},{getClassName:function(){return["<<Interface>>",this.get("name")]}}),U1=Uo,X1=le.define("uml.Generalization",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}),H1=le.define("uml.Implementation",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}),q1=le.define("uml.Aggregation",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}),J1=le.define("uml.Composition",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}),K1=le.define("uml.Association"),Q1=_t.define("uml.State",{attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this),this.updateName(),this.updateEvents(),this.updatePath(),_t.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join(`
`))},updatePath:function(){var t="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",t,{silent:!0})}}),$1=jo.define("uml.StartState",{type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}}),tC=_t.define("uml.EndState",{size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'}),eC=le.define("uml.Transition",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}}),rC={__proto__:null,Class:Yo,ClassView:Uo,Abstract:W1,AbstractView:Z1,Interface:Y1,InterfaceView:U1,Generalization:X1,Implementation:H1,Aggregation:q1,Composition:J1,Association:K1,State:Q1,StartState:$1,EndState:tC,Transition:eC},iC=5,$f=["arc","gap","cubic"],nC=0,tg=1,aC=["smooth"],na=1/3,aa=2/3;function Xo(t,e,r){var i=[].concat(t,r,e);return i.reduce(function(n,a,o){var s=i[o+1];return s!=null&&(n[o]=Tr(a,s)),n},[])}function oC(t){var e=t.paper,r=e._jumpOverUpdateList;if(r==null){r=e._jumpOverUpdateList=[];var i=e.model;i.on("batch:stop",function(){this.hasActiveBatch()||sC(e)}),i.on("reset",function(){r=e._jumpOverUpdateList=[]})}r.indexOf(t)<0&&(r.push(t),t.listenToOnce(t.model,"change:connector remove",function(){r.splice(r.indexOf(t),1)}))}function sC(t){for(var e=t._jumpOverUpdateList,r=0;r<e.length;r++){var i=e[r],n=i.getFlag(i.constructor.Flags.CONNECTOR);i.requestUpdate(n)}}function lC(t,e){return lt(e).reduce(function(r,i){var n=t.intersection(i);return n&&r.push(n),r},[])}function eg(t,e){return Tr(t,e).squaredLength()}function uC(t,e,r){return e.reduce(function(i,n,a){if(n.skip===!0)return i;var o=i.pop()||t,s=Bt(n).move(o.start,-r),l=Bt(n).move(o.start,+r),u=e[a+1];if(u!=null){var g=l.distance(u);g<=r&&(l=u.move(o.start,g),u.skip=!0)}else{var h=s.distance(o.end);if(h<r*2+tg)return i.push(o),i}var y=l.distance(o.start);if(y<r*2+tg)return i.push(o),i;var x=Tr(s,l);return x.isJump=!0,i.push(Tr(o.start,s),x,Tr(l,o.end)),i},[])}function rg(t,e,r,i){var n=new rt,a;return a=rt.createSegment("M",t[0].start),n.appendSegment(a),lt(t).forEach(function(o,s){if(o.isJump){var l,u,g,h;if(r==="arc"){l=-90,u=o.start.difference(o.end);var y=Number(u.x<0||u.x===0&&u.y<0);y&&(l+=180);var x=o.midpoint(),C=new dt(x,o.end).rotate(x,l),p;p=new dt(o.start,x),g=p.pointAt(2/3).rotate(o.start,l),h=C.pointAt(1/3).rotate(C.end,-l),a=rt.createSegment("C",g,h,C.end),n.appendSegment(a),p=new dt(x,o.end),g=C.pointAt(1/3).rotate(C.end,l),h=p.pointAt(1/3).rotate(o.end,-l),a=rt.createSegment("C",g,h,o.end),n.appendSegment(a)}else if(r==="gap")a=rt.createSegment("M",o.end),n.appendSegment(a);else if(r==="cubic"){l=o.start.theta(o.end);var E=e*.6,k=e*1.35;u=o.start.difference(o.end),y=Number(u.x<0||u.x===0&&u.y<0),y&&(k*=-1),g=Z(o.start.x+E,o.start.y+k).rotate(o.start,l),h=Z(o.end.x-E,o.end.y+k).rotate(o.end,l),a=rt.createSegment("C",g,h,o.end),n.appendSegment(a)}}else{var w=t[s+1];i==0||!w||w.isJump?(a=rt.createSegment("L",o.end),n.appendSegment(a)):hC(i,n,o.end,o.start,w.end)}}),n}function hC(t,e,r,i,n){var a=r.distance(i)/2,o=r.distance(n)/2,s=-Math.min(t,a),l=-Math.min(t,o),u=r.clone().move(i,s).round(),g=r.clone().move(n,l).round(),h=new Z(na*u.x+aa*r.x,aa*r.y+na*u.y),y=new Z(na*g.x+aa*r.x,aa*r.y+na*g.y),x;x=rt.createSegment("L",u),e.appendSegment(x),x=rt.createSegment("C",h,y,g),e.appendSegment(x)}var cC=function(t,e,r,i){oC(this);var n=i.raw,a=i.size||iC,o=i.jump&&(""+i.jump).toLowerCase(),s=i.radius||nC,l=i.ignoreConnectors||aC;$f.indexOf(o)===-1&&(o=$f[0]);var u=this.paper,g=u.model,h=g.getLinks();if(h.length===1)return rg(Xo(t,e,r),a,o,s);var y=this.model,x=h.indexOf(y),C=u.options.defaultConnector||{},p=h.filter(function(m,A){var M=m.get("connector")||C;return lt(l).includes(M.name)?!1:A>x?M.name!=="jumpover":!0}),E=p.map(function(m){return u.findViewByModel(m)}),k=Xo(t,e,r),w=E.map(function(m){return m==null?[]:m===this?k:Xo(m.sourcePoint,m.targetPoint,m.route)},this),S=k.reduce(function(m,A){var M=p.reduce(function(N,D,z){if(D!==y){var _=lC(A,w[z]);N.push.apply(N,_)}return N},[]).sort(function(N,D){return eg(A.start,N)-eg(A.start,D)});return M.length>0?m.push.apply(m,uC(A,M,a)):m.push(A),m},[]),T=rg(S,a,o,s);return n?T:T.serialize()},dC=function(t,e,r,i){var n=i&&i.raw,a=[t].concat(r).concat([e]),o=new Qt(a),s=new rt(o);return n?s:s.serialize()},ig=function(t,e,r,i){i||(i={});var n=i.radius||10,a=i.raw,o=new rt,s;s=rt.createSegment("M",t),o.appendSegment(s);for(var l=1/3,u=2/3,g,h,y,x,C,p,E,k,w,S,T,m=0,A=r.length;m<A;m++)g=new Z(r[m]),h=r[m-1]||t,y=r[m+1]||e,x=C||g.distance(h)/2,C=g.distance(y)/2,p=-Math.min(n,x),E=-Math.min(n,C),k=g.clone().move(h,p).round(),w=g.clone().move(y,E).round(),S=new Z(l*k.x+u*g.x,u*g.y+l*k.y),T=new Z(l*w.x+u*g.x,u*g.y+l*w.y),s=rt.createSegment("L",k),o.appendSegment(s),s=rt.createSegment("C",S,T,w),o.appendSegment(s);return s=rt.createSegment("L",e),o.appendSegment(s),a?o:o.serialize()},fC=function(t,e,r,i){var n=i&&i.raw,a;if(r&&r.length!==0){var o=[t].concat(r).concat([e]),s=Zt.throughPoints(o);a=new rt(s)}else{a=new rt;var l;if(l=rt.createSegment("M",t),a.appendSegment(l),Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)){var u=(t.x+e.x)/2;l=rt.createSegment("C",u,t.y,u,e.y,e.x,e.y),a.appendSegment(l)}else{var g=(t.y+e.y)/2;l=rt.createSegment("C",t.x,g,e.x,g,e.x,e.y),a.appendSegment(l)}}return n?a:a.serialize()},dr={AUTO:"auto",HORIZONTAL:"horizontal",VERTICAL:"vertical",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},Xe={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",AUTO:"auto",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},Ho=function(t,e,r,i,n){r===void 0&&(r=[]),i===void 0&&(i={});var a=Boolean(i.raw),o=i.direction;o===void 0&&(o=dr.AUTO);var s=i.precision;s===void 0&&(s=3);var l={coeff:i.distanceCoefficient||.6,angleTangentCoefficient:i.angleTangentCoefficient||80,tau:i.tension||.5,sourceTangent:i.sourceTangent?new Z(i.sourceTangent):null,targetTangent:i.targetTangent?new Z(i.targetTangent):null,rotate:Boolean(i.rotate)};typeof i.sourceDirection=="string"?l.sourceDirection=i.sourceDirection:typeof i.sourceDirection=="number"?l.sourceDirection=new Z(1,0).rotate(null,i.sourceDirection):l.sourceDirection=i.sourceDirection?new Z(i.sourceDirection).normalize():null,typeof i.targetDirection=="string"?l.targetDirection=i.targetDirection:typeof i.targetDirection=="number"?l.targetDirection=new Z(1,0).rotate(null,i.targetDirection):l.targetDirection=i.targetDirection?new Z(i.targetDirection).normalize():null;var u=[t].concat(r.map(function(z){return new Z(z)}),[e]),g;if(l.sourceTangent)g=l.sourceTangent;else{var h=yC(n,u,o,l),y=u[0].distance(u[1])*l.coeff,x=u[1].difference(u[0]).normalize(),C=qo(h,x);if(C>Math.PI/4){var p=y+(C-Math.PI/4)*l.angleTangentCoefficient;g=h.clone().scale(p,p)}else g=h.clone().scale(y,y)}var E;if(l.targetTangent)E=l.targetTangent;else{var k=bC(n,u,o,l),w=u.length-1,S=u[w-1].distance(u[w])*l.coeff,T=u[w-1].difference(u[w]).normalize(),m=qo(k,T);if(m>Math.PI/4){var A=S+(m-Math.PI/4)*l.angleTangentCoefficient;E=k.clone().scale(A,A)}else E=k.clone().scale(S,S)}var M=xC(u,g,E,l),N=M.map(function(z){return AC(z,l)}),D=new rt(N).round(s);return a?D:D.serialize()};Ho.Directions=dr,Ho.TangentDirections=Xe;function gC(t,e,r){var i=t.sourceBBox,n,a;if(!t.sourceView)i.x>e[1].x?n="right":n="left";else if(a=t.sourceView.model.angle(),r.rotate&&a){var o=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),s=e[0].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[0]);var l;switch(n){case"left":l=new Z(-1,0);break;case"right":default:l=new Z(1,0);break}return r.rotate&&a&&l.rotate(null,-a),l}function vC(t,e,r){var i=t.targetBBox,n,a;if(!t.targetView)i.x>e[e.length-2].x?n="left":n="right";else if(a=t.targetView.model.angle(),r.rotate&&a){var o=t.targetView.getNodeUnrotatedBBox(t.targetView.el),s=e[e.length-1].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[e.length-1]);var l;switch(n){case"left":l=new Z(-1,0);break;case"right":default:l=new Z(1,0);break}return r.rotate&&a&&l.rotate(null,-a),l}function pC(t,e,r){var i=t.sourceBBox,n,a;if(!t.sourceView)i.y>e[1].y?n="bottom":n="top";else if(a=t.sourceView.model.angle(),r.rotate&&a){var o=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),s=e[0].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[0]);var l;switch(n){case"top":l=new Z(0,-1);break;case"bottom":default:l=new Z(0,1);break}return r.rotate&&a&&l.rotate(null,-a),l}function mC(t,e,r){var i=t.targetBBox,n,a;if(!t.targetView)i.y>e[e.length-2].y?n="top":n="bottom";else if(a=t.targetView.model.angle(),r.rotate&&a){var o=t.targetView.getNodeUnrotatedBBox(t.targetView.el),s=e[e.length-1].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[e.length-1]);var l;switch(n){case"top":l=new Z(0,-1);break;case"bottom":default:l=new Z(0,1);break}return r.rotate&&a&&l.rotate(null,-a),l}function ng(t,e,r){var i=t.sourceBBox,n,a;if(!t.sourceView)n=i.sideNearestToPoint(e[1]);else if(a=t.sourceView.model.angle(),r.rotate&&a){var o=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),s=e[0].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[0]);var l;switch(n){case"top":l=new Z(0,-1);break;case"bottom":l=new Z(0,1);break;case"right":l=new Z(1,0);break;case"left":l=new Z(-1,0);break}return r.rotate&&a&&l.rotate(null,-a),l}function ag(t,e,r){var i=t.targetBBox,n,a;if(!t.targetView)n=i.sideNearestToPoint(e[e.length-2]);else if(a=t.targetView.model.angle(),r.rotate&&a){var o=t.targetView.getNodeUnrotatedBBox(t.targetView.el),s=e[e.length-1].clone();s.rotate(i.center(),a),n=o.sideNearestToPoint(s)}else n=i.sideNearestToPoint(e[e.length-1]);var l;switch(n){case"top":l=new Z(0,-1);break;case"bottom":l=new Z(0,1);break;case"right":l=new Z(1,0);break;case"left":l=new Z(-1,0);break}return r.rotate&&a&&l.rotate(null,-a),l}function og(t,e,r){return e[1].difference(e[0]).normalize()}function sg(t,e,r){var i=e.length-1;return e[i-1].difference(e[i]).normalize()}function lg(t,e,r){var i=t.sourceBBox,n=i.center();return e[0].difference(n).normalize()}function ug(t,e,r){var i=t.targetBBox,n=i.center();return e[e.length-1].difference(n).normalize()}function yC(t,e,r,i){if(i.sourceDirection)switch(i.sourceDirection){case Xe.UP:return new Z(0,-1);case Xe.DOWN:return new Z(0,1);case Xe.LEFT:return new Z(-1,0);case Xe.RIGHT:return new Z(1,0);case Xe.AUTO:return ng(t,e,i);case Xe.CLOSEST_POINT:return og(t,e);case Xe.OUTWARDS:return lg(t,e);default:return i.sourceDirection}switch(r){case dr.HORIZONTAL:return gC(t,e,i);case dr.VERTICAL:return pC(t,e,i);case dr.CLOSEST_POINT:return og(t,e);case dr.OUTWARDS:return lg(t,e);case dr.AUTO:default:return ng(t,e,i)}}function bC(t,e,r,i){if(i.targetDirection)switch(i.targetDirection){case Xe.UP:return new Z(0,-1);case Xe.DOWN:return new Z(0,1);case Xe.LEFT:return new Z(-1,0);case Xe.RIGHT:return new Z(0,1);case Xe.AUTO:return ag(t,e,i);case Xe.CLOSEST_POINT:return sg(t,e);case Xe.OUTWARDS:return ug(t,e);default:return i.targetDirection}switch(r){case dr.HORIZONTAL:return vC(t,e,i);case dr.VERTICAL:return mC(t,e,i);case dr.CLOSEST_POINT:return sg(t,e);case dr.OUTWARDS:return ug(t,e);case dr.AUTO:default:return ag(t,e,i)}}function wC(t,e){var r=Math.cos(e),i=Math.sin(e),n=r*t.x-i*t.y,a=i*t.x+r*t.y;t.x=n,t.y=a}function qo(t,e){var r=t.dot(e)/(t.magnitude()*e.magnitude());return r<-1&&(r=-1),r>1&&(r=1),Math.acos(r)}function hg(t,e){return t.x*e.y-t.y*e.x}function xC(t,e,r,i){for(var n=i.tau,a=i.coeff,o=[],s=[],l=[],u=t.length-1,g=0;g<u;g++)o[g]=t[g].distance(t[g+1]);s[0]=e,s[u]=r;for(var h=1;h<u;h++){var y=void 0,x=void 0;h===1?y=t[h-1].clone().offset(s[h-1].x,s[h-1].y):y=t[h-1].clone(),h===u-1?x=t[h+1].clone().offset(s[h+1].x,s[h+1].y):x=t[h+1].clone();var C=y.difference(t[h]).normalize(),p=x.difference(t[h]).normalize(),E=qo(C,p),k=(Math.PI-E)/2,w=void 0,S=hg(C,p),T=void 0;T=hg(t[h].difference(t[h+1]),t[h].difference(t[h-1])),S<0&&(k=-k),E<Math.PI/2&&(k<0&&T<0||k>0&&T>0)&&(k=k-Math.PI),w=p.clone(),wC(w,k);var m=w.clone(),A=w.clone(),M=o[h-1]*a,N=o[h]*a;m.scale(M,M),A.scale(N,N),s[h]=[m,A]}for(var D=0;D<u;D++){var z=void 0,_=void 0;D===0?z=t[D+1].difference(s[D].x/n,s[D].y/n):z=t[D+1].difference(s[D][1].x/n,s[D][1].y/n),D===u-1?_=t[D].clone().offset(s[D+1].x/n,s[D+1].y/n):_=t[D].difference(s[D+1][0].x/n,s[D+1][0].y/n),l[D]=[z,t[D],t[D+1],_]}return l}function AC(t,e){var r=e.tau,i=new Z;i.x=t[1].x+(t[2].x-t[0].x)/(6*r),i.y=t[1].y+(t[2].y-t[0].y)/(6*r);var n=new Z;return n.x=t[2].x+(t[3].x-t[1].x)/(6*r),n.y=t[2].y+(t[3].y-t[1].y)/(6*r),new Zt(t[1],i,n,t[2])}var cg={__proto__:null,jumpover:cC,normal:dC,rounded:ig,smooth:fC,curve:Ho},CC=Cr.extend({tagName:"path",className:"highlight-stroke",attributes:{"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"},options:{padding:3,rx:0,ry:0,useFirstSubpath:!1,attrs:{"stroke-width":3,stroke:"#FEB663"}},getPathData:function(e,r){var i=this,n=i.options,a=n.useFirstSubpath,o;try{var s=F(r);if(o=s.convertToPathData().trim(),s.tagName()==="PATH"&&a){var l=o.search(/.M/i)+1;l>0&&(o=o.substr(0,l))}}catch{var u=e.getNodeBoundingRect(r);o=F.rectToPath(tt({},n,u.toJSON()))}return o},highlightConnection:function(e){this.vel.attr("d",e.getSerializedConnection())},highlightNode:function(e,r){var i=this,n=i.vel,a=i.options,o=a.padding,s=a.layer,l=this.getNodeMatrix(e,r);if(o){!s&&r===e.el&&n.remove();var u=e.getNodeBoundingRect(r),g=u.x+u.width/2,h=u.y+u.height/2;u=F.transformRect(u,l);var y=Math.max(u.width,1),x=Math.max(u.height,1),C=(y+o)/y,p=(x+o)/x,E=F.createSVGMatrix({a:C,b:0,c:0,d:p,e:g-C*g,f:h-p*h});l=l.multiply(E)}n.attr({d:this.getPathData(e,r),transform:F.matrixToTransformString(l)})},highlight:function(e,r){var i=this,n=i.vel,a=i.options;n.attr(a.attrs),e.isNodeConnection(r)?this.highlightConnection(e):this.highlightNode(e,r)}}),dg=20;function IC(t,e){for(var r=t.children();r.length>0;){var i=r.shift();e(i)&&r.push.apply(r,i.children())}}var SC=Cr.extend({tagName:"rect",className:"highlight-mask",attributes:{"pointer-events":"none"},options:{padding:3,maskClip:dg,deep:!1,attrs:{stroke:"#FEB663","stroke-width":3,"stroke-linecap":"butt","stroke-linejoin":"miter"}},VISIBLE:"white",INVISIBLE:"black",MASK_ROOT_ATTRIBUTE_BLACKLIST:["marker-start","marker-end","marker-mid","transform","stroke-dasharray"],MASK_CHILD_ATTRIBUTE_BLACKLIST:["stroke","fill","stroke-width","stroke-opacity","stroke-dasharray","fill-opacity","marker-start","marker-end","marker-mid"],MASK_REPLACE_TAGS:["FOREIGNOBJECT","IMAGE","USE","TEXT","TSPAN","TEXTPATH"],MASK_REMOVE_TAGS:["TEXT","TSPAN","TEXTPATH"],transformMaskChild:function(e,r){var i=this,n=i.MASK_CHILD_ATTRIBUTE_BLACKLIST,a=i.MASK_REPLACE_TAGS,o=i.MASK_REMOVE_TAGS,s=r.tagName();if(!F.isSVGGraphicsElement(r)||o.includes(s))return r.remove(),!1;if(a.includes(s)){var l=e.vel.findOne("#"+r.id);if(l){var u=l.node,g=e.getNodeBoundingRect(u);e.model.isElement()&&(g=F.transformRect(g,e.getNodeMatrix(u)));var h=F("rect",g.toJSON()),y=g.center(),x=y.x,C=y.y,p=l.rotate(),E=p.angle,k=p.cx;k===void 0&&(k=x);var w=p.cy;w===void 0&&(w=C),E&&h.rotate(E,k,w),r.parent().append(h)}return r.remove(),!1}return n.forEach(function(S){S==="fill"&&r.attr("fill")==="none"||r.removeAttr(S)}),!0},transformMaskRoot:function(e,r){var i=this,n=i.MASK_ROOT_ATTRIBUTE_BLACKLIST;n.forEach(function(a){r.removeAttr(a)})},getMaskShape:function(e,r){var i=this,n=this,a=n.options,o=n.MASK_REPLACE_TAGS,s=a.deep,l=r.tagName(),u;if(l==="G"){if(!s)return null;u=r.clone(),IC(u,function(g){return i.transformMaskChild(e,g)})}else{if(o.includes(l))return null;u=r.clone()}return this.transformMaskRoot(e,u),u},getMaskId:function(){return"highlight-mask-"+this.cid},getMask:function(e,r){var i=this,n=i.VISIBLE,a=i.INVISIBLE,o=i.options,s=o.padding,l=o.attrs,u="stroke-width"in l?l["stroke-width"]:1,g=r.attr("fill")!=="none",h=parseFloat(r.attr("stroke-width"));isNaN(h)&&(h=1);var y=h+s*2,x=y+u*2,C=this.getMaskShape(e,r);if(!C){var p=e.getNodeBoundingRect(r.node);p.inflate(p.width?0:.5,p.height?0:.5),C=F("rect",p.toJSON())}return C.attr(l),F("mask",{id:this.getMaskId()}).append([C.clone().attr({fill:g?n:"none",stroke:n,"stroke-width":x}),C.clone().attr({fill:g?a:"none",stroke:a,"stroke-width":y})])},removeMask:function(e){var r=e.svg.getElementById(this.getMaskId());r&&e.defs.removeChild(r)},addMask:function(e,r){e.defs.appendChild(r.node)},highlight:function(e,r){var i=this,n=i.options,a=i.vel,o=n.padding,s=n.attrs,l=n.maskClip;l===void 0&&(l=dg);var u=n.layer,g="stroke"in s?s.stroke:"#000000";!u&&r===e.el&&a.remove();var h=e.getNodeBoundingRect(r).inflate(o+l),y=this.getNodeMatrix(e,r),x=this.getMask(e,F(r));this.addMask(e.paper,x),a.attr(h.toJSON()),a.attr({transform:F.matrixToTransformString(y),mask:"url(#"+x.id+")",fill:g})},unhighlight:function(e){this.removeMask(e.paper)}}),MC=Cr.extend({UPDATABLE:!1,MOUNTABLE:!1,opacityClassName:Ze("highlight-opacity"),highlight:function(t,e){F(e).addClass(this.opacityClassName)},unhighlight:function(t,e){F(e).removeClass(this.opacityClassName)}}),fg=Ze("highlighted"),kC=Cr.extend({UPDATABLE:!1,MOUNTABLE:!1,options:{className:fg},highlight:function(t,e){F(e).addClass(this.options.className)},unhighlight:function(t,e){F(e).removeClass(this.options.className)}},{className:fg}),Jo={ROW:"row",COLUMN:"column"},PC=Cr.extend({tagName:"g",MOUNTABLE:!0,UPDATE_ATTRIBUTES:function(){return[this.options.attribute]},_prevItems:null,highlight:function(e,r){var i=this,n=e.model,a=this.options,o=a.attribute,s=a.size;s===void 0&&(s=20);var l=a.gap;l===void 0&&(l=5);var u=a.direction;if(u===void 0&&(u=Jo.ROW),!o)throw new Error("List: attribute is required");var g=typeof s=="number"?{width:s,height:s}:s,h=u===Jo.ROW,y=h?g.width:g.height,x=n.get(o);Array.isArray(x)||(x=[]);var C=this._prevItems||[],p=x.map(function(m,A){return ze(C[A],x[A])});if(C.length!==x.length||p.some(function(m){return!m})){var E=this.vel.children(),k=x.map(function(m,A){var M=A in E?E[A].node:null;if(p[A])return M;var N=i.createListItem(m,g,M);if(!N)return null;if(!(N instanceof SVGElement))throw new Error("List: item must be an SVGElement");N.dataset.index=A,N.dataset.attribute=o;var D=A*(y+l);return N.setAttribute("transform",h?"translate("+D+", 0)":"translate(0, "+D+")"),N});this.vel.empty().append(k),this._prevItems=x}var w=x.length,S=w===0?0:w*y+(w-1)*l,T=h?{width:S,height:g.height}:{width:g.width,height:S};this.position(n,T)},position:function(e,r){var i=this,n=i.vel,a=i.options,o=a.margin;o===void 0&&(o=5);var s=a.position;s===void 0&&(s="top-left");var l=e.size(),u=l.width,g=l.height,h=he(o),y=h.left,x=h.right,C=h.top,p=h.bottom,E=new at(y,C,u-(y+x),g-(C+p)),k=di(E,s),w=k.x,S=k.y;switch(s){case we.CENTER:case we.TOP:case we.BOTTOM:{w-=r.width/2;break}case we.RIGHT:case we.BOTTOM_RIGHT:case we.TOP_RIGHT:{w-=r.width;break}}switch(s){case we.CENTER:case we.RIGHT:case we.LEFT:{S-=r.height/2;break}case we.BOTTOM:case we.BOTTOM_RIGHT:case we.BOTTOM_LEFT:{S-=r.height;break}}n.attr("transform","translate("+w+", "+S+")")}},{Directions:Jo,Positions:we}),gg={__proto__:null,stroke:CC,mask:SC,opacity:MC,addClass:kC,list:PC};function oa(t,e,r){if(fe(r)){var i=r.x,n=r.y;if(isFinite(n)){var a=new dt(e,t),o=a.parallel(n),s=o.start,l=o.end;e=s,t=l}r=i}if(!isFinite(r))return t;var u=t.distance(e);return r===0&&u>0?t:t.move(e,-Math.min(r,u-1))}function Ko(t){var e=t.getAttribute("stroke-width");return e===null?0:parseFloat(e)||0}function TC(t,e,r){r===void 0&&(r=0);var i,n,a,o,s=t.start,l=t.end;switch(e){case"left":i="x",n=l,a=s,o=-1;break;case"right":i="x",n=s,a=l,o=1;break;case"top":i="y",n=l,a=s,o=-1;break;case"bottom":i="y",n=s,a=l,o=1;break;default:return}s[i]<l[i]?n[i]=a[i]:a[i]=n[i],isFinite(r)&&(n[i]+=o*r,a[i]+=o*r)}function NC(t,e,r,i){var n=i.offset,a=i.alignOffset,o=i.align;return o&&TC(t,o,a),oa(t.end,t.start,n)}function vg(t,e,r,i){var n=e.getNodeBBox(r);i.stroke&&n.inflate(Ko(r)/2);var a=t.intersect(n),o=a?t.start.chooseClosest(a):t.end;return oa(o,t.start,i.offset)}function LC(t,e,r,i){var n=e.model.angle();if(n===0)return vg(t,e,r,i);var a=e.getNodeUnrotatedBBox(r);i.stroke&&a.inflate(Ko(r)/2);var o=a.center(),s=t.clone().rotate(o,n),l=s.setLength(1e6).intersect(a),u=l?s.start.chooseClosest(l).rotate(o,-n):t.end;return oa(u,t.start,i.offset)}function EC(t){if(!t)return null;var e=t;do{var r=e.tagName;if(typeof r!="string")return null;if(r=r.toUpperCase(),r==="G")e=e.firstElementChild;else if(r==="TITLE")e=e.nextElementSibling;else break}while(e);return e}var Qo="segmentSubdivisons",$o="shapeBBox";function DC(t,e,r,i){var n,a,o=i.selector,s=t.end;if(typeof o=="string"?n=e.findBySelector(o)[0]:Array.isArray(o)?n=Ye(r,o):n=EC(r),!F.isSVGGraphicsElement(n)){if(n===r||!F.isSVGGraphicsElement(r))return s;n=r}var l=e.getNodeShape(n),u=e.getNodeMatrix(n),g=e.getRootTranslateMatrix(),h=e.getRootRotateMatrix(),y=g.multiply(h).multiply(u),x=y.inverse(),C=F.transformLine(t,x),p=C.start.clone(),E=e.getNodeData(n);if(i.insideout===!1){E[$o]||(E[$o]=l.bbox());var k=E[$o];if(k.containsPoint(p))return s}var w;if(l instanceof rt){var S=i.precision||2;E[Qo]||(E[Qo]=l.getSegmentSubdivisions({precision:S})),w={precision:S,segmentSubdivisions:E[Qo]}}i.extrapolate===!0&&C.setLength(1e6),a=C.intersect(l,w),a?F.isArray(a)&&(a=p.chooseClosest(a)):i.sticky===!0&&(l instanceof at?a=l.pointNearestToPoint(p):l instanceof Re?a=l.intersectionWithLineFromCenterToPoint(p):a=l.closestPoint(p,w));var T=a?F.transformPoint(a,y):s,m=i.offset||0;return i.stroke&&(m+=Ko(n)/2),oa(T,t.start,m)}var zC=NC,BC=vg,OC=LC,RC=DC,pg={__proto__:null,anchor:zC,bbox:BC,rectangle:OC,boundary:RC};function mg(t,e){if(e===0)return"0%";var r=1e3,i=Math.round(t/e*100*r)/r;return i+"%"}function yg(t){return function(e,r,i,n){var a=r.isNodeConnection(i)?GC:_C;return a(t,e,r,i,n)}}function _C(t,e,r,i,n){var a=r.model.angle(),o=r.getNodeUnrotatedBBox(i),s=r.model.getBBox().center();n.rotate(s,a);var l=n.x-o.x,u=n.y-o.y;return t&&(l=mg(l,o.width),u=mg(u,o.height)),e.anchor={name:"topLeft",args:{dx:l,dy:u,rotate:!0}},e}function GC(t,e,r,i,n){var a=r.getConnection();if(!a)return e;var o=a.closestPointLength(n);if(t){var s=a.length();e.anchor={name:"connectionRatio",args:{ratio:o/s}}}else e.anchor={name:"connectionLength",args:{length:o}};return e}var jC=Xr,FC=yg(!1),bg=yg(!0),VC={__proto__:null,useDefaults:jC,pinAbsolute:FC,pinRelative:bg},WC=function(t,e,r){return t},ZC=function(t,e,r){var i=e.side||"bottom",n=he(e.padding||40),a=r.sourceBBox,o=r.targetBBox,s=a.center(),l=o.center(),u,g,h;switch(i){case"bottom":h=1,u="y",g="height";break;case"top":h=-1,u="y",g="height";break;case"left":h=-1,u="x",g="width";break;case"right":h=1,u="x",g="width";break;default:throw new Error("Router: invalid side")}return s[u]+=h*(a[g]/2+n[i]),l[u]+=h*(o[g]/2+n[i]),h*(s[u]-l[u])>0?l[u]=s[u]:s[u]=l[u],[s].concat(t,l)},YC={N:"S",S:"N",E:"W",W:"E"},UC={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function sa(t,e,r){var i=new Z(t.x,e.y);return r.containsPoint(i)&&(i=new Z(e.x,t.y)),i}function ts(t,e){return t[e==="W"||e==="E"?"width":"height"]}function He(t,e){return t.x===e.x?t.y>e.y?"N":"S":t.y===e.y?t.x>e.x?"W":"E":null}function la(t){return new at(t.x,t.y,0,0)}function ua(t){var e=he(t.padding||t.elementPadding||20);return{x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}function wg(t,e){return t.sourceBBox.clone().moveAndExpand(ua(e))}function xg(t,e){return t.targetBBox.clone().moveAndExpand(ua(e))}function XC(t,e){if(t.sourceAnchor)return t.sourceAnchor;var r=wg(t,e);return r.center()}function HC(t,e){if(t.targetAnchor)return t.targetAnchor;var r=xg(t,e);return r.center()}function Ag(t,e,r){var i=new Z(t.x,e.y),n=new Z(e.x,t.y),a=He(t,i),o=He(t,n),s=YC[r],l=a===r||a!==s&&(o===s||o!==r)?i:n;return{points:[l],direction:He(l,e)}}function ha(t,e,r){var i=sa(t,e,r);return{points:[i],direction:He(i,e)}}function qC(t,e,r,i){var n={},a=[new Z(t.x,e.y),new Z(e.x,t.y)],o=a.filter(function(h){return!r.containsPoint(h)}),s=o.filter(function(h){return He(h,t)!==i}),l;if(s.length>0)l=s.filter(function(h){return He(t,h)===i}).pop(),l=l||s[0],n.points=[l],n.direction=He(l,e);else{l=No(a,o)[0];var u=new Z(e).move(l,-ts(r,i)/2),g=sa(u,t,r);n.points=[g,u],n.direction=He(u,e)}return n}function JC(t,e,r,i){var n=ha(e,t,i),a=n.points[0];if(r.containsPoint(a)){n=ha(t,e,r);var o=n.points[0];if(i.containsPoint(o)){var s=new Z(t).move(o,-ts(r,He(t,o))/2),l=new Z(e).move(a,-ts(i,He(e,a))/2),u=new dt(s,l).midpoint(),g=ha(t,u,r),h=Ag(u,e,g.direction);n.points=[g.points[0],h.points[0]],n.direction=h.direction}}return n}function es(t,e,r,i,n){var a={},o=r.union(i).inflate(1),s=o.center().distance(e)>o.center().distance(t),l=s?e:t,u=s?t:e,g,h,y;return n?(g=Z.fromPolar(o.width+o.height,UC[n],l),g=o.pointNearestToPoint(g).move(g,-1)):g=o.pointNearestToPoint(l).move(l,1),h=sa(g,u,o),g.round().equals(h.round())?(h=Z.fromPolar(o.width+o.height,bt(g.theta(l))+Math.PI/2,u),h=o.pointNearestToPoint(h).move(u,1).round(),y=sa(g,h,o),a.points=s?[h,y,g]:[g,y,h]):a.points=s?[h,g]:[g,h],a.direction=He(s?g:h,e),a}function rs(t,e,r){var i=wg(r,e),n=xg(r,e),a=XC(r,e),o=HC(r,e);i=i.union(la(a)),n=n.union(la(o)),t=lt(t).map(Z),t.unshift(a),t.push(o);for(var s,l=[],u=0,g=t.length-1;u<g;u++){var h=null,y=t[u],x=t[u+1],C=!!He(y,x);if(u===0)u+1===g?i.intersect(n.clone().inflate(1))?h=es(y,x,i,n):C||(h=JC(y,x,i,n)):i.containsPoint(x)?h=es(y,x,i,la(x).moveAndExpand(ua(e))):C||(h=ha(y,x,i));else if(u+1===g){var p=C&&He(x,y)===s;n.containsPoint(y)||p?h=es(y,x,la(y).moveAndExpand(ua(e)),n,s):C||(h=qC(y,x,n,s))}else C||(h=Ag(y,x,s));h?(Array.prototype.push.apply(l,h.points),s=h.direction):s=He(y,x),u+1<g&&l.push(x)}return l}var Cg={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:!0,excludeEnds:[],excludeTypes:["basic.Text"],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var t=this.step,e=this.cost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:-t,offsetY:0,cost:e},{offsetX:0,offsetY:t,cost:e},{offsetX:0,offsetY:-t,cost:e}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var t=this.step;return{x:-t,y:-t,width:2*t,height:2*t}},isPointObstacle:null,fallbackRouter:function(t,e,r){if(!yt(rs))throw new Error("Manhattan requires the orthogonal router as default fallback.");return rs(t,tt({},Cg,e),r)},fallbackRoute:function(t,e,r){return null},draggingRoute:null};function is(t){this.map={},this.options=t,this.mapGridSize=100}is.prototype.build=function(t,e){var r=this.options,i=lt(r.excludeEnds).reduce(function(l,u){var g=e.get(u);if(g){var h=t.getCell(g.id);h&&l.push(h)}return l},[]),n=[],a=t.getCell(e.get("source").id);a&&(n=Kn(n,a.getAncestors().map(function(l){return l.id})));var o=t.getCell(e.get("target").id);o&&(n=Kn(n,o.getAncestors().map(function(l){return l.id})));var s=this.mapGridSize;return t.getElements().reduce(function(l,u){var g=lt(r.excludeTypes).includes(u.get("type")),h=i.find(function(T){return T.id===u.id}),y=n.includes(u.id),x=g||h||y;if(!x)for(var C=u.getBBox().moveAndExpand(r.paddingBox),p=C.origin().snapToGrid(s),E=C.corner().snapToGrid(s),k=p.x;k<=E.x;k+=s)for(var w=p.y;w<=E.y;w+=s){var S=k+"@"+w;l[S]=l[S]||[],l[S].push(C)}return l},this.map),this},is.prototype.isPointAccessible=function(t){var e=t.clone().snapToGrid(this.mapGridSize).toString();return lt(this.map[e]).every(function(r){return!r.containsPoint(t)})};function gi(){this.items=[],this.hash={},this.values={},this.OPEN=1,this.CLOSE=2}gi.prototype.add=function(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=this.OPEN,this.values[t]=e;var r=Jn(this.items,t,function(i){return this.values[i]}.bind(this));this.items.splice(r,0,t)},gi.prototype.remove=function(t){this.hash[t]=this.CLOSE},gi.prototype.isOpen=function(t){return this.hash[t]===this.OPEN},gi.prototype.isClose=function(t){return this.hash[t]===this.CLOSE},gi.prototype.isEmpty=function(){return this.items.length===0},gi.prototype.pop=function(){var t=this.items.shift();return this.remove(t),t};function Ig(t,e){return e&&e.paddingBox?t.sourceBBox.clone().moveAndExpand(e.paddingBox):t.sourceBBox.clone()}function Sg(t,e){return e&&e.paddingBox?t.targetBBox.clone().moveAndExpand(e.paddingBox):t.targetBBox.clone()}function Mg(t,e){if(t.sourceAnchor)return t.sourceAnchor;var r=Ig(t,e);return r.center()}function KC(t,e){if(t.targetAnchor)return t.targetAnchor;var r=Sg(t,e);return r.center()}function ns(t,e,r,i,n){var a=360/r,o=t.theta(QC(t,e,i,n)),s=et(o+a/2);return a*Math.floor(s/a)}function QC(t,e,r,i){var n=i.step,a=e.x-t.x,o=e.y-t.y,s=a/r.x,l=o/r.y,u=s*n,g=l*n;return new Z(t.x+u,t.y+g)}function kg(t,e){var r=Math.abs(t-e);return r>180?360-r:r}function $C(t,e,r){var i=r.step;lt(r.directions).forEach(function(n){n.gridOffsetX=n.offsetX/i*e.x,n.gridOffsetY=n.offsetY/i*e.y})}function tI(t,e,r){return{source:e.clone(),x:Pg(r.x-e.x,t),y:Pg(r.y-e.y,t)}}function Pg(t,e){if(!t)return e;var r=Math.abs(t),i=Math.round(r/e);if(!i)return r;var n=i*e,a=r-n,o=a/i;return e+o}function eI(t,e){var r=e.source,i=ht(t.x-r.x,e.x)+r.x,n=ht(t.y-r.y,e.y)+r.y;return new Z(i,n)}function fn(t,e){return t.round(e)}function ca(t,e,r){return fn(eI(t.clone(),e),r)}function gn(t){return t.clone().toString()}function as(t){return new Z(t.x===0?0:Math.abs(t.x)/t.x,t.y===0?0:Math.abs(t.y)/t.y)}function rI(t,e,r,i,n,a,o){for(var s=[],l=as(n.difference(r)),u=gn(r),g=t[u],h;g;){h=e[u];var y=as(h.difference(g));y.equals(l)||(s.unshift(h),l=y),u=gn(g),g=t[u]}var x=e[u],C=as(x.difference(i));return C.equals(l)||s.unshift(x),s}function Tg(t,e){for(var r=1/0,i=0,n=e.length;i<n;i++){var a=t.manhattanDistance(e[i]);a<r&&(r=a)}return r}function Ng(t,e,r,i,n){var a=n.precision,o=n.directionMap,s=t.difference(e.center()),l=Yt(o)?Object.keys(o):[],u=lt(r),g=l.reduce(function(h,y){if(u.includes(y)){for(var x=o[y],C=new Z(t.x+x.x*(Math.abs(s.x)+e.width),t.y+x.y*(Math.abs(s.y)+e.height)),p=new dt(t,C),E=p.intersect(e)||[],k=E.length,w,S=null,T=0;T<k;T++){var m=E[T],A=t.squaredDistance(m);(w===void 0||A>w)&&(w=A,S=m)}if(S){var M=ca(S,i,a);e.containsPoint(M)&&(M=ca(M.offset(x.x*i.x,x.y*i.y),i,a)),h.push(M)}}return h},[]);return e.containsPoint(t)||g.push(ca(t,i,a)),g}function iI(t,e,r,i){var n=i.precision,a,o;t instanceof at?a=fn(Mg(this,i).clone(),n):a=fn(t.clone(),n),e instanceof at?o=fn(KC(this,i).clone(),n):o=fn(e.clone(),n);var s=tI(i.step,a,o),l,u,g,h;if(t instanceof at?(l=a,g=Ng(l,t,i.startDirections,s,i)):(l=a,g=[l]),e instanceof at?(u=o,h=Ng(o,e,i.endDirections,s,i)):(u=o,h=[u]),g=g.filter(function(St){return!r(St)}),h=h.filter(function(St){return!r(St)}),g.length>0&&h.length>0){for(var y=new gi,x={},C={},p={},E=0,k=g.length;E<k;E++){var w=g[E],S=gn(w);y.add(S,Tg(w,h)),x[S]=w,p[S]=0}var T=i.previousDirectionAngle,m=T===void 0,A,M,N=i.directions;$C(N,s,i);for(var D=N.length,z=lt(h).reduce(function(St,Ct){var jt=gn(Ct);return St.push(jt),St},[]),_=i.maximumLoops;!y.isEmpty()&&_>0;){var j=y.pop(),V=x[j],W=C[j],Y=p[j],X=W===void 0,J=V.equals(l),Q;X?m?J?Q=null:Q=ns(l,V,D,s,i):Q=T:Q=ns(W,V,D,s,i);var it=g.length===h.length;if(it){for(var st=0;st<g.length;st++)if(!g[st].equals(h[st])){it=!1;break}}var gt=X&&it;if(!gt&&z.indexOf(j)>=0)return i.previousDirectionAngle=Q,rI(C,x,V,l,u);for(E=0;E<D;E++){A=N[E];var nt=A.angle;if(M=kg(Q,nt),!(!(m&&J)&&M>i.maxAllowedDirectionChange)){var ut=ca(V.clone().offset(A.gridOffsetX,A.gridOffsetY),s,n),ft=gn(ut);if(!(y.isClose(ft)||r(ut))){if(z.indexOf(ft)>=0){var vt=ut.equals(u);if(!vt){var xt=ns(ut,u,D,s,i),Et=kg(nt,xt);if(Et>i.maxAllowedDirectionChange)continue}}var Rt=A.cost,It=J?0:i.penalties[M],Wt=Y+Rt+It;(!y.isOpen(ft)||Wt<p[ft])&&(x[ft]=ut,C[ft]=V,p[ft]=Wt,y.add(ft,Wt+Tg(ut,h)))}}}_--}}return i.fallbackRoute.call(this,l,u,i)}function nI(t){if(t.directions=re(t,"directions"),t.penalties=re(t,"penalties"),t.paddingBox=re(t,"paddingBox"),t.padding=re(t,"padding"),t.padding){var e=he(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}lt(t.directions).forEach(function(r){var i=new Z(0,0),n=new Z(r.offsetX,r.offsetY);r.angle=et(i.theta(n))})}function aI(t,e,r){nI(e),r.options.perpendicular=!!e.perpendicular;var i=Ig(r,e),n=Sg(r,e),a=Mg(r,e),o;if(typeof e.isPointObstacle=="function")o=e.isPointObstacle;else{var s=new is(e);s.build(r.paper.model,r.model),o=function(T){return!s.isPointAccessible(T)}}for(var l=lt(t).map(Z),u=[],g=a,h,y,x=0,C=l.length;x<=C;x++){var p=null;if(y=h||i,h=l[x],!h){h=n;var E=!r.model.get("source").id||!r.model.get("target").id;if(E&&yt(e.draggingRoute)){var k=y===i?a:y,w=h.origin();p=e.draggingRoute.call(r,k,w,e)}}if(p=p||iI.call(r,y,h,o,e),p===null)return e.fallbackRouter(t,e,r);var S=p[0];S&&S.equals(g)&&p.shift(),g=p[p.length-1]||g,Array.prototype.push.apply(u,p)}return u}var os=function(t,e,r){return aI(t,tt({},Cg,e),r)},oI={maxAllowedDirectionChange:45,diagonalCost:function(){var t=this.step;return Math.ceil(Math.sqrt(t*t<<1))},directions:function(){var t=this.step,e=this.cost(),r=this.diagonalCost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:t,offsetY:t,cost:r},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:t,cost:r},{offsetX:-t,offsetY:0,cost:e},{offsetX:-t,offsetY:-t,cost:r},{offsetX:0,offsetY:-t,cost:e},{offsetX:t,offsetY:-t,cost:r}]},fallbackRoute:function(t,e,r){var i=t.theta(e),n=[],a={x:e.x,y:t.y},o={x:t.x,y:e.y};if(i%180>90){var s=a;a=o,o=s}var l=i%90<45?a:o,u=new dt(t,l),g=90*Math.ceil(i/90),h=Z.fromPolar(u.squaredLength(),bt(g+135),l),y=new dt(e,h),x=u.intersection(y),C=x||e,p=x?C:t,E=360/r.directions.length,k=p.theta(e),w=et(k+E/2),S=E*Math.floor(w/E);return r.previousDirectionAngle=S,C&&n.push(C.round()),n.push(e),n}},sI=function(t,e,r){if(!yt(os))throw new Error("Metro requires the manhattan router.");return os(t,tt({},oI,e),r)},Lg={__proto__:null,normal:WC,oneSide:ZC,orthogonal:rs,manhattan:os,metro:sI};function lI(t,e,r,i){var n="ratio"in i?i.ratio:.5;return t.getPointAtRatio(n)}function uI(t,e,r,i){var n="length"in i?i.length:20;return t.getPointAtLength(n)}function hI(t,e,r,i){var n=1e6,a=t.getConnection(),o=t.getConnectionSubdivisions(),s=new dt(r.clone().offset(0,n),r.clone().offset(0,-n)),l=new dt(r.clone().offset(n,0),r.clone().offset(-n,0)),u=s.intersect(a,{segmentSubdivisions:o}),g=l.intersect(a,{segmentSubdivisions:o}),h=[];return u&&Array.prototype.push.apply(h,u),g&&Array.prototype.push.apply(h,g),h.length>0?r.chooseClosest(h):"fallbackAt"in i?Eg(t,i.fallbackAt):Dg(t,e,r,i)}function cI(t,e,r,i){var n=t.getClosestPoint(r);return n||new Z}function vn(t){return function(e,r,i,n){if(i instanceof Element){var a=this.paper.findView(i),o;if(a)if(a.isNodeConnection(i)){var s="fixedAt"in n?n.fixedAt:"50%";o=Eg(a,s)}else o=a.getNodeBBox(i).center();else o=new Z;return t.call(this,e,r,o,n)}return t.apply(this,arguments)}}function Eg(t,e){var r=parseFloat(e);return pe(e)?t.getPointAtRatio(r/100):t.getPointAtLength(r)}var dI=vn(hI),Dg=vn(cI),zg={__proto__:null,resolveRef:vn,connectionRatio:lI,connectionLength:uI,connectionPerpendicular:dI,connectionClosest:Dg};function zr(t){return function(e,r,i,n){var a=!!n.rotate,o=a?e.getNodeUnrotatedBBox(r):e.getNodeBBox(r),s=o[t](),l=n.dx;if(l){var u=pe(l);l=parseFloat(l),isFinite(l)&&(u&&(l/=100,l*=o.width),s.x+=l)}var g=n.dy;if(g){var h=pe(g);g=parseFloat(g),isFinite(g)&&(h&&(g/=100,g*=o.height),s.y+=g)}return a?s.rotate(e.model.getBBox().center(),-e.model.angle()):s}}function fI(t,e,r,i){var n=t.model.angle(),a=t.getNodeBBox(e),o=a.center(),s=a.origin(),l=a.corner(),u=i.padding;if(isFinite(u)||(u=0),s.y+u<=r.y&&r.y<=l.y-u){var g=r.y-o.y;o.x+=n===0||n===180?0:g*1/Math.tan(bt(n)),o.y+=g}else if(s.x+u<=r.x&&r.x<=l.x-u){var h=r.x-o.x;o.y+=n===90||n===270?0:h*Math.tan(bt(n)),o.x+=h}return o}function gI(t,e,r,i){var n=!!i.rotate,a,o,s;n?(a=t.getNodeUnrotatedBBox(e),s=t.model.getBBox().center(),o=t.model.angle()):a=t.getNodeBBox(e);var l=i.padding;isFinite(l)&&a.inflate(l),n&&r.rotate(s,o);var u=a.sideNearestToPoint(r),g;switch(u){case"left":g=a.leftMiddle();break;case"right":g=a.rightMiddle();break;case"top":g=a.topMiddle();break;case"bottom":g=a.bottomMiddle();break}return n?g.rotate(s,-o):g}function vI(t,e,r,i,n){return t.model.getPointFromConnectedLink(this.model,n).offset(i.dx,i.dy)}var pI=zr("center"),mI=zr("topMiddle"),yI=zr("bottomMiddle"),bI=zr("leftMiddle"),wI=zr("rightMiddle"),xI=zr("origin"),AI=zr("topRight"),CI=zr("bottomLeft"),II=zr("corner"),SI=vn(fI),MI=vn(gI),kI=vI,Bg={__proto__:null,center:pI,top:mI,bottom:yI,left:bI,right:wI,topLeft:xI,topRight:AI,bottomLeft:CI,bottomRight:II,perpendicular:SI,midSide:MI,modelCenter:kI},PI=d.Collection.extend({initialize:function(t,e){e.cellNamespace?this.cellNamespace=e.cellNamespace:this.cellNamespace=typeof joint<"u"&&hr(joint,"shapes")?joint.shapes:null,this.graph=e.graph},model:function(t,e){var r=e.collection,i=r.cellNamespace,n=t.type==="link"?le:Ye(i,t.type,".")||At,a=new n(t,e);return e.dry||(a.graph=r.graph),a},comparator:function(t){return t.get("z")||0}}),Ie=d.Model.extend({initialize:function(t,e){e=e||{};var r=new PI([],{model:e.cellModel,cellNamespace:e.cellNamespace,graph:this});d.Model.prototype.set.call(this,"cells",r),r.on("all",this.trigger,this),this.on("change:z",this._sortOnChangeZ,this),this._out={},this._in={},this._nodes={},this._edges={},this._batches={},r.on("add",this._restructureOnAdd,this),r.on("remove",this._restructureOnRemove,this),r.on("reset",this._restructureOnReset,this),r.on("change:source",this._restructureOnChangeSource,this),r.on("change:target",this._restructureOnChangeTarget,this),r.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.get("cells").sort()},_restructureOnAdd:function(t){if(t.isLink()){this._edges[t.id]=!0;var e=t.attributes,r=e.source,i=e.target;r.id&&((this._out[r.id]||(this._out[r.id]={}))[t.id]=!0),i.id&&((this._in[i.id]||(this._in[i.id]={}))[t.id]=!0)}else this._nodes[t.id]=!0},_restructureOnRemove:function(t){if(t.isLink()){delete this._edges[t.id];var e=t.attributes,r=e.source,i=e.target;r.id&&this._out[r.id]&&this._out[r.id][t.id]&&delete this._out[r.id][t.id],i.id&&this._in[i.id]&&this._in[i.id][t.id]&&delete this._in[i.id][t.id]}else delete this._nodes[t.id]},_restructureOnReset:function(t){t=t.models,this._out={},this._in={},this._nodes={},this._edges={},t.forEach(this._restructureOnAdd,this)},_restructureOnChangeSource:function(t){var e=t.previous("source");e.id&&this._out[e.id]&&delete this._out[e.id][t.id];var r=t.attributes.source;r.id&&((this._out[r.id]||(this._out[r.id]={}))[t.id]=!0)},_restructureOnChangeTarget:function(t){var e=t.previous("target");e.id&&this._in[e.id]&&delete this._in[e.id][t.id];var r=t.get("target");r.id&&((this._in[r.id]||(this._in[r.id]={}))[t.id]=!0)},getOutboundEdges:function(t){return this._out&&this._out[t]||{}},getInboundEdges:function(t){return this._in&&this._in[t]||{}},toJSON:function(){var t=d.Model.prototype.toJSON.apply(this,arguments);return t.cells=this.get("cells").toJSON(),t},fromJSON:function(t,e){if(!t.cells)throw new Error("Graph JSON must contain cells array.");return this.set(t,e)},set:function(t,e,r){var i;return typeof t=="object"?(i=t,r=e):(i={})[t]=e,i.hasOwnProperty("cells")&&(this.resetCells(i.cells,r),i=Ce(i,"cells")),d.Model.prototype.set.call(this,i,r)},clear:function(t){t=tt({},t,{clear:!0});var e=this.get("cells");if(e.length===0)return this;this.startBatch("clear",t);var r=e.sortBy(function(i){return i.isLink()?1:2});do r.shift().remove(t);while(r.length>0);return this.stopBatch("clear"),this},_prepareCell:function(t,e){var r;if(t instanceof d.Model?(r=t.attributes,!t.graph&&(!e||!e.dry)&&(t.graph=this)):r=t,!$t(r.type))throw new TypeError("dia.Graph: cell type must be a string.");return t},minZIndex:function(){var t=this.get("cells").first();return t&&t.get("z")||0},maxZIndex:function(){var t=this.get("cells").last();return t&&t.get("z")||0},addCell:function(t,e){return Array.isArray(t)?this.addCells(t,e):(t instanceof d.Model?t.has("z")||t.set("z",this.maxZIndex()+1):t.z===void 0&&(t.z=this.maxZIndex()+1),this.get("cells").add(this._prepareCell(t,e),e||{}),this)},addCells:function(t,e){return t.length===0?this:(t=kf(t),e.maxPosition=e.position=t.length-1,this.startBatch("add",e),t.forEach(function(r){this.addCell(r,e),e.position--},this),this.stopBatch("add",e),this)},resetCells:function(t,e){var r=lt(t).map(function(i){return this._prepareCell(i,e)},this);return this.get("cells").reset(r,e),this},removeCells:function(t,e){return t.length&&(this.startBatch("remove"),me(t,"remove",e),this.stopBatch("remove")),this},_removeCell:function(t,e,r){r=r||{},r.clear||(r.disconnectLinks?this.disconnectLinks(t,r):this.removeLinks(t,r)),this.get("cells").remove(t,{silent:!0}),t.graph===this&&(t.graph=null)},getCell:function(t){return this.get("cells").get(t)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return this.get("cells").filter(function(t){return t.isElement()})},getLinks:function(){return this.get("cells").filter(function(t){return t.isLink()})},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(t,e){e=e||{};var r=e.indirect,i=e.inbound,n=e.outbound;i===void 0&&n===void 0&&(i=n=!0);var a=[],o={};n&&s(this,t),i&&l(this,t);function s(h,y){if(Ut(h.getOutboundEdges(y.id),function(C,p){if(!o[p]){var E=h.getCell(p);a.push(E),o[p]=!0,r&&(i&&l(h,E),n&&s(h,E))}}.bind(h)),r&&y.isLink()){var x=y.getTargetCell();x&&x.isLink()&&(o[x.id]||(a.push(x),s(h,x)))}}function l(h,y){if(Ut(h.getInboundEdges(y.id),function(C,p){if(!o[p]){var E=h.getCell(p);a.push(E),o[p]=!0,r&&(i&&l(h,E),n&&s(h,E))}}.bind(h)),r&&y.isLink()){var x=y.getSourceCell();x&&x.isLink()&&(o[x.id]||(a.push(x),l(h,x)))}}if(e.deep){var u=t.getEmbeddedCells({deep:!0}),g={};u.forEach(function(h){h.isElement()&&(g[h.id]=!0)}),u.forEach(function(h){h.isLink()||(n&&Ut(this.getOutboundEdges(h.id),function(y,x){if(!o[x]){var C=this.getCell(x),p=C.attributes,E=p.source,k=p.target,w=E.id,S=k.id;if(!e.includeEnclosed&&w&&g[w]&&S&&g[S])return;a.push(this.getCell(x)),o[x]=!0}}.bind(this)),i&&Ut(this.getInboundEdges(h.id),function(y,x){if(!o[x]){var C=this.getCell(x),p=C.attributes,E=p.source,k=p.target,w=E.id,S=k.id;if(!e.includeEnclosed&&w&&g[w]&&S&&g[S])return;a.push(this.getCell(x)),o[x]=!0}}.bind(this)))},this)}return a},getNeighbors:function(t,e){e||(e={});var r=e.inbound,i=e.outbound;r===void 0&&i===void 0&&(r=i=!0);var n=this.getConnectedLinks(t,e).reduce(function(s,l){var u=l.attributes,g=u.source,h=u.target,y=l.hasLoop(e);if(r&&hr(g,"id")&&!s[g.id]){var x=this.getCell(g.id);x.isElement()&&(y||x&&x!==t&&(!e.deep||!x.isEmbeddedIn(t)))&&(s[g.id]=x)}if(i&&hr(h,"id")&&!s[h.id]){var C=this.getCell(h.id);C.isElement()&&(y||C&&C!==t&&(!e.deep||!C.isEmbeddedIn(t)))&&(s[h.id]=C)}return s}.bind(this),{});if(t.isLink()){if(r){var a=t.getSourceCell();a&&a.isElement()&&!n[a.id]&&(n[a.id]=a)}if(i){var o=t.getTargetCell();o&&o.isElement()&&!n[o.id]&&(n[o.id]=o)}}return lt(n)},getCommonAncestor:function(){var t=Array.from(arguments).map(function(r){for(var i=[],n=r.get("parent");n;)i.push(n),n=this.getCell(n).get("parent");return i},this);t=t.sort(function(r,i){return r.length-i.length});var e=lt(t.shift()).find(function(r){return t.every(function(i){return i.includes(r)})});return this.getCell(e)},getSuccessors:function(t,e){e=e||{};var r=[];return this.search(t,function(i){i!==t&&r.push(i)},tt({},e,{outbound:!0})),r},cloneCells:Do,cloneSubgraph:function(t,e){var r=this.getSubgraph(t,e);return this.cloneCells(r)},getSubgraph:function(t,e){e=e||{};var r=[],i={},n=[],a=[];return lt(t).forEach(function(o){if(i[o.id]||(r.push(o),i[o.id]=o,o.isLink()?a.push(o):n.push(o)),e.deep){var s=o.getEmbeddedCells({deep:!0});s.forEach(function(l){i[l.id]||(r.push(l),i[l.id]=l,l.isLink()?a.push(l):n.push(l))})}}),a.forEach(function(o){var s=o.attributes,l=s.source,u=s.target;if(l.id&&!i[l.id]){var g=this.getCell(l.id);r.push(g),i[g.id]=g,n.push(g)}if(u.id&&!i[u.id]){var h=this.getCell(u.id);r.push(this.getCell(u.id)),i[h.id]=h,n.push(h)}},this),n.forEach(function(o){var s=this.getConnectedLinks(o,e);s.forEach(function(l){var u=l.attributes,g=u.source,h=u.target;!i[l.id]&&g.id&&i[g.id]&&h.id&&i[h.id]&&(r.push(l),i[l.id]=l)})},this),r},getPredecessors:function(t,e){e=e||{};var r=[];return this.search(t,function(i){i!==t&&r.push(i)},tt({},e,{inbound:!0})),r},search:function(t,e,r){r=r||{},r.breadthFirst?this.bfs(t,e,r):this.dfs(t,e,r)},bfs:function(t,e,r){r===void 0&&(r={});var i={},n={},a=[];for(a.push(t),n[t.id]=0;a.length>0;){var o=a.shift();if(!i[o.id]&&(i[o.id]=!0,e.call(this,o,n[o.id])!==!1))for(var s=this.getNeighbors(o,r),l=0,u=s.length;l<u;l++){var g=s[l];n[g.id]=n[o.id]+1,a.push(g)}}},dfs:function(t,e,r){r===void 0&&(r={});var i={},n={},a=[];for(a.push(t),n[t.id]=0;a.length>0;){var o=a.pop();if(!i[o.id]&&(i[o.id]=!0,e.call(this,o,n[o.id])!==!1))for(var s=this.getNeighbors(o,r),l=a.length,u=0,g=s.length;u<g;u++){var h=s[u];n[h.id]=n[o.id]+1,a.splice(l,0,h)}}},getSources:function(){var t=[];return Ut(this._nodes,function(e,r){(!this._in[r]||je(this._in[r]))&&t.push(this.getCell(r))}.bind(this)),t},getSinks:function(){var t=[];return Ut(this._nodes,function(e,r){(!this._out[r]||je(this._out[r]))&&t.push(this.getCell(r))}.bind(this)),t},isSource:function(t){return!this._in[t.id]||je(this._in[t.id])},isSink:function(t){return!this._out[t.id]||je(this._out[t.id])},isSuccessor:function(t,e){var r=!1;return this.search(t,function(i){if(i===e&&i!==t)return r=!0,!1},{outbound:!0}),r},isPredecessor:function(t,e){var r=!1;return this.search(t,function(i){if(i===e&&i!==t)return r=!0,!1},{inbound:!0}),r},isNeighbor:function(t,e,r){r=r||{};var i=r.inbound,n=r.outbound;i===void 0&&n===void 0&&(i=n=!0);var a=!1;return this.getConnectedLinks(t,r).forEach(function(o){var s=o.attributes,l=s.source,u=s.target;if(i&&hr(l,"id")&&l.id===e.id||n&&hr(u,"id")&&u.id===e.id)return a=!0,!1}),a},disconnectLinks:function(t,e){this.getConnectedLinks(t).forEach(function(r){r.set(r.attributes.source.id===t.id?"source":"target",{x:0,y:0},e)})},removeLinks:function(t,e){me(this.getConnectedLinks(t),"remove",e)},findModelsFromPoint:function(t){return this.getElements().filter(function(e){return e.getBBox({rotate:!0}).containsPoint(t)})},findModelsInArea:function(t,e){e===void 0&&(e={});var r=new at(t),i=e.strict;i===void 0&&(i=!1);var n=i?"containsRect":"intersect";return this.getElements().filter(function(a){return r[n](a.getBBox({rotate:!0}))})},findModelsUnderElement:function(t,e){e===void 0&&(e={});var r=e.searchBy;r===void 0&&(r="bbox");var i=t.getBBox().rotateAroundCenter(t.angle()),n=r==="bbox"?this.findModelsInArea(i):this.findModelsFromPoint(di(i,r));return n.filter(function(a){return t.id!==a.id&&!a.isEmbeddedIn(t)})},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(t,e){e===void 0&&(e={});var r=e.rotate;return r===void 0&&(r=!0),lt(t).reduce(function(i,n){var a=n.getBBox({rotate:r});return a?i?i.union(a):a:i},null)},translate:function(t,e,r){var i=this.getCells().filter(function(n){return!n.isEmbedded()});return me(i,"translate",t,e,r),this},resize:function(t,e,r){return this.resizeCells(t,e,this.getCells(),r)},resizeCells:function(t,e,r,i){var n=this.getCellsBBox(r);if(n){var a=Math.max(t/n.width,0),o=Math.max(e/n.height,0);me(r,"scale",a,o,n.origin(),i)}return this},startBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)+1,this.trigger("batch:start",tt({},e,{batchName:t}))},stopBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)-1,this.trigger("batch:stop",tt({},e,{batchName:t}))},hasActiveBatch:function(t){var e=this._batches,r;return arguments.length===0?r=Object.keys(e):Array.isArray(t)?r=t:r=[t],r.some(function(i){return e[i]>0})}},{validations:{multiLinks:function(t,e){var r=e.attributes,i=r.source,n=r.target;if(i.id&&n.id){var a=e.getSourceCell();if(a){var o=t.getConnectedLinks(a,{outbound:!0}),s=o.filter(function(l){var u=l.attributes,g=u.source,h=u.target;return g&&g.id===i.id&&(!g.port||g.port===i.port)&&h&&h.id===n.id&&(!h.port||h.port===n.port)});if(s.length>1)return!1}}return!0},linkPinning:function(t,e){var r=e.attributes,i=r.source,n=r.target;return i.id&&n.id}}});_f(Ie.prototype,["resetCells","addCells","removeCells"],ea.cells);var lr={CELLS:"cells",BACK:"back",FRONT:"front",TOOLS:"tools",LABELS:"labels"},Og=Xt.extend({tagName:"g",svgElement:!0,pivotNodes:null,defaultTheme:null,options:{name:""},className:function(){return Ze(this.options.name+"-layer")},init:function(){this.pivotNodes={}},insertSortedNode:function(t,e){this.el.insertBefore(t,this.insertPivot(e))},insertNode:function(t){var e=this,r=e.el;t.parentNode!==r&&r.appendChild(t)},insertPivot:function(t){var e=this,r=e.el,i=e.pivotNodes;t=+t,t||(t=0);var n=i[t];if(n)return n;n=i[t]=document.createComment("z-index:"+(t+1));var a=-1/0;for(var o in i)o=+o,o<t&&o>a&&(a=o,t-1);if(a!==-1/0){var s=i[a];r.insertBefore(n,s.nextSibling)}else r.insertBefore(n,r.firstChild);return n},removePivots:function(){var t=this,e=t.el,r=t.pivotNodes;for(var i in r)e.removeChild(r[i]);this.pivotNodes={}}}),Lt={RENDER:"RENDER",UPDATE:"UPDATE",TOOLS:"TOOLS",LEGACY_TOOLS:"LEGACY_TOOLS",LABELS:"LABELS",VERTICES:"VERTICES",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"},Ei=Vt.extend({className:function(){var t=Vt.prototype.className.apply(this).split(" ");return t.push("link"),t.join(" ")},options:{shortLinkLength:105,doubleLinkTools:!1,longLinkLength:155,linkToolsOffset:40,doubleLinkToolsOffset:65,sampleInterval:50},_labelCache:null,_labelSelectors:null,_markerCache:null,_V:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){Vt.prototype.initialize.apply(this,arguments),this._labelCache={},this._labelSelectors={},this._markerCache={},this._V={},this.cleanNodesCache()},presentationAttributes:{markup:[Lt.RENDER],attrs:[Lt.UPDATE],router:[Lt.UPDATE],connector:[Lt.CONNECTOR],smooth:[Lt.UPDATE],manhattan:[Lt.UPDATE],toolMarkup:[Lt.LEGACY_TOOLS],labels:[Lt.LABELS],labelMarkup:[Lt.LABELS],vertices:[Lt.VERTICES,Lt.UPDATE],vertexMarkup:[Lt.VERTICES],source:[Lt.SOURCE,Lt.UPDATE],target:[Lt.TARGET,Lt.UPDATE]},initFlag:[Lt.RENDER,Lt.SOURCE,Lt.TARGET,Lt.TOOLS],UPDATE_PRIORITY:1,confirmUpdate:function(t,e){if(e||(e={}),this.hasFlag(t,Lt.SOURCE)){if(!this.updateEndProperties("source"))return t;t=this.removeFlag(t,Lt.SOURCE)}if(this.hasFlag(t,Lt.TARGET)){if(!this.updateEndProperties("target"))return t;t=this.removeFlag(t,Lt.TARGET)}var r=this,i=r.paper,n=r.sourceView,a=r.targetView;if(i&&(n&&!i.isViewMounted(n)||a&&!i.isViewMounted(a)))return t;if(this.hasFlag(t,Lt.RENDER))return this.render(),this.updateHighlighters(!0),this.updateTools(e),t=this.removeFlag(t,[Lt.RENDER,Lt.UPDATE,Lt.VERTICES,Lt.LABELS,Lt.TOOLS,Lt.LEGACY_TOOLS,Lt.CONNECTOR]),t;var o=!1;this.hasFlag(t,Lt.VERTICES)&&(this.renderVertexMarkers(),t=this.removeFlag(t,Lt.VERTICES));var s=this,l=s.model,u=l.attributes,g=this.hasFlag(t,Lt.LABELS),h=this.hasFlag(t,Lt.LEGACY_TOOLS);g&&(this.onLabelsChange(l,u.labels,e),t=this.removeFlag(t,Lt.LABELS),o=!0),h&&(this.renderTools(),t=this.removeFlag(t,Lt.LEGACY_TOOLS));var y=this.hasFlag(t,Lt.UPDATE),x=this.hasFlag(t,Lt.CONNECTOR);return(y||x)&&(y?e.translateBy&&l.isRelationshipEmbeddedIn(e.translateBy)?this.translate(e.tx,e.ty):this.update():(this.updatePath(),this.updateDOM()),this.updateTools(e),t=this.removeFlag(t,[Lt.UPDATE,Lt.TOOLS,Lt.CONNECTOR]),g=!1,h=!1,o=!0),g&&this.updateLabelPositions(),h&&this.updateToolsPosition(),o&&this.updateHighlighters(),this.hasFlag(t,Lt.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,Lt.TOOLS)),t},requestConnectionUpdate:function(t){this.requestUpdate(this.getFlag(Lt.UPDATE),t)},isLabelsRenderRequired:function(t){t===void 0&&(t={});var e=this.model.previous("labels");if(!e)return!0;if("propertyPathArray"in t&&"propertyValue"in t){var r=t.propertyPathArray||[],i=r.length;if(i>1){var n=!!e[r[1]];if(n){if(i===2)return"markup"in Object(t.propertyValue);if(r[2]!=="markup")return!1}}}return!0},onLabelsChange:function(t,e,r){this.isLabelsRenderRequired(r)?this.renderLabels():this.updateLabels()},render:function(){return this.vel.empty(),this.unmountLabels(),this._V={},this.renderMarkup(),this.renderLabels(),this.update(),this},renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.LinkView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);this.selectors=e.selectors,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=F(t);Array.isArray(e)||(e=[e]);for(var r=this._V,i=0,n=e.length;i<n;i++){var a=e[i],o=a.attr("class");o&&(o=gf(o),r[f.camelCase(o)]=a)}this.renderTools(),this.renderVertexMarkers(),this.renderArrowheadMarkers(),this.vel.append(e)},_getLabelMarkup:function(t){if(!!t){if(Array.isArray(t))return this.parseDOMJSON(t,null);if(typeof t=="string")return this._getLabelStringMarkup(t);throw new Error("dia.linkView: invalid label markup")}},_getLabelStringMarkup:function(t){var e=F(t),r=document.createDocumentFragment();if(!Array.isArray(e))r.appendChild(e.node);else for(var i=0,n=e.length;i<n;i++){var a=e[i].node;r.appendChild(a)}return{fragment:r,selectors:{}}},_normalizeLabelMarkup:function(t){if(!!t){var e=t.fragment;if(!(t.fragment instanceof DocumentFragment)||!t.fragment.hasChildNodes())throw new Error("dia.LinkView: invalid label markup.");var r,i=e.childNodes;return i.length>1||i[0].nodeName.toUpperCase()!=="G"?r=F("g").append(e):r=F(i[0]),r.addClass("label"),{node:r.node,selectors:t.selectors}}},renderLabels:function(){var t=this._V,e=t.labels,r=this._labelCache={},i=this._labelSelectors={},n=this.model,a=n.attributes.labels||[],o=a.length;if(o===0)return e&&e.remove(),this;e?e.empty():(e=t.labels=F("g").addClass("labels"),this.options.labelsLayer&&(e.addClass(Ze(re(this,"className"))),e.attr("model-id",n.id)));for(var s=0;s<o;s++){var l=a[s],u=this._normalizeLabelMarkup(this._getLabelMarkup(l.markup)),g,h;if(u)g=u.node,h=u.selectors;else{var y=n._builtins.defaultLabel,x=this._normalizeLabelMarkup(this._getLabelMarkup(y.markup)),C=n._getDefaultLabel(),p=this._normalizeLabelMarkup(this._getLabelMarkup(C.markup)),E=p||x;g=E.node,h=E.selectors}g.setAttribute("label-idx",s),e.append(g),r[s]=g;var k=this.selector;if(h[k])throw new Error("dia.LinkView: ambiguous label root selector.");h[k]=g,i[s]=h}return e.parent()||this.mountLabels(),this.updateLabels(),this},mountLabels:function(){var t=this,e=t.el,r=t.paper,i=t.model,n=t._V,a=t.options,o=n.labels;if(!(!o||!i.hasLabels())){var s=o.node;a.labelsLayer?r.getLayerView(a.labelsLayer).insertSortedNode(s,i.get("z")):s.parentNode!==e&&e.appendChild(s)}},unmountLabels:function(){var t=this,e=t.options,r=t._V;if(!!r){var i=r.labels;i&&e.labelsLayer&&i.remove()}},onMount:function(){this.mountLabels()},unmount:function(){Vt.prototype.unmount.apply(this,arguments),this.unmountLabels()},findLabelNode:function(t,e){var r=this._labelCache[t];if(!r)return null;var i=this._labelSelectors[t],n=this.findBySelector(e,r,i),a=n[0];return a===void 0&&(a=null),a},_mergeLabelAttrs:function(t,e,r,i){return e===null?null:e===void 0?r===null?null:r===void 0?t?void 0:i:t?r:ie({},i,r):t?ie({},r,e):ie({},i,r,e)},updateLabels:function(){if(!this._V.labels)return this;for(var t=this.model,e=t.get("labels")||[],r=this.can("labelMove"),i=t._builtins.defaultLabel,n=i.attrs,a=t._getDefaultLabel(),o=a.markup,s=a.attrs,l=0,u=e.length;l<u;l++){var g=this._labelCache[l];g.setAttribute("cursor",r?"move":"default");var h=this._labelSelectors[l],y=e[l],x=y.markup,C=y.attrs,p=this._mergeLabelAttrs(x||o,C,s,n);this.updateDOMSubtreeAttributes(g,p,{rootBBox:new at(y.size),selectors:h})}return this},renderTools:function(){if(!this._V.linkTools)return this;var t=f(this._V.linkTools.node).empty(),e=De(this.model.get("toolMarkup")||this.model.toolMarkup),r=F(e());if(t.append(r.node),this._toolCache=r,this.options.doubleLinkTools){var i;this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup?(e=De(this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup),i=F(e())):i=r.clone(),t.append(i.node),this._tool2Cache=i}return this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var t=f(this._V.markerVertices.node).empty(),e=De(this.model.get("vertexMarkup")||this.model.vertexMarkup);return this.model.vertices().forEach(function(r,i){t.append(F(e(tt({idx:i},r))).node)}),this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var t=f(this._V.markerArrowheads.node);t.empty();var e=De(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);return this._V.sourceArrowhead=F(e({end:"source"})),this._V.targetArrowhead=F(e({end:"target"})),t.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node),this},removeRedundantLinearVertices:function(t){var e=.001,r=this.model,i=r.vertices(),n=[this.sourceAnchor].concat(i,[this.targetAnchor]),a=n.length,o=new Qt(n);o.simplify({threshold:e});var s=o.points.map(function(u){return u.toJSON()}),l=s.length;return a===l?0:(r.vertices(s.slice(1,l-1),t),a-l)},updateDefaultConnectionPath:function(){var t=this._V;t.connection&&t.connection.attr("d",this.getSerializedConnection()),t.connectionWrap&&t.connectionWrap.attr("d",this.getSerializedConnection()),t.markerSource&&t.markerTarget&&this._translateAndAutoOrientArrows(t.markerSource,t.markerTarget)},getEndView:function(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(t){switch(t){case"source":return new Z(this.sourceAnchor);case"target":return new Z(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(t){switch(t){case"source":return new Z(this.sourcePoint);case"target":return new Z(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(t){switch(t){case"source":var e=this.sourceView;if(!e)break;return this.sourceMagnet||e.el;case"target":var r=this.targetView;if(!r)break;return this.targetMagnet||r.el;default:throw new Error("dia.LinkView: type parameter required.")}},update:function(){return this.updateRoute(),this.updatePath(),this.updateDOM(),this},translate:function(t,e){t===void 0&&(t=0),e===void 0&&(e=0);var r=this,i=r.route,n=r.path;if(!(!i||!n)){var a=new Qt(i);a.translate(t,e),this.route=a.points,this._translateConnectionPoints(t,e),n.translate(t,e),this.updateDOM()}},updateDOM:function(){var e=this,r=e.el,i=e.model,n=e.selectors;this.cleanNodesCache(),this.updateDOMSubtreeAttributes(r,i.attr(),{selectors:n}),this.updateDefaultConnectionPath(),this.updateLabelPositions(),this.updateToolsPosition(),this.updateArrowheadMarkers(),this.options.perpendicular=null},updateRoute:function(){var t=this,e=t.model,r=e.vertices(),i=this.findAnchors(r),n=this.sourceAnchor=i.source,a=this.targetAnchor=i.target,o=this.findRoute(r);this.route=o;var s=this.findConnectionPoints(o,n,a);this.sourcePoint=s.source,this.targetPoint=s.target},updatePath:function(){var t=this,e=t.route,r=t.sourcePoint,i=t.targetPoint,n=this.findMarkerPoints(e,r,i),a=this.findPath(e,n.source||r,n.target||i);this.path=a},findMarkerPoints:function(t,e,r){var i=t[0],n=t[t.length-1],a=this._markerCache,o,s;return this._V.markerSource&&(a.sourceBBox=a.sourceBBox||this._V.markerSource.getBBox(),o=Z(e).move(i||r,a.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()),this._V.markerTarget&&(a.targetBBox=a.targetBBox||this._V.markerTarget.getBBox(),s=Z(r).move(n||e,a.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()),a.sourcePoint=o||e.clone(),a.targetPoint=s||r.clone(),{source:o,target:s}},findAnchorsOrdered:function(t,e,r,i){var n,a,o,s,l=this.model,u=l.get(t),g=l.get(r),h=this.getEndView(t),y=this.getEndView(r),x=this.getEndMagnet(t),C=this.getEndMagnet(r);h?(e?o=new Z(e):y?o=C:o=new Z(g),n=this.getAnchor(u.anchor,h,x,o,t)):n=new Z(u),y?(s=new Z(i||n),a=this.getAnchor(g.anchor,y,C,s,r)):a=new Z(g);var p={};return p[t]=n,p[r]=a,p},findAnchors:function(t){var e=this.model,r=t[0],i=t[t.length-1];return e.target().priority&&!e.source().priority?this.findAnchorsOrdered("target",i,"source",r):this.findAnchorsOrdered("source",r,"target",i)},findConnectionPoints:function(t,e,r){var i=t[0],n=t[t.length-1],a=this.model,o=a.get("source"),s=a.get("target"),l=this.sourceView,u=this.targetView,g=this.paper.options,h,y,x;if(l&&!l.isNodeConnection(this.sourceMagnet)){h=this.sourceMagnet||l.el;var C=o.connectionPoint||g.defaultConnectionPoint,p=i||r,E=new dt(p,e);x=this.getConnectionPoint(C,l,h,E,"source")}else x=e;var k;if(u&&!u.isNodeConnection(this.targetMagnet)){y=this.targetMagnet||u.el;var w=s.connectionPoint||g.defaultConnectionPoint,S=n||e,T=new dt(S,r);k=this.getConnectionPoint(w,u,y,T,"target")}else k=r;return{source:x,target:k}},getAnchor:function(t,e,r,i,n){var a=e.isNodeConnection(r),o=this.paper.options;if(t||(a?t=o.defaultLinkAnchor:o.perpendicularLinks||this.options.perpendicular?t={name:"perpendicular"}:t=o.defaultAnchor),!t)throw new Error("Anchor required.");var s;if(typeof t=="function")s=t;else{var l=t.name,u=a?"linkAnchorNamespace":"anchorNamespace";if(s=o[u][l],typeof s!="function")throw new Error("Unknown anchor: "+l)}var g=s.call(this,e,r,i,t.args||{},n,this);return g?g.round(this.decimalsRounding):new Z},getConnectionPoint:function(t,e,r,i,n){var a,o=i.end,s=this.paper.options;if(typeof s.linkConnectionPoint=="function"){var l=r===e.el?void 0:r;if(a=s.linkConnectionPoint(this,e,l,i.start,n),a)return a}if(!t)return o;var u;if(typeof t=="function")u=t;else{var g=t.name;if(u=s.connectionPointNamespace[g],typeof u!="function")throw new Error("Unknown connection point: "+g)}return a=u.call(this,i,e,r,t.args||{},n,this),a?a.round(this.decimalsRounding):o},_translateConnectionPoints:function(t,e){var r=this._markerCache;r.sourcePoint.offset(t,e),r.targetPoint.offset(t,e),this.sourcePoint.offset(t,e),this.targetPoint.offset(t,e),this.sourceAnchor.offset(t,e),this.targetAnchor.offset(t,e)},_normalizeLabelPosition:function(t){return typeof t=="number"?{distance:t,offset:null,angle:0,args:null}:t},updateLabelPositions:function(){if(!this._V.labels)return this;var t=this.path;if(!t)return this;var e=this.model,r=e.get("labels")||[];if(!r.length)return this;for(var i=e._builtins.defaultLabel,n=i.position,a=e._getDefaultLabel(),o=this._normalizeLabelPosition(a.position),s=ie({},n,o),l=0,u=r.length;l<u;l++){var g=this._labelCache[l];if(!!g){var h=r[l],y=this._normalizeLabelPosition(h.position),x=ie({},s,y),C=this._getLabelTransformationMatrix(x);g.setAttribute("transform",F.matrixToTransformString(C)),this._cleanLabelMatrices(l)}}return this},_cleanLabelMatrices:function(t){var e=this,r=e.metrics,i=e._labelSelectors,n=i[t];if(!!n)for(var a in n){var o=n[a],s=o.id;s&&s in r&&delete r[s].magnetMatrix}},updateToolsPosition:function(){if(!this._V.linkTools)return this;var t="",e=this.options.linkToolsOffset,r=this.getConnectionLength();if(!Number.isNaN(r)){r<this.options.shortLinkLength&&(t="scale(.5)",e/=2);var i=this.getPointAtLength(e);if(this._toolCache.attr("transform","translate("+i.x+", "+i.y+") "+t),this.options.doubleLinkTools&&r>=this.options.longLinkLength){var n=this.options.doubleLinkToolsOffset||e;i=this.getPointAtLength(r-n),this._tool2Cache.attr("transform","translate("+i.x+", "+i.y+") "+t),this._tool2Cache.attr("visibility","visible")}else this.options.doubleLinkTools&&this._tool2Cache.attr("visibility","hidden")}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if(f.css(this._V.markerArrowheads.node,"display")==="none")return this;var t=this.getConnectionLength()<this.options.shortLinkLength?.5:1;return this._V.sourceArrowhead.scale(t),this._V.targetArrowhead.scale(t),this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead),this},updateEndProperties:function(t){var e=this,r=e.model,i=e.paper,n=t+"View",a=r.get(t),o=a&&a.id;if(!o)return this[n]=null,this.updateEndMagnet(t),!0;var s=i.getModelById(o);if(!s)throw new Error("LinkView: invalid "+t+" cell.");var l=s.findView(i);return l?(this[n]=l,this.updateEndMagnet(t),!0):!1},updateEndMagnet:function(t){var e=t+"Magnet",r=this.getEndView(t);if(r){var i=r.getMagnetFromLinkEnd(this.model.get(t));i===r.el&&(i=null),this[e]=i}else this[e]=null},_translateAndAutoOrientArrows:function(t,e){var r=lt(this.route);t&&t.translateAndAutoOrient(this.sourcePoint,r[0]||this.targetPoint,this.paper.cells),e&&e.translateAndAutoOrient(this.targetPoint,r[r.length-1]||this.sourcePoint,this.paper.cells)},_getLabelPositionAngle:function(t){var e=this.model.label(t).position||{};return e.angle||0},_getLabelPositionArgs:function(t){var e=this.model.label(t).position||{};return e.args},_getDefaultLabelPositionArgs:function(){var t=this.model._getDefaultLabel(),e=t.position||{};return e.args},_mergeLabelPositionArgs:function(t,e){return t===null?null:t===void 0?e===null?null:e:ie({},e,t)},addLabel:function(t,e,r,i){var n,a,o=0,s;typeof t!="number"?(n=t.x,a=t.y,typeof e=="number"?(o=e,s=r):s=e):(n=t,a=e,typeof r=="number"?(o=r,s=i):s=r);var l=this._getDefaultLabelPositionArgs(),u=s,g=this._mergeLabelPositionArgs(u,l),h={position:this.getLabelPosition(n,a,o,g)},y=-1;return this.model.insertLabel(y,h,s),y},addVertex:function(t,e,r){var i=typeof t!="number",n=i?t.x:t,a=i?t.y:e,o=i?e:r,s={x:n,y:a},l=this.getVertexIndex(n,a);return this.model.insertVertex(l,s,o),l},sendToken:function(t,e,r){function i(h,y){return function(){h.remove(),typeof y=="function"&&y()}}var n,a,o;Yt(e)?(n=e.duration,a=e.direction==="reverse",o=e.connection):(n=e,a=!1,o=null),n=n||1e3;var s={dur:n+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};a&&(s.keyPoints="1;0",s.keyTimes="0;1");var l=F(t),u;if(typeof o=="string")u=this.findBySelector(o,this.el,this.selectors)[0];else{var g=this._V;u=g.connection?g.connection.node:this.el.querySelector("path")}if(!(u instanceof SVGPathElement))throw new Error("dia.LinkView: token animation requires a valid connection path.");l.appendTo(this.paper.cells).animateAlongPath(s,u),setTimeout(i(l,r),n)},findRoute:function(t){t||(t=[]);var e=this.paper.options.routerNamespace||Lg,r=this.model.router(),i=this.paper.options.defaultRouter;if(!r)if(i)r=i;else return t.map(Z);var n=yt(r)?r:e[r.name];if(!yt(n))throw new Error('dia.LinkView: unknown router: "'+r.name+'".');var a=r.args||{},o=n.call(this,t,a,this);return o||t.map(Z)},findPath:function(t,e,r){var i=this.paper.options.connectorNamespace||cg,n=this.model.connector(),a=this.paper.options.defaultConnector;n||(n=a||{});var o=yt(n)?n:i[n.name];if(!yt(o))throw new Error('dia.LinkView: unknown connector: "'+n.name+'".');var s=be(n.args||{});s.raw=!0;var l=o.call(this,e,r,t,s,this);return typeof l=="string"&&(l=new rt(F.normalizePathData(l))),l},getConnection:function(){var t=this.path;return t?t.clone():null},getSerializedConnection:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("data"))return e.data;var r=t.serialize();return e.data=r,r},getConnectionSubdivisions:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("segmentSubdivisions"))return e.segmentSubdivisions;var r=t.getSegmentSubdivisions();return e.segmentSubdivisions=r,r},getConnectionLength:function(){var t=this.path;if(!t)return 0;var e=this.metrics;if(e.hasOwnProperty("length"))return e.length;var r=t.length({segmentSubdivisions:this.getConnectionSubdivisions()});return e.length=r,r},getPointAtLength:function(t){var e=this.path;return e?e.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getPointAtRatio:function(t){var e=this.path;return e?(pe(t)&&(t=parseFloat(t)/100),e.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})):null},getTangentAtLength:function(t){var e=this.path;return e?e.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getTangentAtRatio:function(t){var e=this.path;return e?e.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPoint:function(t){var e=this.path;return e?e.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointLength:function(t){var e=this.path;return e?e.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointRatio:function(t){var e=this.path;return e?e.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getLabelPosition:function(t,e,r,i){var n={},a=0,o;typeof r=="number"?(a=r,o=i):o=r,o&&(n.args=o);var s=!(o&&o.absoluteDistance),l=o&&o.absoluteDistance&&o.reverseDistance,u=o&&o.absoluteOffset,g=this.path,h={segmentSubdivisions:this.getConnectionSubdivisions()},y=new Z(t,e),x=g.closestPointT(y,h),C=g.lengthAtT(x,h);s&&(C=C/this.getConnectionLength()||0),l&&(C=-1*(this.getConnectionLength()-C)||1),n.distance=C;var p;u||(p=g.tangentAtT(x));var E;if(p)E=p.pointOffset(y);else{var k=g.pointAtT(x),w=y.difference(k);E={x:w.x,y:w.y}}return n.offset=E,n.angle=a,n},_getLabelTransformationMatrix:function(t){var e,r=0,i={};if(typeof t=="number")e=t;else if(typeof t.distance=="number")i=t.args||{},e=t.distance,r=t.angle||0;else throw new Error("dia.LinkView: invalid label position distance.");var n=e>0&&e<=1,a=0,o={x:0,y:0};if(t.offset){var s=t.offset;typeof s=="number"&&(a=s),s.x&&(o.x=s.x),s.y&&(o.y=s.y)}var l=o.x!==0||o.y!==0||a===0,u=i.keepGradient,g=i.ensureLegibility,h=this.path,y={segmentSubdivisions:this.getConnectionSubdivisions()},x=n?e*this.getConnectionLength():e,C=h.tangentAtLength(x,y),p,E=r;if(C){if(l)p=C.start,p.offset(o);else{var k=C.clone();k.rotate(C.start,-90),k.setLength(a),p=k.end}u&&(E=C.angle()+r,g&&(E=et((E+90)%180-90)))}else p=h.start,l&&p.offset(o);return F.createSVGMatrix().translate(p.x,p.y).rotate(E)},getLabelCoordinates:function(t){var e=this._getLabelTransformationMatrix(t);return new Z(e.e,e.f)},getVertexIndex:function(t,e){for(var r=this.model,i=r.vertices(),n=this.getClosestPointLength(new Z(t,e)),a=0,o=i.length;a<o;a++){var s=i[a],l=this.getClosestPointLength(s);if(n<l)break}return a},notifyPointerdown:function(e,r,i){Vt.prototype.pointerdown.call(this,e,r,i),this.notify("link:pointerdown",e,r,i)},notifyPointermove:function(e,r,i){Vt.prototype.pointermove.call(this,e,r,i),this.notify("link:pointermove",e,r,i)},notifyPointerup:function(e,r,i){this.notify("link:pointerup",e,r,i),Vt.prototype.pointerup.call(this,e,r,i)},pointerdblclick:function(t,e,r){Vt.prototype.pointerdblclick.apply(this,arguments),this.notify("link:pointerdblclick",t,e,r)},pointerclick:function(t,e,r){Vt.prototype.pointerclick.apply(this,arguments),this.notify("link:pointerclick",t,e,r)},contextmenu:function(t,e,r){Vt.prototype.contextmenu.apply(this,arguments),this.notify("link:contextmenu",t,e,r)},pointerdown:function(t,e,r){this.notifyPointerdown(t,e,r);var i=t.target.getAttribute("class");switch(i){case"marker-vertex":this.dragVertexStart(t,e,r);return;case"marker-vertex-remove":case"marker-vertex-remove-area":this.dragVertexRemoveStart(t,e,r);return;case"marker-arrowhead":this.dragArrowheadStart(t,e,r);return;case"connection":case"connection-wrap":this.dragConnectionStart(t,e,r);return;case"marker-source":case"marker-target":return}this.dragStart(t,e,r)},pointermove:function(t,e,r){var i=this._dragData;i&&this.eventData(t,i);var n=this.eventData(t);switch(n.action){case"vertex-move":this.dragVertex(t,e,r);break;case"label-move":this.dragLabel(t,e,r);break;case"arrowhead-move":this.dragArrowhead(t,e,r);break;case"move":this.drag(t,e,r);break}i&&tt(i,this.eventData(t)),this.notifyPointermove(t,e,r)},pointerup:function(t,e,r){var i=this._dragData;i&&(this.eventData(t,i),this._dragData=null);var n=this.eventData(t);switch(n.action){case"vertex-move":this.dragVertexEnd(t,e,r);break;case"label-move":this.dragLabelEnd(t,e,r);break;case"arrowhead-move":this.dragArrowheadEnd(t,e,r);break;case"move":this.dragEnd(t,e,r)}this.notifyPointerup(t,e,r),this.checkMouseleave(t)},mouseover:function(t){Vt.prototype.mouseover.apply(this,arguments),this.notify("link:mouseover",t)},mouseout:function(t){Vt.prototype.mouseout.apply(this,arguments),this.notify("link:mouseout",t)},mouseenter:function(t){Vt.prototype.mouseenter.apply(this,arguments),this.notify("link:mouseenter",t)},mouseleave:function(t){Vt.prototype.mouseleave.apply(this,arguments),this.notify("link:mouseleave",t)},mousewheel:function(t,e,r,i){Vt.prototype.mousewheel.apply(this,arguments),this.notify("link:mousewheel",t,e,r,i)},onevent:function(t,e,r,i){var n=F(t.target).findParentByClass("link-tool",this.el);if(n){if(t.stopPropagation(),this.can("useLinkTools"))if(e==="remove"){this.model.remove({ui:!0});return}else this.notify(e,t,r,i);this.notifyPointerdown(t,r,i),this.paper.delegateDragEvents(this,t.data)}else Vt.prototype.onevent.apply(this,arguments)},onlabel:function(t,e,r){this.notifyPointerdown(t,e,r),this.dragLabelStart(t,e,r);var i=this.eventData(t).stopPropagation;i&&t.stopPropagation()},dragConnectionStart:function(t,e,r){if(!!this.can("vertexAdd")){var i=this.addVertex({x:e,y:r},{ui:!0});this.eventData(t,{action:"vertex-move",vertexIdx:i})}},dragLabelStart:function(t,e,r){if(this.can("labelMove")){var i=t.currentTarget,n=parseInt(i.getAttribute("label-idx"),10),a=this._getLabelPositionAngle(n),o=this._getLabelPositionArgs(n),s=this._getDefaultLabelPositionArgs(),l=this._mergeLabelPositionArgs(o,s);this.eventData(t,{action:"label-move",labelIdx:n,positionAngle:a,positionArgs:l,stopPropagation:!0})}else this.eventData(t,{stopPropagation:!0});this.paper.delegateDragEvents(this,t.data)},dragVertexStart:function(t,e,r){if(!!this.can("vertexMove")){var i=t.target,n=parseInt(i.getAttribute("idx"),10);this.eventData(t,{action:"vertex-move",vertexIdx:n})}},dragVertexRemoveStart:function(t,e,r){if(!!this.can("vertexRemove")){var i=t.target,n=parseInt(i.getAttribute("idx"),10);this.model.removeVertex(n)}},dragArrowheadStart:function(t,e,r){if(!!this.can("arrowheadMove")){var i=t.target,n=i.getAttribute("end"),a=this.startArrowheadMove(n,{ignoreBackwardsCompatibility:!0});this.eventData(t,a)}},dragStart:function(t,e,r){!this.can("linkMove")||this.eventData(t,{action:"move",dx:e,dy:r})},dragLabel:function(t,e,r){var i=this.eventData(t),n={position:this.getLabelPosition(e,r,i.positionAngle,i.positionArgs)};this.paper.options.snapLabels&&delete n.position.offset,this.model.label(i.labelIdx,n)},dragVertex:function(t,e,r){var i=this.eventData(t);this.model.vertex(i.vertexIdx,{x:e,y:r},{ui:!0})},dragArrowhead:function(t,e,r){if(this.paper.options.snapLinks){var i=this._snapArrowhead(t,e,r);!i&&this.paper.options.snapLinksSelf&&this._snapArrowheadSelf(t,e,r)}else this.paper.options.snapLinksSelf?this._snapArrowheadSelf(t,e,r):this._connectArrowhead(this.getEventTarget(t),e,r,this.eventData(t))},drag:function(t,e,r){var i=this.eventData(t);this.model.translate(e-i.dx,r-i.dy,{ui:!0}),this.eventData(t,{dx:e,dy:r})},dragLabelEnd:function(){},dragVertexEnd:function(){},dragArrowheadEnd:function(t,e,r){var i=this.eventData(t),n=this.paper;n.options.snapLinks?this._snapArrowheadEnd(i):this._connectArrowheadEnd(i,e,r),n.linkAllowed(this)?(this._finishEmbedding(i),this._notifyConnectEvent(i,t)):this._disallow(i),this._afterArrowheadMove(i)},dragEnd:function(){},_disallow:function(t){switch(t.whenNotAllowed){case"remove":this.model.remove({ui:!0});break;case"revert":default:this.model.set(t.arrowhead,t.initialEnd,{ui:!0});break}},_finishEmbedding:function(t){this.paper.options.embeddingMode&&this.model.reparent()&&(t.z=null)},_notifyConnectEvent:function(t,e){var r=t.arrowhead,i=t.initialEnd,n=this.model.prop(r),a=n&&!le.endsEqual(i,n);if(a){var o=this.paper;i.id&&this.notify("link:disconnect",e,o.findViewByModel(i.id),t.initialMagnet,r),n.id&&this.notify("link:connect",e,o.findViewByModel(n.id),t.magnetUnderPointer,r)}},_snapToPoints:function(t,e,r){for(var i=null,n=1/0,a=null,o=1/0,s=t.x,l=t.y,u=0;u<e.length;u++){var g=Math.abs(e[u].x-t.x);g<n&&(n=g,i=e[u]);var h=Math.abs(e[u].y-t.y);h<o&&(o=h,a=e[u])}return n<r&&(s=i.x),o<r&&(l=a.y),{x:s,y:l}},_snapArrowheadSelf:function(t,e,r){var i=this,n=i.paper,a=i.model,o=n.options,s=o.snapLinksSelf,l=this.eventData(t),u=s.radius||20,g=this.getEndAnchor(l.arrowhead==="source"?"target":"source"),h=a.vertices(),y=[g].concat(h),x=this._snapToPoints({x:e,y:r},y,u);this._connectArrowhead(document.elementFromPoint(x.x,x.y),x.x,x.y,this.eventData(t))},_snapArrowhead:function(t,e,r){var i=this,n=i.paper,a=n.options,o=a.snapLinks,s=a.connectionStrategy,l=this.eventData(t),u=!1,g=o.radius||50,h=n.findViewsInArea({x:e-g,y:r-g,width:2*g,height:2*g}),y=l.closestView||null,x=l.closestMagnet||null,C=l.magnetProxy||null;l.closestView=l.closestMagnet=l.magnetProxy=null;var p=Number.MAX_VALUE,E=new Z(e,r);h.forEach(function(z){var _=[];z.el.getAttribute("magnet")!=="false"&&_.push({bbox:z.model.getBBox(),magnet:z.el}),z.$("[magnet]").toArray().forEach(function(j){_.push({bbox:z.getNodeBBox(j),magnet:j})}),_.forEach(function(j){var V=j.magnet,W=j.bbox,Y=W.center().squaredDistance(E);if(Y<p){var X=x===V;(X||n.options.validateConnection.apply(n,l.validateConnectionArgs(z,z.el===V?null:V)))&&(p=Y,l.closestView=z,l.closestMagnet=V)}})},this);var k,w=null,S=l.closestView,T=l.closestMagnet;T&&(w=l.magnetProxy=S.findProxyNode(T,"highlighter"));var m=l.arrowhead,A=x!==T;if(y&&A&&y.unhighlight(C,{connecting:!0,snapping:!0}),S){var M=l.prevEnd,N=l.prevX,D=l.prevY;if(l.prevX=e,l.prevY=r,u=!0,!A&&(typeof s!="function"||N===e&&D===r)||(k=S.getLinkEnd(T,e,r,this.model,m),!A&&ze(M,k)))return u;l.prevEnd=k,A&&S.highlight(w,{connecting:!0,snapping:!0})}else k={x:e,y:r};return this.model.set(m,k||{x:e,y:r},{ui:!0}),y&&this.notify("link:snap:disconnect",t,y,x,m),S&&this.notify("link:snap:connect",t,S,T,m),u},_snapArrowheadEnd:function(t){var e=t.closestView,r=t.closestMagnet;e&&r&&(e.unhighlight(t.magnetProxy,{connecting:!0,snapping:!0}),t.magnetUnderPointer=e.findMagnet(r)),t.closestView=t.closestMagnet=null},_connectArrowhead:function(t,e,r,i){var n=this,a=n.paper,o=n.model;if(i.eventTarget!==t){i.magnetProxy&&i.viewUnderPointer.unhighlight(i.magnetProxy,{connecting:!0});var s=i.viewUnderPointer=a.findView(t);if(s){var l=i.magnetUnderPointer=s.findMagnet(t),u=i.magnetProxy=s.findProxyNode(l,"highlighter");l&&this.paper.options.validateConnection.apply(a,i.validateConnectionArgs(s,l))?u&&s.highlight(u,{connecting:!0}):(i.magnetUnderPointer=null,i.magnetProxy=null)}else i.magnetUnderPointer=null,i.magnetProxy=null}i.eventTarget=t,o.set(i.arrowhead,{x:e,y:r},{ui:!0})},_connectArrowheadEnd:function(t,e,r){t===void 0&&(t={});var i=this,n=i.model,a=t.viewUnderPointer,o=t.magnetUnderPointer,s=t.magnetProxy,l=t.arrowhead;if(!(!o||!s||!a)){a.unhighlight(s,{connecting:!0});var u=a.getLinkEnd(o,e,r,n,l);n.set(l,u,{ui:!0})}},_beforeArrowheadMove:function(t){t.z=this.model.get("z"),this.model.toFront();var e=this.el.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets(t)},_afterArrowheadMove:function(t){t.z!==null&&(this.model.set("z",t.z,{ui:!0}),t.z=null),this.el.style.pointerEvents=t.pointerEvents,this.paper.options.markAvailable&&this._unmarkAvailableMagnets(t)},_createValidateConnectionArgs:function(t){var e=[];e[4]=t,e[5]=this;var r,i=0,n=0;t==="source"?(i=2,r="target"):(n=2,r="source");var a=this.model.get(r);if(a.id){var o=e[i]=this.paper.findViewByModel(a.id),s=o.getMagnetFromLinkEnd(a);s===o.el&&(s=void 0),e[i+1]=s}function l(u,g){return e[n]=u,e[n+1]=u.el===g?void 0:g,e}return l},_markAvailableMagnets:function(t){function e(h,y){var x=h.paper,C=x.options.validateConnection;return C.apply(x,this.validateConnectionArgs(h,y))}var r=this.paper,i=r.model.getCells();t.marked={};for(var n=0,a=i.length;n<a;n++){var o=i[n].findView(r);if(!!o){var s=Array.prototype.slice.call(o.el.querySelectorAll("[magnet]"));o.el.getAttribute("magnet")!=="false"&&s.push(o.el);var l=s.filter(e.bind(t,o));if(l.length>0){for(var u=0,g=l.length;u<g;u++)o.highlight(l[u],{magnetAvailability:!0});o.highlight(null,{elementAvailability:!0}),t.marked[o.model.id]=l}}}},_unmarkAvailableMagnets:function(t){for(var e=Object.keys(t.marked),r,i,n=0,a=e.length;n<a;n++){r=e[n],i=t.marked[r];var o=this.paper.findViewByModel(r);if(o){for(var s=0,l=i.length;s<l;s++)o.unhighlight(i[s],{magnetAvailability:!0});o.unhighlight(null,{elementAvailability:!0})}}t.marked=null},startArrowheadMove:function(t,e){e||(e={});var r={action:"arrowhead-move",arrowhead:t,whenNotAllowed:e.whenNotAllowed||"revert",initialMagnet:this[t+"Magnet"]||(this[t+"View"]?this[t+"View"].el:null),initialEnd:be(this.model.get(t)),validateConnectionArgs:this._createValidateConnectionArgs(t)};return this._beforeArrowheadMove(r),e.ignoreBackwardsCompatibility!==!0&&(this._dragData=r),r},onRemove:function(){Vt.prototype.onRemove.apply(this,arguments),this.unmountLabels()}},{Flags:Lt});Object.defineProperty(Ei.prototype,"sourceBBox",{enumerable:!0,get:function(){var t=this.sourceView;if(!t){var e=this.model.source();return new at(e.x,e.y)}var r=this.sourceMagnet;return t.isNodeConnection(r)?new at(this.sourceAnchor):t.getNodeBBox(r||t.el)}}),Object.defineProperty(Ei.prototype,"targetBBox",{enumerable:!0,get:function(){var t=this.targetView;if(!t){var e=this.model.target();return new at(e.x,e.y)}var r=this.targetMagnet;return t.isNodeConnection(r)?new at(this.targetAnchor):t.getNodeBBox(r||t.el)}});var Di={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"},TI=50,Rg=20,_g=1e3,NI=1/0,da=9007199254740991,ss=Vt.Highlighting,pn={};pn[ss.DEFAULT]={name:"stroke",options:{padding:3}},pn[ss.MAGNET_AVAILABILITY]={name:"addClass",options:{className:"available-magnet"}},pn[ss.ELEMENT_AVAILABILITY]={name:"addClass",options:{className:"available-cell"}};var LI=[{name:lr.BACK},{name:lr.CELLS},{name:lr.LABELS},{name:lr.FRONT},{name:lr.TOOLS}],Oe=Xt.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:1,drawGrid:!1,background:!1,perpendicularLinks:!1,elementView:kt,linkView:Ei,snapLabels:!1,snapLinks:!1,snapLinksSelf:!1,labelsLayer:!1,multiLinks:!0,guard:function(t,e){return!1},highlighting:pn,preventContextMenu:!0,preventDefaultBlankAction:!0,restrictTranslate:!1,markAvailable:!1,defaultLink:new le,defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"bbox"},connectionStrategy:null,validateMagnet:function(t,e,r){return e.getAttribute("magnet")!=="passive"},validateConnection:function(t,e,r,i,n,a){return(n==="target"?r:t)instanceof kt},embeddingMode:!1,validateEmbedding:function(t,e){return!0},validateUnembedding:function(t){return!0},findParentBy:"bbox",frontParentOnly:!0,interactive:{labelMove:!1},linkPinning:!0,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:Di.EXACT,frozen:!1,onViewUpdate:function(t,e,r,i,n){e&(t.FLAG_INSERT|t.FLAG_REMOVE)||i.mounting||i.isolate||n.requestConnectedLinksUpdate(t,r,i)},onViewPostponed:function(t,e,r){return r.forcePostponedViewUpdate(t,e)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,routerNamespace:null,connectorNamespace:null,highlighterNamespace:gg,anchorNamespace:Bg,linkAnchorNamespace:zg,connectionPointNamespace:pg},events:{dblclick:"pointerdblclick",dbltap:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",wheel:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","mousedown .joint-cell [event]":"onevent","touchstart .joint-cell [event]":"onevent","mousedown .joint-cell [magnet]":"onmagnet","touchstart .joint-cell [magnet]":"onmagnet","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},svg:null,viewport:null,defs:null,tools:null,$background:null,layers:null,$grid:null,$document:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,_layers:null,SORT_DELAYING_BATCHES:["add","to-front","to-back"],UPDATE_DELAYING_BATCHES:["translate"],MIN_SCALE:1e-6,init:function(){var t=this,e=t.options,r=t.el;e.cellViewNamespace||(e.cellViewNamespace=typeof joint<"u"&&hr(joint,"shapes")?joint.shapes:null);var i=this.model=e.model||new Ie;this._layers={},this.setGrid(e.drawGrid),this.cloneOptions(),this.render(),this._setDimensions(),this.startListening(),this._views={},this._mw_evt_buffer={event:null,deltas:[]},this.$document=f(r.ownerDocument),this.resetViews(i.attributes.cells.models),!this.isFrozen()&&this.isAsync()&&this.updateViewsAsync()},_resetUpdates:function(){return this._updates={id:null,priorities:[{},{},{}],unmountedCids:[],mountedCids:[],unmounted:{},mounted:{},count:0,keyFrozen:!1,freezeKey:null,sort:!1}},startListening:function(){var t=this.model;this.listenTo(t,"add",this.onCellAdded).listenTo(t,"remove",this.onCellRemoved).listenTo(t,"change",this.onCellChange).listenTo(t,"reset",this.onGraphReset).listenTo(t,"sort",this.onGraphSort).listenTo(t,"batch:stop",this.onGraphBatchStop),this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("scale translate",this.update)},onCellAdded:function(t,e,r){var i=r.position;this.isAsync()||!Nt(i)?this.renderView(t,r):(r.maxPosition===i&&this.freeze({key:"addCells"}),this.renderView(t,r),i===0&&this.unfreeze({key:"addCells"}))},onCellRemoved:function(t,e,r){var i=this.findViewByModel(t);i&&this.requestViewUpdate(i,i.FLAG_REMOVE,i.UPDATE_PRIORITY,r)},onCellChange:function(t,e){if(t!==this.model.attributes.cells&&t.hasChanged("z")&&this.options.sorting===Di.APPROX){var r=this.findViewByModel(t);r&&this.requestViewUpdate(r,r.FLAG_INSERT,r.UPDATE_PRIORITY,e)}},onGraphReset:function(t,e){this.resetLayers(),this.resetViews(t.models,e)},onGraphSort:function(){this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)||this.sortViews()},onGraphBatchStop:function(t){if(!this.isFrozen()){var e=t&&t.batchName,r=this.model;if(!this.isAsync()){var i=this.UPDATE_DELAYING_BATCHES;i.includes(e)&&!r.hasActiveBatch(i)&&this.updateViews(t)}var n=this.SORT_DELAYING_BATCHES;n.includes(e)&&!r.hasActiveBatch(n)&&this.sortViews()}},cloneOptions:function(){var t=this,e=t.options,r=e.defaultConnector,i=e.defaultRouter,n=e.defaultConnectionPoint,a=e.defaultAnchor,o=e.defaultLinkAnchor,s=e.origin,l=e.highlighting,u=e.cellViewNamespace,g=e.interactive;!u&&typeof joint<"u"&&hr(joint,"shapes")&&(e.cellViewNamespace=joint.shapes),yt(r)||(e.defaultConnector=de(r)),yt(i)||(e.defaultRouter=de(i)),yt(n)||(e.defaultConnectionPoint=de(n)),yt(a)||(e.defaultAnchor=de(a)),yt(o)||(e.defaultLinkAnchor=de(o)),fe(g)&&(e.interactive=tt({},g)),fe(l)&&(e.highlighting=on({},l,pn)),e.origin=tt({},s)},children:function(){var t=F.namespace;return[{namespaceURI:t.xhtml,tagName:"div",className:Ze("paper-background"),selector:"background"},{namespaceURI:t.xhtml,tagName:"div",className:Ze("paper-grid"),selector:"grid"},{namespaceURI:t.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":t.xlink},selector:"svg",children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:Ze("layers"),selector:"layers"}]}]},hasLayerView:function(e){return e in this._layers},getLayerView:function(e){var r=this,i=r._layers;if(e in i)return i[e];throw new Error('dia.Paper: Unknown layer "'+e+'"')},getLayerNode:function(e){return this.getLayerView(e).el},render:function(){this.renderChildren();var t=this,e=t.childNodes,r=t.options,i=e.svg,n=e.defs,a=e.layers,o=e.background,s=e.grid;return this.svg=i,this.defs=n,this.layers=a,this.$background=f(o),this.$grid=f(s),this.renderLayers(),F.ensureId(i),r.background&&this.drawBackground(r.background),r.drawGrid&&this.drawGrid(),this},renderLayers:function(t){var e=this;t===void 0&&(t=LI),this.removeLayers(),t.forEach(function(a){var o=a.name;a.sorted;var s=new Og({name:o});e.layers.appendChild(s.el),e._layers[o]=s});var r=this.getLayerView(lr.CELLS),i=this.getLayerView(lr.TOOLS),n=this.getLayerView(lr.LABELS);this.tools=i.el,this.cells=this.viewport=r.el,r.vel.addClass(Ze("viewport")),n.vel.addClass(Ze("viewport"))},removeLayers:function(){var t=this,e=t._layers;Object.keys(e).forEach(function(r){e[r].remove(),delete e[r]})},resetLayers:function(){var t=this,e=t._layers;Object.keys(e).forEach(function(r){e[r].removePivots()})},update:function(){return this.options.drawGrid&&this.drawGrid(),this._background&&this.updateBackgroundImage(this._background),this},matrix:function(t){var e=this.layers;if(t===void 0){var r=e.getAttribute("transform");return(this._viewportTransformString||null)===r?t=this._viewportMatrix:(t=e.getCTM(),this._viewportMatrix=t,this._viewportTransformString=r),F.createSVGMatrix(t)}t=F.createSVGMatrix(t);var i=F.matrixToTransformString(t);return e.setAttribute("transform",i),this._viewportMatrix=t,this._viewportTransformString=e.getAttribute("transform"),this},clientMatrix:function(){return F.createSVGMatrix(this.cells.getScreenCTM())},requestConnectedLinksUpdate:function(t,e,r){if(t instanceof Vt)for(var i=t.model,n=this.model.getConnectedLinks(i),a=0,o=n.length;a<o;a++){var s=n[a],l=this.findViewByModel(s);if(!!l){var u=["UPDATE"];s.getTargetCell()===i&&u.push("TARGET"),s.getSourceCell()===i&&u.push("SOURCE");var g=Math.max(e+1,l.UPDATE_PRIORITY);this.scheduleViewUpdate(l,l.getFlag(u),g,r)}}},forcePostponedViewUpdate:function(t,e){if(!t||!(t instanceof Vt))return!1;var r=t.model;if(r.isElement())return!1;if((e&t.getFlag(["SOURCE","TARGET"]))===0){var i=0,n=this.findViewByModel(r.getSourceCell());n&&!this.isViewMounted(n)&&(i=this.dumpView(n),t.updateEndMagnet("source"));var a=0,o=this.findViewByModel(r.getTargetCell());if(o&&!this.isViewMounted(o)&&(a=this.dumpView(o),t.updateEndMagnet("target")),i===0&&a===0)return!this.dumpView(t)}return!1},requestViewUpdate:function(t,e,r,i){i||(i={}),this.scheduleViewUpdate(t,e,r,i);var n=this.isAsync();if(!(this.isFrozen()||n&&i.async!==!1)&&!this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)){var a=this.updateViews(i);n&&this.notifyAfterRender(a,i)}},scheduleViewUpdate:function(t,e,r,i){var n=this,a=n._updates,o=n.options,s=t.FLAG_REMOVE,l=t.FLAG_INSERT,u=t.UPDATE_PRIORITY,g=t.cid,h=a.priorities[r];if(h||(h=a.priorities[r]={}),r>u)for(var y=r-1;y>=u;y--){var x=a.priorities[y];!x||!(g in x)||(h[g]|=x[g],delete x[g])}var C=h[g]||0;if((C&e)!==e){C||a.count++,e&s&&C&l?h[g]^=l:e&l&&C&s&&(h[g]^=s),h[g]|=e;var p=o.onViewUpdate;typeof p=="function"&&p.call(this,t,e,r,i||{},this)}},dumpViewUpdate:function(t){if(!t)return 0;var e=this._updates,r=t.cid,i=e.priorities[t.UPDATE_PRIORITY],n=this.registerMountedView(t)|i[r];return delete i[r],n},dumpView:function(t,e){var r=this.dumpViewUpdate(t);return r?this.updateView(t,r,e):0},updateView:function(t,e,r){if(!t)return 0;var i=t.FLAG_REMOVE,n=t.FLAG_INSERT,a=t.model;if(t instanceof Vt){if(e&i)return this.removeView(a),0;e&n&&(this.insertView(t),e^=n)}return e?t.confirmUpdate(e,r||{}):0},requireView:function(t,e){var r=this.findViewByModel(t);return r?(this.dumpView(r,e),r):null},registerUnmountedView:function(t){var e=t.cid,r=this._updates;if(e in r.unmounted)return 0;var i=r.unmounted[e]|=t.FLAG_INSERT;return r.unmountedCids.push(e),delete r.mounted[e],i},registerMountedView:function(t){var e=t.cid,r=this._updates;if(e in r.mounted)return 0;r.mounted[e]=!0,r.mountedCids.push(e);var i=r.unmounted[e]||0;return delete r.unmounted[e],i},isViewMounted:function(t){if(!t)return!1;var e=t.cid,r=this._updates;return e in r.mounted},dumpViews:function(t){var e=ne({},t,{viewport:null});this.checkViewport(e),this.updateViews(e)},updateViews:function(t){this.notifyBeforeRender(t);var e,r=0,i=0,n=da;do i++,e=this.updateViewsBatch(t),r+=e.updated,n=Math.min(e.priority,n);while(!e.empty);var a={updated:r,batches:i,priority:n};return this.notifyAfterRender(a,t),a},hasScheduledUpdates:function(){for(var t=this._updates.priorities,e=Object.keys(t),r=e.length;r>0&&r--;)for(var i in t[e[r]])return!0;return!1},updateViewsAsync:function(t,e){t||(t={}),e||(e={processed:0,priority:da});var r=this._updates,i=r.id;if(i){Ti(i),e.processed===0&&this.hasScheduledUpdates()&&this.notifyBeforeRender(t);var n=this.updateViewsBatch(t),a=ne({},t,{mountBatchSize:_g-n.mounted,unmountBatchSize:_g-n.unmounted}),o=this.checkViewport(a),s=o.unmounted,l=o.mounted,u=e.processed,g=r.count;n.updated>0&&(u+=n.updated+n.unmounted,n.processed=u,e.priority=Math.min(n.priority,e.priority),n.empty&&l===0?(n.unmounted+=s,n.mounted+=l,n.priority=e.priority,this.notifyAfterRender(n,t),e.processed=0,e.priority=da,r.count=0):e.processed=u);var h=t.progress;if(g&&typeof h=="function"&&h.call(this,n.empty,u,g,n,this),r.id!==i)return}r.id=Pi(this.updateViewsAsync,this,t,e)},notifyBeforeRender:function(t){t===void 0&&(t={});var e=t.beforeRender;typeof e!="function"&&(e=this.options.beforeRender,typeof e!="function")||e.call(this,t,this)},notifyAfterRender:function(t,e){e===void 0&&(e={});var r=e.afterRender;typeof r!="function"&&(r=this.options.afterRender),typeof r=="function"&&r.call(this,t,e,this),this.trigger("render:done",t,e)},updateViewsBatch:function(t){t||(t={});var e=t.batchSize||NI,r=this._updates,i=0,n=0,a=0,o=0,s=da,l=!0,u=this.options,g=r.priorities,h="viewport"in t?t.viewport:u.viewport;typeof h!="function"&&(h=null);var y=u.onViewPostponed;typeof y!="function"&&(y=null);var x=Object.keys(g);t:for(var C=0,p=x.length;C<p;C++){var E=+x[C],k=g[E];for(var w in k){if(i>=e){l=!1;break t}var S=Er[w];if(!S){delete k[w];continue}var T=k[w];if((T&S.FLAG_REMOVE)===0){var m=w in r.unmounted;if(S.DETACHABLE&&h&&!h.call(this,S,!m,this)){m||(this.registerUnmountedView(S),S.unmount()),r.unmounted[w]|=T,delete k[w],a++;continue}m&&(T|=S.FLAG_INSERT,o++),T|=this.registerMountedView(S)}var A=this.updateView(S,T,t);if(A>0&&(k[w]=A,!y||!y.call(this,S,A,this)||k[w])){n++,l=!1;continue}s>E&&(s=E),i++,delete k[w]}}return{priority:s,updated:i,postponed:n,unmounted:a,mounted:o,empty:l}},getUnmountedViews:function(){for(var t=this._updates,e=Object.keys(t.unmounted),r=e.length,i=new Array(r),n=0;n<r;n++)i[n]=Er[e[n]];return i},getMountedViews:function(){for(var t=this._updates,e=Object.keys(t.mounted),r=e.length,i=new Array(r),n=0;n<r;n++)i[n]=Er[e[n]];return i},checkUnmountedViews:function(t,e){e||(e={});var r=0;typeof t!="function"&&(t=null);for(var i=("mountBatchSize"in e)?e.mountBatchSize:1/0,n=this._updates,a=n.unmountedCids,o=n.unmounted,s=0,l=Math.min(a.length,i);s<l;s++){var u=a[s];if(u in o){var g=Er[u];if(!!g){if(g.DETACHABLE&&t&&!t.call(this,g,!1,this)){a.push(u);continue}r++;var h=this.registerMountedView(g);h&&this.scheduleViewUpdate(g,h,g.UPDATE_PRIORITY,{mounting:!0})}}}return a.splice(0,s),r},checkMountedViews:function(t,e){e||(e={});var r=0;if(typeof t!="function")return r;for(var i=("unmountBatchSize"in e)?e.unmountBatchSize:1/0,n=this._updates,a=n.mountedCids,o=n.mounted,s=0,l=Math.min(a.length,i);s<l;s++){var u=a[s];if(u in o){var g=Er[u];if(!!g){if(!g.DETACHABLE||t.call(this,g,!0,this)){a.push(u);continue}r++;var h=this.registerUnmountedView(g);h&&g.unmount()}}}return a.splice(0,s),r},checkViewport:function(t){var e=ne({},t,{mountBatchSize:1/0,unmountBatchSize:1/0}),r="viewport"in e?e.viewport:this.options.viewport,i=this.checkMountedViews(r,e);if(i>0){var n=this._updates.unmountedCids;e.mountBatchSize=Math.min(n.length-i,e.mountBatchSize)}var a=this.checkUnmountedViews(r,e);return{mounted:a,unmounted:i}},freeze:function(t){t||(t={});var e=this._updates,r=t.key,i=this.options.frozen,n=e.freezeKey;if(r&&r!==n){if(i&&n)return;e.freezeKey=r,e.keyFrozen=i}this.options.frozen=!0;var a=e.id;e.id=null,this.isAsync()&&a&&Ti(a)},unfreeze:function(t){t||(t={});var e=this._updates,r=t.key,i=e.freezeKey;r&&i&&r!==i||(e.freezeKey=null,!(r&&r===i&&e.keyFrozen)&&(this.isAsync()?(this.freeze(),this.updateViewsAsync(t)):this.updateViews(t),this.options.frozen=e.keyFrozen=!1,e.sort&&(this.sortViews(),e.sort=!1)))},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen},isExactSorting:function(){return this.options.sorting===Di.EXACT},onRemove:function(){this.freeze(),this.removeLayers(),this.removeViews()},getComputedSize:function(){var t=this.options,e=t.width,r=t.height;return Nt(e)||(e=this.el.clientWidth),Nt(r)||(r=this.el.clientHeight),{width:e,height:r}},setDimensions:function(t,e){var r=this,i=r.options,n=i.width,a=i.height,o=t===void 0?n:t,s=e===void 0?a:e;if(!(n===o&&a===s)){i.width=o,i.height=s,this._setDimensions();var l=this.getComputedSize();this.trigger("resize",l.width,l.height)}},_setDimensions:function(){var t=this,e=t.options,r=e.width,i=e.height;Nt(r)&&(r=Math.round(r)),Nt(i)&&(i=Math.round(i)),this.$el.css({width:r===null?"":r,height:i===null?"":i})},setOrigin:function(t,e){return this.translate(t||0,e||0)},fitToContent:function(t,e,r,i){Yt(t)?i=t:i=tt({gridWidth:t,gridHeight:e,padding:r},i);var n=this.getFitToContentArea(i),a=n.x,o=n.y,s=n.width,l=n.height,u=this.scale(),g=u.sx,h=u.sy;return this.setOrigin(-a*g,-o*h),this.setDimensions(s*g,l*h),new at(a,o,s,l)},getFitToContentArea:function(t){t===void 0&&(t={});var e=t.gridWidth||1,r=t.gridHeight||1,i=he(t.padding||0),n=Math.max(t.minWidth||0,e),a=Math.max(t.minHeight||0,r),o=t.maxWidth||Number.MAX_VALUE,s=t.maxHeight||Number.MAX_VALUE,l=t.allowNewOrigin,u="contentArea"in t?new at(t.contentArea):this.getContentArea(t),g=this.scale(),h=g.sx,y=g.sy;u.x*=h,u.y*=y,u.width*=h,u.height*=y;var x=Math.ceil((u.width+u.x)/e),C=Math.ceil((u.height+u.y)/r);t.allowNegativeBottomRight||(x=Math.max(x,1),C=Math.max(C,1)),x*=e,C*=r;var p=0;(l==="negative"&&u.x<0||l==="positive"&&u.x>=0||l==="any")&&(p=Math.ceil(-u.x/e)*e,p+=i.left,x+=p);var E=0;return(l==="negative"&&u.y<0||l==="positive"&&u.y>=0||l==="any")&&(E=Math.ceil(-u.y/r)*r,E+=i.top,C+=E),x+=i.right,C+=i.bottom,x=Math.max(x,n),C=Math.max(C,a),x=Math.min(x,o),C=Math.min(C,s),new at(-p/h,-E/y,x/h,C/y)},scaleContentToFit:function(t){t||(t={});var e,r;if("contentArea"in t){var i=t.contentArea;e=this.localToPaperRect(i),r=new Z(i)}else e=this.getContentBBox(t),r=this.paperToLocalPoint(e);if(!(!e.width||!e.height)){ne(t,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var n=he(t.padding),a=t.minScaleX||t.minScale,o=t.maxScaleX||t.maxScale,s=t.minScaleY||t.minScale,l=t.maxScaleY||t.maxScale,u;if(t.fittingBBox)u=t.fittingBBox;else{var g=this.translate(),h=this.getComputedSize();u={x:g.tx,y:g.ty,width:h.width,height:h.height}}u=new at(u).moveAndExpand({x:n.left,y:n.top,width:-n.left-n.right,height:-n.top-n.bottom});var y=this.scale(),x=u.width/e.width*y.sx,C=u.height/e.height*y.sy;if(t.preserveAspectRatio&&(x=C=Math.min(x,C)),t.scaleGrid){var p=t.scaleGrid;x=p*Math.floor(x/p),C=p*Math.floor(C/p)}x=Math.min(o,Math.max(a,x)),C=Math.min(l,Math.max(s,C));var E=this.options.origin,k=u.x-r.x*x-E.x,w=u.y-r.y*C-E.y;this.scale(x,C),this.translate(k,w)}},getContentArea:function(t){return t&&t.useModelGeometry?this.model.getBBox()||new at:F(this.cells).getBBox()},getContentBBox:function(t){return this.localToPaperRect(this.getContentArea(t))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=this.options,i=r.restrictTranslate,n;return yt(i)?n=i.apply(this,t):i===!0?n=this.getArea():i?n=new at(i):n=null,n},createViewForModel:function(t){var e=this,r=e.options,i,n,a=r.cellViewNamespace,o=t.get("type")+"View",s=Ye(a,o,".");t.isLink()?(i=r.linkView,n=Ei):(i=r.elementView,n=kt);var l=i.prototype instanceof d.View?s||i:i.call(this,t)||s||n;return new l({model:t,interactive:r.interactive,labelsLayer:r.labelsLayer===!0?lr.LABELS:r.labelsLayer})},removeView:function(t){var e=t.id,r=this,i=r._views,n=r._updates,a=i[e];if(a){var o=a.cid,s=n.mounted,l=n.unmounted;a.remove(),delete i[e],delete s[o],delete l[o]}return a},renderView:function(t,e){var r=t.id,i=this._views,n,a,o=!0;return r in i&&(n=i[r],n.model===t?(a=n.FLAG_INSERT,o=!1):this.removeView(t)),o&&(n=i[r]=this.createViewForModel(t),n.paper=this,a=this.registerUnmountedView(n)|n.getFlag(re(n,"initFlag"))),this.requestViewUpdate(n,a,n.UPDATE_PRIORITY,e),n},onImageDragStart:function(){return!1},resetViews:function(t,e){e||(e={}),t||(t=[]),this._resetUpdates(),this.removeViews(),this.freeze({key:"reset"});for(var r=0,i=t.length;r<i;r++)this.renderView(t[r],e);this.unfreeze({key:"reset"}),this.sortViews()},removeViews:function(){me(this._views,"remove"),this._views={}},sortViews:function(){if(!!this.isExactSorting()){if(this.isFrozen()){this._updates.sort=!0;return}this.sortViewsExact()}},sortViewsExact:function(){var t=f(this.cells).children("[model-id]"),e=this.model.get("cells");Af(t,function(r,i){var n=e.get(r.getAttribute("model-id")),a=e.get(i.getAttribute("model-id")),o=n.attributes.z||0,s=a.attributes.z||0;return o===s?0:o<s?-1:1})},insertView:function(t){var e=this.getLayerView(lr.CELLS),r=t.el,i=t.model;switch(this.options.sorting){case Di.APPROX:e.insertSortedNode(r,i.get("z"));break;case Di.EXACT:default:e.insertNode(r);break}t.onMount()},scale:function(t,e,r,i){if(t===void 0)return F.matrixToScale(this.matrix());e===void 0&&(e=t),r===void 0&&(r=0,i=0);var n=this.translate();if(r||i||n.tx||n.ty){var a=n.tx-r*(t-1),o=n.ty-i*(e-1);this.translate(a,o)}t=Math.max(t||0,this.MIN_SCALE),e=Math.max(e||0,this.MIN_SCALE);var s=this.matrix();return s.a=t,s.d=e,this.matrix(s),this.trigger("scale",t,e,r,i),this},rotate:function(t,e,r){if(t===void 0)return F.matrixToRotate(this.matrix());if(e===void 0){var i=this.cells.getBBox();e=i.width/2,r=i.height/2}var n=this.matrix().translate(e,r).rotate(t).translate(-e,-r);return this.matrix(n),this},translate:function(t,e){if(t===void 0)return F.matrixToTranslate(this.matrix());var r=this,i=r.options,n=i.origin,a=i.drawGrid;t||(t=0),e||(e=0);var o=this.matrix();if(o.e===t&&o.f===e)return this;o.e=t,o.f=e,this.matrix(o);var s=this.translate(),l=s.tx,u=s.ty;return n.x=l,n.y=u,this.trigger("translate",l,u),a&&this.drawGrid(),this},findView:function(t){var e=$t(t)?this.cells.querySelector(t):t instanceof f?t[0]:t,r=this.findAttribute("model-id",e);if(r)return this._views[r]},findViewByModel:function(t){var e=$t(t)||Nt(t)?t:t&&t.id;return this._views[e]},findViewsFromPoint:function(t){t=new Z(t);var e=this.model.getElements().map(this.findViewByModel,this);return e.filter(function(r){return r&&r.vel.getBBox({target:this.cells}).containsPoint(t)},this)},findViewsInArea:function(t,e){e=ne(e||{},{strict:!1}),t=new at(t);var r=this.model.getElements().map(this.findViewByModel,this),i=e.strict?"containsRect":"intersect";return r.filter(function(n){return n&&t[i](n.vel.getBBox({target:this.cells}))},this)},removeTools:function(){return this.dispatchToolsEvent("remove"),this},hideTools:function(){return this.dispatchToolsEvent("hide"),this},showTools:function(){return this.dispatchToolsEvent("show"),this},dispatchToolsEvent:function(t){for(var e,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];typeof t=="string"&&(e=this).trigger.apply(e,["tools:event",t].concat(r))},getModelById:function(t){return this.model.getCell(t)},snapToGrid:function(t,e){return this.clientToLocalPoint(t,e).snapToGrid(this.options.gridSize)},localToPaperPoint:function(t,e){var r=new Z(t,e),i=F.transformPoint(r,this.matrix());return i},localToPaperRect:function(t,e,r,i){var n=new at(t,e,r,i),a=F.transformRect(n,this.matrix());return a},paperToLocalPoint:function(t,e){var r=new Z(t,e),i=F.transformPoint(r,this.matrix().inverse());return i},paperToLocalRect:function(t,e,r,i){var n=new at(t,e,r,i),a=F.transformRect(n,this.matrix().inverse());return a},localToClientPoint:function(t,e){var r=new Z(t,e),i=F.transformPoint(r,this.clientMatrix());return i},localToClientRect:function(t,e,r,i){var n=new at(t,e,r,i),a=F.transformRect(n,this.clientMatrix());return a},clientToLocalPoint:function(t,e){var r=new Z(t,e),i=F.transformPoint(r,this.clientMatrix().inverse());return i},clientToLocalRect:function(t,e,r,i){var n=new at(t,e,r,i),a=F.transformRect(n,this.clientMatrix().inverse());return a},localToPagePoint:function(t,e){return this.localToPaperPoint(t,e).offset(this.pageOffset())},localToPageRect:function(t,e,r,i){return this.localToPaperRect(t,e,r,i).offset(this.pageOffset())},pageToLocalPoint:function(t,e){var r=new Z(t,e),i=r.difference(this.pageOffset());return this.paperToLocalPoint(i)},pageToLocalRect:function(t,e,r,i){var n=this.pageOffset(),a=new at(t,e,r,i);return a.x-=n.x,a.y-=n.y,this.paperToLocalRect(a)},clientOffset:function(){var t=this.svg.getBoundingClientRect();return new Z(t.left,t.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(t){if(!(t instanceof Ei))throw new Error("Must provide a linkView.");var e=t.model,r=this.options,i=this.model,n=i.constructor.validations;return!(!r.multiLinks&&!n.multiLinks.call(this,i,e)||!r.linkPinning&&!n.linkPinning.call(this,i,e)||typeof r.allowLink=="function"&&!r.allowLink.call(this,t,this))},getDefaultLink:function(t,e){return yt(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()},resolveHighlighter:function(t){t===void 0&&(t={});var e=t.highlighter,r=t.type,i=this.options,n=i.highlighting,a=i.highlighterNamespace;if(e===void 0){if(!n||r&&(e=n[r],e===!1))return!1;e||(e=n.default)}if(!e)return!1;$t(e)&&(e={name:e});var o=e.name,s=a[o];if(!s)throw new Error('Unknown highlighter ("'+o+'")');if(typeof s.highlight!="function")throw new Error('Highlighter ("'+o+'") is missing required highlight() method');if(typeof s.unhighlight!="function")throw new Error('Highlighter ("'+o+'") is missing required unhighlight() method');return{highlighter:s,options:e.options||{},name:o}},onCellHighlight:function(t,e,r){var i=this.resolveHighlighter(r);if(!!i){var n=i.highlighter,a=i.options;n.highlight(t,e,a)}},onCellUnhighlight:function(t,e,r){var i=this.resolveHighlighter(r);if(!!i){var n=i.highlighter,a=i.options;n.unhighlight(t,e,a)}},pointerdblclick:function(t){t.preventDefault(),t=ot(t);var e=this.findView(t.target);if(!this.guard(t,e)){var r=this.snapToGrid(t.clientX,t.clientY);e?e.pointerdblclick(t,r.x,r.y):this.trigger("blank:pointerdblclick",t,r.x,r.y)}},pointerclick:function(t){var e=this.eventData(t);if(e.mousemoved<=this.options.clickThreshold){t=ot(t);var r=this.findView(t.target);if(this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r?r.pointerclick(t,i.x,i.y):this.trigger("blank:pointerclick",t,i.x,i.y)}},contextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.contextMenuFired){this.contextMenuFired=!1;return}t=ot(t),this.contextMenuTrigger(t)},contextMenuTrigger:function(t){var e=this.findView(t.target);if(!this.guard(t,e)){var r=this.snapToGrid(t.clientX,t.clientY);e?e.contextmenu(t,r.x,r.y):this.trigger("blank:contextmenu",t,r.x,r.y)}},pointerdown:function(t){if(t=ot(t),t.button===2){this.contextMenuFired=!0;var e=f.Event(t,{type:"contextmenu",data:t.data});this.contextMenuTrigger(e)}else{var r=this.findView(t.target);if(this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r?(t.preventDefault(),r.pointerdown(t,i.x,i.y)):(this.options.preventDefaultBlankAction&&t.preventDefault(),this.trigger("blank:pointerdown",t,i.x,i.y)),this.delegateDragEvents(r,t.data)}},pointermove:function(t){var e=this.eventData(t);e.mousemoved||(e.mousemoved=0,this.undelegateEvents());var r=++e.mousemoved;if(!(r<=this.options.moveThreshold)){t=ot(t);var i=this.snapToGrid(t.clientX,t.clientY),n=e.sourceView;n?n.pointermove(t,i.x,i.y):this.trigger("blank:pointermove",t,i.x,i.y),this.eventData(t,e)}},pointerup:function(t){this.undelegateDocumentEvents();var e=ot(t),r=this.snapToGrid(e.clientX,e.clientY),i=this.eventData(t).sourceView;i?i.pointerup(e,r.x,r.y):this.trigger("blank:pointerup",e,r.x,r.y),e.isPropagationStopped()||this.pointerclick(f.Event(t,{type:"click",data:t.data})),t.stopImmediatePropagation(),this.delegateEvents()},mouseover:function(t){t=ot(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseover(t);else{if(this.el===t.target)return;this.trigger("blank:mouseover",t)}},mouseout:function(t){t=ot(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseout(t);else{if(this.el===t.target)return;this.trigger("blank:mouseout",t)}},mouseenter:function(t){t=ot(t);var e=t.target,r=t.relatedTarget,i=t.currentTarget,n=this.findView(e);if(!this.guard(t,n)){var a=this.findView(r);n&&(a===n||(n.mouseenter(t),this.el.contains(r)))||a||i===this.el&&this.trigger("paper:mouseenter",t)}},mouseleave:function(t){t=ot(t);var e=t.target,r=t.relatedTarget,i=t.currentTarget,n=this.findView(e);if(!this.guard(t,n)){var a=this.findView(r);n&&(a===n||(n.mouseleave(t),this.el.contains(r)))||a||i===this.el&&this.trigger("paper:mouseleave",t)}},_processMouseWheelEvtBuf:sn(function(){var t=this._mw_evt_buffer,e=t.event,r=t.deltas,i=r.reduce(function(l,u){return l+mf(u,TI)},0),n=Math.pow(.995,i),a=this.clientToLocalPoint(e.clientX,e.clientY),o=a.x,s=a.y;this.trigger("paper:pinch",e,o,s,n),this._mw_evt_buffer={event:null,deltas:[]}},Rg,{maxWait:Rg}),mousewheel:function(t){t=ot(t);var e=this.findView(t.target);if(!this.guard(t,e)){var r=t.originalEvent,i=this.snapToGrid(r.clientX,r.clientY),n=pf(r),a=n.deltaX,o=n.deltaY;if(t.ctrlKey){var s=this._events["paper:pinch"];s&&s.length>0&&(r.preventDefault(),this._mw_evt_buffer.event=r,this._mw_evt_buffer.deltas.push(o),this._processMouseWheelEvtBuf())}else{var l=Math.max(-1,Math.min(1,r.wheelDelta));e?e.mousewheel(t,i.x,i.y,l):this.trigger("blank:mousewheel",t,i.x,i.y,l),this.trigger("paper:pan",t,a,o)}}},onevent:function(t){var e=t.currentTarget,r=e.getAttribute("event");if(r){var i=this.findView(e);if(i){if(t=ot(t),this.guard(t,i))return;var n=this.snapToGrid(t.clientX,t.clientY);i.onevent(t,r,n.x,n.y)}}},magnetEvent:function(t,e){var r=t.currentTarget,i=r.getAttribute("magnet");if(i){var n=this.findView(r);if(n){if(t=ot(t),this.guard(t,n))return;var a=this.snapToGrid(t.clientX,t.clientY);e.call(this,n,t,r,a.x,a.y)}}},onmagnet:function(t){if(t.button===2){this.contextMenuFired=!0,this.magnetContextMenuFired=!0;var e=f.Event(t,{type:"contextmenu",data:t.data});this.magnetContextMenuTrigger(e),e.isPropagationStopped()&&t.stopPropagation()}else this.magnetEvent(t,function(r,i,n,a,o){r.onmagnet(i,a,o)})},magnetpointerdblclick:function(t){this.magnetEvent(t,function(e,r,i,n,a){e.magnetpointerdblclick(r,i,n,a)})},magnetcontextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.magnetContextMenuFired){this.magnetContextMenuFired=!1;return}this.magnetContextMenuTrigger(t)},magnetContextMenuTrigger:function(t){this.magnetEvent(t,function(e,r,i,n,a){e.magnetcontextmenu(r,i,n,a)})},onlabel:function(t){var e=t.currentTarget,r=this.findView(e);if(r){if(t=ot(t),this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r.onlabel(t,i.x,i.y)}},getPointerArgs:function(e){var r=ot(e),i=this.snapToGrid(r.clientX,r.clientY),n=i.x,a=i.y;return[r,n,a]},delegateDragEvents:function(t,e){e||(e={}),this.eventData({data:e},{sourceView:t||null,mousemoved:0}),this.delegateDocumentEvents(null,e)},guard:function(t,e){return t.type==="mousedown"&&t.button===2||this.options.guard&&this.options.guard(t,e)?!0:t.data&&t.data.guarded!==void 0?t.data.guarded:!(e&&e.model&&e.model instanceof Be||this.svg===t.target||this.el===t.target||f.contains(this.svg,t.target))},setGridSize:function(t){return this.options.gridSize=t,this.options.drawGrid&&this.drawGrid(),this},clearGrid:function(){return this.$grid&&this.$grid.css("backgroundImage","none"),this},_getGridRefs:function(){return this._gridCache||(this._gridCache={root:F("svg",{width:"100%",height:"100%"},F("defs")),patterns:{},add:function(t,e){F(this.root.node.childNodes[0]).append(e),this.patterns[t]=e,this.root.append(F("rect",{width:"100%",height:"100%",fill:"url(#"+t+")"}))},get:function(t){return this.patterns[t]},exist:function(t){return this.patterns[t]!==void 0}}),this._gridCache},setGrid:function(t){this.clearGrid(),this._gridCache=null,this._gridSettings=[];var e=Array.isArray(t)?t:[t||{}];return e.forEach(function(r){this._gridSettings.push.apply(this._gridSettings,this._resolveDrawGridOption(r))},this),this},_resolveDrawGridOption:function(t){var e=this.constructor.gridPatterns;if($t(t)&&Array.isArray(e[t]))return e[t].map(function(l){return tt({},l)});var r=t||{args:[{}]},i=Array.isArray(r),n=r.name;if(!i&&!n&&!r.markup&&(n="dot"),n&&Array.isArray(e[n])){var a=e[n].map(function(l){return tt({},l)}),o=Array.isArray(r.args)?r.args:[r.args||{}];ne(o[0],Ce(t,"args"));for(var s=0;s<o.length;s++)a[s]&&tt(a[s],o[s]);return a}return i?r:[r]},drawGrid:function(t){var e=this.options.gridSize;if(e<=1)return this.clearGrid();var r=Array.isArray(t)?t:[t],i=this.matrix(),n=this._getGridRefs();this._gridSettings.forEach(function(o,s){var l="pattern_"+s,u=ie(o,r[s],{sx:i.a||1,sy:i.d||1,ox:i.e||0,oy:i.f||0});u.width=e*(i.a||1)*(u.scaleFactor||1),u.height=e*(i.d||1)*(u.scaleFactor||1),n.exist(l)||n.add(l,F("pattern",{id:l,patternUnits:"userSpaceOnUse"},F(u.markup)));var g=n.get(l);yt(u.update)&&u.update(g.node.childNodes[0],u);var h=u.ox%u.width;h<0&&(h+=u.width);var y=u.oy%u.height;y<0&&(y+=u.height),g.attr({x:h,y,width:u.width,height:u.height})});var a=new XMLSerializer().serializeToString(n.root.node);return a="url(data:image/svg+xml;base64,"+btoa(a)+")",this.$grid.css("backgroundImage",a),this},updateBackgroundImage:function(t){t=t||{};var e=t.position||"center",r=t.size||"auto auto",i=this.scale(),n=this.translate();if(Yt(e)){var a=n.tx+i.sx*(e.x||0),o=n.ty+i.sy*(e.y||0);e=a+"px "+o+"px"}Yt(r)&&(r=new at(r).scale(i.sx,i.sy),r=r.width+"px "+r.height+"px"),this.$background.css({backgroundSize:r,backgroundPosition:e})},drawBackgroundImage:function(t,e){if(!(t instanceof HTMLImageElement)){this.$background.css("backgroundImage","");return}if(!(!this._background||this._background.id!==e.id)){e=e||{};var r,i=e.size,n=e.repeat||"no-repeat",a=e.opacity||1,o=Math.abs(e.quality)||1,s=this.constructor.backgroundPatterns[un(n)];if(yt(s)){t.width*=o,t.height*=o;var l=s(t,e);if(!(l instanceof HTMLCanvasElement))throw new Error("dia.Paper: background pattern must return an HTML Canvas instance");r=l.toDataURL("image/png"),n="repeat",Yt(i)?(i.width*=l.width/t.width,i.height*=l.height/t.height):i===void 0&&(e.size={width:l.width/o,height:l.height/o})}else r=t.src,i===void 0&&(e.size={width:t.width,height:t.height});this.$background.css({opacity:a,backgroundRepeat:n,backgroundImage:"url("+r+")"}),this.updateBackgroundImage(e)}},updateBackgroundColor:function(t){this.$el.css("backgroundColor",t||"")},drawBackground:function(t){if(t=t||{},this.updateBackgroundColor(t.color),t.image){t=this._background=de(t),Ur(t);var e=document.createElement("img");e.onload=this.drawBackgroundImage.bind(this,e,t),e.src=t.image}else this.drawBackgroundImage(null),this._background=null;return this},setInteractivity:function(t){this.options.interactive=t,me(this._views,"setInteractivity",t)},isDefined:function(t){return!!this.svg.getElementById(t)},defineFilter:function(t){if(!Yt(t))throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.");var e=t.id,r=t.name;if(e||(e=r+this.svg.id+rn(JSON.stringify(t))),!this.isDefined(e)){var i=If,n=i[r]&&i[r](t.args||{});if(!n)throw new Error("Non-existing filter "+r);var a=tt({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3},t.attrs,{id:e});F(n,a).appendTo(this.defs)}return e},defineGradient:function(t){if(!Yt(t))throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.");var e=this,r=e.svg,i=e.defs,n=t.type,a=t.id;a===void 0&&(a=n+r.id+rn(JSON.stringify(t)));var o=t.stops,s=t.attrs;if(s===void 0&&(s={}),this.isDefined(a))return a;var l=lt(o).map(function(g){var h=g.offset,y=g.color,x=g.opacity;return F("stop").attr({offset:h,"stop-color":y,"stop-opacity":Number.isFinite(x)?x:1})}),u=F(n,s,l);return u.id=a,u.appendTo(i),a},definePattern:function(t){if(!Yt(t))throw new TypeError("dia.Paper: definePattern() requires 1. argument to be an object.");var e=this,r=e.svg,i=e.defs,n=t.id;n===void 0&&(n=r.id+rn(JSON.stringify(t)));var a=t.markup,o=t.attrs;if(o===void 0&&(o={}),!a)throw new TypeError("dia.Paper: definePattern() requires markup.");if(this.isDefined(n))return n;var s=F("pattern",{patternUnits:"userSpaceOnUse"});if(s.id=n,s.attr(o),typeof a=="string")s.append(F(a));else{var l=en(a),u=l.fragment;s.append(u)}return s.appendTo(i),n},defineMarker:function(t){if(!Yt(t))throw new TypeError("dia.Paper: defineMarker() requires 1. argument to be an object.");var e=this,r=e.svg,i=e.defs,n=t.id;n===void 0&&(n=r.id+rn(JSON.stringify(t)));var a=t.markup,o=t.attrs;o===void 0&&(o={});var s=t.markerUnits;if(s===void 0&&(s="userSpaceOnUse"),this.isDefined(n))return n;var l=F("marker",{orient:"auto",overflow:"visible",markerUnits:s});if(l.id=n,l.attr(o),a)if(typeof a=="string")l.append(F(a));else{var u=en(a),g=u.fragment;l.append(g)}else{var h=t.type;h===void 0&&(h="path");var y=F(h,Ce(t,"type","id","markup","attrs","markerUnits"));l.append(y)}return l.appendTo(i),n}},{sorting:Di,Layers:lr,backgroundPatterns:{flipXy:function(t){var e=document.createElement("canvas"),r=t.width,i=t.height;e.width=2*r,e.height=2*i;var n=e.getContext("2d");return n.drawImage(t,0,0,r,i),n.setTransform(-1,0,0,-1,e.width,e.height),n.drawImage(t,0,0,r,i),n.setTransform(-1,0,0,1,e.width,0),n.drawImage(t,0,0,r,i),n.setTransform(1,0,0,-1,0,e.height),n.drawImage(t,0,0,r,i),e},flipX:function(t){var e=document.createElement("canvas"),r=t.width,i=t.height;e.width=r*2,e.height=i;var n=e.getContext("2d");return n.drawImage(t,0,0,r,i),n.translate(2*r,0),n.scale(-1,1),n.drawImage(t,0,0,r,i),e},flipY:function(t){var e=document.createElement("canvas"),r=t.width,i=t.height;e.width=r,e.height=i*2;var n=e.getContext("2d");return n.drawImage(t,0,0,r,i),n.translate(0,2*i),n.scale(1,-1),n.drawImage(t,0,0,r,i),e},watermark:function(t,e){e=e||{};var r=t.width,i=t.height,n=document.createElement("canvas");n.width=r*3,n.height=i*3;for(var a=n.getContext("2d"),o=Nt(e.watermarkAngle)?-e.watermarkAngle:-20,s=bt(o),l=n.width/4,u=n.height/4,g=0;g<4;g++)for(var h=0;h<4;h++)(g+h)%2>0&&(a.setTransform(1,0,0,1,(2*g-1)*l,(2*h-1)*u),a.rotate(s),a.drawImage(t,-r/2,-i/2,r,i));return n}},gridPatterns:{dot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(t,e){F(t).attr({width:e.thickness*e.sx,height:e.thickness*e.sy,fill:e.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(t,e){var r=e.sx<=1?e.thickness*e.sx:e.thickness;F(t).attr({width:r,height:r,fill:e.color})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(t,e){var r,i=e.width,n=e.height,a=e.thickness;i-a>=0&&n-a>=0?r=["M",i,0,"H0 M0 0 V0",n].join(" "):r="M 0 0 0 0",F(t).attr({d:r,stroke:e.color,"stroke-width":e.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(t,e){var r,i=e.width,n=e.height,a=e.thickness;i-a>=0&&n-a>=0?r=["M",i,0,"H0 M0 0 V0",n].join(" "):r="M 0 0 0 0",F(t).attr({d:r,stroke:e.color,"stroke-width":e.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",update:function(t,e){var r,i=e.width,n=e.height,a=e.thickness;i-a>=0&&n-a>=0?r=["M",i,0,"H0 M0 0 V0",n].join(" "):r="M 0 0 0 0",F(t).attr({d:r,stroke:e.color,"stroke-width":e.thickness})}}]}}),yr=Xt.extend({name:null,tagName:"g",className:"tool",svgElement:!0,_visible:!0,init:function(){var t=this.name;t&&this.vel.attr("data-tool-name",t)},configure:function(t,e){return this.relatedView=t,this.paper=t.paper,this.parentView=e,this.simulateRelatedView(this.el),this.delegateEvents(),this},simulateRelatedView:function(t){t&&t.setAttribute("model-id",this.relatedView.model.id)},getName:function(){return this.name},show:function(){this.el.style.display="",this._visible=!0},hide:function(){this.el.style.display="none",this._visible=!1},isVisible:function(){return!!this._visible},focus:function(){var t=this.options.focusOpacity;isFinite(t)&&(this.el.style.opacity=t),this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="",this.parentView.blurTool(this)},update:function(){},guard:function(t){var e=this,r=e.paper,i=e.relatedView;return!r||!i?!0:r.guard(t,i)}}),EI=Xt.extend({tagName:"g",className:"tools",svgElement:!0,tools:null,isRendered:!1,options:{tools:null,relatedView:null,name:null},configure:function(t){t=tt(this.options,t);var e=t.tools;if(!Array.isArray(e))return this;var r=t.relatedView;if(!(r instanceof Vt))return this;for(var i=this.tools=[],n=0,a=e.length;n<a;n++){var o=e[n];o instanceof yr&&(o.configure(r,this),this.vel.append(o.el),i.push(o))}return this.isRendered=!1,r.requestUpdate(r.getFlag("TOOLS")),this},getName:function(){return this.options.name},update:function(t){t||(t={});var e=this.tools;if(!e)return this;for(var r=this.isRendered,i=0,n=e.length;i<n;i++){var a=e[i];r?t.tool!==a.cid&&a.isVisible()&&a.update():a.render()}return r||(this.mount(),this.blurTool(),this.isRendered=!0),this},focusTool:function(t){var e=this.tools;if(!e)return this;for(var r=0,i=e.length;r<i;r++){var n=e[r];t===n?n.show():n.hide()}return this},blurTool:function(t){var e=this.tools;if(!e)return this;for(var r=0,i=e.length;r<i;r++){var n=e[r];n!==t&&!n.isVisible()&&(n.show(),n.update())}return this},hide:function(){return this.focusTool(null)},show:function(){return this.blurTool(null)},onRemove:function(){var t=this.tools;if(!t)return this;for(var e=0,r=t.length;e<r;e++)t[e].remove();this.tools=null},mount:function(){var t=this,e=t.options,r=t.el,i=e.relatedView,n=e.layer;n===void 0&&(n=lr.TOOLS);var a=e.z;return i&&(n?i.paper.getLayerView(n).insertSortedNode(r,a):i.el.appendChild(r)),this}}),DI={__proto__:null,Graph:Ie,attributes:ci,LayersNames:lr,PaperLayer:Og,Cell:Be,CellView:Vt,Element:At,ElementView:kt,Link:le,LinkView:Ei,Paper:Oe,ToolView:yr,ToolsView:EI,HighlighterView:Cr},Gg=Xt.extend({tagName:"circle",svgElement:!0,className:"marker-vertex",events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick",dbltap:"onDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},attributes:{r:6,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move"},position:function(t,e){var r=this,i=r.vel,n=r.options,a=n.scale,o=F.createSVGMatrix().translate(t,e);a&&(o=o.scale(a)),i.transform(o,{absolute:!0})},onPointerDown:function(t){this.options.guard(t)||(t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data),this.trigger("will-change",this,t))},onPointerMove:function(t){this.trigger("changing",this,t)},onDoubleClick:function(t){this.trigger("remove",this,t)},onPointerUp:function(t){this.trigger("changed",this,t),this.undelegateDocumentEvents(),this.options.paper.delegateEvents()}}),zI=yr.extend({name:"vertices",options:{handleClass:Gg,snapRadius:20,redundancyRemoval:!0,vertexAdding:!0,stopPropagation:!0,scale:null},children:[{tagName:"path",selector:"connection",className:"joint-vertices-path",attributes:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"cell"}}],handles:null,events:{"mousedown .joint-vertices-path":"onPathPointerDown","touchstart .joint-vertices-path":"onPathPointerDown"},onRender:function(){return this.options.vertexAdding&&(this.renderChildren(),this.updatePath()),this.resetHandles(),this.renderHandles(),this},update:function(){var t=this.relatedView,e=t.model.vertices();return e.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.vertexAdding&&this.updatePath(),this},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),!!Array.isArray(t))for(var e=0,r=t.length;e<r;e++)t[e].remove()},renderHandles:function(){for(var t=this,e=this.relatedView,r=e.model.vertices(),i=0,n=r.length;i<n;i++){var a=r[i],o=new this.options.handleClass({index:i,paper:this.paper,scale:this.options.scale,guard:function(s){return t.guard(s)}});o.render(),o.position(a.x,a.y),this.simulateRelatedView(o.el),o.vel.appendTo(this.el),this.handles.push(o),this.startHandleListening(o)}},updateHandles:function(){for(var t=this.relatedView,e=t.model.vertices(),r=0,i=e.length;r<i;r++){var n=e[r],a=this.handles[r];if(!a)return;a.position(n.x,n.y)}},updatePath:function(){var t=this.childNodes.connection;t&&t.setAttribute("d",this.relatedView.getSerializedConnection())},startHandleListening:function(t){var e=this.relatedView;e.can("vertexMove")&&(this.listenTo(t,"will-change",this.onHandleWillChange),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"changed",this.onHandleChanged)),e.can("vertexRemove")&&this.listenTo(t,"remove",this.onHandleRemove)},getNeighborPoints:function(t){var e=this.relatedView,r=e.model.vertices(),i=t>0?r[t-1]:e.sourceAnchor,n=t<r.length-1?r[t+1]:e.targetAnchor;return{prev:new Z(i),next:new Z(n)}},onHandleWillChange:function(t,e){this.focus();var r=this,i=r.relatedView,n=r.options;i.model.startBatch("vertex-move",{ui:!0,tool:this.cid}),n.stopPropagation||i.notifyPointerdown.apply(i,i.paper.getPointerArgs(e))},onHandleChanging:function(t,e){var r=this,i=r.options,n=r.relatedView,a=t.options.index,o=n.paper.getPointerArgs(e),s=o[0],l=o[1],u=o[2],g={x:l,y:u};this.snapVertex(g,a),n.model.vertex(a,g,{ui:!0,tool:this.cid}),t.position(g.x,g.y),i.stopPropagation||n.notifyPointermove(s,l,u)},onHandleChanged:function(t,e){var r=this,i=r.options,n=r.relatedView;if(i.vertexAdding&&this.updatePath(),!!i.redundancyRemoval){var a=n.removeRedundantLinearVertices({ui:!0,tool:this.cid});a&&this.render(),this.blur(),n.model.stopBatch("vertex-move",{ui:!0,tool:this.cid}),this.eventData(e).vertexAdded&&n.model.stopBatch("vertex-add",{ui:!0,tool:this.cid});var o=n.paper.getPointerArgs(e),s=o[0],l=o[1],u=o[2];i.stopPropagation||n.notifyPointerup(s,l,u),n.checkMouseleave(s)}},snapVertex:function(t,e){var r=this.options.snapRadius;if(r>0){var i=this.getNeighborPoints(e),n=i.prev,a=i.next;Math.abs(t.x-n.x)<r?t.x=n.x:Math.abs(t.x-a.x)<r&&(t.x=a.x),Math.abs(t.y-n.y)<r?t.y=i.prev.y:Math.abs(t.y-a.y)<r&&(t.y=a.y)}},onHandleRemove:function(t,e){var r=t.options.index,i=this.relatedView;i.model.removeVertex(r,{ui:!0}),this.options.vertexAdding&&this.updatePath(),i.checkMouseleave(ot(e))},onPathPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=ot(t),r=this.paper.snapToGrid(e.clientX,e.clientY).toJSON(),i=this.relatedView;i.model.startBatch("vertex-add",{ui:!0,tool:this.cid});var n=i.getVertexIndex(r.x,r.y);this.snapVertex(r,n),i.model.insertVertex(n,r,{ui:!0,tool:this.cid}),this.update();var a=this.handles[n];this.eventData(e,{vertexAdded:!0}),a.onPointerDown(e)}},onRemove:function(){this.resetHandles()}},{VertexHandle:Gg});function fa(t,e){var r=t.model;return e?r.getBBox():r.isLink()?t.getConnection().bbox():t.getNodeUnrotatedBBox(t.el)}function jg(t,e,r){var i=bg.call(this.paper,{},e,r,t,this.model);return i.anchor}function BI(t,e,r,i,n,a){var o=a.options.snapRadius,s=i==="source",l=s?0:-1,u=this.model.vertex(l)||this.getEndAnchor(s?"target":"source");return u&&(Math.abs(u.x-t.x)<o&&(t.x=u.x),Math.abs(u.y-t.y)<o&&(t.y=u.y)),t}var Fg=Xt.extend({tagName:"g",svgElement:!0,className:"marker-segment",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},children:[{tagName:"line",selector:"line",attributes:{stroke:"#33334F","stroke-width":2,fill:"none","pointer-events":"none"}},{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2}}],onRender:function(){this.renderChildren()},position:function(t,e,r,i){var n=this.options,a=n.scale,o=F.createSVGMatrix().translate(t,e).rotate(r);a&&(o=o.scale(a));var s=this.childNodes.handle;s.setAttribute("transform",F.matrixToTransformString(o)),s.setAttribute("cursor",r%180===0?"row-resize":"col-resize");var l=i.getClosestPoint(new Z(t,e)),u=this.childNodes.line;u.setAttribute("x1",t),u.setAttribute("y1",e),u.setAttribute("x2",l.x),u.setAttribute("y2",l.y)},onPointerDown:function(t){this.options.guard(t)||(this.trigger("change:start",this,t),t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data))},onPointerMove:function(t){this.trigger("changing",this,t)},onPointerUp:function(t){this.undelegateDocumentEvents(),this.options.paper.delegateEvents(),this.trigger("change:end",this,t)},show:function(){this.el.style.display=""},hide:function(){this.el.style.display="none"}}),Vg=yr.extend({name:"segments",precision:.5,options:{handleClass:Fg,segmentLengthThreshold:40,redundancyRemoval:!0,anchor:jg,snapRadius:10,snapHandle:!0,stopPropagation:!0},handles:null,onRender:function(){this.resetHandles();var t=this.relatedView,e=t.model.vertices();e.unshift(t.sourcePoint),e.push(t.targetPoint);for(var r=0,i=e.length;r<i-1;r++){var n=e[r],a=e[r+1],o=this.renderHandle(n,a);this.simulateRelatedView(o.el),this.handles.push(o),o.options.index=r}return this},renderHandle:function(t,e){var r=this,i=new this.options.handleClass({paper:this.paper,scale:this.options.scale,guard:function(n){return r.guard(n)}});return i.render(),this.updateHandle(i,t,e),i.vel.appendTo(this.el),this.startHandleListening(i),i},update:function(){return this.render(),this},startHandleListening:function(t){this.listenTo(t,"change:start",this.onHandleChangeStart),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"change:end",this.onHandleChangeEnd)},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),!!Array.isArray(t))for(var e=0,r=t.length;e<r;e++)t[e].remove()},shiftHandleIndexes:function(t){for(var e=this.handles,r=0,i=e.length;r<i;r++)e[r].options.index+=t},resetAnchor:function(t,e){var r=this.relatedView.model;e?r.prop([t,"anchor"],e,{rewrite:!0,ui:!0,tool:this.cid}):r.removeProp([t,"anchor"],{ui:!0,tool:this.cid})},snapHandle:function(t,e,r){var i=t.options.index,n=this.relatedView,a=n.model,o=a.vertices(),s=t.options.axis,l=o[i-2]||r.sourceAnchor,u=o[i+1]||r.targetAnchor,g=this.options.snapRadius;return Math.abs(e[s]-l[s])<g?e[s]=l[s]:Math.abs(e[s]-u[s])<g&&(e[s]=u[s]),e},onHandleChanging:function(t,e){var r=this,i=r.options,n=this.eventData(e),a=this.relatedView,o=a.paper,s=t.options.index-1,l=ot(e),u=o.snapToGrid(l.clientX,l.clientY),g=this.snapHandle(t,u.clone(),n),h=t.options.axis,y=this.options.snapHandle?0:u[h]-g[h],x=a.model,C=de(x.vertices()),p=this.options.anchor;typeof p!="function"&&(p=null);var E=t.options.index,k=[a.sourcePoint.clone()].concat(C,[a.targetPoint.clone()]),w=0;if(E-1>=0){var S=k[E-1],T=k[E],m=new dt(S,T).vector().theta();m%90!==0&&(C.splice(E-1,0,n.originalVertices[E-1]),w++,this.shiftHandleIndexes(1))}var A=C[s+w],M=C[s+1+w];if(E+2<k.length){var N=k[E+1],D=k[E+2],z=new dt(N,D).vector().theta();if(z%90!==0){var _=n.originalVertices.length===1,j=_?0:E,V=n.firstHandleShifted&&!_?1:0,W=1+w;C.splice(E+W,0,n.originalVertices[j-V])}}var Y=a.sourceView,X=a.sourceBBox,J=!1,Q=!1;if(A?s===0?X.containsPoint(A)?(C.shift(),this.shiftHandleIndexes(-1),J=!0):(A[h]=g[h],Q=!0):A[h]=g[h]:(A=a.sourceAnchor.toJSON(),A[h]=g[h],X.containsPoint(A)?(A[h]=g[h],J=!0):(C.unshift(A),this.shiftHandleIndexes(1),n.firstHandleShifted=!0,Q=!0)),p&&Y){if(J){var it=n.sourceAnchor.clone();it[h]=g[h];var st=p.call(a,it,Y,a.sourceMagnet||Y.el,"source",a);this.resetAnchor("source",st)}Q&&this.resetAnchor("source",n.sourceAnchorDef)}var gt=a.targetView,nt=a.targetBBox,ut=!1,ft=!1;if(M?s===C.length-2?nt.containsPoint(M)?(C.pop(),ut=!0):(M[h]=g[h],ft=!0):M[h]=g[h]:(M=a.targetAnchor.toJSON(),M[h]=g[h],nt.containsPoint(M)?ut=!0:(C.push(M),ft=!0)),p&&gt){if(ut){var vt=n.targetAnchor.clone();vt[h]=g[h];var xt=p.call(a,vt,gt,a.targetMagnet||gt.el,"target",a);this.resetAnchor("target",xt)}ft&&this.resetAnchor("target",n.targetAnchorDef)}x.vertices(C,{ui:!0,tool:this.cid}),this.updateHandle(t,A,M,y),i.stopPropagation||a.notifyPointermove(l,u.x,u.y)},onHandleChangeStart:function(t,e){var r=this,i=r.options,n=r.handles,a=r.relatedView,o=a.model,s=a.paper,l=t.options.index;if(!!Array.isArray(n)){for(var u=0,g=n.length;u<g;u++)u!==l&&n[u].hide();this.focus(),this.eventData(e,{sourceAnchor:a.sourceAnchor.clone(),targetAnchor:a.targetAnchor.clone(),sourceAnchorDef:be(o.prop(["source","anchor"])),targetAnchorDef:be(o.prop(["target","anchor"])),originalVertices:de(o.vertices()),firstHandleShifted:!1}),o.startBatch("segment-move",{ui:!0,tool:this.cid}),i.stopPropagation||a.notifyPointerdown.apply(a,s.getPointerArgs(e))}},onHandleChangeEnd:function(t,e){var r=this,i=r.options,n=r.relatedView,a=n.paper,o=n.model;i.redundancyRemoval&&n.removeRedundantLinearVertices({ui:!0,tool:this.cid});var s=ot(e),l=a.snapToGrid(s.clientX,s.clientY);this.render(),this.blur(),o.stopBatch("segment-move",{ui:!0,tool:this.cid}),i.stopPropagation||n.notifyPointerup(s,l.x,l.y),n.checkMouseleave(s)},updateHandle:function(t,e,r,i){var n=Math.abs(e.x-r.x)<this.precision,a=Math.abs(e.y-r.y)<this.precision;if(n||a){var o=new dt(e,r),s=o.length();if(s<this.options.segmentLengthThreshold)t.hide();else{var l=o.midpoint(),u=n?"x":"y";l[u]+=i||0;var g=o.vector().vectorAngle(new Z(1,0));t.position(l.x,l.y,g,this.relatedView),t.show(),t.options.axis=u}}else t.hide()},onRemove:function(){this.resetHandles()}},{SegmentHandle:Fg}),Wg=yr.extend({tagName:"path",xAxisVector:new Z(1,0),events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{scale:null},onRender:function(){this.update()},update:function(){var t=this.ratio,e=this.relatedView,r=e.getTangentAtRatio(t),i,n;if(r?(i=r.start,n=r.vector().vectorAngle(this.xAxisVector)||0):(i=e.getPointAtRatio(t),n=0),!i)return this;var a=F.createSVGMatrix().translate(i.x,i.y).rotate(n),o=this.options,s=o.scale;return s&&(a=a.scale(s)),this.vel.transform(a,{absolute:!0}),this},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.relatedView;e.model.startBatch("arrowhead-move",{ui:!0,tool:this.cid}),e.can("arrowheadMove")&&(e.startArrowheadMove(this.arrowheadType),this.delegateDocumentEvents(),e.paper.undelegateEvents()),this.focus(),this.el.style.pointerEvents="none"}},onPointerMove:function(t){var e=ot(t),r=this.paper.snapToGrid(e.clientX,e.clientY);this.relatedView.pointermove(e,r.x,r.y)},onPointerUp:function(t){this.undelegateDocumentEvents();var e=this.relatedView,r=e.paper,i=ot(t),n=r.snapToGrid(i.clientX,i.clientY);e.pointerup(i,n.x,n.y),r.delegateEvents(),this.blur(),this.el.style.pointerEvents="",e.model.stopBatch("arrowhead-move",{ui:!0,tool:this.cid})}}),OI=Wg.extend({name:"target-arrowhead",ratio:1,arrowheadType:"target",attributes:{d:"M -10 -8 10 0 -10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"target-arrowhead"}}),RI=Wg.extend({name:"source-arrowhead",ratio:0,arrowheadType:"source",attributes:{d:"M 10 -8 -10 0 10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}}),ls=yr.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:!1},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){var t=this,e=t.relatedView,r=t.options,i=t.vel,n=r.useModelGeometry,a=r.rotate,o=he(r.padding),s=fa(e,n).moveAndExpand({x:-o.left,y:-o.top,width:o.left+o.right,height:o.top+o.bottom}),l=e.model;if(l.isElement()){var u=l.angle();if(u)if(a){var g=l.getBBox().center();i.rotate(u,g.x,g.y,{absolute:!0})}else s=s.bbox(u)}return i.attr(s.toJSON()),this}}),Zg=yr.extend({tagName:"g",type:null,children:[{tagName:"circle",selector:"anchor",attributes:{cursor:"pointer"}},{tagName:"rect",selector:"area",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{snap:BI,anchor:jg,scale:null,resetAnchor:!0,customAnchorAttributes:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttributes:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,restrictArea:!0,redundancyRemoval:!0},onRender:function(){this.renderChildren(),this.toggleArea(!1),this.update()},update:function(){var t=this.type,e=this.relatedView,r=e.getEndView(t);return r?(this.updateAnchor(),this.updateArea(),this.el.style.display=""):this.el.style.display="none",this},updateAnchor:function(){var t=this.childNodes;if(!!t){var e=t.anchor;if(!!e){var r=this.relatedView,i=this.type,n=r.getEndAnchor(i),a=this.options,o=r.model.prop([i,"anchor"]),s="translate("+n.x+","+n.y+")";a.scale&&(s+=" scale("+a.scale+")"),e.setAttribute("transform",s);var l=o?a.customAnchorAttributes:a.defaultAnchorAttributes;for(var u in l)e.setAttribute(u,l[u])}}},updateArea:function(){var t=this.childNodes;if(!!t){var e=t.area;if(!!e){var r=this.relatedView,i=this.type,n=r.getEndView(i),a=n.model,o=r.getEndMagnet(i),s=this.options.areaPadding;isFinite(s)||(s=0);var l,u,g;n.isNodeConnection(o)?(l=n.getBBox(),u=0,g=l.center()):(l=n.getNodeUnrotatedBBox(o),u=a.angle(),g=l.center(),u&&g.rotate(a.getBBox().center(),-u)),l.inflate(s),e.setAttribute("x",-l.width/2),e.setAttribute("y",-l.height/2),e.setAttribute("width",l.width),e.setAttribute("height",l.height),e.setAttribute("transform","translate("+g.x+","+g.y+") rotate("+u+")")}}},toggleArea:function(t){this.childNodes.area.style.display=t?"":"none"},onPointerDown:function(t){this.guard(t)||(t.stopPropagation(),t.preventDefault(),this.paper.undelegateEvents(),this.delegateDocumentEvents(),this.focus(),this.toggleArea(this.options.restrictArea),this.relatedView.model.startBatch("anchor-move",{ui:!0,tool:this.cid}))},resetAnchor:function(t){var e=this.type,r=this.relatedView.model;t?r.prop([e,"anchor"],t,{rewrite:!0,ui:!0,tool:this.cid}):r.removeProp([e,"anchor"],{ui:!0,tool:this.cid})},onPointerMove:function(t){var e=this.relatedView,r=this.type,i=e.getEndView(r),n=i.model,a=e.getEndMagnet(r),o=ot(t),s=this.paper.clientToLocalPoint(o.clientX,o.clientY),l=this.options.snap;if(typeof l=="function"&&(s=l.call(e,s,i,a,r,e,this),s=new Z(s)),this.options.restrictArea)if(i.isNodeConnection(a)){var u=i.getClosestPoint(s);u&&(s=u)}else{var g=i.getNodeUnrotatedBBox(a),h=n.angle(),y=n.getBBox().center(),x=s.clone().rotate(y,h);g.containsPoint(x)||(s=g.pointNearestToPoint(x).rotate(y,-h))}var C,p=this.options.anchor;typeof p=="function"&&(C=p.call(e,s,i,a,r,e)),this.resetAnchor(C),this.update()},onPointerUp:function(t){this.paper.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);var e=this.relatedView;this.options.redundancyRemoval&&e.removeRedundantLinearVertices({ui:!0,tool:this.cid}),e.model.stopBatch("anchor-move",{ui:!0,tool:this.cid})},onPointerDblClick:function(){var t=this.options.resetAnchor;t!==!1&&(t===!0&&(t=null),this.resetAnchor(de(t)),this.update())}}),_I=Zg.extend({name:"source-anchor",type:"source"}),GI=Zg.extend({name:"target-anchor",type:"target"}),ga=yr.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,scale:null,rotate:!1},onRender:function(){this.renderChildren(this.options.markup),this.update()},update:function(){return this.position(),this},position:function(){var t=this,e=t.vel;e.transform(this.getCellMatrix(),{absolute:!0})},getCellMatrix:function(){return this.relatedView.model.isLink()?this.getLinkMatrix():this.getElementMatrix()},getElementMatrix:function(){var e=this,r=e.relatedView,i=e.options,n=i.x;n===void 0&&(n=0);var a=i.y;a===void 0&&(a=0);var o=i.offset;o===void 0&&(o={});var s=i.useModelGeometry,l=i.rotate,u=i.scale,g=fa(r,s),h=r.model.angle();l||(g=g.bbox(h));var y=o.x;y===void 0&&(y=0);var x=o.y;x===void 0&&(x=0),pe(n)?n=parseFloat(n)/100*g.width:or(n)&&(n=Number(sr(n,g))),pe(a)?a=parseFloat(a)/100*g.height:or(a)&&(a=Number(sr(a,g)));var C=F.createSVGMatrix().translate(g.x+g.width/2,g.y+g.height/2);return l&&(C=C.rotate(h)),C=C.translate(n+y-g.width/2,a+x-g.height/2),u&&(C=C.scale(u)),C},getLinkMatrix:function(){var e=this,r=e.relatedView,i=e.options,n=i.offset;n===void 0&&(n=0);var a=i.distance;a===void 0&&(a=0);var o=i.rotate,s=i.scale,l,u,g;pe(a)?l=r.getTangentAtRatio(parseFloat(a)/100):l=r.getTangentAtLength(a),l?(u=l.start,g=l.vector().vectorAngle(new Z(1,0))||0):(u=r.getConnection().start,g=0);var h=F.createSVGMatrix().translate(u.x,u.y).rotate(g).translate(0,n);return o||(h=h.rotate(-g)),s&&(h=h.scale(s)),h},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.options.action;typeof e=="function"&&e.call(this.relatedView,t,this.relatedView,this)}}}),Yg=ga.extend({children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(t,e,r){e.model.remove({ui:!0,tool:r.cid})}}}),mn=ga.extend({name:"connect",documentEvents:{mousemove:"drag",touchmove:"drag",mouseup:"dragend",touchend:"dragend",touchcancel:"dragend"},children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2,"pointer-events":"none"}}],options:{distance:80,offset:0,magnet:function(t){return t.el},action:function(t,e,r){return r.dragstart(t)}},getMagnetNode:function(){var t,e=this,r=e.options,i=e.relatedView,n=r.magnet,a;switch(typeof n){case"function":{a=n.call(this,i,this);break}case"string":{t=i.findBySelector(n),a=t[0];break}default:{a=n;break}}if(a||(a=i.el),a instanceof SVGElement)return a;throw new Error("Connect: magnet must be an SVGElement")},dragstart:function(t){var e=this,r=e.paper,i=e.relatedView,n=ot(t),a=r.clientToLocalPoint(n.clientX,n.clientY),o=a.x,s=a.y;i.dragLinkStart(n,this.getMagnetNode(),o,s),r.undelegateEvents(),this.delegateDocumentEvents(null,n.data),this.focus()},drag:function(t){var e=this,r=e.paper,i=e.relatedView,n=ot(t),a=r.snapToGrid(n.clientX,n.clientY),o=a.x,s=a.y;i.dragLink(n,o,s)},dragend:function(t){var e=this,r=e.paper,i=e.relatedView,n=ot(t),a=r.snapToGrid(n.clientX,n.clientY),o=a.x,s=a.y;i.dragLinkEnd(n,o,s),this.undelegateDocumentEvents(),r.delegateEvents(),this.blur(),i.checkMouseleave(n)}}),Ug=mn.extend({name:"hover-connect",defaultMarkup:[{tagName:"circle",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2}}],children:function(){var e=this,r=e.options,i=e.defaultMarkup;return[{tagName:"path",selector:"track",attributes:{fill:"none",stroke:"transparent","stroke-width":r.trackWidth||15,cursor:"pointer"}},{tagName:"g",selector:"button",attributes:{"pointer-events":"none",display:"none"},children:r.markup||i}]},events:Object.assign({mousemove:"onMousemove",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},mn.prototype.events),onRender:function(){this.renderChildren(),this.update()},trackPath:null,update:function(){var e=this,r=e.childNodes;this.trackPath=this.getTrackPath(),mn.prototype.update.apply(this,arguments),r.track.setAttribute("d",this.trackPath.serialize())},position:function(){var e=this,r=e.el,i=e.childNodes;i.button.setAttribute("transform",F.matrixToTransformString(this.getButtonMatrix())),r.setAttribute("transform",F.matrixToTransformString(this.getTrackMatrix()))},getButtonMatrix:function(){var e=this,r=e.options,i=e.trackPath,n=r.offset;n===void 0&&(n=0);var a=r.distance;a===void 0&&(a=0);var o=r.rotate,s=r.scale,l,u,g;pe(a)?l=i.tangentAtRatio(parseFloat(a)/100):l=i.tangentAtLength(a),l?(u=l.start,g=l.vector().vectorAngle(new Z(1,0))||0):(u=i.start,g=0);var h=F.createSVGMatrix().translate(u.x,u.y).rotate(g).translate(0,n);return o||(h=h.rotate(-g)),s&&(h=h.scale(s)),h},getTrackPath:function(){return this.relatedView.getConnection()},getTrackMatrix:function(){return F.createSVGMatrix()},getTrackRatioFromEvent:function(e){var r=this,i=r.relatedView,n=r.trackPath,a=i.paper.clientToLocalPoint(e.clientX,e.clientY),o=F.transformPoint(a,this.getTrackMatrix().inverse());return n.closestPointLength(o)},canShowButton:function(){return f._data(this.paper.el,"events")},showButton:function(){this.childNodes.button.style.display="block"},hideButton:function(){this.childNodes.button.style.display=""},onMousemove:function(e){var r=this,i=r.trackPath;if(!!i){var n=this,a=n.options;a.distance=this.getTrackRatioFromEvent(e),this.position()}},onMouseenter:function(){!this.canShowButton()||this.showButton()},onMouseleave:function(){this.hideButton()}}),jI={__proto__:null,Vertices:zI,Segments:Vg,TargetArrowhead:OI,SourceArrowhead:RI,Boundary:ls,SourceAnchor:_I,TargetAnchor:GI,Button:ga,Remove:Yg,Connect:mn,HoverConnect:Ug},FI=yr.extend({tagName:"g",children:[{tagName:"circle",selector:"handle",attributes:{cursor:"pointer","stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6}},{tagName:"rect",selector:"extras",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{handleAttributes:null,selector:"root",padding:6,scale:null},getPosition:function(){},setPosition:function(){},resetPosition:function(){},onRender:function(){this.renderChildren(),this.toggleExtras(!1),this.update()},update:function(){var t=this.childNodes,e=t.handle,r=t.extras;if(e)this.updateHandle(e);else throw new Error("Control: markup selector `handle` is required");return r&&this.updateExtras(r),this},updateHandle:function(t){var e=this,r=e.relatedView,i=e.options,n=r.model,a=this.getPosition(r,this),o=n.getAbsolutePointFromRelative(a),s=i.handleAttributes,l=i.scale,u="translate("+o.x+","+o.y+")";if(l&&(u+=" scale("+l+")"),t.setAttribute("transform",u),s)for(var g in s)t.setAttribute(g,s[g])},updateExtras:function(t){var e=this,r=e.relatedView,i=e.options,n=this.options,a=n.selector;if(!a){this.toggleExtras(!1);return}var o=r.findBySelector(a),s=o[0];if(!s)throw new Error("Control: invalid selector.");var l=i.padding;isFinite(l)||(l=0);var u=r.getNodeUnrotatedBBox(s),g=r.model,h=g.angle(),y=u.center();h&&y.rotate(g.getBBox().center(),-h),u.inflate(l),t.setAttribute("x",-u.width/2),t.setAttribute("y",-u.height/2),t.setAttribute("width",u.width),t.setAttribute("height",u.height),t.setAttribute("transform","translate("+y.x+","+y.y+") rotate("+h+")")},toggleExtras:function(t){var e=this.childNodes,r=e.extras;!r||(r.style.display=t?"":"none")},onPointerDown:function(t){var e=this,r=e.relatedView,i=e.paper;this.guard(t)||(t.stopPropagation(),t.preventDefault(),i.undelegateEvents(),this.delegateDocumentEvents(),this.focus(),this.toggleExtras(!0),r.model.startBatch("control-move",{ui:!0,tool:this.cid}))},onPointerMove:function(t){var e=this,r=e.relatedView,i=e.paper,n=r.model,a=ot(t),o=a.clientX,s=a.clientY,l=i.clientToLocalPoint(o,s),u=n.getRelativePointFromAbsolute(l);this.setPosition(r,u,this),this.update()},onPointerUp:function(t){var e=this,r=e.relatedView,i=e.paper;i.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleExtras(!1),r.model.stopBatch("control-move",{ui:!0,tool:this.cid})},onPointerDblClick:function(){var t=this,e=t.relatedView;this.resetPosition(e,this),this.update()}}),VI=Ug.extend({getTrackPath:function(){var e=this,r=e.relatedView,i=e.options,n=i.useModelGeometry,a=i.trackPath;if(a===void 0&&(a="M 0 0 H calc(w) V calc(h) H 0 Z"),typeof a=="function"&&(a=a.call(this,r)),or(a)){var o=fa(r,n);a=sr(a,o)}return new rt(F.normalizePathData(a))},getTrackMatrix:function(){var e=this,r=e.relatedView,i=e.options,n=i.useModelGeometry,a=i.rotate,o=fa(r,n),s=r.model.angle();a||(o=o.bbox(s));var l=F.createSVGMatrix().translate(o.x+o.width/2,o.y+o.height/2);return a&&(l=l.rotate(s)),l=l.translate(-o.width/2,-o.height/2),l}}),WI={__proto__:null,Button:ga,Remove:Yg,Connect:mn,Boundary:ls,HoverConnect:VI,Control:FI},ZI="3.6.4",YI=F,UI=function(t,e){e=e||{},me(Er,"setTheme",t,e),Xt.prototype.defaultTheme=t},XI=At,HI=kt,qI=HI.prototype,va=XI.define("standard.Record",{size:{width:100},padding:0,scrollTop:null,items:[],itemHeight:20,itemOffset:20,itemMinLabelWidth:10,itemButtonSize:10,itemIcon:{width:16,height:16,padding:2},itemOverflow:!1,itemAboveViewSelector:"root",itemBelowViewSelector:"root",attrs:{wrapper:{scrollable:!0},bodiesGroups:{fill:"transparent",stroke:"none"},labelsGroups:{fill:"#333333"},buttonsGroups:{fill:"transparent",stroke:"#333333",strokeWidth:1},forksGroups:{stroke:"#333333"},groups:{groupPosition:!0},itemBodies:{groupWidth:!0,itemHighlight:{fill:"#eeeeee"}},itemLabels:{fontSize:16,textVerticalAnchor:"middle",itemText:{textWrap:!0,ellipsis:!0},itemHighlight:{fill:"red"}}}},{markup:[],metrics:null,markupAttributes:["items","itemHeight","itemOffset","itemIcon","itemMinLabelWidth","itemButtonSize","itemOverflow","padding"],initialize:function(){At.prototype.initialize.apply(this,arguments),this.on("change",this.onChange,this),this.buildMarkup()},anyHasChanged:function(t){return Array.isArray(t)?t.some(function(e){return this.hasChanged(e)},this):!1},onChange:function(t,e){e.record!==this.id&&this.hasChanged("markup")&&zi("Markup can not be modified."),this.anyHasChanged(this.markupAttributes)&&this.buildMarkup(e)},getPadding:function(){return he(this.attributes.padding)},buildMarkup:function(t){var e=this.metrics={},r=e.items={},i=this.attributes,n=i.itemHeight,a=i.itemOffset,o=!!i.itemOverflow,s=i.items;Array.isArray(s)||(s=[]);var l=s.length,u=0,g=de(this.markup);Array.isArray(g)||zi("Expects Prototype JSON Markup.");var h=this.getPadding(),y=0,x=[];g.push({tagName:"g",selector:"wrapper",children:x});for(var C=0;C<l;C++){for(var p=[],E=[],k=[],w=[],S=[],T=Array.from(s[C]),m=this.createQueue(T,0,[],null),A=0,M=0;m.length>0;){var N=m.pop(),D=N.path,z=N.level,_=N.item,j=N.parent;z===0&&D.splice(1,0,C);var V=_.id,W=z!==-1,Y=_.height||n,X=_.icon,J=_.items,Q=!!_.highlighted,it=!!_.collapsed,st=Array.isArray(J)&&J.length>0;V||zi("Item id required."),r.hasOwnProperty(V)&&zi("Duplicated item id.");var gt=r[V]={path:D,visible:W,parent:j,label:_.label,height:Y,group:C,hasSubItems:st,highlighted:Q,collapsed:it};if(st&&(gt.children=J.map(function(Et){return Et.id}),Array.prototype.push.apply(m,this.createQueue(J,it||!W?-1:z+1,D,V))),!!W){var nt=a*z;if(gt.x=nt+a,gt.y=A,gt.cx=nt+a/2,gt.cy=A+Y/2,gt.span=_.span||1,V){var ut=this.getItemBodyMarkup(_,nt,A,C,o&&C===0?h.left:0);p.push(ut);var ft=this.getItemLabelMarkup(_,nt,A,C);E.push(ft),st&&(k.push(this.getButtonMarkup(_,nt,A,C)),it||S.push(V)),X&&(w.push(this.getIconMarkup(_,nt,A,C)),gt.x+=i.itemIcon.width+i.itemIcon.padding)}M=Math.max(M,gt.x+i.itemMinLabelWidth),A+=Y}}y=Math.max(M,y),u=Math.max(u,A);var vt=[];x.push({tagName:"g",selector:this.getSelector("group",C),groupSelector:"groups",attributes:{"record-group":C},children:vt}),vt.push({tagName:"g",selector:this.getSelector("bodiesGroup",C),groupSelector:"bodiesGroups",children:p},{tagName:"g",selector:this.getSelector("labelsGroup",C),groupSelector:"labelsGroups",children:E}),S.length>0&&vt.push({tagName:"g",selector:this.getSelector("forksGroup",C),groupSelector:"forksGroups",children:S.map(this.getForkMarkup,this)}),k.length>0&&vt.push({tagName:"g",selector:this.getSelector("buttonsGroup",C),groupSelector:"buttonsGroups",children:k}),w.length>0&&vt.push({tagName:"g",selector:this.getSelector("iconsGroup",C),groupSelector:"iconsGroups",children:w})}e.padding=h,e.groupsCount=l,e.overflow=o,e.minHeight=u+h.top+h.bottom,e.minWidth=y*l+h.left+h.right;var xt=tt({record:this.id,dry:!0},t);this.set("markup",g,xt),this.autoresize(xt)},autoresize:function(t){var e=this.getMinimalSize(),r=this.attributes,i=r.size,n=i.height,a=i.width,o=this.getScrollTop()===null?e.height:n,s=Math.max(a,e.width);this.resize(s,o,t)},getMinimalSize:function(){var t=this.metrics;return{width:t.minWidth,height:t.minHeight}},removeInvalidLinks:function(t){var e=this.graph;return e?e.getConnectedLinks(this).filter(this.isLinkInvalid,this).map(function(r){return r.remove(t)}):[]},isLinkInvalid:function(t){var e=this.id,r=this.metrics.items,i=t.source();if(i.id===e&&i.hasOwnProperty("port")&&!(r[i.port]||this.hasPort(i.port)))return!0;var n=t.target();return!!(n.id===e&&n.hasOwnProperty("port")&&!(r[n.port]||this.hasPort(n.port)))},createQueue:function(t,e,r,i){var n=t.length;return Array.from({length:n},function(a,o){var s=n-o-1;return{path:r.concat(["items",s]),item:t[s],level:e,parent:i}})},getGroupSelector:function(t){for(var e=Array.prototype.slice.call(arguments,1),r=[t],i=0,n=e.length;i<n;i++){var a=e[i];if(a!=null){Array.isArray(a)||(a=[a]);for(var o=0,s=a.length;o<s;o++)r.push(this.getSelector(t,a[o]))}}return r},getItemLabelMarkup:function(t,e,r,i){var n=this.attributes,a=n.itemOffset,o=t.height||n.itemHeight,s=t.id,l=e+a;return t.icon&&(l+=n.itemIcon.width+2*n.itemIcon.padding),{tagName:"text",className:"record-item-label",selector:this.getSelector("itemLabel",s),groupSelector:this.getGroupSelector("itemLabels",i,t.group),attributes:{x:l,y:r+o/2,"item-id":s}}},getItemBodyMarkup:function(t,e,r,i,n){var a=t.height||this.attributes.itemHeight,o=0;n&&(o-=n);var s={x:o,y:r,height:a,"item-id":t.id},l=t.span;return l&&(s["item-span"]=l),{tagName:"rect",selector:this.getSelector("itemBody",t.id),groupSelector:this.getGroupSelector("itemBodies",i,t.group),className:"record-item-body",attributes:s}},getButtonMarkup:function(t,e,r){var i=this.attributes,n=i.itemButtonSize,a=i.itemOffset,o=t.height||i.itemHeight;return{tagName:"path",className:"record-item-button",attributes:{d:this.getButtonPathData(e+a/2,r+o/2,n/2,t.collapsed),"item-id":t.id,cursor:"pointer","shape-rendering":"geometricprecision"}}},getIconMarkup:function(t,e,r){var i=this.attributes,n=i.itemOffset,a=i.itemIcon,o=t.height||i.itemHeight;return{tagName:"image",className:"record-item-icon",attributes:{x:e+n+a.padding,y:r+(o-a.height)/2,width:a.width,height:a.height,"xlink:href":t.icon}}},getForkMarkup:function(t){return{tagName:"path",attributes:{d:this.getForkPathData(t),fill:"none"}}},getButtonPathData:function(t,e,r,i){var n=["M",t-r,e-r,t+r,e-r,t+r,e+r,t-r,e+r,"Z","M",t-r/2,e,t+r/2,e];return i&&Array.prototype.push.apply(n,["M",t,e-r/2,t,e+r/2]),n.join(" ")},getForkPathData:function(t){var e=this.metrics.items;if(!e)return null;var r=e[t];if(!r)return null;var i=r.children;if(!i||i.length===0)return null;for(var n=this.attributes.itemButtonSize,a=[],o,s=0,l=i.length;s<l;s++){o=e[i[s]];var u=o.cx+(o.hasSubItems?-1:1)*n/2;a.push("M",r.cx,o.cy,u,o.cy)}return a.push("M",r.cx,r.cy+n/2,r.cx,o.cy),a.join(" ")},item:function(t,e,r){var i=this.getItemPathArray(t);return i?e===void 0?this.prop(i):this.prop(i,e,r):null},toggleItemCollapse:function(t,e){var r=this.getItemPathArray(t);if(!r)return this;r.push("collapsed");var i=!!this.prop(r);return this.prop(r,!i,e),this},toggleItemHighlight:function(t,e){var r=this.getItemPathArray(t);if(!r)return this;r.push("highlighted");var i=!!this.prop(r);return this.prop(r,!i,e),this},isItemVisible:function(t){return this.getItemCacheAttribute(t,"visible")},isItemCollapsed:function(t){return this.getItemCacheAttribute(t,"collapsed")},isItemHighlighted:function(t){return this.getItemCacheAttribute(t,"highlighted")},getItemParentId:function(t){return this.getItemCacheAttribute(t,"parent")},getItemGroupIndex:function(t){return this.getItemCacheAttribute(t,"group")},getItemPathArray:function(t){var e=this.getItemCacheAttribute(t,"path");return e?e.slice():null},getItemSide:function(t){var e=this.getItemGroupIndex(t);if(e===null)return null;var r=this.metrics,i=r.groupsCount;if(i>1){if(e===0)return"left";if(e+r.items[t].span-1===i-1)return"right"}return"middle"},getItemCacheAttribute:function(t,e){if(!e)return null;var r=this.getItemCache(t);return r?r[e]:null},getItemCache:function(t){var e=this.metrics.items;if(!e)return null;var r=e[t];return r||null},getItemBBox:function(t){var e=this.getItemCache(t);if(!e)return null;var r=e.x,i=e.y,n=e.width,a=e.height;return new at(r,i,n,a)},getSelector:function(t,e){return t+"_"+e},removeItem:function(t,e){var r=this.getItemPathArray(t);if(!r)return this;var i=r.pop(),n=this.prop(r).slice();return n.length>1?(n.splice(i,1),this.prop(r,n,tt({rewrite:!0},e))):r.length>2?this.removeProp(r,e):(i=r.pop(),n=this.get("items").slice(),n.splice(i,1,[]),this.prop(r,n,tt({rewrite:!0},e))),this},addNextSibling:function(t,e,r){var i=this.getItemPathArray(t);if(!i)return this;var n=this.getItemParentId(t)||this.getItemGroupIndex(t),a=i[i.length-1]+1;return this.addItemAtIndex(n,a,e,r)},addPrevSibling:function(t,e,r){var i=this.getItemPathArray(t);if(!i)return this;var n=this.getItemParentId(t)||this.getItemGroupIndex(t),a=i[i.length-1];return this.addItemAtIndex(n,a,e,r)},addItemAtIndex:function(t,e,r,i){if(!r)return this;var n;switch(typeof t){case"number":var a=this.prop("items"),o=Math.min(Math.max(t,0),a.length);n=["items",o];break;case"string":if(n=this.getItemPathArray(t),!n)return this;n.push("items");break;default:zi("Requires an item id.")}var s=this.prop(n);Array.isArray(s)?s=s.slice():s=[];var l=Math.min(Math.max(e,0),s.length);return s.splice(l,0,r),this.prop(n,s,tt({rewrite:!0},i))},toJSON:function(){var t=At.prototype.toJSON.apply(this,arguments);return delete t.markup,t},getItemViewSign:function(t){this.isItemVisible(t)||zi('Item "'+t+'" does not exist or is not visible.');var e=this,r=e.attributes,i=e.metrics,n=i.items[t],a=n.y,o=n.height,s=this.getScrollTop();if(s===null)return 0;var l=r.size,u=l.height,g=i.padding,h=g.top,y=g.bottom;return a-s<0?-1:u-h-y-(a+o-s)<0?1:0},isItemInView:function(t){return this.getItemViewSign(t)===0},isEveryItemInView:function(){if(this.getScrollTop()===null)return!0;var t=this.metrics,e=t.minHeight,r=this.size(),i=r.height;return e<=i},clampScrollTop:function(t){var e=this.size(),r=e.height,i=this.metrics,n=i.minHeight;if(!Number.isFinite(t))return null;var a=Math.min(Math.max(t,0),Math.max(n-r,0));return a},getScrollTop:function(){return this.clampScrollTop(this.get("scrollTop"))},setScrollTop:function(e,r){var i=this.get("scrollTop"),n=this.clampScrollTop(e);i!==n&&this.set("scrollTop",n,r)}},{attributes:{itemText:{set:function(t,e,r,i){if(!fe(t))return null;var n=this.model,a=r.getAttribute("item-id"),o=n.metrics.items[a];if(!!o){var s=o.label,l=n.metrics.padding,u=n.metrics.groupsCount,g=o.x,h=(e.width-l.left-l.right)/u*o.span-g,y=new at(g,o.y,h,o.height),x,C;t.textWrap?(x="textWrap",C=tt({text:s},t)):(x="text",C=s),this.getAttributeDefinition(x).set.call(this,C,y,r,i)}}},itemHighlight:{set:function(t,e,r,i){if(!fe(t))return null;var n=this.model,a=r.getAttribute("item-id"),o=n.getItemCacheAttribute(a,"highlighted");switch(o){case!0:return t;case null:case!1:return Object.keys(t).reduce(function(s,l){var u=i.hasOwnProperty(l)||i.hasOwnProperty(un(l));return!u&&r.getAttribute(l)&&(s[l]=null),s},{})}}},groupWidth:{set:function(t,e,r){var i=this.model.metrics,n=i.padding,a=i.groupsCount,o=(e.width-n.left-n.right)/a,s=Number(r.getAttribute("item-span")||1);if(isFinite(s)||(s=1),o*=s,i.overflow){var l=Number(this.findAttribute("record-group",r));l===0&&(o+=n.left),l+s===a&&(o+=n.right)}return{width:o}}},groupPosition:{position:function(t,e,r){var i=Number(r.getAttribute("record-group")),n=this.model.metrics,a=n.groupsCount,o=n.padding,s=(e.width-o.left-o.right)/a,l=o.left+i*s,u=o.top;return new Z(l,u)}},scrollable:{set:Xg(function(t,e){var r,i=this,n=i.paper,a=n.svg,o=n.defs,s=i.model,l=i.cid,u="scroll-clip-"+l,g,h=a.getElementById(u);h?(h=F(h),r=h.children(),g=r[0]):(g=F("rect"),h=F("clipPath",{id:u},[g]),h.appendTo(o));var y=s.metrics,x=y.padding,C=y.overflow,p=x.top,E=x.bottom,k=x.left,w=x.right,S=0,T=e.width;return C||(S+=k,T-=k+w),g.attr({y:t+p,x:S,width:T,height:Math.max(e.height-p-E,0)}),{"clip-path":"url(#"+u+")"}}),position:Xg(function(t){return new Z(0,-t)})}}}),JI=va.define("standard.BorderedRecord",{padding:0,attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",fill:"#FFFFFF"}}},{markup:[{tagName:"rect",selector:"body"}]}),KI=va.define("standard.HeaderedRecord",{padding:{top:30,left:0,right:0,bottom:0},itemAboveViewSelector:"header",itemBelowViewSelector:"header",attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",fill:"#FFFFFF"},header:{refWidth:"100%",height:30,stroke:"#000000",fill:"transparent"},headerLabel:{refX:"50%",refY:15,textAnchor:"middle",textVerticalAnchor:"middle",fontSize:20,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerLabel"}]}),QI=va.prototype.markupAttributes.reduce(function(t,e){return t[e]=["UPDATE"],t},{scrollTop:["UPDATE","TOOLS"]}),us=kt.extend({events:{"mousedown .record-item-button":"onItemButtonClick","touchstart .record-item-button":"onItemButtonClick"},presentationAttributes:kt.addPresentationAttributes(QI),getLinkEnd:function(t){for(var e,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];var n={id:this.model.id,port:this.findAttribute("item-id",t)||this.findAttribute("port",t)};return(e=this).customizeLinkEnd.apply(e,[n,t].concat(r))},getMagnetFromLinkEnd:function(t){for(var e=t.port,r=this.model;e&&!r.isItemVisible(e);)e=r.getItemParentId(e);if(!e)return qI.getMagnetFromLinkEnd.apply(this,arguments);var i=r.getItemViewSign(e),n;switch(i){case-1:n=String(r.get("itemAboveViewSelector"));break;case 1:n=String(r.get("itemBelowViewSelector"));break;case 0:default:n=r.getSelector("itemBody",e);break}return this.findBySelector(n,this.el,this.selectors)[0]},onItemButtonClick:function(t){if(t.button!==2){t.stopPropagation(),t.preventDefault();var e=t.currentTarget.getAttribute("item-id");this.model.toggleItemCollapse(e,{ui:!0})}}}),$I=us,t2=us;function zi(t){throw new Error("shapes.standard.Record: "+t)}function Xg(t){return function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!!e){var n=this,a=n.model,o=a.getScrollTop();if(o!==null)return t.call.apply(t,[this,o].concat(r))}}}var e2={__proto__:null,Record:va,BorderedRecord:JI,HeaderedRecord:KI,RecordView:us,BorderedRecordView:$I,HeaderedRecordView:t2},r2=_t.extend({markup:['<clipPath class="clip"><rect/></clipPath>','<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="axis">','<g class="y-axis"><path/><g class="ticks"></g></g>','<g class="x-axis"><path/><g class="ticks"></g></g>','<g class="markings"></g>',"</g>",'<g class="data"><g class="series"></g></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>','<line class="guideline x-guideline" /><line class="guideline y-guideline" />',"</g>","</g>"].join(""),tickMarkup:'<g class="tick"><line/><text/></g>',pointMarkup:'<g class="point"><circle/><text/></g>',barMarkup:'<path class="bar"/>',markingMarkup:'<g class="marking"><rect/><text/></g>',serieMarkup:'<g><clipPath class="serie-clip"><rect/></clipPath><path/><g class="bars"></g><g class="points"></g></g>',legendItemMarkup:'<g class="legend-item"><circle/><text/></g>',defaults:Ue({type:"chart.Plot",attrs:{".data path":{fill:"none",stroke:"black"},".data .bars rect":{fill:"none",stroke:"black"},".background rect":{fill:"white",stroke:"#e5e5e5",opacity:1},".background text":{fill:"black",text:"No data available.",ref:".","ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":.5,"ref-y":10,"text-anchor":"middle","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":.5,"ref-y":23,"text-anchor":"middle","y-alignment":"middle","font-size":10},".point":{display:"inline-block"},".point circle":{r:2,stroke:"black",fill:"black",opacity:.3},".point text":{fill:"black","font-size":8,"text-anchor":"middle",display:"none"},".axis path":{fill:"none",stroke:"black"},".axis .tick":{fill:"none",stroke:"black"},".y-axis .tick line":{fill:"none",stroke:"black",x2:2,y2:0,opacity:1},".x-axis .tick line":{fill:"none",stroke:"black",x2:0,y2:-3,opacity:1},".y-axis .tick text":{fill:"black",stroke:"none","font-size":10,"text-anchor":"end"},".x-axis .tick text":{fill:"black",stroke:"none","font-size":10,"text-anchor":"middle"},".y-axis .tick text > tspan":{dy:"-.5em",x:-5},".x-axis .tick text > tspan":{dy:".5em",x:0},".axis .markings":{fill:"black",stroke:"none","fill-opacity":1},".axis .markings text":{fill:"black","text-anchor":"end","font-size":10,dy:-5,dx:-5},".guideline":{"pointer-events":"none",display:"none"},".x-guideline":{stroke:"black",visibility:"hidden"},".y-guideline":{stroke:"black",visibility:"hidden"},".legend":{"ref-x":10,"ref-y":10},".legend-item text":{fill:"black",transform:"translate(14, 0)","font-size":11},".legend-item circle":{r:5,transform:"translate(5,5)"},".legend-item":{cursor:"pointer"},".legend-item.disabled circle":{fill:"gray"},".legend-item.disabled text":{opacity:.5}}},_t.prototype.defaults),legendPosition:function(t,e){e=e||{},this.trigger("batch:start"),[".legend/ref-x",".legend/ref-y",".legend/ref-dx",".legend/ref-dy",".legend/x-alignment",".legend/y-alignment"].forEach(function(n){this.removeAttr(n,{silent:!0})},this);var r=e.padding||10,i={n:{".legend":{"ref-x":.5,"x-alignment":-.5,"ref-y":r}},ne:{".legend":{"ref-dx":-r,"x-alignment":-.999,"ref-y":r}},e:{".legend":{"ref-dx":-r,"x-alignment":-.999,"ref-y":.5,"y-alignment":-.5}},se:{".legend":{"ref-dx":-r,"ref-dy":-r,"x-alignment":-.999,"y-alignment":-.999}},s:{".legend":{"ref-x":.5,"ref-dy":-r,"x-alignment":-.5,"y-alignment":-.999}},sw:{".legend":{"ref-x":r,"ref-dy":-r,"y-alignment":-.999}},w:{".legend":{"ref-x":r,"ref-y":.5,"y-alignment":-.5}},nw:{".legend":{"ref-x":r,"ref-y":r}},nnw:{".legend":{"ref-x":r,"ref-y":-r,"y-alignment":-.999}},nn:{".legend":{"ref-x":.5,"ref-y":-r,"x-alignment":-.5,"y-alignment":-.999}},nne:{".legend":{"ref-dx":-r,"ref-y":-r,"x-alignment":-.999,"y-alignment":-.999}},nnee:{".legend":{"ref-dx":r,"ref-y":-r,"y-alignment":-.999}},nee:{".legend":{"ref-y":r,"ref-dx":r}},ee:{".legend":{"ref-dx":r,"ref-y":.5,"y-alignment":-.5}},see:{".legend":{"ref-dx":r,"ref-dy":-r,"y-alignment":-.999}},ssee:{".legend":{"ref-dx":r,"ref-dy":r}},sse:{".legend":{"ref-dx":-r,"ref-dy":r,"x-alignment":-.999}},ss:{".legend":{"ref-x":.5,"ref-dy":r,"x-alignment":-.5}},ssw:{".legend":{"ref-x":r,"ref-dy":r}},ssww:{".legend":{"ref-x":-r,"ref-dy":r,"x-alignment":-.999}},sww:{".legend":{"ref-x":-r,"ref-dy":-r,"x-alignment":-.999,"y-alignment":-.999}},ww:{".legend":{"ref-x":-r,"ref-y":.5,"x-alignment":-.999,"y-alignment":-.5}},nww:{".legend":{"ref-x":-r,"ref-y":r,"x-alignment":-.999}},nnww:{".legend":{"ref-x":-r,"ref-y":-r,"x-alignment":-.999,"y-alignment":-.999}}};i[t]&&this.attr(i[t]),this.trigger("batch:stop")},addPoint:function(t,e,r){r=r||{};var i=this.get("series"),n=lt(i).findIndex(function(o){return o.name===e});if(n===-1)throw new Error("Serie "+e+" was not found.");var a=de(i[n]);a.data.push(t),Number.isFinite(r.maxLen)&&a.data.length>r.maxLen&&a.data.shift(),i=i.slice(),i[n]=a,this.set("series",i,r)},lastPoint:function(t){var e=lt(this.get("series")).find(function(r){return r&&r.name===t}).data;return e[e.length-1]},firstPoint:function(t){return lt(this.get("series")).find(function(e){return e&&e.name===t}).data[0]}}),i2=kt.extend({events:{mousemove:"onMouseMove",mouseout:"onMouseOut"},presentationAttributes:kt.addPresentationAttributes({series:["UPDATE"],interpolate:["UPDATE"],padding:["UPDATE"],canvas:["UPDATE"],markings:["UPDATE"],axis:["UPDATE"]}),initialize:function(){kt.prototype.initialize.apply(this,arguments),this.on("cell:pointerdown",this.onPointerDown,this),this._disabledSeries=[]},renderMarkup:function(){kt.prototype.renderMarkup.apply(this,arguments),this.elDataClipPath=this.$(".clip")[0],this.elDataClipPathRect=this.elDataClipPath.firstChild,this.elBackgroundRect=this.$(".background rect")[0],this.elBackgroundText=this.$(".background text")[0],this.elForeground=this.$(".foreground")[0],this.elForegroundRect=this.$(".foreground rect")[0],this.elDataSeries=this.$(".data .series")[0],this.elYAxisPath=this.$(".y-axis path")[0],this.elYAxisTicks=this.$(".y-axis .ticks")[0],this.elXAxisPath=this.$(".x-axis path")[0],this.elXAxisTicks=this.$(".x-axis .ticks")[0],this.elMarkings=this.$(".axis .markings")[0],this.elXGuideline=this.$(".x-guideline")[0],this.elYGuideline=this.$(".y-guideline")[0],this.elLegend=this.$(".legend")[0],this.elLegendItems=this.$(".legend-items")[0],this.elTick=F(this.model.tickMarkup),this.elMarking=F(this.model.markingMarkup),this.elLegendItem=F(this.model.legendItemMarkup),this.elPoint=F(this.model.pointMarkup),this.elBar=F(this.model.barMarkup),this.elSerie=F(this.model.serieMarkup),this.elDataClipPath.id="clip_"+this.cid,F(this.$(".data")[0]).attr("clip-path","url(#"+this.elDataClipPath.id+")"),F(this.elMarkings).attr("clip-path","url(#"+this.elDataClipPath.id+")")},update:function(){var t=this.filterSeries();this.calculateStats(t);var e=this.model.get("size"),r=e.width,i=e.height;this.canvas=tt({x:0,y:0,width:r,height:i},this.model.get("canvas"));var n,a={top:0,right:0,bottom:0,left:0},o=this.model.get("padding");Yt(o)?n=tt({},a,o):o!==void 0?n={top:o,right:2*o,bottom:2*o,left:o}:n=a,this.canvas=We(this.canvas).moveAndExpand(We(n.left,n.top,-n.right,-n.bottom));var s={x:0,y:0,width:r,height:i};F(this.elDataClipPathRect).attr(s),F(this.elBackgroundRect).attr(s),F(this.elForegroundRect).attr(s),this.updateAxis(),this.updateMarkings(),this.isEmpty()?f(this.elBackgroundText).show():f(this.elBackgroundText).hide(),this.updateSeries(t),this.updateLegend(),kt.prototype.update.apply(this,arguments)},calculateStats:function(t){t=t||this.model.get("series");var e=[],r=[],i={},n={},a={};lt(t).forEach(function(u,g){var h=a[u.name||g]||(a[u.name||g]={});h.decreasingX=!0,h.decreasingY=!0,h.nonDecreasingX=!0,h.nonDecreasingY=!0;var y;Ut(u.data,function(x){h.minX=h.minX===void 0?x.x:Math.min(h.minX,x.x),h.maxX=h.maxX===void 0?x.x:Math.max(h.maxX,x.x),h.minY=h.minY===void 0?x.y:Math.min(h.minY,x.y),h.maxY=h.maxY===void 0?x.y:Math.max(h.maxY,x.y),y&&(h.decreasingX=h.decreasingX&&x.x<y.x,h.decreasingY=h.decreasingY&&x.y<y.y,h.nonDecreasingX=h.nonDecreasingX&&x.x>=y.x,h.nonDecreasingY=h.nonDecreasingY&&x.y>=y.y),e.includes(x.x)||e.push(x.x),r.includes(x.y)||r.push(x.y),(i[x.x]||(i[x.x]=[])).push({serie:u,x:x.x,y:x.y}),(n[x.y]||(n[x.y]=[])).push({serie:u,x:x.x,y:x.y}),y=x})});var o=this.model.get("axis")||{},s=o["x-axis"]||{},l=o["y-axis"]||{};this.stats={minX:s.min===void 0?e.reduce(function(u,g){return g<u?g:u},1/0):s.min,maxX:s.max===void 0?e.reduce(function(u,g){return g>u?g:u},-1/0):s.max,minY:l.min===void 0?r.reduce(function(u,g){return g<u?g:u},1/0):l.min,maxY:l.max===void 0?r.reduce(function(u,g){return g>u?g:u},-1/0):l.max,bySerie:a,xValues:e,yValues:r,xMap:i,yMap:n}},isEmpty:function(){return!this.stats.xValues.length},updateSeries:function(t){if(t=t||this.model.get("series"),this.elDataSeries.textContent="",!this.isEmpty()){var e=[this.stats.minX,this.stats.maxX],r=[this.stats.minY,this.stats.maxY],i=[this.canvas.x,this.canvas.x+this.canvas.width],n=[this.canvas.y+this.canvas.height,this.canvas.y],a=this.model.get("attrs");lt(t).forEach(function(o,s){var l=o.data,u=[],g=this.elSerie.clone().attr("class",o.name||"serie-"+s);F(this.elDataSeries).append(g),Ut(l,function(w){var S=q.linear(e,i,w.x),T=q.linear(r,n,w.y);u.push({x:S,y:T}),a[".point"]&&a[".point"].display!=="none"&&this.renderPoint(w,o),o.bars&&this.renderBar(w,o)}.bind(this));var h=g.findOne(".serie-clip"),y=this.model.get("size"),x=this.stats.bySerie[o.name||s],C=q.linear(e,i,x.minX),p=q.linear(e,i,x.maxX),E=h.findOne("rect");if(E.attr(We(C,0,p-C,y.height)),!o.bars){var k=g.findOne("path");k.attr({d:this.seriePathData(u,o,s),"clip-path":"url(#"+h.node.id+")"})}},this)}},seriePathClipData:function(t,e){var r=10,i=this.model.get("size"),n=t[0],a=["M",n.x,n.y,"V",i.height+r];return a.join(" ")},renderBar:function(t,e){var r=[this.stats.minX,this.stats.maxX],i=[this.stats.minY,this.stats.maxY],n=[this.canvas.x,this.canvas.x+this.canvas.width],a=[this.canvas.y+this.canvas.height,this.canvas.y],o=q.linear(r,n,t.x),s=q.linear(i,a,t.y),l=e.bars.barWidth||.8,u=l>1?l:this.canvas.width/(this.stats.maxX-this.stats.minX)*l,g=q.linear(i,a,0)-s;i[0]===i[1]&&(s=this.canvas.y+this.canvas.height,g=0);var h=t["top-rx"]||e.bars["top-rx"],y=t["top-ry"]||e.bars["top-ry"],x=t["bottom-rx"]||e.bars["bottom-rx"],C=t["bottom-ry"]||e.bars["bottom-ry"],p={left:o,middle:o-u/2,right:o-u}[e.bars.align||"middle"],E=this.elBar.clone();E.attr({"data-serie":e.name,"data-x":t.x,"data-y":t.y,d:F.rectToPath({x:p,y:s,width:u,height:g,"top-rx":h,"top-ry":y,"bottom-rx":x,"bottom-ry":C})});var k=e.name||"serie-"+this.model.get("series").indexOf(e);return F(this.elDataSeries).findOne("."+k+" .bars").append(E),E.node},renderPoint:function(t,e){var r=[this.stats.minX,this.stats.maxX],i=[this.stats.minY,this.stats.maxY],n=[this.canvas.x,this.canvas.x+this.canvas.width],a=[this.canvas.y+this.canvas.height,this.canvas.y],o=q.linear(r,n,t.x),s=q.linear(i,a,t.y);i[0]===i[1]&&(s=this.canvas.y+this.canvas.height);var l=this.elPoint.clone();l.attr({"data-serie":e.name,"data-x":t.x,"data-y":t.y}),l.findOne("circle").attr({cx:o,cy:s}),l.findOne("text").attr({x:o,dy:s}).text(this.pointLabel(t,e));var u=e.name||"serie-"+this.model.get("series").indexOf(e);return F(this.elDataSeries).findOne("."+u+" .points").append(l),l.node},seriePathData:function(t,e,r){var i,n=t.length,a=[this.stats.minY,this.stats.maxY];if(a[0]===a[1])for(i=0;i<n;i++)t[i].y=this.canvas.y+this.canvas.height;var o,s=e.interpolate===void 0?this.model.get("interpolate"):e.interpolate;switch(s){case"bezier":o=new rt(Zt.throughPoints(t));break;case"step":for(o=new rt,o.appendSegment(rt.createSegment("M",t[0].x,t[0].y)),i=1;i<n;i++)o.appendSegment(rt.createSegment("L",(t[i-1].x+t[i].x)/2,t[i-1].y)),o.appendSegment(rt.createSegment("L",(t[i-1].x+t[i].x)/2,t[i].y));o.appendSegment(rt.createSegment("L",t[n-1].x,t[n-1].y));break;case"stepBefore":for(o=new rt,o.appendSegment(rt.createSegment("M",t[0].x,t[0].y)),i=1;i<n;i++)o.appendSegment(rt.createSegment("L",t[i-1].x,t[i].y)),o.appendSegment(rt.createSegment("L",t[i].x,t[i].y));break;case"stepAfter":for(o=new rt,o.appendSegment(rt.createSegment("M",t[0].x,t[0].y)),i=1;i<n;i++)o.appendSegment(rt.createSegment("L",t[i].x,t[i-1].y)),o.appendSegment(rt.createSegment("L",t[i].x,t[i].y));break;default:for(o=new rt,o.appendSegment(rt.createSegment("M",t[0].x,t[0].y)),i=1;i<n;i++)o.appendSegment(rt.createSegment("L",t[i].x,t[i].y));break}return this.fixPathForFill(o,t,e,r).serialize()},fixPathForFill:function(t,e,r,i){if(e.length===0||r.hideFillBoundaries)return t;var n=this.stats.bySerie[r.name||i];if(!n.nonDecreasingX)return t;var a=t.getSegment(0);t.replaceSegment(0,rt.createSegment("L",a.end.x,a.end.y));var o=r.fillPadding&&r.fillPadding.left||0,s=r.fillPadding&&r.fillPadding.right||0,l=r.fillPadding&&r.fillPadding.bottom||10,u=this.model.get("size"),g=e[0],h=e[e.length-1];return t.insertSegment(0,rt.createSegment("M",h.x+s,u.height+l)),t.insertSegment(1,rt.createSegment("L",g.x-o,u.height+l)),t.insertSegment(2,rt.createSegment("L",g.x-o,g.y)),r.showRightFillBoundary&&(t.appendSegment(rt.createSegment("L",h.x+s,h.y)),t.appendSegment(rt.createSegment("Z"))),t},updateAxis:function(){var t=this.model.get("axis"),e=this.model.get("size"),r=e.height,i=e.width;if(F(this.elXAxisPath).attr("d",["M",0,r,"L",i,r].join(" ")),F(this.elYAxisPath).attr("d",["M",0,0,"L",0,r].join(" ")),this.elXAxisTicks.textContent="",this.elYAxisTicks.textContent="",this.isEmpty())return;var n=[this.stats.minX,this.stats.maxX],a=[this.stats.minY,this.stats.maxY],o=[this.canvas.x,this.canvas.x+this.canvas.width],s=[0,this.canvas.height],l=t&&t["y-axis"]||{},u=t&&t["x-axis"]||{};g.call(this,u,e,n,o),h.call(this,l,e,a,s);function g(p,E,k,w){var S=function(N,D,z){N.translate(D,z.height),F(this.elXAxisTicks).append(N)},T=function(N,D,z){return q.linear(N,D,z)},m=function(N){return N};if(!p.ticks){var A=this.stats.xValues;y.call(this,p,E,k,w,T,S,m,A);return}var M=this.canvas.width/(E.width-2*this.canvas.x);x.call(this,p,E,k,w,T,S,m,M)}function h(p,E,k,w){var S=function(M,N){M.translate(0,N),F(this.elYAxisTicks).append(M)},T=function(M,N,D){return M[0]===M[1]?this.canvas.y+this.canvas.height:q.linear(M,N,D)},m=function(M,N,D){var z=N[1]-(M-N[0]);return z+=q.linear(D,N,this.canvas.y)-N[0],z},A=this.canvas.height/E.height;x.call(this,p,E,k,w,T,S,m,A)}function y(p,E,k,w,S,T,m,A){A.forEach(function(M,N){N%(p.tickStep||1)===0&&C.call(this,p,E,k,w,S,T,m,M)},this)}function x(p,E,k,w,S,T,m,A){var M=k[1]-k[0],N=p.ticks||11;M===0&&(N=1);for(var D=M/N/A,z=k[0],_=0;_<N;_++)C.call(this,p,E,k,w,S,T,m,z),z+=D}function C(p,E,k,w,S,T,m,A){var M=this.elTick.clone(),N=S.call(this,k,w,A);if(!(N>E.width)){T.call(this,M,N,E);var D=m.call(this,A,k,w);M.findOne("text").text(this.tickLabel(D,p))}}},tickLabel:function(t,e){if(yt(e.tickFormat))return e.tickFormat(t);var r=e.tickFormat||".1f",i=an.number(r,t);return i+(yt(e.tickSuffix)?e.tickSuffix(t):e.tickSuffix||"")},pointLabel:function(t,e){if(yt(e.pointFormat))return e.pointFormat(t);var r=e.pointFormat||".1f",i=an.number(r,t.y);return i+(e.pointSuffix||"")},updateMarkings:function(){this.elMarkings.textContent="";var t=this.model.get("markings");if(!t||t.length===0)return;var e=this.model.get("size"),r=e.width,i=e.height,n=[this.stats.minX,this.stats.maxX],a=[this.stats.minY,this.stats.maxY],o=[this.canvas.x,this.canvas.x+this.canvas.width],s=[this.canvas.y,this.canvas.y+this.canvas.height];function l(u,g){return u===void 0?g:u}lt(t).forEach(function(u,g){var h=u.start||u.end,y=u.end||u.start,x=Math.min(l(h.x,this.stats.minX),l(y.x,this.stats.minX)),C=Math.max(l(h.x,this.stats.maxX),l(y.x,this.stats.maxX)),p=Math.min(l(h.y,this.stats.minY),l(y.y,this.stats.minY)),E=Math.max(l(h.y,this.stats.maxY),l(y.y,this.stats.maxY)),k=h.x===void 0||y.x===void 0,w=h.y===void 0||y.y===void 0;k&&(o=[0,r]),w&&(s=[0,i]);var S=q.linear(n,o,x),T=q.linear(n,o,C),m=q.linear(a,s,p),A=q.linear(a,s,E),M=S,N=s[1]-A+s[0],D=T-S,z=A-m;if(a[0]===a[1]&&p===E){if(a[0]!==p)return;N=this.canvas.y+this.canvas.height,z=1}D=Math.max(D,1),z=Math.max(z,1);var _=this.elMarking.clone();_.findOne("rect").attr({x:M,y:N,width:D,height:z}),_.findOne("text").text(u.label||"").attr({x:M+D,y:N});var j=_.attr("class")+" "+(u.name||"marking-"+g);_.attr(tt({class:j},u.attrs)),F(this.elMarkings).append(_)},this)},updateLegend:function(){var t=this.model.get("series");this.elLegendItems.textContent="",lt(t).forEach(function(e,r){if(!(yt(e.showLegend)&&!e.showLegend(e,this.stats.bySerie[e.name||r]))&&e.showLegend!==!1){var i=this.elLegendItem.clone();this._disabledSeries.includes(e.name)&&i.addClass("disabled"),i.attr("data-serie",e.name),i.findOne("circle").attr({fill:this.getSerieColor(e.name)}),i.findOne("text").text(e.label||e.name),i.translate(0,r*(e.legendLabelLineHeight||16)),F(this.elLegendItems).append(i)}},this)},getSerieColor:function(t){var e=this.model.get("attrs"),r=Object.keys(e).find(function(i){return i.includes(t)});return r?e[r].stroke||e[r].fill:"black"},hideSerie:function(t){this._disabledSeries.includes(t)||this._disabledSeries.push(t);var e=this.filterSeries();this.update(e)},showSerie:function(t){this._disabledSeries=hi(this._disabledSeries,t);var e=this.filterSeries();this.update(e)},filterSeries:function(t){return t=t||this.model.get("series"),t=lt(t).filter(function(e){return!this._disabledSeries.includes(e.name)},this),t},onPointerDown:function(t,e,r){var i=f(t.target).closest(".legend-item")[0];i&&(F(i).toggleClass("disabled"),F(i).hasClass("disabled")?this.hideSerie(F(i).attr("data-serie")):this.showSerie(F(i).attr("data-serie")))},onMouseMove:function(t){this.showGuidelines(t.clientX,t.clientY,t)},onMouseOut:function(t){this.hideGuidelines(),this.trigger("mouseout",t)},showGuidelines:function(t,e,r){var i=this.model.get("angle"),n=this.model.getBBox(),a=new Z(F(this.paper.layers).toLocalPoint(t,e)).rotate(n.center(),i);if(We(n).containsPoint(a)){var o=this.model.get("size"),s=a.x-n.x,l=a.y-n.y;F(this.elXGuideline).attr({x1:s,y1:0,x2:s,y2:o.height,visibility:"visible"}),F(this.elYGuideline).attr({x1:0,y1:l,x2:o.width,y2:l,visibility:"visible"});var u=q.linear([this.canvas.x,this.canvas.x+this.canvas.width],[this.stats.minX,this.stats.maxX],s),g=q.linear([this.canvas.y,this.canvas.y+this.canvas.height],[this.stats.minY,this.stats.maxY],l),h={x:u,y:this.stats.minY+this.stats.maxY-g},y={x:t,y:e},x=this.closestPoints(u);this.trigger("mouseover",h,y,x,r)}},closestPoints:function(t){var e=Jn(this.stats.xValues,t),r=this.stats.xValues[e],i=this.stats.xValues[e-1],n=i===void 0||Math.abs(t-r)<Math.abs(t-i)?r:i;return this.stats.xMap[n]},hideGuidelines:function(){F(this.elXGuideline).attr("visibility","hidden"),F(this.elYGuideline).attr("visibility","hidden")}}),pa=_t.extend({markup:['<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="data"></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>',"</g>","</g>"].join(""),sliceMarkup:'<g class="slice"/>',sliceFillMarkup:'<path class="slice-fill"/>',sliceBorderMarkup:'<path class="slice-border"/>',sliceInnerLabelMarkup:'<text class="slice-inner-label"/>',legendSerieMarkup:'<g class="legend-serie"><text/></g>',legendSliceMarkup:'<g class="legend-slice"><circle/><text/></g>',defaults:Ue({type:"chart.Pie",size:{width:200,height:200},pieHole:0,serieDefaults:{startAngle:0,degree:360,label:null,showLegend:!0,labelLineHeight:6},sliceDefaults:{innerLabel:"{percentage:.0f}%",innerLabelMargin:6,legendLabel:"{label}: {value}",legendLabelLineHeight:6,legendLabelMargin:14,offset:0,onClickEffect:{type:"offset",offset:20},onHoverEffect:null},series:[],attrs:{".background > rect":{opacity:0},".background > text":{fill:"black",text:"No data available.",ref:".background > rect","ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":6,"text-anchor":"start","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":18,"text-anchor":"start","y-alignment":"middle","font-size":10},".data":{ref:".background","ref-x":.5,"ref-y":.5},".slice":{cursor:"pointer"},".slice > .slice-fill":{stroke:"#ffffff","stroke-width":1,"fill-opacity":1},".slice.hover > .slice-fill":{"fill-opacity":.8},".slice > .slice-border":{"stroke-width":6,"stroke-opacity":.4,"fill-opacity":1,fill:"none",display:"none"},".slice.hover > .slice-border":{display:"block"},".slice > .slice-inner-label":{"text-anchor":"middle","font-size":"12",stroke:"none","stroke-width":"0",fill:"#ffffff"},".slice > .slice-inner-label > tspan":{dy:"-.5em"},".legend":{"ref-dx":20,"ref-y":5},".legend-serie text":{fill:"grey",transform:"translate(2, 0)","font-size":13},".legend-slice":{cursor:"pointer"},".legend-slice text":{"font-weight":"normal",fill:"black","font-size":11},".legend-slice.hover text":{"font-weight":"bold"},".legend-slice circle":{r:5,transform:"translate(5,5)"}}},_t.prototype.defaults),addSlice:function(t,e,r){r=r||{},e=e||0;var i=this.get("series");i[e]===void 0&&(i[e]={data:[]});var n=de(i[e]);n.data.push(t),i=i.slice(),i[e]=n,r=n.data.length>1?tt(r,{changedSerieIndex:e}):r,this.set("series",i,r)},editSlice:function(t,e,r,i){i=i||{},r=r||0;var n=this.get("series");if(n[r]===void 0||n[r].data[e]===void 0)throw new Error("Slice "+e+" on serie "+r+" was not found.");var a=de(n[r]);a.data[e]=tt(a.data[e],t),n=n.slice(),n[r]=a,this.set("series",n,tt(i,{changedSerieIndex:r}))}}),Hg=kt.extend({events:{"mouseover .slice":"onMouseOverSlice","mouseout .slice":"onMouseOverSlice","mousemove .slice":"onMouseMoveSlice","mouseover .legend-slice":"onEventLegendItem","mouseout .legend-slice":"onEventLegendItem"},presentationAttributes:kt.addPresentationAttributes({series:["UPDATE"],serieDefaults:["UPDATE"],sliceDefaults:["UPDATE"],pieHole:["UPDATE"]}),initialize:function(){kt.prototype.initialize.apply(this,arguments),this.on("cell:pointerclick",this.onClickSlice,this),this.on("cell:pointerclick",this.onEventLegendItem,this)},renderMarkup:function(){kt.prototype.renderMarkup.apply(this,arguments),this.elBackgroundRect=this.$(".background rect")[0],this.elBackgroundText=this.$(".background text")[0],this.elForegroundRect=this.$(".foreground rect")[0],this.elLegendItems=this.$(".legend-items")[0],this.elPie=this.$(".data")[0],this.elSlice=F(this.model.sliceMarkup),this.elSliceFill=F(this.model.sliceFillMarkup),this.elSliceBorder=F(this.model.sliceBorderMarkup),this.elSliceInnerLabel=F(this.model.sliceInnerLabelMarkup),this.elLegendSerie=F(this.model.legendSerieMarkup),this.elLegendSlice=F(this.model.legendSliceMarkup)},update:function(t,e,r){r=r||{};var i=r.changedSerieIndex,n=this.calculateSeries(i);i in n?f(this.elPie).find(".serie-"+i).remove():f(this.elPie).empty();var a=this.model.get("size");F(this.elBackgroundRect).attr(a),F(this.elForegroundRect).attr(a),n.length?f(this.elBackgroundText).hide():f(this.elBackgroundText).show(),lt(n).forEach(function(o,s){i!==void 0&&i!==s||Ut(o.data,this.updateSlice.bind(this))},this),this.updateLegend(),kt.prototype.update.apply(this,arguments)},calculateSeries:function(t){var e=de(this.model.get("series")),r=this.model.get("serieDefaults"),i=this.model.get("sliceDefaults"),n=this.model.get("size"),a=Math.min(n.width,n.height)/2,o=this.model.get("pieHole");o=o>1?o:a*o;var s=a,l=(a-o)/e.length;return this._series=e.map(function(u,g){if(t!==void 0&&t!==g)return u;u=ne(u,r);var h=u.startAngle,y=u.data.reduce(function(p,E){return p+E.value},0),x=u.degree/y||0,C=100/y;return u.data=u.data.map(function(p,E){p=ne(p,Ce(i,"offset","onClickEffect","onHoverEffect")),p.outerRadius=s,p.innerRadius=s-l,g||(p=ne(p,ln(i,"offset","onClickEffect","onHoverEffect")),p.isOuter=!0,p.offset=p.offset>1?p.offset:p.offset*p.outerRadius,p.onClickEffect.offset=p.onClickEffect.offset>1?p.onClickEffect.offset:p.onClickEffect.offset*p.outerRadius),p.serieIndex=g,p.sliceIndex=E,p.innerLabelMargin=p.innerLabelMargin<-1||p.innerLabelMargin>1?p.innerLabelMargin:p.innerLabelMargin*p.outerRadius,p.percentage=p.value*C;var k=p.value*x;return p.degree={angle:k,start:h,end:k+h},p.rad={angle:bt(p.degree.angle,!0),start:bt(p.degree.start,!0),end:bt(p.degree.end,!0)},p.middleangle=(p.rad.start+p.rad.end)/2,h=p.degree.end,p}),s-=l,u}),this._series},updateLegend:function(){var t=this._series;this.elLegendItems.textContent="";var e=0,r=parseInt(this.model.attr(".legend-serie text/font-size"),10),i=parseInt(this.model.attr(".legend-slice text/font-size"),10);lt(t).forEach(function(n,a){if(!!n.showLegend){if(n.label){var o=this.elLegendSerie.clone();n.name&&o.addClass(n.name),o.attr({"data-serie":a}),o.findOne("text").text(n.label),o.translate(0,e),F(this.elLegendItems).append(o),e+=r+n.labelLineHeight}Ut(n.data,function(s,l){var u=this.elLegendSlice.clone(),g=this.getSliceFillColor(l,a);s.name&&u.addClass(s.name),u.attr({"data-serie":a,"data-slice":l}),u.findOne("text").text(an.string(s.legendLabel,s)),u.findOne("text").translate(s.legendLabelMargin),u.translate(0,e),e+=i+s.legendLabelLineHeight,Yt(g)?this.applyGradient(u.findOne("circle"),"fill",g):u.findOne("circle").attr({fill:g}),F(this.elLegendItems).append(u)}.bind(this))}},this)},applyGradient:function(t,e,r){var i=$t(t)?this.findBySelector(t):f(t).toArray(),n=this.paper.defineGradient(r);i.forEach(function(a){F(a).attr(e,"url(#"+n+")")})},updateSlice:function(t){var e=this.elSlice.clone();F(this.elPie).append(e);var r=this.elSliceFill.clone(),i=this.getSliceFillColor(t.sliceIndex,t.serieIndex);r.attr({fill:i,d:F.createSlicePathData(t.innerRadius,t.outerRadius,t.rad.start,t.rad.end)}),e.append(r),Yt(i)&&this.applyGradient("#"+r.attr("id"),"fill",i);var n=this.elSliceBorder.clone(),a=parseInt(this.model.attr(".slice > .slice-border/stroke-width"),10),o=Bt.fromPolar(t.outerRadius+a/2,-t.rad.start,Bt(0,0)),s=Bt.fromPolar(t.outerRadius+a/2,-t.rad.end,Bt(0,0));n.attr({stroke:i,d:this.drawArc(o,s,t.outerRadius+a/2,t.rad.start,t.rad.end)}),e.append(n),Yt(i)&&this.applyGradient("#"+n.attr("id"),"stroke",i);var l=this.elSliceInnerLabel.clone();l.text(an.string(t.innerLabel,t)),e.append(l);var u=l.bbox(),g=t.outerRadius-u.width/2-t.innerLabelMargin;l.translate(g*Math.cos(-t.middleangle),-g*Math.sin(-t.middleangle)),e.attr({"data-serie":t.serieIndex,"data-slice":t.sliceIndex,"data-value":t.value});var h=this._series[t.serieIndex].name;return h&&e.addClass(h),t.name&&e.addClass(t.name),e.addClass("serie-"+t.serieIndex+" slice-"+t.sliceIndex),t.isOuter&&(e.addClass("outer"),t.offset&&(e.addClass("clicked"),this.effectOnSlice(e,t,{type:"offset",offset:t.offset}))),e},getSliceFillColor:function(t,e){e=e||0;var r=this.model.get("attrs"),i=Object.keys(r).find(function(n){return n.indexOf(".serie-"+e+".slice-"+t+" > .slice-fill")>-1});return i?r[i].fill:this._series[e].data[t].fill},onMouseMoveSlice:function(t){var e=F(t.currentTarget),r=e.attr("data-serie"),i=e.attr("data-slice"),n=this._series[r].data[i];this.trigger(t.type,n,t)},mouseOverSlice:function(t,e){e=e||0;var r=F(this.$('.slice[data-serie="'+e+'"][data-slice="'+t+'"]')[0]),i=this._series[e].data[t];r.toggleClass("hover"),i.isOuter&&!je(i.onHoverEffect)&&this.effectOnSlice(r,i,i.onHoverEffect,!r.hasClass("hover"));var n=F(this.$('.legend-slice[data-serie="'+e+'"][data-slice="'+t+'"]')[0]);n&&n.toggleClass("hover");var a=Object.keys(this.model.get("attrs")).filter(function(o){return o.indexOf(".slice")>-1||o.indexOf(".legend-slice")>-1});kt.prototype.update.call(this,this.model,ln(this.model.get("attrs"),a))},onMouseOverSlice:function(t){var e=F(t.currentTarget),r=e.attr("data-serie"),i=e.attr("data-slice");this.mouseOverSlice(i,r);var n=this._series[r].data[i];this.trigger(t.type,n,t)},clickSlice:function(t,e){e=e||0;var r=F(this.$('.slice[data-serie="'+e+'"][data-slice="'+t+'"]')[0]),i=this._series[e].data[t];!i.isOuter||(r.hasClass("clicked")?(r.removeClass("clicked"),this.model.get("series")[e].data[t].offset=0,this.effectOnSlice(r,i,i.onClickEffect,!0)):(r.addClass("clicked"),this.model.get("series")[e].data[t].offset=i.onClickEffect.offset,this.effectOnSlice(r,i,i.onClickEffect)))},onClickSlice:function(t){var e=F(f(t.target).closest(".slice.outer")[0]);if(e){var r=e.attr("data-serie"),i=e.attr("data-slice");this.clickSlice(i,r);var n=this._series[r].data[i];this.trigger(t.type,n,t)}},onEventLegendItem:function(t){var e=F(f(t.target).closest(".legend-slice")[0]);if(e){var r=e.attr("data-serie"),i=e.attr("data-slice");switch(t.type){case"click":this.clickSlice(i,r);break;case"mouseover":case"mouseout":this.mouseOverSlice(i,r);break}}},effectOnSlice:function(t,e,r,i){switch(i=i||!1,r.type){case"enlarge":i?t.scale(1):t.scale(r.scale||1.05);break;case"offset":i?t.translate(0,0,{absolute:!0}):t.translate(r.offset*Math.cos(-e.middleangle),-r.offset*Math.sin(-e.middleangle));break}},svgArcMax:2*Math.PI-1e-6,drawArc:function(t,e,r,i,n){var a=0,o=1,s=n-i;return s>Math.PI&&(a=1,s>=this.svgArcMax&&(a=0,o=0)),"M"+t.x+","+t.y+" A"+r+","+r+" 0 "+a+","+o+" "+e.x+","+e.y}}),n2=pa.extend({defaults:Ue({type:"chart.Knob",sliceDefaults:{legendLabel:"{value:.0f}",outer:{offsetOnClick:0}},pieHole:.7,value:0,attrs:{".legend":{"ref-x":.5,"ref-y":.5,"ref-dx":null,"x-alignment":-.5,"y-alignment":-.5},".legend-slice text":{"font-size":30},".legend-slice circle":{display:"none"},".slice-inner-label":{display:"none"},".slice-fill":{stroke:"none"}}},pa.prototype.defaults),initialize:function(){this.set("series",this.getKnobSeries(),{silent:!0}),pa.prototype.initialize.apply(this,arguments),this.on("change:value change:min change:max change:fill",this.updateKnob,this)},getKnobSeries:function(){var t=Array.isArray(this.get("value"))?this.get("value"):[this.get("value")],e=Array.isArray(this.get("fill"))?this.get("fill"):[this.get("fill")],r=Array.isArray(this.get("min"))?this.get("min"):[this.get("min")],i=Array.isArray(this.get("max"))?this.get("max"):[this.get("max")],n=t.map(function(a,o){var s=r[o]===void 0?r[0]:r[o],l=i[o]===void 0?i[0]:i[o],u=e[o]===void 0?e[0]:e[o];return{degree:q.linear([s,l],[0,360],a),data:[{value:a,fill:u}],showLegend:!(o>0)}});return n},updateKnob:function(){this.set("series",this.getKnobSeries())}}),a2=Hg,o2=_t.extend({markup:['<g class="rotatable">','<g class="scalable">','<g class="background"><rect/></g>','<g class="cells"/>','<g class="foreground"/>',"</g>",'<g class="labels">','<g class="rows"/>','<g class="columns"/>',"</g>","</g>"].join(""),cellMarkup:'<rect class="cell"/>',labelMarkup:'<text class="label"/>',gridLineMarkup:'<path class="grid-line"/>',defaults:Ue({type:"chart.Matrix",attrs:{".background rect":{fill:"#eeeeee"},".grid-line":{stroke:"white","stroke-width":2},".label":{fill:"black","alignment-baseline":"middle"},".labels .rows .label":{"text-anchor":"end"},".labels .columns .label":{"text-anchor":"start"}}},_t.prototype.defaults)}),s2=kt.extend({presentationAttributes:kt.addPresentationAttributes({size:["LABELS"],cells:["MARKUP","LABELS"]}),initFlag:["LABELS"].concat(kt.prototype.initFlag),confirmUpdate:function(){var t=kt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"MARKUP")&&(this.renderMarkup(),t=this.removeFlag(t,"MARKUP")),this.hasFlag(t,"LABELS")&&(this.renderLabels(),t=this.removeFlag(t,"LABELS")),t},renderMarkup:function(){kt.prototype.renderMarkup.apply(this,arguments),this.elCells=this.$(".cells")[0],this.elRowLabels=this.$(".labels .rows")[0],this.elColumnLabels=this.$(".labels .columns")[0],this.elForeground=this.$(".foreground")[0],this.elCell=F(this.model.cellMarkup),this.elGridLine=F(this.model.gridLineMarkup);var t=this.model.get("cells")||[],e=this.model.get("size");this.elBackgroundRect=this.$(".background rect")[0],F(this.elBackgroundRect).attr(e);var r=e.height/t.length,i=e.width/t.length,n=document.createDocumentFragment();this.elCells.textContent="",this.elForeground.textContent="";for(var a=document.createDocumentFragment(),o,s,l,u,g,h=0;h<t.length;h++)for(l=this.elGridLine.clone(),l.addClass("horizontal"),l.attr("d","M 0 "+h*r+" "+e.width+" "+h*r),a.appendChild(l.node),o=t[h],s=0;s<o.length;s++)h===0&&(l=this.elGridLine.clone(),l.addClass("vertical"),l.attr("d","M "+s*i+" 0 "+s*i+" "+e.height),a.appendChild(l.node)),u=o[s],u&&(g=this.elCell.clone(),g.attr(tt({x:s*i,y:h*r,width:i,height:r},u)),n.appendChild(g.node));this.elForeground.appendChild(a),this.elCells.appendChild(n)},renderLabels:function(){this.elLabel=F(this.model.labelMarkup);var t=this.model.get("cells")||[],e=this.model.get("labels")||{},r=e.rows||[],i=e.columns||[],n=this.model.get("size"),a=n.height/t.length,o=n.width/t.length,s,l;this.elRowLabels.textContent="",this.elColumnLabels.textContent="";for(var u=document.createDocumentFragment(),g=0;g<r.length;g++)s=e.rows[g],l=this.elLabel.clone(),l.text(s.text),l.attr(tt({x:-(e.padding||5),y:g*a+a/2,"text-anchor":"end","dominant-baseline":"central","font-size":a,"data-row":g},Ce(s,"text"))),u.appendChild(l.node);this.elRowLabels.appendChild(u);for(var h,y,x=document.createDocumentFragment(),C=0;C<i.length;C++)s=e.columns[C],l=this.elLabel.clone(),h=C*o+o/2,y=-(e.padding||5),l.attr("x",h),l.text(s.text),l.attr(tt({y,"text-anchor":"start","dominant-baseline":"central","font-size":o,"data-column":C},Ce(s,"text"))),l.rotate(-90,h,y),x.appendChild(l.node);this.elColumnLabels.appendChild(x)}}),l2={__proto__:null,Plot:r2,PlotView:i2,Pie:pa,PieView:Hg,Knob:n2,KnobView:a2,Matrix:o2,MatrixView:s2},hs={none:"",message:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIGhlaWdodD0iNTEycHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iNTEycHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik00NzkuOTk4LDY0SDMyQzE0LjMyOSw2NCwwLDc4LjMxMiwwLDk2djMyMGMwLDE3LjY4OCwxNC4zMjksMzIsMzIsMzJoNDQ3Ljk5OEM0OTcuNjcxLDQ0OCw1MTIsNDMzLjY4OCw1MTIsNDE2Vjk2ICBDNTEyLDc4LjMxMiw0OTcuNjcxLDY0LDQ3OS45OTgsNjR6IE00MTYsMTI4TDI1NiwyNTZMOTYsMTI4SDQxNnogTTQ0OCwzODRINjRWMTYwbDE5MiwxNjBsMTkyLTE2MFYzODR6Ii8+PC9zdmc+",plus:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLjUsMTRIMTR2OC41YzAsMC4yNzYtMC4yMjQsMC41LTAuNSwwLjVoLTRDOS4yMjQsMjMsOSwyMi43NzYsOSwyMi41VjE0SDAuNSAgQzAuMjI0LDE0LDAsMTMuNzc2LDAsMTMuNXYtNEMwLDkuMjI0LDAuMjI0LDksMC41LDlIOVYwLjVDOSwwLjIyNCw5LjIyNCwwLDkuNSwwaDRDMTMuNzc2LDAsMTQsMC4yMjQsMTQsMC41VjloOC41ICBDMjIuNzc2LDksMjMsOS4yMjQsMjMsOS41djRDMjMsMTMuNzc2LDIyLjc3NiwxNCwyMi41LDE0eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",cross:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXoiLz48L3N2Zz4=",user:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLDIwLjk5OGgtMWMwLDAtMSwwLTEtMVYxNy41YzAtMC4yNzctMC4yMjQtMC41LTAuNS0wLjVTMTksMTcuMjIzLDE5LDE3LjUgIGwtMC4wMDgsNC4yOTVjMCwwLjYwOS0yLjAxLDIuMjA1LTYuNDkyLDIuMjA1cy02LjQ5Mi0xLjU5Ni02LjQ5Mi0yLjIwNUw2LDE3LjVDNiwxNy4yMjMsNS43NzYsMTcsNS41LDE3UzUsMTcuMjIzLDUsMTcuNXYyLjQ5OCAgYzAsMS0xLDEtMSwxSDNjMCwwLTEsMC0xLTFWMTUuNzVjMC0yLjkyMiwyLjg5Mi01LjQwMSw2LjkzLTYuMzQxYzAsMCwxLjIzNCwxLjEwNywzLjU3LDEuMTA3czMuNTctMS4xMDcsMy41Ny0xLjEwNyAgYzQuMDM4LDAuOTQsNi45MywzLjQxOSw2LjkzLDYuMzQxdjQuMjQ4QzIzLDIwLjk5OCwyMiwyMC45OTgsMjIsMjAuOTk4eiBNMTIuNDc3LDljLTIuNDg1LDAtNC41LTIuMDE1LTQuNS00LjVTOS45OTEsMCwxMi40NzcsMCAgczQuNSwyLjAxNSw0LjUsNC41UzE0Ljk2Miw5LDEyLjQ3Nyw5eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",circle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gULEBE3DEP64QAAAwlJREFUaN7dmktrU0EUx38ZmmBbfEIL2hSjkYKC1EW6EDFudC+404/gE6WKSvGxERQfIH4AX1T9EOKrCrYurVrbgsZWoaBVixDbpC6ci+Fyz9ybZG478cBs7syc+Z+5c86c+c8ksCPrgW1ADtgEbARafG1+AW+AYWAIGADGWUTZAJwHxoD5GssocA7ILiTwLcADoFQHcH8pAfeB7jiBtwO3gLJF4P5S1mO02wa/C5iMEbi/TAI7bYE/Y3m5VLOs+sLAJULqrgKHIxhZBp4DT4FX2jkLGoinq1M7fg7YDmwFVATd14CjFboiy5UIs/QBOAmka/izaeCU1hE2zuVqlZ8IUfgVOAA0WViiTcBBrdM0Zm9UhTuAOYOiRzXOeJh0Ak8M484B+TAlK4BPBiU3gWSMoTqpw6g0fgFYblJww9D5dojT25IEcMeA47rUsdsQLp9FmPmURSNSOqpJS2lzUKd+ocN3IBNx5mz+oXXADwHTXX/jjMFxjy1iwtgrYJoF1lY27BMafozZaaMspYKA7XRlw7f1xt4Y5biA7bXXIGv4TW0OGNCmsQRhzCidlwTJADDlgAFTwAuhLq+AHqHyMe6IhKVHAV1C5ZBDBkhYupThPPreIQNGJTJBGXKLLw4Z8NmQu/Fb8PCkQwakBIxFRWPLvAJmhMpWh4AuFb7PKGBaqFzjkAGrhe/TSjNrQZJ1yAAJy5gCRoTKnEMGSFhGFDBoOBu7IhKWQe8wLRFLHQ6A7zCcFNNK59vvAjoqYK8DBuwTCLBhTUD8Hweahj9S2jjU297VqzrU26BVmi2yEjXRKg1PbHnpqYla7AeWxAi+GbhHHdSit2mYyN2XQQ5kQTJ6Y6qL3PUkCr2+H7v0+jcs0eueRLngGNeKa9mxY73g8JzpEtHusorAQ/7e+e7WUWIl//jSVTrK7QEu6KgW9d7tYr3B44iBWPJfkZZ8pZ4r2VngkC0HywMTLNwN5YSBcKtZWoGzernEBbyox2iJc6Np2KcGfnHisYet1CDouc2yCjbhp07MrD+3+QNxi4JkAscRswAAAABJRU5ErkJggg==",service:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1RJREFUeNrMWltMVFcUHZAIRSAkSFACITRAVbQ/DVhHiRZC2y9jotFgqgmxKqShKdFCggZbEpP2h1Q/oLUg8GH0xy/LKwpDEEFsjKCM8kYkgAhTpggDMzCc7kX2mGF677w80J5khbnnntc+Zz/W2ReNxvsSQLhPWCBYGPhdTdjg7aBCCI/gVSfu+CHBfPz48ba7d+82AocOHfqT6mYIEV6Oua4CfE6YHxsbeyS49Pf3P6C6RYJ2vQTwVTtKHx+fXYRzhM0qTbYR/g4JCQmyVYSFhQXTHyMhUWXMzTzmTo3MorATHxH0eEXAriYrtCmNiop6tby8bLCdgNVqfR0ZGTlC735RaJ/EY+HhGSFhTVSIyg7CIO3mRHNzs44WOYydJuQQ/AjxhJ9hsFqt9qlwKElJSRB8nvAjIYYN+hucDMbCmMHBwZP03E/YLlUAKh8TnoSHh49NT0+vLG5paWk0JyfnPu9cJ8EUGho6cfTo0fbBwcFWRwH6+vpaYcy0yCk26Hb0zc7ObsFYaIOxaY5xqn9M2ClTgGw8wqM4LuzevXu6xMTEnitXrjTOz8/3Chfl7du3Ly5fvtyUkJDQrzRedXV1I2/KWZkCwCDrsMMWi+WV46Sk42+EhwV24VhnNpuHaY43NFct5pRtA7tw9BkZGQ/peVHIL+bDhw8/YrtKXJM4QOVrVNfV1TXKXr2d6mTK8EI+tk4KPrszNjY2mIJTiK+vb5iK+zX29vbqW1paLNRe7N271590PpF+hyq1hzpt3bpVTE5ODlDfFIU5FdfiTRxAkDKVlpY2QI2VVNvOHUIVXjJmUEcC6Rz7keGLffv2CdoMK5/AogzupCZA8aZNmwxkbEMKi18sKSmxqcF1QjohmgF6UYl3LPw7GxoYGBAbN24U+fn5puLi4qWqqqoBGdwJxZ+J2ZeEXF6U9dixYw+VdLi1tbWJF3/aycBn0aa9vb3J1q++vl4EBARAfYRM7oTSwpFzjjAeExMznJ6e/mRkZORfAoA20Mn8Re3KFAaD9zpH2MzP13GK1GcafSl+iIiICGEymd6Nh4BG7SbVNgNj8Zg7nQmwdPLkybahoaG22dnZbntu41i6u7sh7CzhM1fciZCKTUEf9M3KyhLJycnYBCGTO6FYmpqa3HKX5eXlDWysUW5wp0K0LSoqasvLyxP+/v7ixIkTQjZ3WhFAR8UbAdzgTmY/Pz9rfHy8KCgoEKOjo0I2d1pxzxhAr9e3GI3GZ87ogp0KpbriTrdv3+6ghS9XVlYaFxYWxFpxJ5QaltxMeAOOf+DAgQ4VI55mIy53hzuRx7GuNXfSsM5FwJURzhBK3HSjZ/8P3MmrQIYgxUJUcvDKx/OtW7c61ps7ObtSziHiqlEJ0AU+VqgfPI8lOjraajAYVNUGKgg7Kisra4RDwG9bnFAqZMTjcBBI3ziLA0ovQPL0cXFxg6STU84W1NPT8+DSpUtt8DY3btwwqqm2p9zJ1q+wsBAqC7uL9EQA3H+Fu+41NzdXkPELMmQhizvZeSc9bQ5OucAtATiKLsAPK+0KXCKIWW1trSBSJjIzM8EwxYULF4RM7mRf0tLSnrCX/JXwLW9CLPO4VVfKcHAj4kMvldwZ6ojzr5CywMBAsWXLFrFnz54VmjAxMSE84U4KQqziTvYFapqSktIJnkbtXjNvW+DU5ioB8vDIOrlq7Xfu3GmgINNHl47lixcvIiO3QszsuY273ElFgFXcSSVGTBFfew7eBv4GHucoAHz6Y+I1r23UgFRmED6e1QD8XZBOW7zlTk4EgE28rKioaHBnbNgnPJ+vw8UGrO8rcoVzdJ2MqKmp0ZEbC7l58yaSWacJn0LqoKCgcc1/XOg0nHqhBDt6XI+TsXvnNXdycQJpUCHouzOagTkxN9/mrKqZAE7QgloEOtR7zZ1cCFABRqpkxNgIMuKnmIsvQGaOJ9UepzLelzupjJnlzI2mpqZ28KKvcspHy2vY4I0AMrhTDOMLQhXeXbt2zftAJikd7yl3AmZAxXFK3lIJH08lUUo++aBSo+ki7vQBGaHTRBjdwJ7TghGENFqtNoAuPTvUEmFkDxN0Z7ZSkBymvlqltUj5DOQpd/Kk4HbG6pct5fuYp9xJQlk8depUK1/8P5EqgDvcydPV4g6gVMcutNmWd5IlgEvuhA8ixJl63LjU64uKinS4g+AW5niauE+wKn0vUwB3uNMcvM+RI0faQcKU0ioHDx60pVWMtmQWvj9jLFtaBXNwWmWXbBvYThiAO8TO8UIMHHAQaOIIPyEQ7d+/v9NRgN27d3exfv/AhG4D9zVgLIzJ7heJrW3SjdgVd7Jr8zsybfZUATyKU4tXVXKt9Txml2pqUdbXdDXuZPf+OySPkX+1CQBixtzmjEqfQL6tJaqtxU/ix3I9n4JaeUEInZmZGSHasVIxNTU1wx9TulTGNNGf35zN67eOFL6X4Hv+/Hkr3aN14PNEPYL5atgvjde4+1HBy3/PaXb49xwwzD/eZyP/EWAAQ3AUnjpOYHIAAAAASUVORK5CYII="},ma={initialize:function(){this._parent=(this._parent||this).constructor.__super__,this._parent.initialize.apply(this,arguments),this.listenTo(this,"change:icon",this._onIconChange),this._onIconChange(this,this.get("icon")||"none")},_onIconChange:function(t,e){if(hr(hs,e))t.attr({image:{"xlink:href":hs[e],dataIconType:e}});else throw"BPMN: Unknown icon: "+e}},ya={initialize:function(){this._parent=(this._parent||this).constructor.__super__,this._parent.initialize.apply(this,arguments),this.listenTo(this,"change:subProcess",this._onSubProcessChange),this._onSubProcessChange(this,this.get("subProcess")||null)},_onSubProcessChange:function(t,e){t.attr({".sub-process":{visibility:e?"visible":"hidden","data-sub-process":e||""}})}},u2=Jr,h2=Dr.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body outer"/><rect class="body inner"/></g>',cr.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<path class="sub-process"/><image class="icon"/></g>'].join(""),defaults:Ue({size:{width:100,height:100},type:"bpmn.Activity",attrs:{rect:{rx:8,ry:8,width:100,height:100},".body":{fill:"#ffffff",stroke:"#000000"},".inner":{transform:"scale(0.9,0.9) translate(5,5)"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".inner","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",stroke:"#000000",fill:"transparent"},image:{ref:".inner","ref-x":5,width:20,height:20}},activityType:"task",subProcess:null},Dr.prototype.defaults),initialize:function(){Dr.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:activityType",this.onActivityTypeChange),this.listenTo(this,"change:subProcess",this.onSubProcessChange),this.onSubProcessChange(this,this.get("subProcess")),this.onActivityTypeChange(this,this.get("activityType"))},onActivityTypeChange:function(t,e){switch(e){case"task":t.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;case"transaction":t.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".inner"},image:{ref:".inner"}});break;case"event-sub-process":t.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"1,2"},path:{ref:".outer"},image:{ref:".outer"}});break;case"call-activity":t.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;default:throw"BPMN: Unknown Activity Type: "+e}},onSubProcessChange:function(t,e){e?t.attr({".fobj div":{style:{verticalAlign:"baseline",paddingTop:10}},image:{"ref-dy":-25,"ref-y":""},".content":{"ref-y":10,"y-alignment":null}}):t.attr({".fobj div":{style:{verticalAlign:"middle",paddingTop:0}},image:{"ref-dy":"","ref-y":5},".content":{"ref-y":.5,"y-alignment":"middle"}})}}).extend(ma).extend(ya),c2=Jr,d2=Dr.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',cr.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<path class="stroke"/></g>'].join(""),defaults:Ue({size:{width:100,height:100},type:"bpmn.Annotation",attrs:{rect:{width:100,height:100},".body":{"fill-opacity":.1,fill:"#ffffff",stroke:"none"},".fobj div":{style:{textAlign:"left",paddingLeft:10}},".stroke":{stroke:"#000000",fill:"none","stroke-width":3}},wingLength:20},Dr.prototype.defaults),initialize:function(){Dr.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:size",this.onSizeChange),this.onSizeChange(this,this.get("size"))},onSizeChange:function(t,e){t.attr(".stroke",{d:t.getStrokePathData(e.width,e.height,t.get("wingLength"))})},getStrokePathData:function(t,e,r){return r=Math.min(r,t),["M",r,"0 L 0 0 0",e,r,e].join(" ")}}),f2=At.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/><image/></g></g><text class="label"/>',defaults:Ue({type:"bpmn.Gateway",size:{width:80,height:80},attrs:{".body":{points:"40,0 80,40 40,80 0,40",fill:"#ffffff",stroke:"#000000"},".label":{text:"",ref:".body","ref-x":.5,"ref-dy":20,"y-alignment":"middle","x-alignment":"middle","font-size":14,"font-family":"Arial, helvetica, sans-serif",fill:"#000000"},image:{width:40,height:40,"xlink:href":"",transform:"translate(20,20)"}}},At.prototype.defaults)}).extend(ma),g2=At.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="body outer"/><circle class="body inner"/><image/></g><text class="label"/></g>',defaults:Ue({type:"bpmn.Event",size:{width:60,height:60},attrs:{".body":{fill:"#ffffff",stroke:"#000000"},".outer":{"stroke-width":1,r:30,transform:"translate(30,30)"},".inner":{"stroke-width":1,r:26,transform:"translate(30,30)"},image:{width:40,height:40,"xlink:href":"",transform:"translate(10,10)"},".label":{text:"",fill:"#000000","font-family":"Arial","font-size":14,ref:".outer","ref-x":.5,"ref-dy":20,"x-alignment":"middle","y-alignment":"middle"}},eventType:"start"},At.prototype.defaults),initialize:function(){At.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:eventType",this.onEventTypeChange),this.onEventTypeChange(this,this.get("eventType"))},onEventTypeChange:function(t,e){switch(e){case"start":t.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1}});break;case"end":t.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5}});break;case"intermediate":t.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1}});break;default:throw"BPMN: Unknown Event Type: "+e}}}).extend(ma),v2=At.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>','<svg overflow="hidden" class="blackbox-wrap"><text class="blackbox-label"/></svg>','<rect class="header"/><text class="label"/>','<g class="lanes"/>',"</g>"].join(""),laneMarkup:'<g class="lane"><rect class="lane-body"/><rect class="lane-header"/><text class="lane-label"/></g>',defaults:Ue({type:"bpmn.Pool",size:{width:600,height:300},attrs:{".body":{fill:"#ffffff",stroke:"#000000",width:500,height:200,"pointer-events":"stroke"},".header":{fill:"#ffffff",stroke:"#000000",width:20,ref:".body","ref-height":1,"pointer-events":"visiblePainted"},".label":{fill:"#000000",transform:"rotate(-90)",ref:".header","ref-x":10,"ref-y":.5,"font-family":"Arial","font-size":14,"x-alignment":"middle","text-anchor":"middle"},".lane-body":{fill:"#ffffff",stroke:"#000000","pointer-events":"stroke"},".lane-header":{fill:"#ffffff",stroke:"#000000","pointer-events":"visiblePainted"},".lane-label":{fill:"#000000",transform:"rotate(-90)","text-anchor":"middle","font-family":"Arial","font-size":13},".blackbox-wrap":{ref:".body","ref-width":1,"ref-height":1},".blackbox-label":{text:"Black Box","text-anchor":"middle",transform:"translate(0,-7)"},".blackbox-label > tspan":{dx:"50%",dy:"50%"}}},At.prototype.defaults)}),p2=kt.extend({options:{headerWidth:20},presentationAttributes:kt.addPresentationAttributes({lanes:["LANES"]}),confirmUpdate:function(){var t=kt.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"LANES")&&(this.renderLanes(this.model.get("lanes")),t=this.removeFlag(t,["LANES"])),t},update:function(){return this.lanesAttrs===void 0?this.renderLanes(this.model.get("lanes")):kt.prototype.update.call(this,this.model,ie({},this.model.get("attrs"),this.lanesAttrs||{}))},renderMarkup:function(){kt.prototype.renderMarkup.apply(this,arguments),this.$lanes=this.$(".lanes"),this.laneMarkup=F(this.model.laneMarkup)},renderLanes:function(t){t=t||{},this.index=0;var e=t.headerWidth===void 0?this.options.headerWidth:t.headerWidth;this.lanesAttrs={".header":{width:e},".label":{text:t.label||""}},this.$lanes.empty(),t.sublanes&&this.renderSublanes(t.sublanes,e,0,1,"lanes"),this.update(this.model,ie({},this.model.get("attrs"),this.lanesAttrs))},calculateRatios:function(t,e){for(var r=0,i=[],n=[],a=0,o=t.length;a<o;a++){var s=t[a],l=s.ratio;Number.isFinite(l)?(r+=l/10,n[a]=l/10/e):i.push(a)}for(var u=Math.max(1-r,0)*e/i.length,g=0,h=i.length;g<h;g++)n[i[g]]=u;return n},renderSublanes:function(t,e,r,i,n){var a=this.options.headerWidth,o=n+"/sublanes/",s=this.calculateRatios(t,i);lt(t).reduce(function(l,u,g){var h="lane"+this.index,y="."+h+" .lane-body",x="."+h+" .lane-header",C="."+h+" .lane-label";u.name&&(h+=" "+u.name);var p=o+g,E=this.laneMarkup.clone().addClass(h).attr({"data-lane-path":p,"data-lane-index":this.index});this.$lanes.append(E.node);var k=s[g],w=u.headerWidth===void 0?a:u.headerWidth,S=r+l;return this.lanesAttrs[y]={ref:".body","ref-height":k,"ref-width":-e,"ref-x":e,"ref-y":S},this.lanesAttrs[x]={width:w,ref:".body","ref-height":k,"ref-x":e,"ref-y":S},this.lanesAttrs[C]={text:u.label,ref:x,"ref-x":10,"ref-y":.5,"x-alignment":"middle"},this.index++,u.sublanes&&this.renderSublanes(u.sublanes,e+w,S,k,p),l+k}.bind(this),0)}}),m2=At.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><rect class="label-rect"/><g class="label-group"><svg overflow="hidden" class="label-wrap"><text class="label"/></svg></g></g>',defaults:Ue({type:"bpmn.Group",size:{width:200,height:200},attrs:{".body":{width:200,height:200,stroke:"#000000","stroke-dasharray":"6,6","stroke-width":2,fill:"transparent",rx:15,ry:15,"pointer-events":"stroke"},".label-rect":{ref:".body","ref-width":.6,"ref-x":.4,"ref-y":-30,height:25,fill:"#ffffff",stroke:"#000000"},".label-group":{ref:".label-rect","ref-x":0,"ref-y":0},".label-wrap":{ref:".label-rect","ref-width":1,"ref-height":1},".label":{text:"",x:"50%",y:"1.3em","text-anchor":"middle","font-family":"Arial","font-size":14,fill:"#000000"}}},At.prototype.defaults)}),y2=At.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:Ue({type:"bpmn.DataObject",size:{width:60,height:80},attrs:{".body":{points:"20,0 60,0 60,80 0,80 0,20 20,0 20,20 0,20",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"}}},At.prototype.defaults)}),b2=At.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/><path class="sub-process"/></g>',defaults:Ue({type:"bpmn.Conversation",size:{width:100,height:100},attrs:{".body":{points:"25,0 75,0 100,50 75,100 25,100 0,50",stroke:"#000000",fill:"#ffffff"},".label":{text:"",ref:".body","ref-x":.5,"ref-dy":5,"text-anchor":"middle"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",fill:"#ffffff",stroke:"#000000","fill-opacity":0}},conversationType:"conversation"},At.prototype.defaults),initialize:function(){At.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:conversationType",this.onConversationTypeChange),this.onConversationTypeChange(this,this.get("conversationType"))},onConversationTypeChange:function(t,e){switch(e){case"conversation":t.attr("polygon/stroke-width",1);break;case"call-conversation":t.attr("polygon/stroke-width",4);break;default:throw"BPMN: Unknown Conversation Type: "+e}}}).extend(ya),w2=Dr.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',cr.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<text class="label"/><path class="sub-process"/><g class="participants"/>',"</g>"].join(""),participantMarkup:'<g class="participant"><rect class="participant-rect"/><text class="participant-label"/></g>',defaults:Ue({type:"bpmn.Choreography",size:{width:60,height:80},attrs:{rect:{},".body":{width:60,height:80,stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"},".participant-rect":{stroke:"#000000",fill:"#aaaaaa",ref:".body","ref-width":1},".participant-label":{"text-anchor":"middle",ref:".participant_0 .participant-rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle"},".sub-process":{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",fill:"transparent",stroke:"#000000"}},participants:[],initiatingParticipant:0},Dr.prototype.defaults)}).extend(ya),x2=Jr.extend({options:{participantHeight:20},presentationAttributes:Jr.addPresentationAttributes({participants:"PARTICIPANTS",initiatingParticipant:"INIT_PARTICIPANT"}),initFlag:["PARTICIPANTS"].concat(Jr.prototype.initFlag),confirmUpdate:function(){var t=Jr.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"PARTICIPANTS")?(this.renderParticipants(this.model.get("participants")),t=this.removeFlag(t,["PARTICIPANTS","INIT_PARTICIPANT"]),t):(this.hasFlag(t,"INIT_PARTICIPANT")&&(this.layoutAndUpdate(),t=this.removeFlag(t,"INIT_PARTICIPANT")),t)},update:function(){return this.participantsAttrs===void 0?this.renderParticipants(this.model.get("participants")):(this.layoutAndUpdate(),this)},render:function(){this.participantsAttrs=void 0,kt.prototype.render.apply(this,arguments)},renderMarkup:function(){kt.prototype.renderMarkup.apply(this,arguments),this.$participants=this.$(".participants"),this.participantMarkup=F(this.model.participantMarkup)},renderParticipants:function(t){var e=this,r=this,i=r.$participants,n=F(i[0]).children();i.empty(),this.participantsAttrs={},lt(t).forEach(function(a,o){var s="participant_"+o,l="."+s;e.participantsAttrs[l+" .participant-rect"]={height:e.options.participantHeight},e.participantsAttrs[l+" .participant-label"]={text:a};var u=o<n.length?n[o]:e.participantMarkup.clone();e.$participants.append(u.addClass(s).node)}),this.layoutAndUpdate()},layoutAndUpdate:function(){var t=this.model.get("participants")||[],e=t.length,r=this.options.participantHeight,i=this.model.get("size").height,n=Math.max(0,i-r*e),a=0,o=this.model.get("initiatingParticipant"),s=Math.max(Nt(o)?Math.abs(o):t.indexOf(o),0),l=Math.min(s,e-2);lt(t).forEach(function(y,x){var C=".participant_"+x;this.participantsAttrs[C]={transform:"translate(0,"+a+")"},this.participantsAttrs[C+" .participant-rect"].fill=s==x?this.model.attr(".body/fill"):this.model.attr(".participant-rect/fill"),this.participantsAttrs[C+" .participant-rect"].stroke=s==x?this.model.attr(".body/stroke"):this.model.attr(".participant-rect/stroke"),a+=r+(l==x?n:0)},this);var u=e<2?0:l-e+1;this.participantsAttrs[".sub-process"]={"ref-dy":Math.max(-i,u*r-30)};var g=e<2?0:l+1;this.participantsAttrs[".fobj div"]={style:{height:n,paddingTop:r*g}},this.participantsAttrs[".content"]={"ref-y":r*g+n/2};var h=ie({},this.model.get("attrs"),this.participantsAttrs||{});nn(h,"div/html"),Jr.prototype.update.call(this,this.model,h)}}),A2=At.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:Ue({type:"bpmn.Message",size:{width:60,height:40},attrs:{".body":{points:"0,0 60,0 60,40 0,40 0,0 60,0 30,20 0,0",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"}}},At.prototype.defaults)}),C2=le.extend({defaults:{type:"bpmn.Flow",attrs:{".marker-source":{d:"M 0 0"},".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#000000"},".connection":{"stroke-dasharray":" ","stroke-width":1},".connection-wrap":{style:"",onMouseOver:"",onMouseOut:""}},flowType:"normal"},initialize:function(){le.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:flowType",this.onFlowTypeChange),this.onFlowTypeChange(this,this.get("flowType"))},onFlowTypeChange:function(t,e){var r;switch(e){case"default":r={".marker-source":{d:"M 0 5 L 20 5 M 20 0 L 10 10",fill:"none"}};break;case"conditional":r={".marker-source":{d:"M 20 8 L 10 0 L 0 8 L 10 16 z",fill:"#FFF"}};break;case"normal":r={};break;case"message":r={".marker-target":{fill:"#FFF"},".connection":{"stroke-dasharray":"4,4"}};break;case"association":r={".marker-target":{d:"M 0 0"},".connection":{"stroke-dasharray":"4,4"}};break;case"conversation":r={".marker-target":{d:"M 0 0"},".connection":{"stroke-width":"7px"},".connection-wrap":{style:"stroke: #fff; stroke-width: 5px; opacity: 1;",onMouseOver:"var s=this.style;s.stroke='#000';s.strokeWidth=15;s.opacity=.4",onMouseOut:"var s=this.style;s.stroke='#fff';s.strokeWidth=5;s.opacity=1"}};break;default:throw"BPMN: Unknown Flow Type: "+e}r.root={dataFlowType:e},t.attr(ie({},this.defaults.attrs,r))}}),I2={__proto__:null,icons:hs,IconInterface:ma,SubProcessInterface:ya,ActivityView:u2,Activity:h2,AnnotationView:c2,Annotation:d2,Gateway:f2,Event:g2,Pool:v2,PoolView:p2,Group:m2,DataObject:y2,Conversation:b2,Choreography:w2,ChoreographyView:x2,Message:A2,Flow:C2},qg=le,Jg=ci,S2=new Z(1,0),M2=qg.define("measurement.Distance",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path","stroke-width":2,d:"M 0 10 0 -10 M 10 10 0 0 10 -10",fill:"none"},sourceMarker:{type:"path","stroke-width":2,d:"M 0 10 0 -10 M 10 10 0 0 10 -10",fill:"none"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"},anchorLines:{stroke:"#333333",strokeWidth:1,strokeDasharray:"1,2"},sourceAnchorLine:{dAnchor:"source"},targetAnchorLine:{dAnchor:"target"},distanceLabel:{distanceText:{unit:"px",fixed:0},fontFamily:"sans-serif",fontWeight:"lighter",fontSize:14,labelPosition:{ratio:.5,offset:12},textAnchor:"middle",textVerticalAnchor:"middle"}}},{markup:[{tagName:"path",selector:"sourceAnchorLine",groupSelector:"anchorLines"},{tagName:"path",selector:"targetAnchorLine",groupSelector:"anchorLines"},{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}},{tagName:"text",selector:"distanceLabel"}],getDistanceText:function(t,e){e===void 0&&(e={});var r=e.fixed;r===void 0&&(r=0);var i=e.unit;i===void 0&&(i="");var n=t.getConnectionLength().toFixed(r);return i?n+" "+i:""+n}},{attributes:{distanceText:{set:function(t){for(var e,r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];(e=Jg.text.set).call.apply(e,[this,this.model.getDistanceText(this,t)].concat(r))}},dAnchor:{set:function(t){var e=new dt(this.getEndAnchor(t),this.getEndConnectionPoint(t));return{d:"M "+e.serialize()}}},labelPosition:{set:function(t){var e=t.ratio;e===void 0&&(e=.5);var r=t.offset;r===void 0&&(r=0);var i,n,a=this.getTangentAtRatio(e);a?(n=a.vector().vectorAngle(S2),i=a.start):(i=this.path.start,n=0);var o,s=r;if(n===0)o="translate("+i.x+","+i.y+")";else{var l=et((n+90)%180-90);n!==l&&(s=-r),o="translate("+i.x+","+i.y+") rotate("+l+")"}return{transform:o,y:s}}}}}),Bi={self:"self",source:"source",target:"target"},se={clockwise:"clockwise",anticlockwise:"anticlockwise",small:"small",large:"large"},k2=qg.define("measurement.Angle",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round"},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"},angles:{stroke:"#333333",fill:"none",strokeWidth:1,angleRadius:40},sourceAngle:{angleD:"source"},targetAngle:{angleD:"target"},angleLabels:{textAnchor:"middle",textVerticalAnchor:"middle",fill:"#333333",fontSize:11,fontFamily:"sans-serif",angleTextDecimalPoints:0,angleTextDistance:23},sourceAngleLabel:{angleText:"source",angleTextPosition:"source"},targetAngleLabel:{angleText:"target",angleTextPosition:"target"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"sourceAngle",groupSelector:"angles",attributes:{cursor:"pointer"}},{tagName:"path",selector:"targetAngle",groupSelector:"angles",attributes:{cursor:"pointer"}},{tagName:"text",selector:"sourceAngleLabel",groupSelector:"angleLabels"},{tagName:"text",selector:"targetAngleLabel",groupSelector:"angleLabels"}],getAngleText:function(t){t===void 0&&(t={});var e=t.angle;e===void 0&&(e=0);var r=t.decimalPoints;return r===void 0&&(r=2),e.toFixed(r)+"\xB0"}},{AngleStarts:Bi,AngleDirections:se,attributes:{angleD:{set:function(t,e,r,i){var n=i.angleRadius;n===void 0&&(n=40);var a=i.angleStart;a===void 0&&(a=Bi.self);var o=i.anglePie;o===void 0&&(o=!1);var s=i.angleDirection;s===void 0&&(s=se.small);var l=i.angle,u=cs(this,t,{angle:l,angleRadius:n,angleStart:a,angleDirection:s});if(!u)return{d:"M 0 0 0 0"};var g=u.connectionPoint,h=u.linkArcPoint,y=u.otherArcPoint,x=u.arcAngle,C=u.largeArcFlag,p=u.sweepFlag,E=["M "+h.serialize(),"A "+n+" "+n+" "+x+" "+C+" "+p+" "+y.serialize()];return o&&E.push("L "+g.serialize()+" Z"),{d:E.join(" ")}}},angleText:{set:function(t,e,r,i){var n="",a=cs(this,t,{angleRadius:40});a&&(n=this.model.getAngleText({angle:a.angleBetween,decimalPoints:i.angleTextDecimalPoints})),Jg.text.set.call(this,n,e,r,i)}},angleTextPosition:{set:function(t,e,r,i){var n=i.angleTextDistance;n===void 0&&(n=60);var a=cs(this,t,{angleRadius:n});if(!a)return{};var o=a.connectionPoint,s=a.otherArcPoint,l=a.linkArcPoint,u=a.angleBetween,g=a.largeArcFlag,h;if(Math.abs(u-180)<1e-6){var y=l.clone().rotate(o,g?90:-90);h=new dt(o,y).setLength(n)}else{var x=new dt(l,s).midpoint();h=new dt(o,x).setLength(n),g&&h.scale(-1,-1,h.start)}var C=h.end,p=et((h.angle()+90)%180-90);return{transform:"translate("+C.serialize()+") rotate("+p+")"}}},angle:{},angleRadius:{},angleTextDistance:{},angleTextDecimalPoints:{},anglePie:{},angleStart:{},angleDirection:{}}});function cs(t,e,r){var i,n="angleData",a=t.nodeCache(t.el);if(n in a){if(e in a[n])return a[n][e]}else a[n]={};var o=typeof r.angle=="number",s=t.getEndView(e);if(!s&&!o)return null;var l=e==="target",u=t.getTangentAtRatio(l?1:0);if(!u)return null;if(l&&u.scale(-1,-1,u.start),o)i=P2(u,r);else if(s.model.isLink())i=T2(u,s,r);else{var g=t.getEndMagnet(e);i=N2(u,s,g,r)}return a.angleData[e]=i,i}function P2(t,e){var r=e.angle,i=e.angleRadius,n=t.clone().rotate(t.start,-r);return Kg(t,n,{angleRadius:i,angleStart:Bi.target,angleDirection:r<0?se.clockwise:se.anticlockwise})}function T2(t,e,r){var i=e.getClosestPointLength(t.start),n=e.getTangentAtLength(i);return Kg(t,n,r)}function Kg(t,e,r){var i=r.angleRadius,n=r.angleStart,a=r.angleDirection,o=t.setLength(i),s=o.start,l=o.end,u=t.angle(),g=e.setLength(i),h=g.end,y=s.angleBetween(l,h),x=1,C=0,p=!1,E=!1,k=!0,w=Math.floor(y/90);switch(n){case Bi.target:{switch(a===se.small?a=y<180?se.clockwise:se.anticlockwise:a===se.large&&(a=y>180?se.clockwise:se.anticlockwise),a){case se.anticlockwise:{y>0&&y<180&&(C^=1),E=!0;break}default:case se.clockwise:{y>=180&&(C^=1),x^=1;break}}k=!1;break}case Bi.source:{switch(a===se.small?a=y>180?se.clockwise:se.anticlockwise:a===se.large&&(a=y<180?se.clockwise:se.anticlockwise),a){case se.anticlockwise:{y>180&&(C^=1),x=1,E=!0;break}default:case se.clockwise:{y<180&&(C^=1),x=0;break}}k=!1,p=!0,y=et(y+180);break}default:case Bi.self:{switch(a){case se.anticlockwise:{p=w===0||w===1,x=1,E=!0;break}case se.clockwise:{p=w===2||w===3,x=0,E=!1;break}case se.small:{p=w===1||w===2,x=w===0||w===2?0:1,E=w===1||w===3;break}case se.large:{p=w===0||w===3,x=w===1||w===3?0:1,E=w===0||w===2;break}}break}}return p&&(h=h.reflection(s)),k&&y>=180&&(y=et(y-180)),E&&(y=et((k?180:360)-y)),{angleBetween:y,connectionPoint:s,linkArcPoint:l,otherArcPoint:h,largeArcFlag:C,sweepFlag:x,arcAngle:u}}function N2(t,e,r,i){var n=i.angleRadius,a=i.angleDirection,o=e.model,s=o.getBBox(),l=o.angle(),u=s.center(),g=e.getNodeUnrotatedBBox(r),h=t.clone().setLength(1),y=h.end,x=y.rotate(u,l);if(g.containsPoint(x))return null;var C=0,p=0,E=t.angle()-l;x.y>g.y+g.height||x.y<g.y?(E+=90,C=n):p=n,E=et(E);var k,w=Math.floor(E/90);switch(w){case 0:{k=1;break}case 1:{k=0;break}case 2:{C*=-1,p*=-1,k=1;break}case 3:{C*=-1,p*=-1,k=0;break}}var S=!1;switch(a){case se.large:S=!0;break;case se.anticlockwise:S=w===0||w===2;break;case se.clockwise:S=w===1||w===3;break}S&&(C*=-1,p*=-1,k^=1);var T=0,m=t.setLength(n),A=m.start,M=m.end,N=A.clone().offset(C,p).rotate(A,-l),D=A.angleBetween(M,N);return D>180&&(D=360-D),{arcAngle:E,angleBetween:D,sweepFlag:k,largeArcFlag:T,otherArcPoint:N,linkArcPoint:M,connectionPoint:A}}var L2={__proto__:null,Distance:M2,Angle:k2},Ot='xmlns="http://www.w3.org/2000/svg"';function E2(t){t===void 0&&(t={});var e=t.color;e===void 0&&(e="#000");var r=t.svg;r===void 0&&(r=!1);var i={exclusive_blank:null,exclusive:"<svg "+Ot+' viewBox="12 12 26 26"><path fill="'+e+'" stroke="'+e+'" d="M18.25 17.063L23.5 25.5l-5.25 8.438h4l3.25-5.25 3.25 5.25h3.906L27.438 25.5l5.218-8.438H28.75l-3.25 5.25-3.25-5.25h-4z"/></svg>',inclusive:"<svg "+Ot+' viewBox="12 12 26 26"><circle cx="25" cy="25" r="9.429" fill="none" stroke="'+e+'" stroke-width="3"/></svg>',parallel:"<svg "+Ot+' viewBox="12 12 26 26"><path fill="'+e+'" stroke="'+e+'" stroke-width="1.4" d="M16.388 21.821v5.625h5.86v6.328h5.624v-6.328H34.2v-5.625h-6.328v-5.86h-5.625v5.86z"/></svg>',event:"<svg "+Ot+' viewBox="12 12 26 26"><circle stroke-width="1.4" cx="25" cy="25" r="12.121" fill="none" stroke="'+e+'"/><circle stroke-width="1.4" cx="25" cy="25" r="10.121" fill="none" stroke="'+e+'"/><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="M29.828 31.845h-9.069l-2.801-8.625 7.337-5.33 7.335 5.33-2.802 8.625z"/></svg>',exclusive_event:"<svg "+Ot+' viewBox="12 12 26 26"><circle stroke-width="1.4" cx="25" cy="25" r="12.121" fill="none" stroke="'+e+'"/><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="M29.828 31.845h-9.069l-2.801-8.625 7.337-5.33 7.335 5.33-2.802 8.625z"/></svg>',parallel_event:"<svg "+Ot+' viewBox="12 12 26 26"><circle stroke-width="1.4" cx="25" cy="25" r="12.121" fill="none" stroke="'+e+'"/><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="M16.388 21.821v5.625h5.86v6.328h5.624v-6.328H34.2v-5.625h-6.328v-5.86h-5.625v5.86z"/></svg>',complex:"<svg "+Ot+' viewBox="13 13 25 25"><path fill="none" stroke="'+e+'" stroke-width="4" d="M16.25 25.5h19m-9.75-9.25v19m-6.644-2.96L32.29 18.857m-13.435.353L32.29 32.644"/></svg>'};if(r)return i;var n={};return Object.keys(i).forEach(function(a){n[a]="data:image/svg+xml,"+encodeURIComponent(i[a])}),n}function D2(t){t===void 0&&(t={});var e=t.color;e===void 0&&(e="#000");var r=t.svg;r===void 0&&(r=!1);var i={none:null,parallel:"<svg "+Ot+' viewBox="-3 -3 16 16"><path fill="none" stroke="'+e+'" stroke-width="2" d="M0 0v10M3 0v10M6 0v10"/></svg>',sequential:"<svg "+Ot+' viewBox="-3 -3 16 16"><path fill="none" stroke="'+e+'" stroke-width="2" d="M0 2h10M0  5h10M0 8h10"/></svg>',"sub-process":"<svg "+Ot+' viewBox="-2 -2 14 14"><path fill="none" stroke="'+e+'" stroke-width="1" d="M0 0h10v10H0zm5 2v6M2 5h6"/></svg>',compensation:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 13.438v13.124L12.437 20 19 13.437m6.563 0v13.126L19 20l6.563-6.563z"/></svg>',"ad-hoc":"<svg "+Ot+' viewBox="0 0 2000 2000"><path fill="'+e+'" d="M300 1039.87c58.332-138.228 134.894-282.23 266.546-360.085c97.784-58.392 218.701-22.42 308.428 34.819c138.188 85.207 246.292 211.842 382.606 299.507c82.335 48.265 184.733 8.718 244.748-58.056c72.401-84.446 155.215-164.023 197.672-269.981v330.038c-61.331 121.67-140.231 248.152-266.392 307.169c-103.228 44.44-223.148 17.789-312.524-46.586c-131.02-87.979-227.486-223.69-369.854-294.78c-69.172-36.004-157.377-27.545-215.331 26.623C431.412 1101.042 371.534 1231.858 300 1350v-310.13z"/></svg>',loop:"<svg "+Ot+' viewBox="0 0 2000 2000"><path fill="'+e+'" d="M1057.07 410.836C805.11 407.3 563.447 583.065 491.134 824.983c-55.584 173.977-23.105 373.061 85.522 520.027l-269.086-52.09l-22.804 117.814l483.865 93.664l93.687-479.986l-117.779-22.988l-56.861 291.316c-138.733-165.6-136.73-427.773 4.367-591.379c137.417-171.716 399.203-221.007 590.733-114c183.232 94.568 284.888 318.597 234.896 518.746c-44.77 208.91-247.404 367.34-460.604 363.053c-55.485-3.935-83.374 76.196-37.436 107.561c40.104 24.986 90.846 7.364 134.808 4.475c248.181-37.748 457.52-249.452 489.52-498.91c36.994-238.025-91.384-488.935-304.803-600.241c-86.168-46.769-184.068-71.364-282.089-71.21z"/></svg>'};if(r)return i;var n={};return Object.keys(i).forEach(function(a){n[a]="data:image/svg+xml,"+encodeURIComponent(i[a])}),n}function z2(t){t===void 0&&(t={});var e=t.color;e===void 0&&(e="#000");var r=t.svg;r===void 0&&(r=!1);var i={none:null,"business-rule":"<svg "+Ot+' viewBox="5 5 25 20"><path fill="'+e+'" stroke="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="m 8,8 0,4 20,0 0,-4 z"/><path stroke="'+e+'" fill="none" d=" m 8,8 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"/></svg>',manual:"<svg "+Ot+' viewBox="0 0 2000 2000"><path d="M919.379 382.988c-22.3.007-42.953 8.258-60.567 19.616l-.029.017-.027.02c-94.694 61.32-418.867 286.29-490.127 335.2l-.002.003h-.002c-64.371 44.196-107.733 110.904-132.662 189.935l-.004.016-.004.014c-25.952 82.515-22.622 172.403-22.371 247.685l.002.02v.02c.255 56.685 1.606 106.154 16.309 166.148l.003.015c21.373 87.802 62.768 151.336 121.23 190.285 58.46 38.948 130.615 52.768 211.575 53.018 292.284 1.097 584.741 1.49 877.182 0h.05c32.21-.211 62.96-13.752 82.135-37.678 19.174-23.923 27.017-54.865 27.43-88.81.29-22.768-2.91-44.287-10.307-63.512h32.375c31.532 0 60.434-8.984 81.153-27.916 20.711-18.926 31.304-44.62 36.808-71.68v-.007c7.683-37.64 4.055-74.807-10.916-105.997 32.946-2.661 62.034-15.102 80.74-37.906 21.024-25.627 27.148-58.205 27.256-92.72.115-36.034-8.629-70.421-28.812-97.766s-53.772-45.956-91.567-46.01H1666.21c-13.76-.011-26.16.008-41.781 0 7.516-18.744 10.82-39.826 10.752-62.006v-.113c-.228-35.772-9.251-69.954-29.535-97.127-20.284-27.173-53.809-45.753-91.586-45.754-224.42-.885-446.252 2.157-634.903 1.203 9.83-9.885 19.378-19.525 29.871-29.96 32.482-32.304 63.7-62.743 79.827-83.612 38.555-49.623 44.307-116.852 11.85-166.305-17.114-26.143-42.208-43.832-69.151-47.513a89.543 89.543 0 00-10.012-.8v.003a90.145 90.145 0 00-2.162-.026zm.547 70.028a17.31 17.31 0 012.148.152c5.305.725 10.986 2.62 20.07 16.506l.018.025.016.026c12.691 19.326 12.131 58.305-8.623 84.992l-.035.045-.036.045c-7.546 9.77-41.454 44.616-73.818 76.802-32.364 32.187-63.134 61.896-78.357 80.442-14.557 17.734-9.216 32.647-5.268 41.982 3.948 9.335 8.465 20.237 28.598 25.02 6.028 1.432 6.36 1.02 8.289 1.152 1.929.133 3.923.224 6.267.309 4.689.169 10.688.297 18.094.406 226.465 1.38 450.423-1.24 676.709-.92h.063c17.211 0 26.557 5.657 35.492 17.627 8.929 11.962 15.468 31.813 15.629 55.652.066 24.73-5.857 39.82-13.057 48.133-7.2 8.313-16.845 13.52-37.475 13.588H1030v70h484.791c66.478.006 101.54-.042 151.363 0 17.308.03 26.53 5.662 35.324 17.578 8.8 11.922 15.21 31.827 15.133 55.975v.002c-.08 25.822-5.346 41.196-11.375 48.545-6.029 7.349-14.638 12.732-39.482 12.902-8.43.058-68.808.014-93.863.043-.397-.005-.786-.042-1.184-.043-180.227-.85-360.455-.002-540.682-.002H1030l-.025 70h.025c.043 0 382.517.239 541.33.047 19.7.279 31.511 8.21 40.934 23.601 9.563 15.621 14.323 40.11 8.68 67.756v.028c-3.737 18.38-9.413 28.473-15.436 33.976-6.023 5.504-14.335 9.592-33.934 9.592-180.523-.086-361.044-.452-541.568 0h-.092l.092 70h409.414c14.707.096 21.247 4.008 27.96 12.977 6.715 8.968 12.44 25.642 12.132 49.652v.025c-.284 23.412-5.952 38.272-12.057 45.889-6.105 7.617-12.405 11.357-27.973 11.459-292.123 1.488-584.356 1.097-876.51 0h-.025c-73.053-.223-130.456-12.932-173-41.275-42.55-28.344-73.607-72.869-92.039-148.598l-.008-.03-.005-.029c-12.87-52.492-14.06-94.01-14.311-149.81v-.041c-.256-76.57-1.724-160.05 19.146-226.408 21.392-67.802 55.988-119.253 105.512-153.256l.004-.002c72.125-49.505 398.23-275.66 488.5-334.12l.004-.001c8.476-5.465 15.5-7.79 20.719-8.303.87-.086 1.689-.122 2.457-.113z" fill="'+e+'" /></svg>',receive:"<svg "+Ot+' viewBox="10 10 20 20"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M12.5 15.313v9.374h15v-9.375zm0 0l7.5 5.624 7.5-5.625"/></svg>',script:"<svg "+Ot+' viewBox="0 0 2000 2000"><path d="M759.41 378l-8.262 4.904-2.699 1.604C631.658 453.72 551.284 517.185 498.23 579.16c-53.13 62.06-78.817 124.548-79.547 184.787-1.454 119.88 86.972 209.719 165.425 290.067 78.394 80.286 148.323 156.002 154.905 218.664 3.354 31.938-4.195 64.019-39.02 107.943-34.678 43.74-97.616 96.128-198.24 154.785L353.193 1622h916.854l10.85-6.313.011-.01c106.636-62.16 178.477-119.59 224.254-177.33 45.914-57.91 64.594-118.499 58.62-175.378-11.838-112.702-103.646-194.827-180.829-273.873-77.243-79.108-139.852-153.721-139-224.024.43-35.49 14.072-75.084 57.219-125.484 43.073-50.314 115.696-109.181 227.031-175.158v-.002L1674.045 378H759.41zm25.842 92.918h564.643c-49.73 37.078-89.049 72.898-119.307 108.242-53.13 62.06-78.817 124.548-79.547 184.787-1.453 119.882 86.977 209.72 165.43 290.067 78.393 80.286 148.316 156 154.898 218.664 3.355 31.938-4.193 64.019-39.017 107.943-33.397 42.123-93.456 92.386-187.79 148.461h-566.09c39.27-30.627 70.469-60.635 94.33-90.732 45.914-57.911 64.594-118.5 58.62-175.38-11.838-112.701-103.645-194.826-180.828-273.872-77.243-79.108-139.85-153.721-138.998-224.024.43-35.49 14.07-75.084 57.216-125.484 41.627-48.624 111.275-105.346 216.44-168.672zM653.13 629.393v42.92h441.398v-42.92H653.131zm-16.402 231.175v42.918h456.384v-42.918H636.73zm206.794 231.17v42.918h441.989v-42.918H843.523zm63.198 231.174v42.918h457.986v-42.918H906.721z" fill="'+e+'"/></svg>',send:"<svg "+Ot+' viewBox="10 10 20 20"><path fill="'+e+'" d="M12.5 14.344l7.5 5.625 7.5-5.625zm0 .937v9.375h15v-9.375L20 20.906z"/></svg>',service:"<svg "+Ot+' viewBox="0 0 2000 2000"><path d="M825.746 438.174c-.046 36.998.01 73.998.106 110.996-31.554 8.927-60.387 21.384-87.616 36.644l-79.582-78.625-148.806 149.668 79.576 78.612a393.526 393.526 0 00-35.752 87.242l-112.725.205v210.79l113.903-.411c10.416 41.298 33.084 78.425 55.662 111.623V963.094l-99.565.357V892.79l99.069-.18 5.56-28.172c8.11-41.084 24.17-80.249 47.244-115.292l15.785-23.973-69.603-68.762 50.094-50.385 69.73 68.893 23.73-15.836c36.264-23.926 75.929-39.963 115.481-48.316l27.96-5.805-.25-96.785h71.966l-.557 96.281h188.834c-17.713-21.144-91.12-48.658-118.508-56.324l.635-109.957c-78.4-.002-139.865.004-212.37-.002zm199.158 201.658l.287 110.992c-31.554 8.927-60.387 21.383-87.617 36.645l-79.584-78.625-148.806 149.668 79.578 78.611a393.515 393.515 0 00-35.754 87.244l-112.723.203v210.79l113.9-.409c8.966 31.257 21.395 59.8 36.626 86.746l-81.495 81.176 150.465 147.879 81.201-80.824c27.815 15.444 57.38 27.436 88.034 35.781l.052 114.713c72.392.634 149.467.307 211.336.3v-116.07c31.578-8.904 60.501-21.45 87.737-36.705l81.134 79.996 148.905-149.48-81.305-80.123a394.444 394.444 0 0035.799-87.399l110.379-.681v-210.586l-111.618.68c-8.972-31.287-21.22-59.637-36.654-86.762l77.121-77.319-150.38-148.13-77.022 77.285a398.637 398.637 0 00-87.68-35.639l.633-109.957h-212.549zm70.18 70h71.967l-.555 96.283 28.426 5.578c41.272 8.1 80.83 24.14 116.015 47.073l23.825 15.529 67.216-67.445 50.618 49.86-67.31 67.483 16.194 23.907c23.765 35.872 39.529 74.65 48.428 114.58l5.856 28.011 97.28-.591v70.59l-96.737.595-5.557 28.012a324.606 324.606 0 01-47.299 115.398l-15.803 24.006 71.258 70.223-50.086 50.28-71.265-70.266-23.69 15.738c-36.275 23.706-75.624 40.123-115.324 48.21l-28.144 5.622v102.215c-19.241.046-40.231.016-71.37-.028l-.045-101.449-28.271-5.521c-41.33-8.071-80.823-24.038-115.947-47.067l-23.754-15.574-71.541 71.21-50.625-49.757 71.64-71.361-16.347-24.004c-23.787-35.794-39.523-74.612-48.438-114.496l-5.85-27.926-99.564.355v-70.66l99.069-.181 5.56-28.168c8.11-41.085 24.17-80.252 47.244-115.295l15.785-23.975-69.605-68.762 50.094-50.384 69.732 68.892 23.73-15.834c36.31-23.77 74.841-39.541 115.481-48.314l27.96-5.805-.251-96.787zm37.166 257.203c-86.647 0-157.639 70.994-157.639 157.64 0 86.648 70.992 157.638 157.639 157.638s157.639-70.99 157.639-157.637-70.992-157.64-157.639-157.64zm0 70c48.816 0 87.639 38.825 87.639 87.64 0 48.817-38.823 87.638-87.639 87.638-48.816 0-87.637-38.821-87.637-87.637s38.82-87.64 87.637-87.64z" fill="'+e+'"/></svg>',user:"<svg "+Ot+' viewBox="0 0 2000 2000"><path d="M991.75 365c-177.277 0-304.097 136.28-304.453 291.514v.088c.011 46.944 12.714 96.49 32.56 141.177 14.33 32.267 32.147 61.932 53.858 85.696-129.03 44.143-280.193 116.795-356.598 260.054L413 1151.25V1615h1157.5v-463.75l-4.117-7.72c-75.306-141.2-223.199-213.75-350.98-258.077 62.379-63.433 80.78-145.306 80.8-228.851v-.088C1295.847 501.28 1169.027 365 991.75 365zM870.709 530.299c8.194.02 17.191.294 27.11.879 79.022 4.657 105.618 18.882 126.062 32.373 20.443 13.49 34.855 26.333 88.883 27.908h.034c42.101-1.575 62.349-9.081 76.869-17.584 5.884-3.445 10.824-7.027 15.887-10.447 13.38 28.682 20.567 60.389 20.648 93.203-.028 93.44-16.092 158.876-101.768 212.424l8.381 63.17c17.833 5.415 36.266 11.357 54.975 17.873 2.613 10.9 5.632 25.196 7.662 40.394 2.127 15.923 2.964 32.489 1.652 44.928-1.311 12.439-5.173 19.154-5.851 19.832-43.547 43.547-120.847 68.943-199.252 68.943-78.406 0-155.705-25.396-199.252-68.943-.678-.678-4.54-7.393-5.852-19.832-1.311-12.439-.475-29.005 1.653-44.928 2.041-15.282 5.084-29.662 7.707-40.584 18.522-6.44 36.77-12.32 54.43-17.683l4.995-67.688c-4.068-5.217-8.213-8.673-13.16-12.385-19.121-14.345-42.31-45.903-58.69-82.785-16.373-36.868-26.517-79.01-26.532-112.744.101-40.444 10.985-79.211 30.976-112.697 3.577-1.332 7.349-2.739 11.588-4.133 14.908-4.903 35.337-9.583 70.846-9.494zM719.361 979.855c-.063.46-.133.907-.195 1.368-2.587 19.363-4.107 40.44-1.883 61.537 2.224 21.096 7.79 43.81 25.969 61.988 62.048 62.048 155.95 89.447 248.748 89.447 92.797 0 186.7-27.4 248.748-89.447 18.178-18.178 23.745-40.892 25.969-61.988 2.224-21.097.704-42.174-1.883-61.537-.051-.382-.11-.753-.162-1.133 94.334 41.369 185.515 100.615 235.828 189.074V1545H1333v-265h-70v265H719v-265h-70v265H483v-375.836c50.408-88.626 141.838-147.93 236.361-189.309z" fill="'+e+'" fill-rule="evenodd"/></svg>'};if(r)return i;var n={};return Object.keys(i).forEach(function(a){n[a]="data:image/svg+xml,"+encodeURIComponent(i[a])}),n}function B2(t){t===void 0&&(t={});var e=t.color;e===void 0&&(e="#000");var r=t.svg;r===void 0&&(r=!1);var i={none:null,message1:"<svg "+Ot+' viewBox="10 10 20 20"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2" d="M12.5 15.313v9.374h15v-9.375zm0 0l7.5 5.624 7.5-5.625"/></svg>',message2:"<svg "+Ot+' viewBox="10 10 20 20"><path fill="'+e+'" d="M12.5 14.344l7.5 5.625 7.5-5.625zm0 .937v9.375h15v-9.375L20 20.906z"/></svg>',timer1:"<svg "+Ot+' viewBox="8 8 24 24"><g fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><circle cx="20" cy="20" r="10"/><path d="M20 10v3m5-2l-1.5 3m5.5 1l-3 1.5m4 3.5h-3m2 5l-3-1.5M25 29l-1.5-3M20 30v-3m-5 2l1.5-3M11 25l3-1.5M10 20h3m-2-5l3 1.5m1-5.5l1.5 3m5.5-1l-2 7h4"/></g></svg>',conditional1:"<svg "+Ot+' viewBox="6 6 28 28"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.563 11.563h16.874v16.874H11.563V11.563m2.813 2.813h11.25m-11.25 3.75h11.25m-11.25 3.75h11.25m-11.25 3.75h11.25z"/></svg>',link1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.406 18.125h8.438v-2.813L27.53 20l-4.687 4.688v-2.813h-9.375v-3.75"/></svg>',link2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.406 18.125h8.438v-2.813L27.53 20l-4.687 4.688v-2.813h-9.375v-3.75"/></svg>',signal1:"<svg "+Ot+'  viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.17 24.851h13.706l-6.853-11.879-6.854 11.88z"/></svg>',signal2:"<svg "+Ot+'  viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.17 24.851h13.706l-6.853-11.879-6.854 11.88z"/></svg>',error1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M26.4 15.455l-3.238 12.58L17.7 18.37 13.76 23.8l3.478-12.412 5.576 8.72 3.586-4.652z"/></svg>',error2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M26.4 15.455l-3.238 12.58L17.7 18.37 13.76 23.8l3.478-12.412 5.576 8.72 3.586-4.652z"/></svg>',escalation1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 13.219l5.625 14.062L20 20.953l-5.625 6.328z"/></svg>',escalation2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 13.219l5.625 14.062L20 20.953l-5.625 6.328z"/></svg>',termination1:"<svg "+Ot+' viewBox="8 8 24 24"><circle cx="20" cy="20" r="10.5" fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/></svg>',termination2:"<svg "+Ot+' viewBox="8 8 24 24"><circle cx="20" cy="20" r="10.5" fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"/></svg>',compensation1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 13.438v13.124L12.437 20 19 13.437m6.563 0v13.126L19 20l6.563-6.563z"/></svg>',compensation2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 13.438v13.124L12.437 20 19 13.437m6.563 0v13.126L19 20l6.563-6.563z"/></svg>',cancel1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.284 14.274l2.867-2.868 5.735 5.735 5.735-5.735 2.868 2.868-5.735 5.735 5.735 5.735-2.868 2.867-5.735-5.735-5.735 5.735-2.867-2.867 5.735-5.735-5.735-5.735z"/></svg>',cancel2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.284 14.274l2.867-2.868 5.735 5.735 5.735-5.735 2.868 2.868-5.735 5.735 5.735 5.735-2.868 2.867-5.735-5.735-5.735 5.735-2.867-2.867 5.735-5.735-5.735-5.735z"/></svg>',multiple1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M24.52 26.39h-9.443l-2.918-8.982 7.64-5.55 7.64 5.551-2.919 8.98z"/></svg>',multiple2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M24.52 26.39h-9.443l-2.918-8.982 7.64-5.55 7.64 5.551-2.919 8.98z"/></svg>',parallel1:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="none" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.344 17.203v5.625h5.86v6.328h5.624v-6.328h6.328v-5.625h-6.328v-5.86h-5.625v5.86z"/></svg>',parallel2:"<svg "+Ot+' viewBox="8 8 24 24"><path fill="'+e+'" stroke="'+e+'" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.344 17.203v5.625h5.86v6.328h5.624v-6.328h6.328v-5.625h-6.328v-5.86h-5.625v5.86z"/></svg>'};if(r)return i;var n={};return Object.keys(i).forEach(function(a){n[a]="data:image/svg+xml,"+encodeURIComponent(i[a])}),n}var ds=B2({color:"${color}",svg:!0}),O2=E2({color:"${color}",svg:!0}),Qg=D2({color:"${color}",svg:!0}),R2=z2({color:"${color}",svg:!0});function $g(t){return function(e,r,i,n){var a=3;switch(e){case"double":{var o=r.clone().inflate(-a),s=n.fill;return s===void 0&&(s="none"),{d:t(r,n,0)+" "+t(o,n,a),fill:s}}case"thick":{var l=r.clone().inflate(-a),u=n.stroke;return u===void 0&&(u="black"),{d:t(r,n,0)+" "+t(l,n,a),fill:u}}default:case"single":return{d:t(r,n,0),fill:"none"}}}}function tv(t,e,r,i){var n;switch(t){case"dashed":{var a=e.width,o=e.height,s=Math.floor(Math.min(a,o)/20);n=s*4+","+s;break}case"dotted":{var l=i.strokeWidth||i["stroke-width"];n=l+","+l*2;break}default:case"solid":{n="none";break}}return{"stroke-dasharray":n}}function ev(t,e,r){r===void 0&&(r={});var i,n=r[t];if(typeof n=="string"){var a=e.iconColor;a===void 0&&(a="black");var o=n.replace(/\${color}/g,a);i="data:image/svg+xml,"+encodeURIComponent(o)}else i=null;return{"xlink:href":i,"data-icon-type":t}}function yn(t){return function(r,i,n,a){return ev(r,a,this.model.constructor[t])}}var Oi={row:"row",column:"column"},Ri={topLeft:"left-top",bottomLeft:"left-bottom",topRight:"right-top",bottomRight:"right-bottom",topMiddle:"top",bottomMiddle:"bottom",rightMiddle:"right",leftMiddle:"left",center:"center"},rv=Object.keys(Ri).reduce(function(t,e){return t[Ri[e]]=e,t},{});function iv(t){return function(e,r,i,n){var a=this,o=f(i),s="joint-icons",l=o.data(s.toString()),u=n.iconColor;u===void 0&&(u="#333333");var g=n.iconSize;g===void 0&&(g=30);var h=n.iconsFlow;h===void 0&&(h=Oi.row);var y=e.toString()+" "+u+" "+g+" "+h;if(l!==y){var x=F(i);x.empty();var C=h===Oi.column;if(!Array.isArray(e))return;var p=e.map(function(E,k){var w=F("image");w.attr(ev(E,n,a.model.constructor[t]));var S,T;return C?(S=0,T=k*g):(S=k*g,T=0),w.attr({x:S,y:T,width:g,height:g}),w});x.append(p)}o.data(s,y)}}function nv(t,e,r,i){var n=i.iconSize;n===void 0&&(n=30);var a=i.iconsFlow;a===void 0&&(a=Oi.row);var o=i.iconsOrigin;o===void 0&&(o=Ri.topLeft);var s,l,u=Array.isArray(t)?t.length:0;a===Oi.column?(s=n,l=u*n):(s=u*n,l=n);var g=new at(0,0,-s,-l);return o in rv?g[rv[o]]():g.center()}function av(t,e,r,i,n,a,o){var s=be(i),l=he(i.labelMargin),u=l.left,g=l.right,h=l.top,y=l.bottom,x=_2[i.labelAlignment],C=new at(u,h,n-u-g,a-h-y);x&&(s.textAnchor=x["text-anchor"],s.textVerticalAnchor=x["text-vertical-anchor"]);var p,E;return e.textWrap?(p="textWrap",E={text:o,ellipsis:e.ellipsis}):(p="text",E=o),t.getAttributeDefinition(p).set.call(t,E,C,r,s),x}var Pe=be(Ri),_2={"left-top":{"text-anchor":"start","text-vertical-anchor":"top"},"left-bottom":{"text-anchor":"start","text-vertical-anchor":"bottom"},"right-top":{"text-anchor":"end","text-vertical-anchor":"top"},"right-bottom":{"text-anchor":"end","text-vertical-anchor":"bottom"},top:{"text-anchor":"middle","text-vertical-anchor":"top"},bottom:{"text-anchor":"middle","text-vertical-anchor":"bottom"},right:{"text-anchor":"end","text-vertical-anchor":"middle"},left:{"text-anchor":"start","text-vertical-anchor":"middle"},center:{"text-anchor":"middle","text-vertical-anchor":"middle"}},G2=At.define("bpmn2.Event",{size:{width:40,height:40},attrs:{root:{magnetSelector:"background",highlighterSelector:"background"},background:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%",fill:"#FFFFFF"},border:{stroke:"#333333",fillRule:"evenodd",borderType:"single",borderStyle:"solid",strokeWidth:2},icon:{iconColor:"#333333",iconType:"none",refX:"15%",refY:"15%",refWidth:"70%",refHeight:"70%"},label:{refDy:10,refX:"50%",textVerticalAnchor:"top",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"icon"},{tagName:"path",selector:"border"},{tagName:"text",selector:"label"}]},{attributes:{borderType:{set:$g(function(t){return j2(t)})},borderStyle:{set:tv},iconType:{set:yn("EVENT_ICONS")}},EVENT_ICONS:ds});function j2(t){var e=t.center(),r=F("ellipse",{cx:e.x,cy:e.y,rx:t.width/2,ry:t.height/2});return F.convertEllipseToPathData(r)}var F2=At.define("bpmn2.Gateway",{size:{width:58,height:58},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{refPoints:"1,0,2,1,1,2,0,1",fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},icon:{iconColor:"#333333",refX:"19%",refY:"19%",refWidth:"62%",refHeight:"62%"},label:{refDy:10,refX:"50%",textVerticalAnchor:"top",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"image",selector:"icon"},{tagName:"text",selector:"label"}]},{attributes:{iconType:{set:yn("GATEWAY_ICONS")}},GATEWAY_ICONS:O2}),ba=10,V2=At.define("bpmn2.DataStore",{size:{width:63,height:63},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{lateralArea:ba,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{refCx:"50%",cy:ba,refRx:"50%",ry:ba,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:ba,fontSize:12,fontFamily:"sans-serif",fontWeight:"bold",fill:"#333333",textWrap:{width:"200%"}}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(t===void 0)return this.attr("body/lateralArea");var r=pe(t),i={lateralArea:t},n={refY2:t},a=r?{refCy:t,refRy:t,cy:null,ry:null}:{refCy:null,refRy:null,cy:t,ry:t};return this.attr({body:i,top:a,label:n},e)}},{attributes:{lateralArea:{set:function(t,e){var r=pe(t);r&&(t=parseFloat(t)/100);var i=e.x,n=e.y,a=e.width,o=e.height,s=a/2,l=r?o*t:t,u=F.KAPPA,g=u*s,h=u*(r?o*t:t),y=i,x=i+a/2,C=i+a,p=n+l,E=p-l,k=n+o-l,w=n+o,S=["M",y,p,"L",y,k,"C",i,k+h,x-g,w,x,w,"C",x+g,w,C,k+h,C,k,"L",C,p,"C",C,p-h,x+g,E,x,E,"C",x-g,E,y,p-h,y,p,"Z"],T=7,m=p+T,A=p+l+T;return S.push("M",C,m,"C",C,m+h,x+g,A,x,A,"C",x-g,A,y,m+h,y,m),m+=T,A+=T,S.push("L",y,m,"C",y,m+h,x-g,A,x,A,"C",x+g,A,C,m+h,C,m,"Z"),{d:S.join(" ")}}}}}),W2=At.define("bpmn2.DataObject",{size:{width:48,height:65},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{objectD:10,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{refY:"100%",refY2:10,refX:"50%",textVerticalAnchor:"top",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold",textWrap:{width:"200%"}},dataTypeIcon:{iconColor:"#333333",iconType:"none",x:0,y:0,width:25,height:25},collectionIcon:{iconColor:"#333333",collection:!1,refX:"50%",refY:"100%",y:-16-2,x:-16/2+2,width:16,height:16}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"},{tagName:"image",selector:"dataTypeIcon"},{tagName:"image",selector:"collectionIcon"}]},{attributes:{objectD:{set:function(t,e){var r=t,i=e.topLeft(),n=e.bottomLeft(),a=e.bottomRight(),o=e.topRight(),s=o.clone().offset(-r,r),l=o.clone().offset(0,r),u=o.clone().offset(-r,0),g="M "+i.serialize()+" "+n.serialize()+" "+a.serialize()+" "+l.serialize()+" "+u.serialize()+" Z",h="M "+u.serialize()+" "+s.serialize()+" "+l.serialize();return{d:g+" "+h}}},iconType:{set:yn("DATA_OBJECT_TYPE_ICONS")},collection:{set:yn("DATA_OBJECT_COLLECTION_ICONS")}},DATA_OBJECT_TYPE_ICONS:{none:null,input:ds.link1,output:ds.link2},DATA_OBJECT_COLLECTION_ICONS:{false:null,true:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="-3 -3 16 16"><path fill="none" stroke="${color}" stroke-width="2" d="M0 0v10M3 0v10M6 0v10"/></svg>'}}),wa={markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{label:{fill:"#333333",fontSize:12,textAnchor:"middle",textVerticalAnchor:"middle",fontFamily:"sans-serif"},body:{ref:"label",fill:"#ffffff",stroke:"none",refX:0,refY:0,refWidth:"100%",refHeight:"100%"}},position:{distance:.5}},Z2=le.define("bpmn2.DataAssociation",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",strokeDasharray:"2,5",targetMarker:{type:"path",d:"M 10 -7 0 0 10 7","stroke-width":2,fill:"none"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{defaultLabel:wa,markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),Y2=At.define("bpmn2.Activity",{size:{width:120,height:100},attrs:{root:{magnetSelector:"background",highlighterSelector:"background"},background:{refWidth:"100%",refHeight:"100%",fill:"#FFFFFF",rx:10,ry:10},border:{stroke:"#333333",fillRule:"evenodd",borderType:"single",borderStyle:"solid",borderRadius:10,strokeWidth:2},icon:{iconColor:"#333333",iconType:"none",x:5,y:0,width:30,height:30},label:{refY:"50%",refX:"50%",textVerticalAnchor:"middle",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold",textWrap:{width:-10,height:-50,ellipsis:!0}},markers:{event:"element:marker:pointerdown",iconSize:16,iconColor:"#333333",iconTypes:[""],iconsOrigin:Ri.bottomMiddle,iconsFlow:Oi.row,refX:"50%",refY:"100%",refY2:-5}}},{markup:[{tagName:"rect",selector:"background"},{tagName:"image",selector:"icon"},{tagName:"path",selector:"border"},{tagName:"text",selector:"label"},{tagName:"g",selector:"markers"}]},{attributes:{borderType:{set:$g(function(t,e,r){var i=e.borderRadius;i===void 0&&(i=0);var n=Math.max(Math.min(i,2),i-r),a=t.toJSON();return a.rx=a.ry=n,F.rectToPath(a)})},borderStyle:{set:tv},iconType:{set:yn("ACTIVITY_TYPE_ICONS")},iconTypes:{set:iv("ACTIVITY_MARKER_ICONS"),position:nv},iconSize:{},iconsOrigin:{},iconsFlow:{},iconColor:{},borderRadius:{}},ACTIVITY_TYPE_ICONS:R2,ACTIVITY_MARKER_ICONS:Ce(Qg,"none")}),U2=At.define("bpmn2.Conversation",{size:{width:58,height:47},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{fill:"#FFFFFF",stroke:"#333333",refPoints:"1,0 3,0, 4,1 3,2 1,2 0,1, 1,0",strokeLinejoin:"round",strokeWidth:2},markers:{event:"element:marker:pointerdown",iconSize:16,iconColor:"#333333",iconTypes:[],iconsOrigin:Ri.bottomMiddle,iconsFlow:Oi.row,refX:"50%",refY:"100%"},label:{refDy:10,refX:"50%",textVerticalAnchor:"top",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"},{tagName:"g",selector:"markers"}]},{attributes:{iconTypes:{set:iv("CONVERSATION_MARKER_ICONS"),position:nv},iconSize:{},iconsOrigin:{},iconsFlow:{},iconColor:{}},CONVERSATION_MARKER_ICONS:Ce(Qg,"none")}),X2=le.define("bpmn2.ConversationLink",{attrs:{line:{connection:!0,stroke:"#FFFFFF",strokeWidth:2,strokeLinejoin:"round"},outline:{connection:!0,stroke:"#333333",strokeWidth:6,strokeLinejoin:"round"},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{defaultLabel:wa,markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"outline",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),H2=ci.sourceMarker.set,q2=ci.targetMarker.set,bn={sequence:"sequence",default:"default",conditional:"conditional",message:"message"},J2=le.define("bpmn2.Flow",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",flowType:"sequence"},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{defaultLabel:wa,markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]},{attributes:{flowType:{set:function(t,e,r,i){var n=i.markerFill;n===void 0&&(n="#FFFFFF");var a=i.strokeWidth;a===void 0&&(a=2);var o={"stroke-dasharray":"none","marker-start":null,"marker-end":null},s,l;switch(t){case bn.default:{s={d:"M 5 -5 15 5","stroke-width":a},l={type:"path",d:"M 12 -5 0 0 12 5 z"};break}case bn.conditional:{s={d:"M 0 0 9 -5 18 0 9 5 Z","stroke-width":a,fill:n},l={type:"path",d:"M 12 -5 0 0 12 5 z"};break}case bn.message:{o["stroke-dasharray"]="5,2",s={type:"circle",cx:5,r:5,"stroke-width":a,fill:n},l={type:"path",d:"M 12 -5 0 0 12 5 z","stroke-width":a,fill:n};break}case bn.sequence:default:{l={type:"path",d:"M 12 -5 0 0 12 5 z"};break}}return s&&tt(o,H2.call(this,s,e,r,i)),l&&tt(o,q2.call(this,l,e,r,i)),o}},markerFill:{}},FLOW_TYPES:bn}),K2=At.define("bpmn2.Group",{size:{width:120,height:100},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{refWidth:"100%",refHeight:"100%",fill:"transparent",rx:10,ry:10,stroke:"#333333",borderStyle:"dashed",strokeWidth:2,strokeLinecap:"square",pointerEvents:"none"},wrapper:{refX:5,refY:5,refWidth:-10,refHeight:-10,pointerEvents:"stroke",strokeWidth:10,stroke:"transparent",fill:"none"},label:{refY:6,refX:"50%",textAnchor:"middle",fontSize:12,fontFamily:"sans-serif",fontWeight:"bold",textWrap:{width:-12,height:-12,ellipsis:!0}}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"wrapper"},{tagName:"text",selector:"label"}]},{attributes:{borderStyle:{set:function(t,e,r,i){var n=2,a=i.strokeWidth||i["stroke-width"]||1,o=n*a+","+n*a+","+a/n;return{"stroke-dasharray":o}}}}}),Q2=At.define("bpmn2.Annotation",{size:{width:80,height:40},attrs:{root:{magnetSelector:"body",highlighterSelector:"body"},body:{refWidth:"100%",refHeight:"100%",fill:"transparent"},border:{annotationD:{size:10},fill:"none",stroke:"#333333",strokeWidth:2},label:{refY:6,refX:4,fontSize:12,fontFamily:"sans-serif",textWrap:{width:-12,height:-12,ellipsis:!0}}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"path",selector:"border"},{tagName:"text",selector:"label"}]},{attributes:{annotationD:{set:function(t,e){var r=t.size||0,i=t.side,n=e.topLeft(),a=e.bottomLeft(),o=e.topRight(),s=e.bottomRight();switch(i){case"top":{var l=n.clone().offset(0,r),u=o.clone().offset(0,r),g="M "+l.serialize()+" "+n.serialize()+" "+o.serialize()+" "+u.serialize();return{d:""+g}}case"right":{var h=o.clone().offset(-r,0),y=s.clone().offset(-r,0),x="M "+h.serialize()+" "+o.serialize()+" "+s.serialize()+" "+y.serialize();return{d:""+x}}case"bottom":{var C=a.clone().offset(0,-r),p=s.clone().offset(0,-r),E="M "+C.serialize()+" "+a.serialize()+" "+s.serialize()+" "+p.serialize();return{d:""+E}}case"left":default:{var k=n.clone().offset(r,0),w=a.clone().offset(r,0),S="M "+k.serialize()+" "+n.serialize()+" "+a.serialize()+" "+w.serialize();return{d:""+S}}}}}}}),$2=le.define("bpmn2.AnnotationLink",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",strokeDasharray:"2,5"},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{defaultLabel:wa,markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),fs=At.define("bpmn2.Pool",{size:{width:600,height:300},lanes:null,milestones:null,milestonesSize:20,padding:0,headerSize:20,attrs:{body:{refWidth:"100%",refHeight:"100%",fill:"transparent"},laneGroups:{laneContainerPosition:!0},laneHeaders:{fill:"#ffffff",stroke:"#333333",strokeWidth:2,headerSize:!0,shapeRendering:"optimizespeed"},laneLabels:{fontSize:14,fill:"#333333",transform:"rotate(-90)",textAnchor:"middle",textVerticalAnchor:"middle",labelAlignment:Pe.center,labelMargin:{vertical:2,horizontal:10},fontFamily:"sans-serif",labelPosition:!0,laneLabel:{textWrap:!0,ellipsis:!0}},lanes:{stroke:"#333333",strokeWidth:2,fill:"#ffffff",laneSize:!0,shapeRendering:"optimizespeed"},milestoneGroups:{milestoneContainerPosition:!0},milestoneHeaders:{fill:"#ffffff",stroke:"#333333",strokeWidth:2,milestoneHeaderSize:!0,shapeRendering:"optimizespeed"},milestoneLabels:{fontSize:14,fill:"#333333",labelMargin:{vertical:2,horizontal:10},fontFamily:"sans-serif",textAnchor:"end",textVerticalAnchor:"middle",labelAlignment:Pe.rightMiddle,milestoneLabelPosition:!0,milestoneLabel:{textWrap:!0,ellipsis:!0}},milestoneLines:{stroke:"#333333",strokeWidth:2,milestoneLinePosition:!0,shapeRendering:"optimizespeed"}}},{metrics:null,markup:[{tagName:"rect",selector:"body"}],markupAttributes:["lanes","padding","milestones","headerSize","milestonesSize"],initialize:function(){At.prototype.initialize.apply(this,arguments),this.on("change",this.onChange,this),this.buildMarkup()},anyHasChanged:function(t){return Array.isArray(t)?t.some(function(e){return this.hasChanged(e)},this):!1},onChange:function(t,e){e.pool!==this.id&&this.hasChanged("markup")&&$e("Markup cannot be modified."),this.anyHasChanged(this.markupAttributes)&&this.buildMarkup(e)},buildMarkup:function(t){var e=de(this.markup);Array.isArray(e)||$e("Expects Prototype JSON Markup.");var r=this.attributes.lanes||[{}];Array.isArray(r)||$e("Expects lanes to be an array.");var i=this.attributes.milestones||[];Array.isArray(i)||$e("Expects milestones to be an array.");var n=this.metrics={};n.lanes={},n.lanesNameCache={},n.milestonesNameCache={},n.milestones={},n.totalTakenHeightSpace=0,n.topLaneGroupsCount=r.length,n.padding=he(this.attributes.padding),this.buildLanesMarkupRecursively(r,e,"",1,0),this.buildMilestones(i,e);var a=tt({pool:this.id,dry:!0},t);this.set("markup",e,a),a.autoResize!==!1&&this.autoresize(a)},buildLanesMarkupRecursively:function(t,e,r,i,n){var a=this;Array.isArray(t)||$e("Expects lanes to be an array.");var o=0;return t.forEach(function(s,l){var u=0,g=s.id,h=r?r+"_"+l:""+l,y=a.getLaneGroupMarkup(h,g);e.push(y);var x=Number.isFinite(s.size)?Math.max(s.size,0):void 0,C=a.getLaneMarkup(h,g);y.children.push(C);var p=s.label,E=typeof s.label=="string",k=E?Number.isFinite(s.headerSize)?Math.max(s.headerSize,0):a.attributes.headerSize:0;if(E){var w=a.getHeaderMarkup(h,g),S=a.getLabelMarkup(h,g);y.children.push(w),y.children.push(S)}s.sublanes&&!Array.isArray(s.sublanes)&&$e("Expects sublanes to be an array.");var T=s.sublanes||[];if(T.length){var m=y.children,A=i+1;u=a.buildLanesMarkupRecursively(T,m,h,A,T.length)}u=x&&x>u?x:u,o+=u;var M={nestLevel:i,laneIndexWithinGroup:l,parentId:r?"lanes_"+r:"",parentSublanesCount:n,headerSize:k,label:p,hasLabel:E,size:x,takenUpSpaceByLaneAndSublanes:u,sublanesCount:T.length,name:g};a.addLaneGroupMetrics(h,M)}),o},buildMilestones:function(t,e){var r=this,i=this,n=i.metrics,a=i.attributes,o=n.padding;n.milestonesCount=t.length,o.top+=t.length?a.milestonesSize:0,t.forEach(function(s,l){var u=s.id,g="milestone_"+l,h=n.milestonesNameCache[g]!==void 0;if(u){var y=u!==g&&n.milestones[u]!==void 0,x=n.milestonesNameCache[u]!==void 0;(x||y)&&$e("Duplicated milestone group id: "+u),n.milestonesNameCache[u]=g}h&&$e("Duplicated milestone group id: "+g);var C=r.getMilestoneGroupMarkup(l,u);e.push(C);var p=r.getMilestoneHeaderMarkup(l,u),E=r.getMilestoneLabelMarkup(l,u),k=r.getMilestoneLineMarkup(l,u);n.milestones[g]={label:typeof s.label=="string"?s.label:"",indexWithin:l,size:Number.isFinite(s.size)?Math.max(s.size,0):void 0,name:u},C.children.push(k),C.children.push(p),C.children.push(E)})},addLaneGroupMetrics:function(t,e){var r="lanes_"+t,i=e.laneSize,n=e.name,a=this,o=a.metrics,s=o.lanesNameCache[r]!==void 0;if(s&&$e("Duplicated lane group id: "+r),n){var l=n!==r&&o.lanes[n]!==void 0,u=o.lanesNameCache[n]!==void 0;(u||l)&&$e("Duplicated lane group id: "+n),o.lanesNameCache[n]=r}o.lanes[r]=e,Number.isFinite(i)&&(o.totalTakenHeightSpace+=i)},autoresize:function(t){var e=this.getMinimalSize(),r=this.attributes.size;this.resize(Math.max(e.width,r.width),Math.max(e.height,r.height),t)},getMinimalSize:function(){var t=this,e=t.metrics,r=e.padding,i,n,a=0,o=0,s=0,l=this.attributes.milestonesSize,u=e.lanes,g=e.milestones;return Object.keys(u).forEach(function(h){for(var y=u[h],x=h,C=0;x;){var p=e.lanes[x];C+=p.headerSize||0,x=p.parentId}a=C>a?C:a,y.nestLevel===1&&(o+=y.takenUpSpaceByLaneAndSublanes||0)}),Object.keys(g).forEach(function(h){s+=g[h].size||0}),i=a>s?a:s,n=e.milestonesCount&&l>o?0:o,{height:n+r.top+r.bottom,width:i+r.left+r.right}},getLaneGroupMarkup:function(t,e){var r=["laneGroups"];return e&&r.push("lanes_"+e),{tagName:"g",selector:"lanes_"+t,groupSelector:r,attributes:{laneGroupId:"lanes_"+t},children:[]}},getMilestoneGroupMarkup:function(t,e){var r=["milestoneGroups"];return e&&r.push("milestone_"+e),{tagName:"g",selector:"milestone_"+t,groupSelector:r,attributes:{milestoneGroupId:"milestone_"+t},children:[]}},getLaneMarkup:function(t,e){var r=["lanes"];return e&&r.push("lane_"+e),{tagName:"rect",selector:"lane_"+t,groupSelector:r,children:[],attributes:{laneGroupId:"lanes_"+t}}},getHeaderMarkup:function(t,e){var r=["laneHeaders"];return e&&r.push("header_"+e),{tagName:"rect",selector:"header_"+t,groupSelector:r,attributes:{laneGroupId:"lanes_"+t}}},getLabelMarkup:function(t,e){var r=["laneLabels"];return e&&r.push("label_"+e),{tagName:"text",selector:"label_"+t,groupSelector:r,attributes:{laneGroupId:"lanes_"+t}}},getMilestoneHeaderMarkup:function(t,e){var r=["milestoneHeaders"];return e&&r.push("milestoneHeader_"+e),{tagName:"rect",selector:"milestoneHeader_"+t,groupSelector:r,attributes:{milestoneGroupId:"milestone_"+t}}},getMilestoneLabelMarkup:function(t,e){var r=["milestoneLabels"];return e&&r.push("milestoneLabel_"+e),{tagName:"text",selector:"milestoneLabel_"+t,groupSelector:r,attributes:{milestoneGroupId:"milestone_"+t}}},getMilestoneLineMarkup:function(t,e){var r=["milestoneLines"];return e&&r.push("milestoneLine_"+e),{tagName:"line",selector:"milestoneLine_"+t,groupSelector:r,attributes:{milestoneGroupId:"milestone_"+t}}},getParentIndexesArray:function(t){for(var e=[],r=t;r;){e.push(r);var i=this.metrics.lanes[r];r=i.parentId}return e.reverse()},getFlexAndFixedLaneSizesWithinGroup:function(t){var e=this,r=e.metrics,i=r.lanes[t],n=i.parentId,a=0,o=0,s=i.parentSublanesCount-1;for(n||(n="lanes",s=r.topLaneGroupsCount-1);s>=0;){var l=n+"_"+s,u=r.lanes[l];Number.isFinite(u.size)?a+=Math.max(u.size,u.takenUpSpaceByLaneAndSublanes):o++,s--}return{totalFixedSize:a,flexLanesWithinGroupCount:o}},getLaneWidth:function(t){var e=this,r=e.metrics,i=r.padding,n=this.getParentIndexesArray(t),a=this.attributes.size.width-i.left-i.right,o=0;return n.forEach(function(s){var l=r.lanes[s];o+=l.headerSize}),Math.max(a-o,0)},getLaneHeight:function(t){var e=this,r=this,i=r.metrics,n=i.lanes[t],a=i.padding,o=this.getParentIndexesArray(t),s=this.attributes.size.height-a.top-a.bottom,l=n.parentId,u=s;if(l){var g=i.lanes[l],h=g.sublanesCount,y=n.laneIndexWithinGroup,x=y===h-1;if(x){var C=this.getLaneContainerPosition(t),p=C.y,E=this.getLaneHeight(l);return Math.max(E-p,0)}}if(Number.isFinite(n.size))if(!l&&n.laneIndexWithinGroup===i.topLaneGroupsCount-1){var k=this.getLaneContainerPosition(t),w=k.y;return Math.max(this.attributes.size.height-w-a.bottom,0)}else{var S=n.takenUpSpaceByLaneAndSublanes;return Math.max(S,n.size,0)}var T=o.map(function(D){return D}).reverse().find(function(D){return i.lanes[D].size});if(T){var m=o.map(function(D){return D}),A=m.indexOf(T);o=m.slice(A+1),u=i.lanes[T].size}o.forEach(function(D){for(var z=e.getFlexAndFixedLaneSizesWithinGroup(D),_=i.lanes[D],j=_.parentId,V=i.lanes[D].parentSublanesCount,W=i.topLaneGroupsCount,Y=0,X=0,J=(u-z.totalFixedSize)/(z.flexLanesWithinGroupCount||1),Q=j?V-1:W-1;Q>=0;){var it=(j||"lanes")+"_"+Q;if(it===t){Q--;continue}var st=i.lanes[it],gt=st.takenUpSpaceByLaneAndSublanes;!st.size&&gt>J&&(Y+=gt,X++),Q--}u-=z.totalFixedSize+Y,u/=Math.max(z.flexLanesWithinGroupCount-X,1)});var M=n.takenUpSpaceByLaneAndSublanes,N=M>u?M:u;return Math.max(N,0)},getMilestoneWidth:function(t){var e=this,r=e.metrics,i=r.padding,n=this.attributes.size.width-i.left-i.right,a=r.milestones[t],o=r.milestonesCount;if(Number.isFinite(a.size))return a.size;for(var s=o-1,l=0,u=0;s>=0;){var g="milestone_"+s,h=r.milestones[g];Number.isFinite(h.size)&&(l+=h.size,u++),s--}var y=(n-l)/(o-u||1);return Math.max(y,0)},getLaneContainerPosition:function(t){var e=this,r=e.metrics,i=r.padding,n=r.lanes[t],a=n.laneIndexWithinGroup,o=n.nestLevel,s=n.parentId,l=s?r.lanes[s].headerSize:0,u=l,g=0;o===1&&(u+=i.left,g+=i.top);for(var h=0,y=a-1;y>=0;){var x=s?s+"_"+y:"lanes_"+y;h+=this.getLaneHeight(x),y--}return new Z(u,g+h)},getMilestoneContainerPosition:function(t){for(var e=this,r=e.metrics,i=r.milestones[t],n=i.indexWithin,a=r.padding,o=n-1,s=0;o>=0;){var l="milestone_"+o,u=this.getMilestoneWidth(l);s+=u,o--}var g=this.attributes.milestonesSize,h=s+a.left,y=a.top-g;return new Z(h,y)},getLaneBBox:function(t){typeof t!="string"&&$e("Expects id to be a string");var e=this,r=e.metrics,i=this.position(),n=r.lanes[t];if(n||(t=r.lanesNameCache[t],n=r.lanes[t]),!n)return null;var a=n.parentId,o=n.headerSize,s={x:0,y:0};if(a){var l=this.getLaneBBox(a);s.x+=l.x-i.x,s.y+=l.y-i.y}var u=this.getLaneContainerPosition(t),g=u.x,h=u.y,y=this.getLaneWidth(t),x=this.getLaneHeight(t);return new at({x:g+s.x+i.x,y:h+s.y+i.y,width:y+o,height:x})},getMilestoneBBox:function(t){typeof t!="string"&&$e("Expects id to be a string");var e=this,r=e.metrics,i=e.attributes,n=r.padding,a=r.milestones,o=a[t];if(o||(t=r.milestonesNameCache[t],o=a[t]),!o)return null;var s=this.position(),l=this.getMilestoneWidth(t),u=i.milestonesSize,g=i.size.height-n.bottom-n.top+u,h=this.getMilestoneContainerPosition(t),y=h.x,x=h.y;return new at(y+s.x,x+s.y,l,g)},getLanesFromPoint:function(t){var e=this;t||$e("A point is required");var r=this.getBBox(),i=r.center(),n=this.angle(),a=new Z(t).rotate(i,n);if(!r.containsPoint(a))return[];var o=this.metrics,s=o.lanes,l=[],u=function(g){for(var h=g?s[g].sublanesCount-1:o.topLaneGroupsCount-1;h>=0;){var y=g?g+"_"+h:"lanes_"+h,x=e.getLaneBBox(y);if(x.containsPoint(a)){var C=s[y].name;l.push(C||y),u(y);break}h--}};return u(),l.reverse()},getMilestoneFromPoint:function(t){t||$e("A point is required");var e=this.metrics,r=this.getBBox(),i=this.angle(),n=new Z(t).rotate(r.center(),i);if(!r.containsPoint(n))return null;for(var a=e.milestonesCount-1;a>=0;){var o="milestone_"+a,s=this.getMilestoneBBox(o);if(s.containsPoint(n)){var l=e.milestones[o].name;return l===void 0?o:l}a--}return null},getLanePath:function(t){var e=this.metrics,r=e.lanes,i=r[t];if(i===void 0){var n=e.lanesNameCache[t];i=r[n]}if(i===void 0)return[];for(var a=[i.laneIndexWithinGroup],o=i;o.parentId;){var s=r[o.parentId].laneIndexWithinGroup;a.unshift(s,"sublanes"),o=r[o.parentId]}return a.unshift("lanes"),a},toJSON:function(){var t=At.prototype.toJSON.apply(this,arguments);return delete t.markup,t}},{attributes:{laneContainerPosition:{position:function(t,e,r){var i=r.getAttribute("laneGroupId");return this.model.getLaneContainerPosition(i)}},laneSize:{set:function(t,e,r){var i=this,n=i.model,a=r.getAttribute("laneGroupId"),o=n.getLaneWidth(a),s=n.getLaneHeight(a),l=n.metrics.lanes[a].headerSize;return{width:o+l,height:s}}},headerSize:{set:function(t,e,r){var i=r.getAttribute("laneGroupId"),n=this.model.metrics.lanes[i],a=n.headerSize,o=Math.max(this.model.getLaneHeight(i),0);return{width:a,height:o}}},labelPosition:{position:function(t,e,r,i){var n=this,a=n.model,o=r.getAttribute("laneGroupId"),s=a.metrics.lanes[o],l=s.headerSize,u=a.getLaneHeight(o),g=he(i.labelMargin),h=g.left,y=g.top,x=g.right,C=g.bottom,p=u/2,E=l/2,k=i.labelAlignment;switch(k){case Pe.topMiddle:return{x:y,y:p+h-x};case Pe.topLeft:return{x:y,y:u-x};case Pe.topRight:return{x:y,y:h};case Pe.leftMiddle:return{x:E+y-C,y:u-x};case Pe.rightMiddle:return{x:E+y-C,y:h};case Pe.bottomLeft:return{x:l-C,y:u-x};case Pe.bottomMiddle:return{x:l-C,y:p+h-x};case Pe.bottomRight:return{x:l-C,y:h};case Pe.center:default:return{x:E+y-C,y:p+h-x}}}},laneLabel:{set:function(t,e,r,i){if(!fe(t))return null;var n=this,a=n.model,o=r.getAttribute("laneGroupId"),s=a.metrics.lanes[o],l=s.headerSize,u=a.getLaneHeight(o),g=s.label;return av(this,t,r,i,u,l,g)}},milestoneContainerPosition:{position:function(t,e,r){var i=r.getAttribute("milestoneGroupId");return this.model.getMilestoneContainerPosition(i)}},milestoneHeaderSize:{set:function(t,e,r){var i=this,n=i.model,a=r.getAttribute("milestoneGroupId"),o=n.getMilestoneWidth(a),s=n.attributes.milestonesSize;return{width:o,height:s}}},milestoneLabelPosition:{position:function(t,e,r,i){var n=this,a=n.model,o=r.getAttribute("milestoneGroupId"),s=a.getMilestoneWidth(o),l=a.attributes.milestonesSize,u=he(i.labelMargin),g=u.left,h=u.top,y=u.right,x=u.bottom,C=l/2,p=s/2,E=i.labelAlignment;switch(E){case Pe.topMiddle:return{x:p+g-y,y:h};case Pe.topLeft:return{x:g,y:h};case Pe.topRight:return{x:s-y,y:h};case Pe.leftMiddle:return{x:g,y:C+h-x};case Pe.bottomLeft:return{x:g,y:l-x};case Pe.bottomMiddle:return{x:p+g-y,y:l-x};case Pe.bottomRight:return{x:s-y,y:l-x};case Pe.rightMiddle:return{x:s-y,y:C+h-x};case Pe.center:default:return{x:p+g-y,y:C+h-x}}}},milestoneLabel:{set:function(t,e,r,i){if(!fe(t))return null;var n=this,a=n.model,o=r.getAttribute("milestoneGroupId"),s=a.metrics.milestones[o],l=a.getMilestoneWidth(o),u=a.attributes.milestonesSize,g=s.label;return av(this,t,r,i,l,u,g)}},milestoneLinePosition:{set:function(t,e,r){var i=this,n=i.model,a=n.position(),o=n.metrics.padding,s=n.attributes.milestonesSize,l=r.getAttribute("milestoneGroupId"),u=n.getMilestoneBBox(l),g=u.x,h=u.width,y=u.height,x="block",C=e.width-o.right,p=Math.ceil(g)-a.x+Math.ceil(h);return p>=C&&(x="none"),{x1:h,x2:h,y1:s,y2:y,display:x}}},textVertical:{set:function(){return{transform:"rotate(-90)"}}},textWrap:{set:function(t,e,r,i){if(i.textVertical){var n=e.width;e.width=e.height,e.height=n}ci.textWrap.set.call(this,t,e,r,i)}},labelMargin:{},labelAlignment:{}}}),tS=fs.define("bpmn2.HeaderedPool",{padding:{top:0,left:30,right:0,bottom:0},attrs:{header:{width:30,refHeight:"100%",stroke:"#333333",strokeWidth:2,fill:"#ffffff",shapeRendering:"optimizespeed"},headerLabel:{textVertical:!0,textWrap:{width:-10,ellipsis:!0,maxLineCount:1},refX:15,refY:"50%",fontSize:20,fill:"#333333",fontFamily:"sans-serif",textAnchor:"middle",textVerticalAnchor:"middle"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerLabel"}]}),eS=fs.prototype.markupAttributes.reduce(function(t,e){return t[e]=["UPDATE","TOOLS"],t},{}),ov=kt.extend({presentationAttributes:kt.addPresentationAttributes(eS)}),rS=ov;function $e(t){throw new Error("shapes.bpmn2.Pool: "+t)}var iS={__proto__:null,Event:G2,Gateway:F2,DataStore:V2,DataObject:W2,DataAssociation:Z2,Activity:Y2,Conversation:U2,ConversationLink:X2,Flow:J2,Group:K2,Annotation:Q2,AnnotationLink:$2,Pool:fs,HeaderedPool:tS,PoolView:ov,HeaderedPoolView:rS},wn={exportElement:function(t){return t.size()},exportLink:function(t){var e=t.get("labelSize")||{},r={minLen:t.get("minLen")||1,weight:t.get("weight")||1,labelpos:t.get("labelPosition")||"c",labeloffset:t.get("labelOffset")||0,width:e.width||0,height:e.height||0};return r},importElement:function(t,e,r){var i=this.getCell(e),n=r.node(e);t.setPosition?t.setPosition(i,n):i.set("position",{x:n.x-n.width/2,y:n.y-n.height/2})},importLink:function(t,e,r){var i=.001,n=this.getCell(e.name),a=r.edge(e),o=a.points||[],s=new Qt(o);if(t.setVertices||t.setLinkVertices)if(yt(t.setVertices))t.setVertices(n,o);else{s.simplify({threshold:i});var l=s.points.map(function(p){return p.toJSON()}),u=l.length;n.set("vertices",l.slice(1,u-1))}if(t.setLabels&&"x"in a&&"y"in a){var g={x:a.x,y:a.y};if(yt(t.setLabels))t.setLabels(n,g,o);else{var h=s.closestPointLength(g),y=s.pointAtLength(h),x=h/s.length(),C=new Z(g).difference(y).toJSON();n.label(0,{position:{distance:x,offset:C}})}}},layout:function(t,e){var r;t instanceof Ie?r=t:r=new Ie().resetCells(t,{dry:!0,sort:!1}),t=null,e=ne(e||{},{resizeClusters:!0,clusterPadding:10,exportElement:this.exportElement,exportLink:this.exportLink});var i=e.dagre||(typeof dagre<"u"?dagre:void 0);if(i===void 0)throw new Error('The the "dagre" utility is a mandatory dependency.');var n=wn.toGraphLib(r,{graphlib:e.graphlib,directed:!0,multigraph:!0,compound:!0,setNodeLabel:e.exportElement,setEdgeLabel:e.exportLink,setEdgeName:function(g){return g.id}}),a={},o=e.marginX||0,s=e.marginY||0;if(e.rankDir&&(a.rankdir=e.rankDir),e.align&&(a.align=e.align),e.nodeSep&&(a.nodesep=e.nodeSep),e.edgeSep&&(a.edgesep=e.edgeSep),e.rankSep&&(a.ranksep=e.rankSep),e.ranker&&(a.ranker=e.ranker),o&&(a.marginx=o),s&&(a.marginy=s),n.setGraph(a),i.layout(n,{debugTiming:!!e.debugTiming}),r.startBatch("layout"),wn.fromGraphLib(n,{importNode:this.importElement.bind(r,e),importEdge:this.importLink.bind(r,e)}),e.resizeClusters){var l=n.nodes().filter(function(g){return n.children(g).length>0}).map(r.getCell.bind(r)).sort(function(g,h){return h.getAncestors().length-g.getAncestors().length});me(l,"fitEmbeds",{padding:e.clusterPadding})}r.stopBatch("layout");var u=n.graph();return new at(o,s,Math.abs(u.width-2*o),Math.abs(u.height-2*s))},fromGraphLib:function(t,e){e=e||{};var r=e.importNode||Xr,i=e.importEdge||Xr,n=this instanceof Ie?this:new Ie;return t.nodes().forEach(function(a){r.call(n,a,t,n,e)}),t.edges().forEach(function(a){i.call(n,a,t,n,e)}),n},toGraphLib:function(t,e){e=e||{};var r=e.graphlib||(typeof graphlib<"u"?graphlib:void 0);if(r===void 0)throw new Error('The the "graphlib" utility is a mandatory dependency.');for(var i=ln(e,"directed","compound","multigraph"),n=new r.Graph(i),a=e.setNodeLabel||Xr,o=e.setEdgeLabel||Xr,s=e.setEdgeName||Xr,l=t.get("cells"),u=0,g=l.length;u<g;u++){var h=l.at(u);if(h.isLink()){var y=h.get("source"),x=h.get("target");if(!y.id||!x.id)break;n.setEdge(y.id,x.id,o(h),s(h))}else if(n.setNode(h.id,a(h)),n.isCompound()&&h.has("parent")){var C=h.get("parent");l.has(C)&&n.setParent(h.id,C)}}return n}};Ie.prototype.toGraphLib=function(t){return wn.toGraphLib(this,t)},Ie.prototype.fromGraphLib=function(t,e){return wn.fromGraphLib.call(this,t,e)};var nS={__proto__:null,Port:Vf,PortLabel:Xf,DirectedGraph:wn},aS=d.Model.extend({defaults:{linkDistance:10,linkStrength:1,charge:10,x:0,y:0},cacheAttribute:"_fcache",initialize:function(){var t=this.get("graph"),e,r;if(Array.isArray(t)){var i=t;e=[],r=[];for(var n=0,a=i.length;n<a;n++){var o=i[n];o.isLink()?e.push(o):r.push(o)}}else r=t.getElements(),e=t.getLinks();this.links=e,this.elements=r,this.x=this.get("x"),this.y=this.get("y"),this.width=this.get("width"),this.height=this.get("height"),this.gravityCenter=this.get("gravityCenter"),this.t=1,this.energy=1/0,this.progress=0},start:function(){var t=this.width,e=this.height,r=this.x,i=this.y;this.elements.forEach(function(n){var a=Pt(r,r+t),o=Pt(i,i+e);n.position(a,o,{forceDirected:!0});var s=n[this.cacheAttribute]={};s.charge=n.get("charge")||this.get("charge"),s.weight=n.get("weight")||1,s.x=s.px=a,s.y=s.py=o,s.fx=0,s.fy=0},this),this.links.forEach(function(n){var a=n[this.cacheAttribute]={};a.source=n.getSourceElement(),a.target=n.getTargetElement(),a.strength=n.get("strength")||this.get("linkStrength"),a.distance=n.get("distance")||this.get("linkDistance")},this)},step:function(){if(this.t*.99<.005)return this.notifyEnd();var t=this.cacheAttribute,e=this.width,r=this.height,i=this.x,n=this.y,a=.1,o=this.gravityCenter,s=this.energy;this.energy=0;var l=0,u=0,g=0,h=0,y,x,C=this.elements.length,p=this.links.length,E,k,w,S,T,m,A,M,N;for(y=0;y<C-1;y++)for(E=this.elements[y][t],l+=E.x,u+=E.y,x=y+1;x<C;x++)k=this.elements[x][t],w=k.x-E.x,S=k.y-E.y,T=w*w+S*S,m=Math.sqrt(T),A=this.t*E.charge/T,M=A*w,N=A*S,E.fx-=M,E.fy-=N,k.fx+=M,k.fy+=N,this.energy+=M*M+N*N;var D=this.elements[C-1][t];l+=D.x,u+=D.y;var z,_,j;for(y=0;y<p;y++)z=this.links[y][t],E=z.source[t],k=z.target[t],w=k.x-E.x,S=k.y-E.y,T=w*w+S*S,m=Math.sqrt(T),_=this.t*z.strength*(m-z.distance)/m,M=_*w,N=_*S,j=E.weight/(E.weight+k.weight),E.x+=M*(1-j),E.y+=N*(1-j),k.x-=M*j,k.y-=N*j,this.energy+=M*M+N*N;var V,W,Y;for(y=0;y<C;y++){V=this.elements[y],W=V[t],Y={x:W.x,y:W.y},o&&(Y.x+=(o.x-Y.x)*this.t*a,Y.y+=(o.y-Y.y)*this.t*a),Y.x+=W.fx,Y.y+=W.fy,Y.x=Math.max(i,Math.min(i+e,Y.x)),Y.y=Math.max(n,Math.min(i+r,Y.y));var X=.9;Y.x+=(W.px-Y.x)*X,Y.y+=(W.py-Y.y)*X,W.px=Y.x,W.py=Y.y,W.fx=W.fy=0,W.x=Y.x,W.y=Y.y,g+=W.x,h+=W.y,this.notify(V,y,Y)}this.t=this.cool(this.t,this.energy,s);var J=l-g,Q=u-h,it=Math.sqrt(J*J+Q*Q);it<1&&this.notifyEnd()},cool:function(t,e,r){if(e<r){if(this.progress+=1,this.progress>=5)return this.progress=0,t/.99}else return this.progress=0,t*.99;return t},notify:function(t,e,r){t.set("position",r,{forceDirected:!0})},notifyEnd:function(){this.trigger("end")}});function oS(t,e,r){var i=e.size,n=e.position;if(i){var a=i.width,o=i.height;t.resize(a,o,r)}if(n){var s=n.x,l=n.y;t.position(s,l,r)}}var gs={layout:function(t,e){var r;t instanceof Ie?r=t:r=new Ie().resetCells(t,{dry:!0,sort:!1}),t=null,e=e||{};var i=r.getElements(),n=e.columns||1,a=Math.ceil(i.length/n),o=e.dx||0,s=e.dy||0,l=e.centre===void 0||e.centre!==!1,u=l?"middle":e.verticalAlign,g=l?"middle":e.horizontalAlign,h=!!e.resizeToFit,y=e.marginX||0,x=e.marginY||0,C=e.columnGap||0,p=e.rowGap||0,E=e.setAttributes;typeof E!="function"&&(E=oS);var k=[],w=e.columnWidth;if(w==="compact")for(var S=0;S<n;S++){var T=this._elementsAtColumn(i,S,n);k.push(this._maxDim(T,"width")+o)}else{(!w||$t(w))&&(w=this._maxDim(i,"width")+o);for(var m=0;m<n;m++)k.push(w)}var A=this._accumulate(k,y).map(function(W,Y){return W+(Y-.5)*C}),M=[],N=e.rowHeight;if(N==="compact")for(var D=0;D<a;D++){var z=this._elementsAtRow(i,D,n);M.push(this._maxDim(z,"height")+s)}else{(!N||$t(N))&&(N=this._maxDim(i,"height")+s);for(var _=0;_<a;_++)M.push(N)}var j=this._accumulate(M,x).map(function(W,Y){return W+(Y-.5)*p});r.startBatch("layout"),i.forEach(function(W,Y){var X=Y%n,J=Math.floor(Y/n),Q=k[X],it=M[J],st=0,gt=0,nt=W.get("size"),ut={};if(h){var ft=Q-2*o,vt=it-2*s,xt=nt.height*(nt.width?ft/nt.width:1),Et=nt.width*(nt.height?vt/nt.height:1);xt>it?ft=Et:vt=xt,nt={width:ft,height:vt},ut.size=nt}switch(u){case"top":break;case"bottom":gt=it-nt.height;break;case"middle":gt=(it-nt.height)/2;break}switch(g){case"left":break;case"right":st=Q-nt.width;break;case"middle":st=(Q-nt.width)/2;break}ut.position={x:A[X]+o+st+C/2,y:j[J]+s+gt+p/2},E.call(r,W,ut,e)}),r.stopBatch("layout"),n>0&&(A[0]+=C/2,A[n]-=C/2),a>0?(j[0]+=p/2,j[a]-=p/2):j.length===0&&(j=[x,x]);var V=new at(y,x,A[n]-A[0],j[a]-j[0]);return{rowHeights:M,columnWidths:k,gridY:j,gridX:A,bbox:V}},_maxDim:function(t,e){return t.reduce(function(r,i){return Math.max(i.get("size")[e],r)},0)},_elementsAtRow:function(t,e,r){for(var i=[],n=r*e,a=Math.min(n+r,t.length);n<a;n++)i.push(t[n]);return i},_elementsAtColumn:function(t,e,r){for(var i=[],n=e,a=t.length;n<a;n+=r)i.push(t[n]);return i},_accumulate:function(t,e){return t.length===0?[]:t.reduce(function(r,i,n){return r.push(r[n]+i),r},[e||0])}};function xa(t,e,r){r=ne(r||{},{siblingGap:0}),this.width=0,this.height=0,this.layoutAreas=this.sortLayoutAreas(t),this.parentArea=e,this.siblingGap=r.siblingGap,this.exists()&&this.computeSize(r)}tt(xa.prototype,{sortLayoutAreas:function(t){var e=Fe(t,"siblingRank");return e.forEach(function(r,i){r.siblingRank=i}),e},move:function(t,e){for(var r=0,i=this.layoutAreas.length;r<i;r++)this.layoutAreas[r].dx+=t,this.layoutAreas[r].dy+=e},exists:function(){return this.layoutAreas.length>0},sumGaps:function(t){var e=Math.max(this.layoutAreas.length-1,0);return e*t},getSiblingRankByPoint:function(t){if(!this.exists())return-1;var e=this.findAreaByPoint(t);return e?e.siblingRank-1:this.layoutAreas.length-1},getFirstChildConnectionPoints:function(){return[]},getConnectionPoints:function(t,e){if(!this.exists())return this.getFirstChildConnectionPoints(t);var r={dx:t.x-this.parentArea.rootCX,dy:t.y-this.parentArea.rootCY};return this.layoutAreas[0].getRootVertices(r,e)},getParentConnectionPoint:function(){var t=this.parentArea,e=this.proxyLayoutArea("getConnectionPoint",t.rootSize),r=Bt(t.rootCX,t.rootCY);return r.offset(e.x,e.y)},getChildConnectionPoint:function(t,e){var r=this.proxyLayoutArea("getConnectionPoint",e);return Bt(t).difference(r)},proxyLayoutArea:function(t){var e=Array.prototype.slice.call(arguments,1);return qe.fromDirection(this.direction).prototype[t].apply(this.parentArea,e)}}),xa.extend=d.Model.extend;var _i=xa.extend({getTopDY:function(){return-this.height/2},findAreaByPoint:function(t){return this.layoutAreas.find(function(e){return e.rootCY>t.y})},computeSize:function(t){this.height=this.sumGaps(t.siblingGap);var e=this.layoutAreas;this.height+=e.reduce(function(r,i){return r+i.height+i.prevSiblingGap+i.nextSiblingGap},0),e.reduce(function(r,i){return this.width=Math.max(this.width,i.getExtendedWidth()),i.dy+=r+i.getCY(),r+i.prevSiblingGap+i.height+i.nextSiblingGap+t.siblingGap}.bind(this),this.getTopDY())},getYTowardsParent:function(){return this.parentArea.rootCY},getXTowardsParent:function(){var t=this.parentArea;return t.rootCX+this.LRSign*(t.rootSize.width/2+t.gap)},getNeighborPointFromRank:function(t){var e,r=this.siblingGap;if(!this.exists())e=this.getYTowardsParent();else{var i=this.layoutAreas[t],n=this.layoutAreas[t+1];i?n?e=(i.y+i.height+n.y)/2:e=i.y+i.height+r/2:e=n.y-r/2}return{x:this.getXTowardsParent(),y:e}}}),sS=_i.extend({direction:"L",LRSign:-1}),lS=_i.extend({direction:"R",LRSign:1}),Aa={getXTowardsParent:function(){var t=this.parentArea;return t.rootCX+this.LRSign*t.gap},getYTowardsParent:function(){var t=this.parentArea,e=t.getLRHeight(t.siblings)/2;return e+=Math.min(t.firstChildGap,this.siblingGap/2),t.rootCY+this.TBSign*e},getFirstChildConnectionPoints:function(t){return[Bt(this.parentArea.rootCX,t.y)]},getChildConnectionPoint:function(t,e){return Bt(t).offset(-this.LRSign*e.width/2,0)},getParentConnectionPoint:function(){var t=this.parentArea,e=Bt(t.rootCX,t.rootCY);return e.offset(0,this.TBSign*(t.rootSize.height-t.rootMargin)/2)}},sv={getTopDY:function(){return 0}},lv={getTopDY:function(){return-this.height}},uv=_i.extend({direction:"BR",LRSign:1,TBSign:1});tt(uv.prototype,Aa,sv);var hv=_i.extend({direction:"BL",LRSign:-1,TBSign:1});tt(hv.prototype,Aa,sv);var cv=_i.extend({direction:"TR",LRSign:1,TBSign:-1});tt(cv.prototype,Aa,lv);var dv=_i.extend({direction:"TL",LRSign:-1,TBSign:-1});tt(dv.prototype,Aa,lv);var fv=xa.extend({getLeftDX:function(){return-this.width/2},findAreaByPoint:function(t){return this.layoutAreas.find(function(e){return e.rootCX>t.x})},computeSize:function(t){this.width=this.sumGaps(t.siblingGap);var e=this.layoutAreas;this.width+=e.reduce(function(r,i){return r+i.width+i.prevSiblingGap+i.nextSiblingGap},0),e.reduce(function(r,i){return this.height=Math.max(this.height,i.getExtendedHeight()),i.dx+=r+i.getCX(),r+i.prevSiblingGap+i.width+i.nextSiblingGap+t.siblingGap}.bind(this),this.getLeftDX())},getNeighborPointFromRank:function(t){var e;if(!this.exists())e=this.parentArea.rootCX;else{var r=this.layoutAreas[t],i=this.layoutAreas[t+1];r?i?e=(r.x+r.width+i.x)/2:e=r.x+r.width+this.siblingGap/2:e=i.x-this.siblingGap/2}return{x:e,y:this.getYTowardsParent()}}}),uS=fv.extend({direction:"T",getYTowardsParent:function(){var t=this.parentArea;return t.rootCY-t.getLRHeight()/2-t.gap}}),hS=fv.extend({direction:"B",getYTowardsParent:function(){var t=this.parentArea;return t.rootCY+t.getLRHeight()/2+t.gap}});function qe(t,e){this.root=t;var r=tt({},e,this.getRootAttributes(t,e.attributeNames)),i=e.gap||0;ne(r,{parentGap:i,siblingGap:i,firstChildGap:i}),this.siblingRank=r.siblingRank,this.rootOffset=r.rootOffset,this.rootMargin=r.rootMargin,this.siblingGap=r.siblingGap,this.gap=this.parentGap=r.parentGap,this.nextSiblingGap=r.nextSiblingGap,this.prevSiblingGap=r.prevSiblingGap,this.firstChildGap=r.firstChildGap,this.dx=0,this.dy=0,this.width=0,this.height=0}tt(qe,{create:function(t,e,r){var i=qe.fromDirection(t,r);return new i(e,r)},fromDirection:function(t,e){var r;switch(t){case"L":r=dS;break;case"T":r=fS;break;case"R":r=cS;break;case"B":r=gS;break;case"BR":r=vS;break;case"BL":r=pS;break;case"TR":r=mS;break;case"TL":r=yS;break;default:r=qe}return r}}),tt(qe.prototype,{direction:null,compute:function(t){this.childAreas=t,this.computeRelativePosition(this.root,t)},getHeight:function(t,e){return this.getTHeight(t)+this.getBHeight(t)+this.getLRHeight()},getWidth:function(t,e){var r=Math.max(t.T.width,t.B.width)/2,i=Math.max(this.getLWidth(t,e)+e.width/2,r),n=Math.max(this.getRWidth(t,e)+e.width/2,r);return i+n},getLRHeight:function(){return Math.max(this.rootSize.height,this.siblings.L.height,this.siblings.R.height)},getTHeight:function(t){return t.T.height+this.getTXHeight(t)},getBHeight:function(t){return t.B.height+this.getBXHeight(t)},getXLRWidth:function(t,e){return this.getLWidth(t,e)+e.width+this.getRWidth(t,e)},getXRWidth:function(t,e){var r=Math.max(t.BR.width,t.TR.width);return r>0&&(r-=e.width/2),r},getTXHeight:function(t){var e=Math.max(t.TR.height,t.TL.height);return e>0&&(e+=this.firstChildGap),e},getBXHeight:function(t){var e=Math.max(t.BR.height,t.BL.height);return e>0&&(e+=this.firstChildGap),e},getXLWidth:function(t,e){var r=Math.max(t.BL.width,t.TL.width);return r>0&&(r-=e.width/2),r},getRWidth:function(t,e){return Math.max(t.R.width,this.getXRWidth(t,e))},getLWidth:function(t,e){return Math.max(t.L.width,this.getXLWidth(t,e))},getTBOverlap:function(t,e){var r=Math.max(t.T.width,t.B.width);return r>0&&(r-=e.width,r/=2),r},getRootDX:function(t,e){var r=this.getTBOverlap(t,e),i=Math.max(this.getLWidth(t,e),r);return i-=Math.max(this.getRWidth(t,e),r),i/2},getMinimalGap:function(t){return Math.min(t.siblingGap,this.firstChildGap,this.parentGap)},getBBox:function(t){var e=We(this),r=t&&t.expandBy;return r&&e.moveAndExpand({x:-r,y:-r,width:r*2,height:r*2}),e},containsPoint:function(t,e){return this.getBBox(e).containsPoint(t)},getLayoutSiblings:function(t){return this.siblings[t]},getExtendedWidth:function(){return this.width+this.gap+this.rootOffset},getExtendedHeight:function(){return this.height+this.gap+this.rootOffset},findMinimalAreaByPoint:function(t,e){if(!this.containsPoint(t,e))return null;var r;return this.childAreas.some(function(i){return r=i.findMinimalAreaByPoint(t,e),!!r}),r||this},getType:function(){return Object.keys(this.siblings).reduce(function(t,e){var r=this.siblings[e];return r.exists()?t.concat(e):t}.bind(this),[]).sort().join("-")},getRootAttributes:function(t,e){var r={rootOffset:t.get(e.offset||"offset")||0,rootMargin:t.get(e.margin||"margin")||0,prevSiblingGap:t.get(e.prevSiblingGap||"prevSiblingGap")||0,nextSiblingGap:t.get(e.nextSiblingGap||"nextSiblingGap")||0},i=t.get(e.siblingRank||"siblingRank");Nt(i)&&(r.siblingRank=i);var n=t.get(e.firstChildGap||"firstChildGap");return Nt(n)&&(r.firstChildGap=n),r},getRootSize:function(t,e){var r=t.size();return r[this.marginDimension]+=e,r},createSiblings:function(t,e){var r=To(t,"direction");return{L:new sS(r.L,this,e),T:new uS(r.T,this,e),R:new lS(r.R,this,e),B:new hS(r.B,this,e),BR:new uv(r.BR,this,e),BL:new hv(r.BL,this,e),TR:new cv(r.TR,this,e),TL:new dv(r.TL,this,e)}},computeSize:function(t,e){return{width:this.getWidth(t,e),height:this.getHeight(t,e)}},computeOrigin:function(){var t=this.siblings,e=this.rootSize,r=Math.max(this.getLWidth(t,e)+e.width/2,this.getXLWidth(t,e)+e.width/2,t.T.width/2,t.B.width/2);return{x:this.rootCX-r,y:this.rootCY-this.getTHeight(t)-this.getLRHeight()/2}},moveSiblings:function(t,e){if(this.hasHorizontalSiblings(t)){var r=e.width/2;t.L.move(-r,0),t.R.move(r,0)}if(this.hasVerticalSiblings(t)){var i=this.getLRHeight()/2;t.T.move(0,-i),t.B.move(0,i),t.BR.move(0,i),t.BL.move(0,i),t.B.move(0,this.getBXHeight(t)),t.TR.move(0,-i),t.TL.move(0,-i),t.T.move(0,-this.getTXHeight(t))}},moveRootToConnectionPoint:function(t){var e=this.getConnectionPoint(t);this.dx+=e.x,this.dy+=e.y},computeRelativePosition:function(t,e){var r=this.siblings=this.createSiblings(e,{siblingGap:this.siblingGap}),i=this.rootSize=this.getRootSize(t,this.rootMargin);tt(this,this.computeSize(r,i)),this.moveSiblings(r,i),this.moveRootToConnectionPoint(i),this.moveRootBehindSiblings(r,i),this.moveRootFromParent()},computeAbsolutePosition:function(){if(this.parentArea)this.rootCX=this.parentArea.rootCX+this.dx,this.rootCY=this.parentArea.rootCY+this.dy,this.level=this.parentArea.level+1;else{var t=this.root.getBBox().center();this.rootCX=t.x,this.rootCY=t.y,this.level=0}tt(this,this.computeOrigin())},hasVerticalSiblings:function(t){return t.T.exists()||t.B.exists()||t.BR.exists()||t.BL.exists()||t.TR.exists()||t.TL.exists()},hasHorizontalSiblings:function(t){return t.L.exists()||t.R.exists()},isSourceArea:function(){return!this.parentArea},isSinkArea:function(){return this.childAreas.length===0},getRootPosition:function(){var t=this.root.get("size");return{x:this.rootCX-t.width/2,y:this.rootCY-t.height/2}},getRootVertices:function(t,e){if(e=e||{},t=t||this,t[this.deltaCoordinate]===0||!this.parentArea)return[];var r=this.parentArea.getInnerSize(),i;if(!e.ignoreSiblings&&this.hasSiblingsBetweenParent()){var n=this.siblings[this.oppositeDirection];i=this.getRelativeVerticesAvoidingSiblings(r,t,n)}else i=this.getRelativeVertices(r,t);return me(i,"offset",this.parentArea.rootCX,this.parentArea.rootCY)},getInnerSize:function(){return{width:this.rootSize.width,height:this.getLRHeight()}},getConnectionPoint:function(){return null},getRelativeVertices:function(){return null},moveRootFromParent:function(){},moveRootBehindSiblings:function(){},hasSiblingsBetweenParent:function(){return!this.isSourceArea()&&this.siblings[this.oppositeDirection].exists()},getCY:function(){return this.height/2+this.prevSiblingGap},getCX:function(){return this.width/2+this.prevSiblingGap}}),qe.extend=d.Model.extend;var cS=qe.extend({direction:"R",oppositeDirection:"L",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(t){return Bt(t.width/2,0)},moveRootBehindSiblings:function(t,e){this.dx+=Math.max(this.getLWidth(t,e),this.getTBOverlap(t,e)),this.dy+=(this.getTHeight(t)-this.getBHeight(t))/2},moveRootFromParent:function(){this.dx+=this.parentGap+this.rootOffset},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=this.parentGap/2;return[r.clone().offset(i,0),r.clone().offset(i,e.dy)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=this.getConnectionPoint(t),n=r.siblingGap/2,a=this.dx>0?-1:1,o=e.dy+a*(r.height+n)/2,s=e.dy+a*this.rootSize.height/4,l=this.gap/2,u=1.5*l+Math.max(this.getLWidth(this.siblings,this.rootSize),this.getTBOverlap(this.siblings,this.rootSize));return[i.clone().offset(l,0),i.clone().offset(l,o),i.clone().offset(u,o),i.clone().offset(u,s)]}}),dS=qe.extend({direction:"L",oppositeDirection:"R",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(t){return Bt(-t.width/2,0)},moveRootBehindSiblings:function(t,e){this.dx-=Math.max(this.getRWidth(t,e),this.getTBOverlap(t,e)),this.dy+=(this.getTHeight(t)-this.getBHeight(t))/2},moveRootFromParent:function(){this.dx-=this.parentGap+this.rootOffset},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=-this.parentGap/2;return[r.clone().offset(i,0),r.clone().offset(i,e.dy)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=this.getConnectionPoint(t),n=this.dx>0?-1:1,a=e.dy+n*(r.height+r.siblingGap/2)/2,o=e.dy+n*this.rootSize.height/4,s=this.gap/2,l=1.5*s+Math.max(this.getRWidth(this.siblings,this.rootSize),this.getTBOverlap(this.siblings,this.rootSize));return[i.clone().offset(-s,0),i.clone().offset(-s,a),i.clone().offset(-l,a),i.clone().offset(-l,o)]}}),fS=qe.extend({direction:"T",oppositeDirection:"B",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(t){return Bt(0,-t.height/2)},moveRootBehindSiblings:function(t,e){this.dx+=this.getRootDX(t,e),this.hasHorizontalSiblings(t)&&(this.dy-=(this.getLRHeight()-e.height)/2),this.dy-=this.getBHeight(t)},moveRootFromParent:function(){this.dy-=this.parentGap+this.rootOffset},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=-this.getTXHeight(this.parentArea.siblings)-this.parentGap/2;return[r.clone().offset(0,i),r.clone().offset(e.dx,i)]},getRelativeVerticesAvoidingSiblings:function(t,e){var r=this.getConnectionPoint(t),i=this.siblings,n=i.B,a=this.getTXHeight(this.parentArea.siblings)+this.parentGap/2,o=a+n.height;o+=this.getBXHeight(this.siblings)+this.parentGap/4;var s=this.dy<0?-1:1,l=i[s>0?"BR":"BL"].width,u=e.dx;u+=s*(Math.max(l,n.width/2)+n.siblingGap/4);var g=e.dx+s*this.rootSize.width/4;return[r.clone().offset(0,-a),r.clone().offset(u,-a),r.clone().offset(u,-o),r.clone().offset(g,-o)]}}),gS=qe.extend({direction:"B",oppositeDirection:"T",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(t){return Bt(0,t.height/2)},moveRootBehindSiblings:function(t,e){this.dx+=this.getRootDX(t,e),this.dy+=this.getTHeight(t),this.hasHorizontalSiblings(t)&&(this.dy+=(this.getLRHeight()-e.height)/2)},moveRootFromParent:function(){this.dy+=this.parentGap+this.rootOffset},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2;return[r.clone().offset(0,i),r.clone().offset(e.dx,i)]},getRelativeVerticesAvoidingSiblings:function(t,e){var r=this.getConnectionPoint(t),i=this.siblings,n=i.T,a=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2,o=a+n.height;o+=this.getTXHeight(i)+this.parentGap/4;var s=this.dy<0?-1:1,l=i[s>0?"TR":"TL"].width,u=e.dx;u+=s*(Math.max(l,n.width/2)+n.siblingGap/4);var g=e.dx+s*this.rootSize.width/4;return[r.clone().offset(0,a),r.clone().offset(u,a),r.clone().offset(u,o),r.clone().offset(g,o)]}}),vS=qe.extend({direction:"BR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(t){return Bt(0,t.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(t,e){var r=Math.max(t.T.width,t.B.width);this.dx+=Math.max(this.getLWidth(t,e),(r-e.width)/2),this.dy+=this.getTHeight(t),this.hasHorizontalSiblings(t)&&(this.dy+=(this.getLRHeight()-e.height)/2)},moveRootFromParent:function(){var t=this.parentArea;t&&(this.dy+=t.firstChildGap),this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=e.dx,n=e.dy,a=t.width,o=t.height,s;return n-o/2<0?s=(a/2+(i-this.rootSize.width/2))/2:s=0,[r.clone().offset(s,n-o/2)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=e.dx-this.rootSize.width/4,n=e.dy;return n+=Math.max(r.height,this.rootSize.height)/2,n+=this.getMinimalGap(r)/2,[Bt(0,n),Bt(i,n)]}}),pS=qe.extend({direction:"BL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(t){return Bt(0,t.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(t,e){var r=Math.max(t.T.width,t.B.width);this.dx-=Math.max(this.getRWidth(t,e),(r-e.width)/2),this.dy+=this.getTHeight(t),this.hasHorizontalSiblings(t)&&(this.dy+=(this.getLRHeight()-e.height)/2)},moveRootFromParent:function(){var t=this.parentArea;t&&(this.dy+=t.firstChildGap),this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=e.dx,n=e.dy,a=t.width,o=t.height,s;return n-o/2<0?s=(-a/2+(i+this.rootSize.width/2))/2:s=0,[r.clone().offset(s,n-o/2)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=e.dx+this.rootSize.width/4,n=e.dy;return n+=Math.max(r.height,this.rootSize.height)/2,n+=this.getMinimalGap(r)/2,[Bt(0,n),Bt(i,n)]}}),mS=qe.extend({direction:"TR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(t){return Bt(0,t.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(t,e){this.dx+=Math.max(this.getLWidth(t,e),this.getTBOverlap(t,e)),this.dy-=this.getBHeight(t),this.hasHorizontalSiblings(t)&&(this.dy-=(this.getLRHeight()-e.height)/2)},moveRootFromParent:function(){var t=this.parentArea;t&&(this.dy-=t.firstChildGap),this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=e.dx,n=e.dy,a=t.width,o=t.height,s;return n+o/2>0?s=(a/2+(i-this.rootSize.width/2))/2:s=0,[r.clone().offset(s,n-o/2)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=e.dx-this.rootSize.width/4,n=e.dy;return n-=Math.max(r.height,this.rootSize.height)/2,n-=this.getMinimalGap(r)/2,[Bt(0,n),Bt(i,n)]}}),yS=qe.extend({direction:"TL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(t){return Bt(0,t.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(t,e){this.dx-=Math.max(this.getRWidth(t,e),this.getTBOverlap(t,e)),this.dy-=this.getBHeight(t),this.hasHorizontalSiblings(t)&&(this.dy-=(this.getLRHeight()-e.height)/2)},moveRootFromParent:function(){var t=this.parentArea;t&&(this.dy-=t.firstChildGap),this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(t,e){var r=this.getConnectionPoint(t),i=e.dx,n=e.dy,a=t.width,o=t.height,s;return n+o/2>0?s=(-a/2+(i+this.rootSize.width/2))/2:s=0,[r.clone().offset(s,n-o/2)]},getRelativeVerticesAvoidingSiblings:function(t,e,r){var i=e.dx+this.rootSize.width/4,n=e.dy;return n-=Math.max(r.height,this.rootSize.height)/2,n-=this.getMinimalGap(r)/2,[Bt(0,n),Bt(i,n)]}}),gv={rotate:function(t){var e="LRBT",r=e.indexOf(t[0])-e.indexOf(t[1]);return function(i){var n=e.indexOf(i);return n>=0?e[(4+n-r)%4]:i}},flip:function(t){var e=t[0],r=t[1];return function(i){return i===e?r:i===r?e:i}},straighten:function(t){return function(){return t[1]}}},bS=d.Model.extend({defaults:{graph:void 0,gap:20,parentGap:20,siblingGap:20,firstChildGap:20,direction:"R",directionRule:gv.straighten,updatePosition:function(t,e,r){t.set("position",e,r)},updateVertices:function(t,e,r){t.set("vertices",e,r)},updateAttributes:null,filter:null,attributeNames:{}},initialize:function(){this._cacheOptions(this.attributes),this.layoutAreas={}},layout:function(t){this.layoutAreas={};for(var e=this.getGraphSources(t),r=0,i=e.length;r<i;r++)this.layoutTree(e[r],t);return this.trigger("layout:done",t),this},layoutTree:function(t,e){e=e||{},e.treeLayout=!0;var r=this._computeLayoutAreas(t,null,e);return this._computeAbsolutePositions(r),this._updateCells(r,e),this},getLayoutBBox:function(){return this.getRootLayoutAreas().reduce(function(t,e){var r=e.getBBox();return t?t.union(r):r},null)},getLayoutArea:function(t){return this.layoutAreas[t.id||t]||null},getRootLayoutAreas:function(){return this.getGraphSources().map(this.getLayoutArea,this)},getGraphSources:function(t){var e=this.graph.getSources();return this.filter&&e.length>0&&(e=this.filter(e,null,t)||e),e},getMinimalRootAreaByPoint:function(t){var e=this.getRootLayoutAreas().filter(function(r){return r.containsPoint(t)});return je(e)?null:e.reduce(function(r,i){return i.width*i.height<r.min&&(r.min=i.width*i.height,r.item=i),r},{min:1/0,item:void 0}).item},_computeLayoutAreas:function(t,e,r){var i=e?e.direction:this.get("direction"),n=t.get(this.getAttributeName("direction"))||i,a=qe.create(n,t,this.attributes);a.parentArea=e,a.link=this.graph.getConnectedLinks(t,{inbound:!0})[0];var o=this._getChildren(t,r);this.layoutAreas[t.id]=a;for(var s=[],l=0,u=o.length;l<u;l++)s.push(this._computeLayoutAreas(o[l],a,r));return a.compute(s),a},_cacheOptions:function(t){var e=["updateAttributes","updateVertices","updatePosition","filter"];e.forEach(function(r){this[r]=yt(t[r])?t[r]:null},this),this.graph=t.graph},_getChildren:function(t,e){if(this.layoutAreas[t.id])return[];var r=this.graph.getNeighbors(t,{outbound:!0});return this.filter&&r.length>0&&(r=this.filter(r,t,e)||r),r},_computeAbsolutePositions:function(t){t.computeAbsolutePosition(t);for(var e=0,r=t.childAreas.length;e<r;e++)this._computeAbsolutePositions(t.childAreas[e])},_updateCells:function(t,e){var r=t.root,i=t.link||null;i&&(this.updatePosition&&this.updatePosition(r,t.getRootPosition(),e),this.updateVertices&&this.updateVertices(i,t.getRootVertices(),e)),this.changeSiblingRank(r,t.siblingRank,e),this.updateAttributes&&this.updateAttributes(t,r,i,e);for(var n=0,a=t.childAreas.length;n<a;n++)this._updateCells(t.childAreas[n],e)},updateDirections:function(t,e,r){r=r||{};var i=this.getAttributeName("direction"),n=this.get("directionRule")(e);this.graph.search(t,function(a,o){if(o!==0){var s=n(a.get(i));this.changeDirection(a,s,r)}}.bind(this),{outbound:!0})},reconnectElement:function(t,e,r){r=r||{};var i=this.getLayoutArea(t),n=i.link;if(n){n.set("source",{id:e.id||e},r);var a=i.direction,o=r.direction||a,s=r.siblingRank||void 0;return this.changeSiblingRank(t,s,r),this.changeDirection(t,o,r),a!==o&&this.updateDirections(t,[a,r.direction],r),!0}return!1},changeSiblingRank:function(t,e,r){t.set(this.getAttributeName("siblingRank"),e,r)},changeDirection:function(t,e,r){t.set(this.getAttributeName("direction"),e,r)},getAttributeName:function(t){return this.get("attributeNames")[t]||t},getAttribute:function(t,e){return t.get(this.getAttributeName(e))},prepare:function(){return this}},{directionRules:gv}),tr={TopBottom:"TB",BottomTop:"BT",LeftRight:"LR",RightLeft:"RL"},Ca={Start:"start",Middle:"middle",End:"end"},wS=function(t,e,r){var i=e.size,n=e.position;if(i){var a=i.width,o=i.height;t.resize(a,o,r)}if(n){var s=n.x,l=n.y;t.position(s,l,r)}},Le={Directions:tr,Alignments:Ca,layout:function(t,e){e===void 0&&(e={});var r=e.direction;r===void 0&&(r=tr.TopBottom);var i=e.topLeft,n=e.bottomLeft,a=e.topRight,o=e.bottomRight,s=e.stackGap;s===void 0&&(s=10);var l=e.stackElementGap;l===void 0&&(l=10);var u=e.stackSize;u===void 0&&(u=100);var g=e.stackCount,h=e.setAttributes;h===void 0&&(h=wS);var y=e.alignment;y===void 0&&(y=Ca.Middle);var x=e.stackIndexAttributeName;x===void 0&&(x="stackIndex");var C=e.stackElementIndexAttributeName;C===void 0&&(C="stackElementIndex");var p,E,k;t instanceof Ie?(E=t.getElements(),k=t):(E=t,E[0]&&(k=E[0].graph)),g?p=Array(g).fill(null).map(function(){return Array()}):p=[],E.forEach(function(Y){var X=Y.get(x)||0;p[X]||(p[X]=[]),p[X].push(Y)});var w=r===tr.TopBottom||r===tr.BottomTop,S=r===tr.LeftRight||r===tr.RightLeft,T=p.length,m,A;w&&(m=p.reduce(function(Y,X){return Math.max(Y,X.reduce(function(J,Q){return J+Q.size().height},0)+(X.length-1)*l)},0),A=T*u+(T-1)*s),S&&(A=p.reduce(function(Y,X){return Math.max(Y,X.reduce(function(J,Q){return J+Q.size().width},0)+(X.length-1)*l)},0),m=T*u+(T-1)*s);for(var M=function(){return i?new at(i.x,i.y,A,m):a?new at(a.x-A,a.y,A,m):n?new at(n.x,n.y-m,A,m):o?new at(o.x-A,o.y-m,A,m):new at(0,0,A,m)},N=M(),D=N.topLeft(),z=[],_=0;_<p.length;_++)p[_]=Fe(p[_],function(Y){return Y.get(C)||0}),w&&(z.push({bbox:new at(D.x,D.y,u,m),elements:p[_],index:_}),D.x+=u+s),S&&(z.push({bbox:new at(D.x,D.y,A,u),elements:p[_],index:_}),D.y+=u+s);k&&k.startBatch("layout");for(var j=0;j<z.length;j++){var V=z[j];if(V.elements.length){var W=V.bbox.topLeft();r===tr.BottomTop&&(W.y+=V.bbox.height),r===tr.RightLeft&&(W.x+=V.bbox.width),V.elements.forEach(function(Y){var X=Y.size();r===tr.BottomTop&&(W.y-=X.height),r===tr.RightLeft&&(W.x-=X.width);var J=W.toJSON();switch(y){case Ca.Middle:{w?J.x+=(u-X.width)/2:J.y+=(u-X.height)/2;break}case Ca.End:{w?J.x+=u-X.width:J.y+=u-X.height;break}}h(Y,{position:J},e),r===tr.BottomTop&&(W.y-=l),r===tr.TopBottom&&(W.y+=X.height+l),r===tr.RightLeft&&(W.x-=l),r===tr.LeftRight&&(W.x+=X.width+l)})}}return k&&k.stopBatch("layout"),{bbox:N,stacks:z}}},xS={__proto__:null,ForceDirected:aS,GridLayout:gs,TreeLayout:bS,StackLayout:Le},AS=ls.extend({name:"swimlane-boundary",tagName:"rect",options:{padding:10,laneId:""},update:function(){var t=this,e=t.vel,r=t.relatedView,i=t.options,n=r.model,a=n.angle(),o=n.getBBox().center(),s=this.getBoundaryBBox(n,i.laneId,i.padding);return s===null?e.attr({width:0,height:0}):(e.attr(s.toJSON()),e.rotate(a,o.x,o.y,{absolute:!0})),this},getBoundaryBBox:function(t,e,r){var i=he(r),n=i.left,a=i.top,o=i.right,s=i.bottom,l=t.getLaneBBox(e);return l===null?null:(l.moveAndExpand({x:-n,y:-a,width:n+o,height:a+s}),l.width<0&&(l.width=0),l.height<0&&(l.height=0),l)}}),Br=function(t,e,r){this.top=t.topLine().rotate(e,-r),this.left=t.leftLine().rotate(e,-r),this.right=t.rightLine().rotate(e,-r),this.bottom=t.bottomLine().rotate(e,-r)};Br.inflatedOnSide=function(t,e,r,i,n){var a=new Br(t,e,r),o=a.getLine(n);switch(n){case"top":case"right":a[n]=o.parallel(-i);break;case"bottom":case"left":a[n]=o.parallel(i);break}return a},Br.prototype={getLine:function(t){switch(t){case"top":return this.top;case"right":return this.right;case"bottom":return this.bottom;case"left":return this.left}},isPointOnLine:function(t,e){var r=Math.round(this.getLine(e).closestPoint(t).distance(t));return r===0},isPointToTheLeftOfLine:function(t,e){var r=Math.round(this.getLine(e).pointOffset(t));switch(e){case"top":case"right":return r>0;case"bottom":case"left":return r<0}},isPointToTheRightOfLine:function(t,e){var r=Math.round(this.getLine(e).pointOffset(t));switch(e){case"top":case"right":return r<0;case"bottom":case"left":return r>0}},isPointInside:function(t){var e=this.isPointToTheLeftOfLine(t,"top"),r=this.isPointToTheLeftOfLine(t,"right"),i=this.isPointToTheLeftOfLine(t,"bottom"),n=this.isPointToTheLeftOfLine(t,"left");return n&&e&&r&&i},isPointInsideOrOnLine:function(t){var e=this.isPointInside(t),r=this.isPointOnLine(t,"top"),i=this.isPointOnLine(t,"right"),n=this.isPointOnLine(t,"bottom"),a=this.isPointOnLine(t,"left");return e||r||i||n||a},findClosestPointToLine:function(t,e){var r=this,i=new Z,n=1/0;return t.forEach(function(a){var o=r.getDistanceFromLineToPoint(a,e);o<n&&(i.update(a.x,a.y),n=o)}),i},findFurthestPointFromLine:function(t,e){var r=this,i=new Z,n=-1/0;return t.forEach(function(a){var o=r.getDistanceFromLineToPoint(a,e);o>n&&(i.update(a.x,a.y),n=o)}),i},getDistanceFromLineToPoint:function(t,e){var r=this.getLine(e),i=this.isPointToTheRightOfLine(t,e)?1:-1,n=Math.abs(r.pointOffset(t))*i;return Math.round(n)}};var vv=Vg.SegmentHandle.extend({className:"swimlane-transform-handle",children:[{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#3498db",stroke:"#FFFFFF","stroke-width":2}}],position:function(t,e,r){var i=this.childNodes.handle,n=F.createSVGMatrix().translate(t,e).rotate(r);i.setAttribute("transform",F.matrixToTransformString(n)),i.setAttribute("cursor",r%180===0?"row-resize":"col-resize")}}),xe={Top:"top",Right:"right",Bottom:"bottom",Left:"left"},vi={X:"x",Y:"y"},CS=yr.extend({name:"swimlane-transform",options:{laneId:void 0,minSize:30,padding:10,stopPropagation:!0,constraintsPadding:10,handleClass:vv,minSizeConstraints:void 0,maxSizeConstraints:void 0},handles:null,minConstraintPoints:null,maxConstraintPoints:null,initialize:function(){var t=this,e=this.options;e.minSizeConstraints===void 0&&(e.minSizeConstraints=function(r,i,n){return t.getMinConstraintsToEmbeds(r,i,n)}),e.maxSizeConstraints===void 0&&(e.maxSizeConstraints=function(r,i,n){return t.getMaxConstraintsToEmbeds(r,i,n)})},update:function(){return this.render(),this},onRender:function(){return this.removeHandles(),this.doesLaneExist()&&this.renderHandles(),this},onRemove:function(){this.removeHandles()},doesLaneExist:function(){return this.relatedView.model.getLaneBBox(this.options.laneId)!==null},removeHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),!!Array.isArray(t))for(var e=0;e<t.length;e++)t[e].remove()},renderHandles:function(){var t=this,e=this.getHandlesPositionInfo();e.forEach(function(r){var i=t.renderHandle(r);t.simulateRelatedView(i.el),t.handles.push(i)})},getHandlesPositionInfo:function(){var t=this,e=t.options,r=t.relatedView,i=e.laneId,n=r.model,a=n.angle(),o=n.getBBox().center(),s=this.getHandlesBoundaryBBox(n,i,e.padding);return[{position:s.topMiddle().rotate(o,-a),axis:vi.Y,side:xe.Top},{position:s.leftMiddle().rotate(o,-a),axis:vi.X,side:xe.Left},{position:s.rightMiddle().rotate(o,-a),axis:vi.X,side:xe.Right},{position:s.bottomMiddle().rotate(o,-a),axis:vi.Y,side:xe.Bottom}]},getHandlesBoundaryBBox:function(t,e,r){var i=he(r),n=i.left,a=i.top,o=i.right,s=i.bottom,l=t.getLaneBBox(e).moveAndExpand({x:-n,y:-a,width:n+o,height:a+s});return l.width<0&&(l.width=0),l.height<0&&(l.height=0),l},renderHandle:function(t){var e=this,r=new this.options.handleClass({paper:this.paper,axis:t.axis,side:t.side,guard:function(i){return e.guard(i)}});return r.render(),r.vel.appendTo(this.el),this.updateHandlePosition(r,t.position),this.startHandleListening(r),r},updateHandlePosition:function(t,e){var r=this.relatedView.model.angle();t.options.axis===vi.X&&(r+=90),t.position(e.x,e.y,r)},startHandleListening:function(t){this.listenTo(t,"change:start",this.onHandleChangeStart),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"change:end",this.onHandleChangeEnd)},onHandleChangeStart:function(t,e){var r=t.options.side,i=this,n=i.options,a=i.handles,o=i.relatedView,s=o.model,l=o.paper;!Array.isArray(a)||(this.hideNonSelectedHandles(a,t),this.updateConstraintPoints(r),this.focus(),s.startBatch("lane-resize",{ui:!0,tool:this.cid}),n.stopPropagation||o.notifyPointerdown.apply(o,l.getPointerArgs(e)))},hideNonSelectedHandles:function(t,e){t.forEach(function(r){return r===e?r.show():r.hide()})},updateConstraintPoints:function(t){var e=this,r=e.relatedView,i=e.options,n=i.laneId,a=r.model,o=i.minSizeConstraints,s=i.maxSizeConstraints,l,u;yt(o)&&(l=o(a,n,t)),yt(s)&&(u=s(a,n,t)),this.minConstraintPoints=Array.isArray(l)?l.map(function(g){return new Z(g)}):[],this.maxConstraintPoints=Array.isArray(u)?u.map(function(g){return new Z(g)}):[]},onHandleChanging:function(t,e){var r=this,i=r.options,n=r.relatedView,a=n.model,o=n.paper,s=i.laneId,l=i.stopPropagation,u=a.getBBox(),g=a.angle(),h=u.center(),y=t.options,x=y.axis,C=y.side,p=this.getHandlesPositionInfo().find(function(D){return D.side===C}).position,E=ot(e),k=o.snapToGrid(E.clientX,E.clientY),w=k.clone().rotate(h,g).round(),S=p.clone().rotate(h,g).round(),T=w.difference(S),m=T.y!==0,A=T.x!==0;if(x===vi.Y&&m){var M=C===xe.Top?-T.y:T.y;this.updateLaneHeight(s,M,C,u,g)}else if(x===vi.X&&A){var N=C===xe.Left?-T.x:T.x;this.updateLaneWidth(s,N,a,C,u,g)}this.updateHandlePosition(t,p),l||n.notifyPointermove(E,k.x,k.y)},onHandleChangeEnd:function(t,e){var r=this,i=r.options,n=r.relatedView,a=n.paper,o=n.model,s=ot(e),l=a.snapToGrid(s.clientX,s.clientY),u=l.x,g=l.y;this.render(),this.blur(),o.stopBatch("lane-resize",{ui:!0,tool:this.cid}),i.stopPropagation||n.notifyPointerup(s,u,g),n.checkMouseleave(s)},updateLaneHeight:function(t,e,r,i,n){var a=this,o=this.relatedView.model,s=o.metrics.lanes,l=de(o.prop("lanes")),u=this.getNeighbourLanesIds(s,t,r),g=this.getSublanesAndMostEmbeddedLaneId(s,t,r),h=u.foundNeighbourLaneId===void 0,y=[u.foundNeighbourLaneId].concat(u.sublaneIds),x=[t].concat(g.sublaneIds,u.laneIdsPathToNeighbour);e=this.getDiffWithinConstraints(t,e,r,i.center(),n),e=this.getDiffWithinLaneSizeLimits(o,e,g.mostEmbeddedLaneId,u.mostEmbeddedLaneId),x.forEach(function(C){return a.addSizeToLane(o,l,C,e)}),h?this.resizeShape(o,i.width,i.height+e,r):y.forEach(function(C){return a.addSizeToLane(o,l,C,-e)}),o.prop("lanes",l,{ui:!0,tool:this.cid,autoResize:!1})},getSublanesAndMostEmbeddedLaneId:function(t,e,r){var i=this.getIdsOfClosestSublanesToTheSide(t,e,r),n=i[0]||e;return{sublaneIds:i,mostEmbeddedLaneId:n}},getOppositeHandleSide:function(t){switch(t){case xe.Top:return xe.Bottom;case xe.Right:return xe.Left;case xe.Bottom:return xe.Top;case xe.Left:return xe.Right}},getNeighbourLanesIds:function(t,e,r){var i=this.getOppositeHandleSide(r),n=this.findNeighbourLane(t,e,r),a=n.foundNeighbourLaneId,o=n.laneIdsPathToNeighbour,s=this.getIdsOfClosestSublanesToTheSide(t,a,i),l=s[0]||a;return{foundNeighbourLaneId:a,laneIdsPathToNeighbour:o,sublaneIds:s,mostEmbeddedLaneId:l}},addSizeToLane:function(t,e,r,i){var n=this.getLaneBBoxHeight(t,r),a=n+i,o=t.getLanePath(r);o.push("size"),Yr({lanes:e},o,a)},updateLaneWidth:function(t,e,r,i,n,a){e=this.getDiffWithinConstraints(t,e,i,n.center(),a);var o=r.getMinimalSize().width,s=Math.max(n.width+e,o);this.resizeShape(r,s,n.height,i)},resizeShape:function(t,e,r,i){t.resize(e,r,{ui:!0,tool:this.cid,direction:i})},getLaneBBoxHeight:function(t,e){return t.getLaneBBox(e).height},getDiffWithinLaneSizeLimits:function(t,e,r,i){var n=Math.sign(e),a=i!==void 0,o=this.getLaneBBoxHeight(t,r),s=a?this.getLaneBBoxHeight(t,i):1/0,l=o+e,u=s-e,g=this.getMinSize();return l<g?e=(o-g)*n:u<g&&(e=(s-g)*n),Math.round(e)},getMinSize:function(){var t=this.options.minSize,e=this.options.constraintsPadding*2;return e>t&&(t=e),t},getDiffWithinConstraints:function(t,e,r,i,n){var a=this.relatedView.model,o=a.getLaneBBox(t),s=this.getConstraintPaddingRelativeToHandleSide(e),l=Br.inflatedOnSide(o,i,n,s,r),u=Br.inflatedOnSide(o,i,n,e+s,r),g=this.getMaxConstraintPointsInsideLane(u),h=this.getMinConstraintPointsOutsideLane(u,r);if(g.length>0){var y=l.findClosestPointToLine(g,r);e=l.getDistanceFromLineToPoint(y,r)}else if(h.length>0){var x=l.findFurthestPointFromLine(h,r);e=l.getDistanceFromLineToPoint(x,r)}return e},getConstraintPaddingRelativeToHandleSide:function(t){var e=t<0?-1:1;return this.options.constraintsPadding*e},getMaxConstraintPointsInsideLane:function(t){return this.maxConstraintPoints.filter(function(e){return t.isPointInside(e)})},getMinConstraintPointsOutsideLane:function(t,e){return this.minConstraintPoints.filter(function(r){var i=t.isPointToTheRightOfLine(r,e),n=t.isPointOnLine(r,e);return i||n})},findNeighbourLane:function(t,e,r){for(var i=[],n=r===xe.Top,a=void 0,o=e;o;){var s=t[o],l=s.parentId,u=s.laneIndexWithinGroup,g=n?u===0:u===s.parentSublanesCount-1;if(g)l&&i.push(l),o=l;else{var h=n?u-1:u+1;a=this.getSublaneIdOfParent(t,l,h);break}}return{foundNeighbourLaneId:a,laneIdsPathToNeighbour:i.reverse()}},getSublaneIdOfParent:function(t,e,r){var i=Object.keys(t);return i.find(function(n){var a=t[n],o=a.parentId===e,s=a.laneIndexWithinGroup===r;return o&&s})},getIdsOfClosestSublanesToTheSide:function(t,e,r){for(var i=[],n=e;n;){var a=t[n],o=a.sublanesCount,s=r===xe.Top?0:o-1,l=n+"_"+s,u=t[l]!==void 0;u?(i.push(l),n=l):n=void 0}return i.reverse()},getMinConstraintsToEmbeds:function(t,e,r){var i=[],n=t.getBBox(),a=n.center(),o=t.angle(),s=t.getLaneBBox(e),l=new Br(s,a,o),u=t.getEmbeddedCells({deep:!0}),g=r===xe.Left||r===xe.Right,h=this.getEmbedPointsInsideLane(l,u,r);if(h.forEach(function(p){return i.push(p)}),g&&u.length>0){var y=this.findLeftMostAndRightMostEmbedPoints(t,l,u),x=y.leftMostPoint,C=y.rightMostPoint;i.push(x),i.push(C)}return i},getMaxConstraintsToEmbeds:function(t,e,r){var i=[],n=t.angle(),a=t.metrics.lanes,o=t.getBBox().center(),s=t.getEmbeddedCells({deep:!0}),l=this.findNeighbourLane(a,e,xe.Top).foundNeighbourLaneId,u=this.findNeighbourLane(a,e,xe.Bottom).foundNeighbourLaneId;if(l!==void 0){var g=t.getLaneBBox(l),h=new Br(g,o,n),y=this.getEmbedPointsInsideLane(h,s,r,{addOverflowingEmbedsOnlyOnHandleSide:!0});y.forEach(function(E){return i.push(E)})}if(u!==void 0){var x=t.getLaneBBox(u),C=new Br(x,o,n),p=this.getEmbedPointsInsideLane(C,s,r,{addOverflowingEmbedsOnlyOnHandleSide:!0});p.forEach(function(E){return i.push(E)})}return i},getEmbedPointsInsideLane:function(t,e,r,i){var n=this,a=[];return e.forEach(function(o){var s=o.angle(),l=o.getBBox(),u=l.center();if(!o.isLink()){var g=n.getBBoxCornerPoints(l,u,s),h=n.isElementInsideLane(t,g,u,r,i);h&&g.forEach(function(y){return a.push(y)})}}),a},isElementInsideLane:function(t,e,r,i,n){n===void 0&&(n={});var a=n.addOverflowingEmbedsOnlyOnHandleSide,o=t.isPointInsideOrOnLine(r);if(a){var s=this.getOppositeHandleSide(i),l=e.every(function(y){return t.isPointInsideOrOnLine(y)}),u,g=e.some(function(y){var x=t.isPointToTheLeftOfLine(y,s),C=t.isPointOnLine(y,s);return x||C}),h=e.some(function(y){return t.isPointToTheRightOfLine(y,s)});return u=g&&h,o&&(l||u)}return o},getBBoxCornerPoints:function(t,e,r){var i=t.topLeft().rotate(e,-r).round(),n=t.topRight().rotate(e,-r).round(),a=t.bottomLeft().rotate(e,-r).round(),o=t.bottomRight().rotate(e,-r).round();return[i,n,a,o]},findLeftMostAndRightMostEmbedPoints:function(t,e,r){var i=this,n=t.angle(),a=t.getBBox(),o=a.center(),s=new Br(a,o,n),l=[];r.forEach(function(y){if(!y.isLink()){var x=y.getBBox(),C=x.center(),p=y.angle();i.getBBoxCornerPoints(x,C,p).forEach(function(E){return l.push(E)})}});var u=s.findFurthestPointFromLine(l,xe.Left),g=this.getLeftMostPointCorrectedToPoolHeaders(t,u,s.left,e.left),h=s.findFurthestPointFromLine(l,xe.Right);return{leftMostPoint:g,rightMostPoint:h}},getLeftMostPointCorrectedToPoolHeaders:function(t,e,r,i){var n=this.getTotalLaneHeadersWidth(t),a=t.metrics.padding.left,o=i.pointOffset(r.start)-a-n,s=r.closestPoint(e),l=new dt(s,e),u=l.length()+o;return l.setLength(u),l.end},getTotalLaneHeadersWidth:function(t){var e=t.metrics.lanes,r=0;return Object.keys(e).forEach(function(i){for(var n=i,a=0;n;){var o=t.metrics.lanes[n];a+=o.headerSize||0,n=o.parentId}r=a>r?a:r}),r}},{TransformHandle:vv}),IS=yr.extend({name:"scroll-bar",tagName:"rect",options:{margin:2,width:8,rightAlign:!1},attributes:{fill:"#333",rx:4,ry:4,"fill-opacity":.4,cursor:"grab"},events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},onRender:function(){this.update()},update:function(){var t=this.getBBox();return t?(this.enable(),this.vel.attr(t.toJSON())):this.disable(),this},getTrackHeight:function(){var e=this,r=e.relatedView,i=e.options,n=r.model,a=n.metrics,o=a.padding,s=i.margin,l=o.top+o.bottom+2*Math.abs(s),u=n.attributes.size,g=u.height;return g-l},getScale:function(){var e=this,r=e.relatedView,i=r.model,n=i.metrics,a=i.attributes,o=n.minHeight,s=a.size,l=s.height,u=this.getTrackHeight(),g=u/(o-(l-u));return g},getBBox:function(){var t=this,e=t.relatedView,r=t.options,i=e.model;if(i.isEveryItemInView())return null;var n=i.metrics,a=i.attributes,o=a.size,s=o.width,l=n.padding,u=n.overflow,g=this.getTrackHeight();if(g<=0)return null;var h=r.margin,y=r.width,x=this.getScale(),C=g*x,p=a.position,E=p.x,k=p.y,w=k+Math.abs(h)+l.top,S=E;return r.rightAlign?(S+=s-h,h>=0&&(S-=y),u||(S-=l.right)):(S+=h,h<0&&(S-=y),u||(S+=l.left)),new at({x:S,y:w+x*i.getScrollTop(),width:y,height:C})},disable:function(){this.vel.attr("display","none")},enable:function(){this.vel.attr("display","")},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this,r=e.relatedView,i=r.model;i.startBatch("scroll-record",{ui:!0,tool:this.cid}),this.focus(),this.delegateDocumentEvents(null,{y:t.clientY,scrollTop:i.getScrollTop()}),r.paper.undelegateEvents()}},onPointerMove:function(t){var e=ot(t),r=e.data,i=r.y,n=r.scrollTop,a=r.lastScrollTop,o=this,s=o.relatedView,l=s.model,u=this.getScale(),g=n+(e.clientY-i)/u;a!==g&&(e.data.lastScrollTop=g,l.setScrollTop(g))},onPointerUp:function(){this.undelegateDocumentEvents(),this.paper.delegateEvents(),this.blur(),this.el.style.pointerEvents="",this.relatedView.model.stopBatch("scroll-record",{ui:!0,tool:this.cid})}}),SS={__proto__:null,SwimlaneBoundary:AS,SwimlaneTransform:CS,RecordScrollbar:IS},MS=d.Collection.extend({LOCAL_STORAGE_KEY:"joint.ui.Clipboard.cells",defaults:{useLocalStorage:!0,origin:"center",translate:{dx:20,dy:20}},constructor:function(t){d.Collection.prototype.constructor.call(this,[],t),this.defaults=tt({},this.defaults,t),this.cid=Ur()},copyElements:function(t,e,r){r=tt({},this.defaults,r);var i=Array.isArray(t)?t:t.toArray(),n=Fe(Object.values(e.cloneSubgraph(i,r)),function(a){return a.attributes.z||0});return this.reset(n),r.useLocalStorage&&window.localStorage&&localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(this.toJSON())),i},cutElements:function(t,e,r){r=tt({},this.defaults,r);var i=this.copyElements(t,e,r),n=r.removeCellOptions||{};return n.clipboard=this.cid,e.startBatch("cut"),me(i,"remove",n),e.stopBatch("cut"),i},pasteCells:function(t,e){var r=this;e=tt({},this.defaults,e),e.useLocalStorage&&this.updateFromStorage(t);var i=t.maxZIndex(),n=this.map(function(s){return i+=1,r.modifyCell(s,e,i)}),a=e.addCellOptions||{};a.clipboard=this.cid;var o=Fe(n,function(s){return s.isLink()?2:1});return t.startBatch("paste"),t.addCells(o,a),t.stopBatch("paste"),this.copyElements(this,t,e),o},pasteCellsAtPoint:function(t,e,r){var i=this;r=tt({},this.defaults,r),r.useLocalStorage&&this.updateFromStorage(t);var n=Fe(Object.values(t.cloneSubgraph(this.toArray(),r)),function(x){return x.attributes.z||0}),a=t.get("cells").cellNamespace,o=new Ie([],{cellNamespace:a});o.resetCells(n,{sort:!1});var s=this.getOriginPoint(n,o,r.origin);if(!s)return[];var l={dx:e.x-s.x,dy:e.y-s.y};r.translate=l;var u=t.maxZIndex(),g=this.map(function(x){return u+=1,i.modifyCell(x,r,u)}),h=r.addCellOptions||{};h.clipboard=this.cid;var y=Fe(g,function(x){return x.isLink()?2:1});return t.startBatch("paste"),t.addCells(y,h),t.stopBatch("paste"),this.copyElements(n,o,r),y},isEmpty:function(t){if(t=tt({},this.defaults,t),this.length>0)return!1;if(t.useLocalStorage){var e=this.getJSONFromStorage();if(e&&e.length)return!1}return!0},clear:function(t){t=tt({},this.defaults,t),this.reset([]),t.useLocalStorage&&window.localStorage&&localStorage.removeItem(this.LOCAL_STORAGE_KEY)},modifyCell:function(t,e,r){if(t.set("z",r),t.isLink()&&e.link&&t.set(e.link),e.translate){var i=e.translate,n=i.dx,a=i.dy;t.translate(isFinite(n)?n:0,isFinite(a)?a:0)}return t.collection=null,t},updateFromStorage:function(t){var e=this.getJSONFromStorage();if(!!e){var r={cells:e},i=t.get("cells").cellNamespace,n=new Ie([],{cellNamespace:i}).fromJSON(r,{sort:!1,dry:!0});this.reset(n.getCells())}},getJSONFromStorage:function(){return window.localStorage&&JSON.parse(localStorage.getItem(this.LOCAL_STORAGE_KEY))||null},getOriginPoint:function(t,e,r){var i=e.getCellsBBox(t);return i?di(i,r):null}}),xn=Xt.extend({className:"select-box",events:{"click .select-box-selection":"onToggle"},options:{options:[],width:void 0,openPolicy:"auto",target:null,keyboardNavigation:!0,selected:void 0,selectBoxOptionsClass:void 0,disabled:!1},init:function(){this.options.target=this.options.target||document.body,ke(this,"onOutsideClick","onOptionSelect"),f(document).on("click.selectBox",this.onOutsideClick),this.$el.data("view",this),this.options.selected===void 0?this.selection=lt(this.options.options).find(function(t){return t.selected===!0})||this.options.options[0]:this.selection=this.options.options[this.options.selected]},render:function(){return this.$el.empty(),this.$selection=null,this.renderSelection(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions();var t=this.options,e={selectBoxView:this,parentClassName:re(this,"className")||null,extraClassName:re(t,"selectBoxOptionsClass")||null,options:t.options};t.width&&(e.width=t.width),t.theme&&(e.theme=t.theme);var r=this.optionsView=new this.constructor.OptionsView(e);r.render(),this.listenTo(r,"option:select",this.onOptionSelect),this.listenTo(r,"option:hover",this.onOptionHover),this.listenTo(r,"options:mouseout",this.onOptionsMouseOut),this.$options=r.$el,this.$optionsArrow=r.$arrow,this.$target=f(t.target)},onOptionHover:function(t,e){this.trigger("option:hover",t,e)},onOptionsMouseOut:function(t){this.trigger("options:mouseout",t)},onOptionSelect:function(t,e){this.select(t,e)},removeOptions:function(){this.optionsView&&(this.stopListening(this.optionsView),this.optionsView.remove(),this.optionsView=null)},renderSelection:function(t){if(this.$selection||(this.$selection=f("<div/>",{class:"select-box-selection"}),this.$el.append(this.$selection)),this.$selection.empty(),t){var e=this.constructor.OptionsView.prototype.renderOptionContent.call(void 0,t);this.$selection.append(e)}else if(this.options.placeholder){var r=f("<div/>",{class:"select-box-placeholder",html:this.options.placeholder});this.$selection.append(r)}},onToggle:function(t){this.toggle()},onOutsideClick:function(t){!this.el.contains(t.target)&&this.$el.hasClass("opened")&&this.close()},getSelection:function(){return this.selection},getSelectionValue:function(t){return t=t||this.selection,t&&(t.value===void 0?t.content:t.value)},getSelectionIndex:function(){return lt(this.options.options).findIndex(function(t){return t===this.selection}.bind(this))},select:function(t,e){e===void 0&&(e={}),this.selection=this.options.options[t],this.renderSelection(this.selection),this.trigger("option:select",this.selection,t,e),this.close()},selectByValue:function(t,e){for(var r=this.options.options||[],i=0;i<r.length;i++){var n=r[i];if(n.value===void 0&&n.content===t)return this.select(i,e);if(n.value!==void 0&&ze(n.value,t))return this.select(i,e)}},isOpen:function(){return this.$el.hasClass("opened")},toggle:function(){this.isOpen()?this.close():this.open()},position:function(){var t=this.$(".select-box-selection"),e=t.outerHeight(),r=t.offset(),i=r.left,n=r.top,a=this.$options.outerHeight(),o={left:0,top:0};this.options.target!==document.body?(o=this.$target.offset(),o.width=this.$target.outerWidth(),o.height=this.$target.outerHeight(),o.left-=this.$target.scrollLeft(),o.top-=this.$target.scrollTop()):(o.width=f(window).width(),o.height=f(window).height());var s=i,l="auto",u=this.options.openPolicy;switch(u==="selected"&&!this.selection&&(u="auto"),u){case"above":l=n-a;break;case"coverAbove":l=n-a+e;break;case"below":l=n+e;break;case"coverBelow":l=n;break;case"selected":var g=this.$options.find(".selected").position();l=n-g.top;break;default:var h=n-this.$target.scrollTop()+a>o.top+o.height;l=h?n-a+e:n;break}s-=o.left,l-=o.top,this.$options.css({left:s,top:l})},open:function(){this.isDisabled()||(this.renderOptions(),this.$options.appendTo(this.options.target),this.$options.addClass("rendered"),this.position(),this.$el.addClass("opened"),this.respectWindowBoundaries(),this.alignOptionsArrow())},respectWindowBoundaries:function(){var t=this.calculateElOverflow(this.$options,this.$target),e={left:0,top:0};this.$options.outerWidth()<=this.$target.innerWidth()&&(t.left&&t.right||(t.left?e.left=t.left:t.right&&(e.left=-t.right))),this.$options.outerHeight()<=this.$target.innerHeight()&&(t.top&&t.bottom||(t.top?e.top=t.top:t.bottom&&(e.top=-t.bottom))),this.$options.css({left:"+="+e.left,top:"+="+e.top})},alignOptionsArrow:function(){var t=this.$el[0].getBoundingClientRect(),e=this.$options[0].getBoundingClientRect(),r=t.left+t.width/2;r-=e.left,r-=this.$optionsArrow.outerWidth()/2,this.$optionsArrow.css({left:r})},close:function(){this.removeOptions(),this.$el.removeClass("opened"),this.trigger("close")},onRemove:function(){this.removeOptions(),f(document).off(".selectBox",this.onOutsideClick)},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.close(),this.$el.addClass("disabled")},onSetTheme:function(t,e){this.$options&&(t&&this.$options.removeClass(this.themeClassNamePrefix+t),this.$options.addClass(this.themeClassNamePrefix+e))},calculateElOverflow:function(t,e){e||(e=window),t instanceof f&&(t=t[0]),e instanceof f&&(e=e[0]);var r={},i=t.getBoundingClientRect(),n;if(e===window){var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;n={width:a,height:o,left:0,top:0,right:a,bottom:o}}else n=e.getBoundingClientRect();return["left","top"].forEach(function(s){r[s]=Math.min(0,i[s]-n[s])}),["right","bottom"].forEach(function(s){r[s]=Math.min(0,n[s]-i[s])}),Ut(r,function(s,l){r[l]=Math.abs(Math.round(s))}),r}},{OptionsView:Xt.extend({events:{"mouseover .select-box-option":"onOptionHover","click .select-box-option":"onOptionClick"},className:function(){var t=["select-box-options"],e=this.options.parentClassName;return e&&t.push(e),t.join(" ")},init:function(){ke(this,"onMouseout","onKeydown"),f(document).on({"keydown.selectBoxOptions":this.onKeydown,"mouseleave.selectBoxOptions mouseout.selectBoxOptions":this.onMouseout})},render:function(){var t=this.options.extraClassName;return t&&this.$el.addClass(t),this.options.width&&this.$el.css("width",this.options.width),lt(this.options.options).forEach(function(e,r){var i=this.renderOption(e,r);this.options.selectBoxView.selection===e&&i.addClass("selected hover"),this.$el.append(i)},this),this.$arrow=f("<div/>").addClass("select-box-options-arrow").appendTo(this.$el),this},renderOption:function(t,e){var r=this.renderOptionContent(t);return r.addClass("select-box-option"),r.data("index",e),r},renderOptionContent:function(t){var e=f("<div/>",{class:"select-box-option-content",html:t.content});return t.icon&&e.prepend(f("<img/>",{class:"select-box-option-icon",src:t.icon})),e},select:function(t,e){e===void 0&&(e={}),this.trigger("option:select",t,e)},hover:function(t){var e=this.options.options[t];this.markOptionHover(t),this.trigger("option:hover",e,t)},onOptionClick:function(t){var e=this.getOptionIndex(t.target);this.select(e,{ui:!0})},onOptionHover:function(t){var e=this.getOptionIndex(t.target);this.hover(e)},onMouseout:function(t){this.trigger("options:mouseout",t)},onKeydown:function(t){var e=this.options.selectBoxView;if(!!e.options.keyboardNavigation&&!!e.isOpen()){var r;switch(t.which){case 39:case 40:r=1;break;case 38:case 37:r=-1;break;case 13:var i=this.getOptionHoverIndex();i>=0&&this.select(i);return;case 27:return e.close();default:return}t.preventDefault();var n=this.getOptionHoverIndex(),a=n+r,o=this.options.options;a<0&&(a=o.length-1),a>=o.length&&(a=0),this.hover(a)}},onRemove:function(){f(document).off(".selectBoxOptions")},markOptionHover:function(t){this.$el.find(".hover").removeClass("hover"),f(this.$el.find(".select-box-option")[t]).addClass("hover")},getOptionHoverIndex:function(){return this.$el.find(".select-box-option.hover").index()},getOptionIndex:function(t){return f(t).closest(".select-box-option").data("index")}})}),pv=xn.extend({className:"select-box color-palette",position:function(){var t=this.$(".select-box-selection"),e=t.outerHeight(),r=t.offset(),i=r.left,n=r.top+e;if(this.options.target!==document.body){this.$target=this.$target||f(this.options.target);var a=this.$target.offset();i-=a.left-this.$target.scrollLeft(),n-=a.top-this.$target.scrollTop()}this.$options.css({left:i,top:n})}},{OptionsView:xn.OptionsView.extend({renderOptionContent:function(t){var e=f("<div/>",{class:"select-box-option-content"});return e.css("background-color",t.content),t.icon&&e.prepend(f("<img/>",{class:"select-box-option-icon",src:t.icon})),e}})}),mv=Xt.extend({className:"context-toolbar",eventNamespace:"context-toolbar",events:{"click .tool":"onToolPointerdown"},options:{padding:20,autoClose:!0,vertical:!1,anchor:"top",position:"bottom",scale:1},documentEvents:{mousedown:"onDocumentPointerdown",touchstart:"onDocumentPointerdown"},init:function(){ke(this,"onDocumentPointerdown")},render:function(){var t=this.options,e=this.constructor;return e.opened&&e.close(),t.autoClose&&setTimeout(this.delegateAutoCloseEvents.bind(this),0),t.type&&this.$el.attr("data-type",t.type),this.beforeMount(),this.getRoot().append(this.$el),this.renderContent(),this.position(),this.scale(),e.opened=this,this},delegateAutoCloseEvents:function(){this.delegateDocumentEvents(),document.addEventListener("mousedown",this.onDocumentPointerdown,!0),document.addEventListener("touchstart",this.onDocumentPointerdown,!0)},undelegateAutoCloseEvents:function(){this.undelegateDocumentEvents(),document.removeEventListener("mousedown",this.onDocumentPointerdown,!0),document.removeEventListener("touchstart",this.onDocumentPointerdown,!0)},beforeMount:function(){this.$el.toggleClass("joint-vertical",!!this.options.vertical)},renderContent:function(){var t=f("<div/>",{class:"tools"});this.options.tools&&lt(this.options.tools).forEach(function(e){var r;e.icon?r=f("<img/>",{src:e.icon}):r=e.content;var i=f("<button/>",{class:"tool",html:r,"data-action":e.action});e.attrs&&i.attr(e.attrs),t.append(i)}),this.$el.append(t)},getRoot:function(){return f(this.options.root||document.documentElement)},position:function(){var t=this.options,e=t.target,r=t.padding,i=t.position,n=t.anchor,a=this,o=a.$el,s={x:0,y:0};if(F.toNode(e)!==void 0){var l=li(e),u=di(l,i);s.x=u.x,s.y=u.y;var g=di(new at().inflate(r),i);s.x+=g.x,s.y+=g.y}else{var h=new Z(e);s.x=h.x,s.y=h.y}var y=o.outerWidth(),x=o.outerHeight(),C=di(new at(0,0,y,x),n);s.x-=C.x,s.y-=C.y;var p=li(this.getRoot());s.x-=p.x,s.y-=p.y,o.css({left:s.x,top:s.y})},scale:function(){var e=this.options,r=e.scale,i=e.anchor;if(r){this.el.style.transform="scale("+r+", "+r+")";var n=Io(i).split("-");n[0]==="corner"&&(n[0]="bottom",n[1]="right"),n[0]==="origin"&&(n[0]="top",n[1]="left"),n[1]==="middle"&&(n[1]=null),this.el.style.transformOrigin=n[0]+" "+(n[1]?n[1]:"")}},onRemove:function(){this.undelegateAutoCloseEvents(),this.constructor.opened=void 0},onToolPointerdown:function(t){var e=f(t.currentTarget).attr("data-action");e&&this.trigger("action:"+e,t)},onDocumentPointerdown:function(t){var e=this,r=e.el,i=e.options,n=i.target,a=t.target;if(F.toNode(n)!==void 0){var o=f(n),s=o[0];if(!s||s===a||s.contains(a))return}r.contains(a)||r===a||this.constructor.close()}},{opened:void 0,close:function(){this.opened&&(this.opened.trigger("close"),this.opened.remove(),this.opened=void 0)},update:function(){this.opened&&this.opened.position()}}),Je=Xt.extend({className:"dialog",events:{"click .bg":"action","click .btn-close":"action","click .controls button":"action","mousedown .titlebar":"onDragStart","touchstart .titlebar":"onDragStart"},options:{draggable:!1,closeButtonContent:"&times;",closeButton:!0,inlined:!1,modal:!0,width:0,title:"",buttons:null,type:"",content:null},init:function(){ke(this,"onDrag","onDragEnd"),this.buttons=this.options.buttons},render:function(){var t=f("<div/>",{class:"bg","data-action":"close"}),e=f("<div/>",{class:"fg"}),r=f("<div/>",{class:"titlebar"}),i=f("<div/>",{class:"body"}),n=f("<button/>",{class:"btn-close","data-action":"close",html:this.options.closeButtonContent}),a=f("<div/>",{class:"controls"});if(this.$el.toggleClass("draggable",!!this.options.draggable),this.options.type&&this.$el.attr("data-type",this.options.type),this.options.inlined&&this.$el.addClass("inlined"),this.options.modal&&this.$el.addClass("modal"),this.options.width&&e.width(this.options.width),this.options.title?r.append(this.options.title):r.addClass("empty"),this.options.content&&i.append(this.options.content),this.buttons){var o=[],s=[],l=[];this.buttons.forEach(function(u){var g=f("<button/>",{class:"control-button",html:u.content,"data-action":u.action});u.position?u.position==="left"?(g.addClass(u.position),l.push(g)):u.position==="center"?(g.addClass(u.position),s.push(g)):(g.addClass(u.position),o.push(g)):o.push(g)}),o.reverse().forEach(function(u){a.append(u)}),l.forEach(function(u){a.append(u)}),s.forEach(function(u){a.append(u)})}return e.append(r,i,a),this.options.closeButton&&e.append(n),this.$el.empty().append(t,e),this},open:function(t){return this.delegateEvents(),this.on("action:close",this.close,this),f(document.body).on({"mousemove.dialog touchmove.dialog":this.onDrag,"mouseup.dialog touchend.dialog":this.onDragEnd}),f(t||document.body).append(this.render().el),this.$el.addClass("rendered"),this},close:function(){return this.remove(),this.trigger("close"),this},onRemove:function(){f(document.body).off(".dialog",this.onDrag).off(".dialog",this.onDragStart)},action:function(t){var e=f(t.target).closest("[data-action]"),r=e.attr("data-action");r&&this.trigger("action:"+r)},onDragStart:function(t){this.options.draggable&&(t=ot(t),this._dx=t.clientX,this._dy=t.clientY,this._dragging=!0)},onDrag:function(t){if(this._dragging){t=ot(t);var e=this.$(".fg"),r=e.offset();e.css({top:r.top+(t.clientY-this._dy),left:r.left+(t.clientX-this._dx),margin:0}),this._dx=t.clientX,this._dy=t.clientY}},onDragEnd:function(){this._dragging=!1}}),yv=Je.extend({className:Je.prototype.className+" flash-message",options:ie({},Je.prototype.options,{closeButton:!0,modal:!1,cascade:!0,closeAnimation:{delay:2e3,duration:200,easing:"swing",properties:{opacity:0}},openAnimation:{duration:200,easing:"swing",properties:{opacity:1}}}),init:function(){ke(this,"startCloseAnimation"),Je.prototype.init.apply(this,arguments),this.on("close:animation:complete",this.close,this)},open:function(){Je.prototype.open.apply(this,arguments);var t=this.$(".fg");return this._foregroundHeight=t.height(),this.addToCascade(),t.css("height",0),this.startOpenAnimation(),this.options.closeAnimation&&this.options.closeAnimation.delay&&setTimeout(this.startCloseAnimation,this.options.closeAnimation.delay),this},close:function(){return Je.prototype.close.apply(this,arguments),this.removeFromCascade(),this},addToCascade:function(){if(this.options.cascade){var t=this.constructor.top;this.$(".fg").css("top",t),this.constructor.top+=this._foregroundHeight+this.constructor.padding}this.constructor.opened.push(this)},removeFromCascade:function(){if(this.options.cascade){for(var t=this.constructor.opened,e=!1,r=0;r<t.length;r++){var i=t[r];if(i.options.cascade&&e){var n=parseInt(i.$(".fg").css("top"),10);i.$(".fg").css("top",n-this._foregroundHeight-this.constructor.padding)}i===this&&(e=!0)}e&&(this.constructor.top-=this._foregroundHeight+this.constructor.padding)}this.constructor.opened=hi(this.constructor.opened,this)},startCloseAnimation:function(){this.$(".fg").animate(this.options.closeAnimation.properties,tt({complete:function(){this.trigger("close:animation:complete")}.bind(this)},this.options.closeAnimation))},startOpenAnimation:function(){var t=this.$(".fg");t.animate(tt({},this.options.openAnimation.properties,{height:this._foregroundHeight}),tt({complete:function(){this.trigger("open:animation:complete")}.bind(this)},this.options.openAnimation))}},{top:20,padding:15,opened:[],open:function(t,e,r){return r=r||{},new yv(tt({title:e,type:"info",content:t},r)).open(r.target)},close:function(){me(this.opened,"close")}}),bv=Xt.extend({className:"free-transform",events:{"mousedown .resize":"startResizing","mousedown .rotate":"startRotating","touchstart .resize":"startResizing","touchstart .rotate":"startRotating"},DIRECTIONS:["nw","n","ne","e","se","s","sw","w"],POSITIONS:["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],options:{cellView:void 0,rotateAngleGrid:15,resizeGrid:void 0,preserveAspectRatio:!1,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,allowOrthogonalResize:!0,resizeDirections:null,allowRotation:!0,clearAll:!0,clearOnBlankPointerdown:!0,usePaperScale:!1,padding:3},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup"},init:function(){var t=this.options;t.cellView?ne(t,{cell:t.cellView.model,paper:t.cellView.paper,graph:t.cellView.paper.model}):t.paper&&t.cell&&ne(t,{cellView:t.cell.findView(t.paper),graph:t.paper.model});var e=t.paper,r=t.clearAll;r&&this.constructor.clear(e),this.startListening(),e.$el.append(this.el),this.constructor.registerInstanceToPaper(this,e)},startListening:function(){var t=this,e=this.options,r=e.cell,i=e.paper,n=e.graph,a=e.clearOnBlankPointerdown;this.listenTo(r,"change:size change:position change:angle",this.onCellAttributeChange),this.listenTo(i,"scale translate",function(){return t.requestUpdate()}),this.listenTo(n,"reset",function(){return t.remove()}),this.listenTo(r,"remove",function(){return t.remove()}),a&&this.listenTo(i,"blank:pointerdown",function(){return t.remove()})},onCellAttributeChange:function(t,e,r){r.updateHandled||this.requestUpdate()},renderHandles:function(){var t=this,e=t.options,r=t.POSITIONS,i=f("<div/>").prop("draggable",!1),n=i.clone().addClass("rotate"),a=r.map(function(s){return i.clone().addClass("resize").attr("data-position",s)}),o=e.resizeDirections;Array.isArray(o)&&a.forEach(function(s,l){o.includes(r[l])||s.hide()}),this.$el.empty().append(a,n)},render:function(){var t=this,e=t.options,r=t.$el,i=e.cell,n=e.preserveAspectRatio,a=e.allowRotation,o=e.allowOrthogonalResize;r.attr("data-type",i.get("type")),r.toggleClass("no-orthogonal-resize",n||!o),r.toggleClass("no-rotation",!a),this.renderHandles(),this.requestUpdate()},requestUpdate:function(t){var e=this,r=e.UPDATE_PRIORITY,i=e.options;i.paper.requestViewUpdate(this,1,r,t)},confirmUpdate:function(){this.update()},update:function(){this.options.usePaperScale?this.updateFrameScaled():this.updateFrameNoScale(),this.updateHandleDirections()},updateFrameScaled:function(){var t=this.options,e=t.paper,r=t.cell,i=t.padding,n=he(i),a=n.left,o=n.right,s=n.top,l=n.bottom,u=r.getBBox().moveAndExpand({x:-a,y:-s,width:a+o,height:s+l}),g=u.x,h=u.y,y=u.width,x=u.height,C=r.angle(),p=e.matrix().translate(g,h).translate(y/2,x/2).rotate(C).translate(-y/2,-x/2),E=F.matrixToTransformString(p);this.$el.css({width:y,height:x,left:0,top:0,"transform-origin":"0 0",transform:E,"-webkit-transform":E,"-ms-transform":E})},updateFrameNoScale:function(){var t=this.options,e=t.paper,r=t.cell,i=t.padding,n=he(i),a=n.left,o=n.right,s=n.top,l=n.bottom,u=e.matrix(),g=u.a,h=u.d,y=u.e,x=u.f,C=r.getBBox(),p=r.angle();C.x*=g,C.x+=y,C.y*=h,C.y+=x,C.width*=g,C.height*=h,C.moveAndExpand({x:-a,y:-s,width:a+o,height:s+l});var E="rotate("+p+"deg)";this.$el.css({width:C.width,height:C.height,left:C.x,top:C.y,"transform-origin":"50% 50%",transform:E,"-webkit-transform":E,"-ms-transform":E})},updateHandleDirections:function(){var t=this.options.cell.angle(),e=Math.floor(t*(this.DIRECTIONS.length/360));if(e!=this._previousDirectionsShift){var r=this.DIRECTIONS.slice(e).concat(this.DIRECTIONS.slice(0,e));this.$(".resize").removeClass(this.DIRECTIONS.join(" ")).each(function(i,n){f(n).addClass(r[i])}),this._previousDirectionsShift=e}},calculateTrueDirection:function(t){var e=this.options.cell,r=et(e.get("angle")),i=this.POSITIONS.indexOf(t);return i+=Math.floor(r*(this.POSITIONS.length/360)),i%=this.POSITIONS.length,this.POSITIONS[i]},startResizing:function(t){t.stopPropagation();var e=this,r=e.options,i=r.cell,n=r.graph,a=r.paper;n.startBatch("free-transform",{freeTransform:this.cid});var o=f(t.target).data("position"),s=this.calculateTrueDirection(o),l=0,u=0;o.split("-").forEach(function(m){l={left:-1,right:1}[m]||l,u={top:-1,bottom:1}[m]||u});var g=this.toValidResizeDirection(o),h={"top-right":"bottomLeft","top-left":"corner","bottom-left":"topRight","bottom-right":"origin"}[g],y=r.minWidth,x=r.minHeight,C=r.maxWidth,p=r.maxHeight,E=typeof y=="function"?y.call(this,i,this):y,k=typeof x=="function"?x.call(this,i,this):x,w=typeof C=="function"?C.call(this,i,this):C,S=typeof p=="function"?p.call(this,i,this):p,T={action:"resize",angle:i.angle(),resizeX:l,resizeY:u,selector:h,direction:g,relativeDirection:o,trueDirection:s,maxHeight:S,minHeight:k,maxWidth:w,minWidth:E,cellView:i.findView(a)};this.startOp(t.target),this.delegateDocumentEvents(null,T),this.trigger(T.action+":start",t)},toValidResizeDirection:function(t){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[t]||t},startRotating:function(t){t.stopPropagation();var e=ot(t);this.options.graph.startBatch("free-transform",{freeTransform:this.cid});var r=this.options.cell.getBBox().center(),i=this.options.paper.snapToGrid({x:e.clientX,y:e.clientY}),n={action:"rotate",centerRotation:r,modelAngle:et(this.options.cell.get("angle")||0),startAngle:Bt(i).theta(r)};this.startOp(t.target),this.delegateDocumentEvents(null,n),this.trigger(n.action+":start",t)},pointermove:function(t){var e=t.data,r=e.action,i=e.maxHeight,n=e.maxWidth,a=e.minHeight,o=e.minWidth,s=e.cellView;if(!!r){t=ot(t);var l=this.options,u=l.cell,g=l.paper.snapToGrid({x:t.clientX,y:t.clientY}),h=l.paper.options.gridSize,y=l.resizeGrid||{},x=y.width||h,C=y.height||h;switch(r){case"resize":var p=u.getBBox(),E=Bt(g).rotate(p.center(),e.angle),k=E.difference(p[e.selector]()),w=e.resizeX?k.x*e.resizeX:p.width,S=e.resizeY?k.y*e.resizeY:p.height;if(w=ht(w,x),S=ht(S,C),w=Math.max(w,o||x),S=Math.max(S,a||C),w=Math.min(w,n),S=Math.min(S,i),l.preserveAspectRatio){var T=p.width*S/p.height,m=p.height*w/p.width;T>w?S=m:w=T}if(p.width!=w||p.height!=S){var A={freeTransform:this.cid,direction:e.direction,relativeDirection:e.relativeDirection,trueDirection:e.trueDirection,ui:!0,minWidth:o,minHeight:a,maxWidth:n,maxHeight:i,preserveAspectRatio:l.preserveAspectRatio};s.scalableNode&&(A.async=!1),u.resize(w,S,A)}break;case"rotate":var M=e.startAngle-Bt(g).theta(e.centerRotation);u.rotate(ht(e.modelAngle+M,l.rotateAngleGrid),!0,null,{freeTransform:this.cid});break}this.trigger(""+r,t)}},pointerup:function(t){this.undelegateDocumentEvents();var e=t.data;!e||!e.action||(this.stopOp(),this.trigger(e.action+":stop",t),this.options.graph.stopBatch("free-transform",{freeTransform:this.cid}))},onRemove:function(){bv.unregisterInstanceFromPaper(this,this.options.paper)},startOp:function(t){t&&(f(t).addClass("in-operation"),this._elementOp=t),this.$el.addClass("in-operation"),this.options.paper.undelegateEvents()},stopOp:function(){this._elementOp&&(f(this._elementOp).removeClass("in-operation"),this._elementOp=null),this.$el.removeClass("in-operation"),this.options.paper.delegateEvents()}},{instancesByPaper:{},clear:function(t){t.trigger("freetransform:create"),this.removeInstancesForPaper(t)},removeInstancesForPaper:function(t){me(this.getInstancesForPaper(t),"remove")},getInstancesForPaper:function(t){return this.instancesByPaper[t.cid]||{}},registerInstanceToPaper:function(t,e){this.instancesByPaper[e.cid]||(this.instancesByPaper[e.cid]={}),this.instancesByPaper[e.cid][t.cid]=t},unregisterInstanceFromPaper:function(t,e){this.instancesByPaper[e.cid]&&(this.instancesByPaper[e.cid][t.cid]=null)}}),kS={N:"n",NW:"nw",W:"w",SW:"sw",S:"s",SE:"se",E:"e",NE:"ne"},wv=function(){this.options={handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElement"},icon:null},{name:"direction",position:"se",events:{pointerdown:"directionSwap"},icon:null}],bbox:function(t){var e=t.paper;return e.localToPaperPoint(t.getPointAtRatio(.5))},typeCssName:"type-link",tinyThreshold:-1,smallThreshold:-1,boxContent:!1}};wv.prototype.directionSwap=function(){var t=this.options.cellView.model;t.set({source:t.get("target"),target:t.get("source")},{halo:this.cid})};var Te=function(){this.options={handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElement"},icon:null},{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"},icon:null},{name:"clone",position:"n",events:{pointerdown:"startCloning",pointermove:"doClone",pointerup:"stopCloning"},icon:null},{name:"link",position:"e",events:{pointerdown:"startLinking",pointermove:"doLink",pointerup:"stopLinking"},icon:null},{name:"fork",position:"ne",events:{pointerdown:"startForking",pointermove:"doFork",pointerup:"stopForking"},icon:null},{name:"unlink",position:"w",events:{pointerdown:"unlinkElement"},icon:null},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"},icon:null}],bbox:function(t,e){return t.getBBox({useModelGeometry:e.options.useModelGeometry})},typeCssName:"type-element",tinyThreshold:40,smallThreshold:80,boxContent:function(t,e){var r=De("x: <%= x %>, y: <%= y %>, width: <%= width %>, height: <%= height %>, angle: <%= angle %>"),i=t.model,n=i.getBBox();return r({x:Math.floor(n.x),y:Math.floor(n.y),width:Math.floor(n.width),height:Math.floor(n.height),angle:Math.floor(i.get("angle")||0)})},magnet:function(t){return t.el},loopLinkPreferredSide:"top",loopLinkWidth:40,rotateAngleGrid:15,rotateEmbeds:!1,linkAttributes:{},smoothLinks:void 0}};Te.prototype.startLinking=function(t,e,r){this.startBatch();var i=this.options,n=i.paper,a=i.graph,o=this.createLinkConnectedToSource(t);o.set({target:{x:e,y:r}}).addTo(a,{validation:!1,halo:this.cid,async:!1}),n.undelegateEvents();var s=this._linkView=o.findView(n);s.startArrowheadMove("target",{whenNotAllowed:"remove"})},Te.prototype.startForking=function(t,e,r){var i=this.options,n=i.paper,a=i.graph;this.startBatch();var o=this.cloneCell({fork:!0}),s=o[0],l=o.slice(1),u=[s].concat(Fe(l,function(C){return C.isLink()}));a.addCells(u,{halo:this.cid,async:!1}),this.centerElementAtCursor(s,e,r);var g=this.createLinkConnectedToSource(t),h=s.findView(n),y=this.getElementMagnet(h,"target",t),x=this.getLinkEnd(h,y,t);g.set("target",x).addTo(a,{halo:this.cid,async:!1}),h.pointerdown(t,e,r),this.eventData(t,{cloneView:h})},Te.prototype.getElementMagnet=function(t,e,r){var i=this.options.magnet;if(yt(i)){var n=i.call(this,t,e,r);if(n instanceof SVGElement)return n}throw new Error("ui.Halo: magnet() has to return an SVGElement.")},Te.prototype.getLinkEnd=function(t,e,r){var i={id:t.model.id};if(e!==t.el){var n=t.findAttribute("port",e);n?i.port=n:i.selector=t.getSelector(e)}return i},Te.prototype.createLinkConnectedToSource=function(t){var e=this.options,r=e.paper,i=e.cellView,n=this.getElementMagnet(i,"source",t),a=this.getLinkEnd(i,n,t),o=r.getDefaultLink(i,n).set("source",a);return o.attr(e.linkAttributes),Eo(e.smoothLinks)&&o.set("smooth",e.smoothLinks),o},Te.prototype.startResizing=function(t){this.startBatch(),this._flip=[1,0,0,1,1,0,0,1][Math.floor(et(this.options.cellView.model.get("angle"))/45)]},Te.prototype.startRotating=function(t,e,r){this.startBatch();var i=this.options.cellView.model,n=i.getBBox().center(),a=[i];this.options.rotateEmbeds&&i.getEmbeddedCells({deep:!0}).reduce(function(o,s){return s.isElement()&&o.push(s),o},a),this.eventData(t,{center:n,elements:a,rotationStartAngles:a.map(function(o){return o.angle()}),clientStartAngle:new Z(e,r).theta(n)})},Te.prototype.doResize=function(t,e,r,i,n){var a=this.options.cellView.model.get("size"),o=Math.max(a.width+(this._flip?i:n),1),s=Math.max(a.height+(this._flip?n:i),1);this.options.cellView.model.resize(o,s,{absolute:!0})},Te.prototype.doRotate=function(t,e,r){var i=this.eventData(t),n=i.clientStartAngle-new Z(e,r).theta(i.center);i.elements.forEach(function(a,o){var s=i.rotationStartAngles[o],l=ht(s+n,this.options.rotateAngleGrid);a.rotate(l,!0,i.center,{halo:this.cid})},this)},Te.prototype.doClone=function(t,e,r){var i=this.eventData(t),n=i.cloneView;n&&n.pointermove(t,e,r)},Te.prototype.startCloning=function(t,e,r){var i=this,n=i.options,a=n.paper,o=a.model;this.startBatch();var s=this.cloneCell({clone:!0}),l=s[0],u=s.slice(1),g=[l].concat(Fe(u,function(y){return y.isLink()}));o.addCells(g,{halo:this.cid,async:!1}),this.centerElementAtCursor(l,e,r);var h=l.findView(a);h.pointerdown(t,e,r),this.eventData(t,{cloneView:h})},Te.prototype.centerElementAtCursor=function(t,e,r){var i=t.getBBox().center(),n=e-i.x,a=r-i.y;t.translate(n,a,{deep:!0})},Te.prototype.doFork=function(t,e,r){var i=this.eventData(t),n=i.cloneView;n&&n.pointermove(t,e,r)},Te.prototype.doLink=function(t,e,r){this._linkView&&this._linkView.pointermove(t,e,r)},Te.prototype.stopLinking=function(t,e,r){var i=this._linkView;if(i){i.pointerup(t,e,r);var n=i.model;n.hasLoop()&&this.makeLoopLink(n),this.stopBatch(),this.triggerAction("link","add",n),this._linkView=null}this.options.paper.delegateEvents()},Te.prototype.stopForking=function(t,e,r){var i=this.eventData(t),n=i.cloneView;n&&n.pointerup(t,e,r),this.stopBatch()},Te.prototype.stopCloning=function(t,e,r){var i=this.eventData(t),n=i.cloneView;n&&n.pointerup(t,e,r),this.stopBatch()},Te.prototype.unlinkElement=function(t){this.startBatch(),this.options.graph.removeLinks(this.options.cellView.model),this.stopBatch()},Te.prototype.makeLoopLink=function(t){var e=this.options.loopLinkWidth,r=this.options.paper.options,i=We({x:0,y:0,width:r.width,height:r.height}),n=this.options.paper.paperToLocalRect(this.options.cellView.getBBox()),a,o,s=mr([this.options.loopLinkPreferredSide,"top","bottom","left","right"]),l=s.find(function(u){var g,h=0,y=0;switch(u){case"top":g=Bt(n.x+n.width/2,n.y-e),h=e/2;break;case"bottom":g=Bt(n.x+n.width/2,n.y+n.height+e),h=e/2;break;case"left":g=Bt(n.x-e,n.y+n.height/2),y=e/2;break;case"right":g=Bt(n.x+n.width+e,n.y+n.height/2),y=e/2;break}return a=Bt(g).offset(-h,-y),o=Bt(g).offset(h,y),i.containsPoint(a)&&i.containsPoint(o)},this);l&&t.set("vertices",[a,o])};var PS=Xt.extend({PIE_INNER_RADIUS:20,PIE_OUTER_RADIUS:50,className:"halo",events:{"mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown","mousedown .pie-toggle":"onPieTogglePointerDown","touchstart .pie-toggle":"onPieTogglePointerDown"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup"},options:{clearAll:!0,clearOnBlankPointerdown:!0,useModelGeometry:!1,clone:function(t,e){return t.clone().unset("z")},type:"surrounding",pieSliceAngle:45,pieStartAngleOffset:0,pieIconSize:14,pieToggles:[{name:"default",position:"e"}]},init:function(){var t=this.options,e=t.cellView,r=e.model,i=r.isLink()?new wv:new Te;tt(this,Ce(i,"options"));var n=e.paper,a=n.model;ne(t,i.options,{paper:n,graph:a}),ke(this,"render","update"),t.clearAll&&this.constructor.clear(n),this.listenTo(a,"reset",this.close),this.listenTo(r,"remove",this.close),this.listenTo(n,"halo:create",this.close),t.clearOnBlankPointerdown&&this.listenTo(n,"blank:pointerdown",this.close),this.listenTo(a,"all",this.update),this.listenTo(n,"scale translate",this.update),this.handles=[],lt(t.handles).forEach(this.addHandle,this)},render:function(){var t=this.options;switch(this.$el.empty(),this.$handles=f("<div/>").addClass("handles").appendTo(this.el),this.$box=f("<label/>").addClass("box").appendTo(this.el),this.$pieToggles={},this.$el.addClass(t.type),this.$el.addClass(this.cellTypeCssClass()),this.$el.attr("data-type",t.cellView.model.get("type")),this.$handles.append(lt(this.handles).map(this.renderHandle,this)),t.type){case"toolbar":case"surrounding":this.hasHandle("fork")&&this.toggleFork();break;case"pie":lt(this.options.pieToggles).forEach(function(e){var r=f("<div/>");r.addClass("pie-toggle "+(e.position||"e")),r.attr("data-name",e.name),ui(r,e.attrs),r.appendTo(this.el),this.$pieToggles[e.name]=r},this);break;default:throw new Error("ui.Halo: unknown type")}return this.update(),this.$el.addClass("animate").appendTo(t.paper.el),this.setPieIcons(),this},setPieIcons:function(){this.options.type==="pie"&&this.$el.find(".handle").each(function(t,e){var r,i=f(e),n=i.attr("data-action"),a=this.getHandle(n);if(!(a&&a.icon)){var o=window.getComputedStyle(e,":before").getPropertyValue("content");o&&o!=="none"&&(r=i.find(".slice-text-icon"),r.length>0&&F(r[0]).text(o.replace(/['"]/g,"")));var s=i.css("background-image");if(s){var l=s.match(/url\(['"]?([^'"]+)['"]?\)/);if(l){var u=l[1];r=i.find(".slice-img-icon"),r.length>0&&F(r[0]).attr("xlink:href",u)}}}}.bind(this))},update:function(){if(!!this.isRendered()){this.updateBoxContent();var t=this.getBBox();this.$el.toggleClass("tiny",t.width<this.options.tinyThreshold&&t.height<this.options.tinyThreshold),this.$el.toggleClass("small",!this.$el.hasClass("tiny")&&t.width<this.options.smallThreshold&&t.height<this.options.smallThreshold),this.$el.css({width:t.width,height:t.height,left:t.x,top:t.y}),this.hasHandle("unlink")&&this.toggleUnlink()}},getBBox:function(){var t=this.options.cellView,e=this.options.bbox,r=yt(e)?e(t,this):e;return r=ne({},r,{x:0,y:0,width:1,height:1}),We(r)},cellTypeCssClass:function(){return this.options.typeCssName},updateBoxContent:function(){var t=this.options.boxContent,e=this.options.cellView;if(yt(t)){var r=t.call(this,e,this.$box[0]);r&&this.$box.html(r)}else t?this.$box.html(t):this.$box.remove()},extendHandles:function(t){Ut(t,function(e){var r=this.getHandle(e.name);r&&tt(r,e)}.bind(this))},addHandles:function(t){return lt(t).forEach(this.addHandle,this),this},addHandle:function(t){var e=this.getHandle(t.name);return e||(this.handles.push(t),Ut(t.events,function(r,i){$t(r)?this.on("action:"+t.name+":"+i,this[r],this):this.on("action:"+t.name+":"+i,r)}.bind(this)),this.$handles&&this.renderHandle(t).appendTo(this.$handles)),this},renderHandle:function(t){var e=this.getHandleIdx(t.name),r=f("<div/>").addClass("handle").addClass(t.name).attr("data-action",t.name).prop("draggable",!1);switch(this.options.type){case"toolbar":case"surrounding":r.addClass(t.position),t.content&&r.html(t.content);break;case"pie":var i=this.PIE_OUTER_RADIUS,n=this.PIE_INNER_RADIUS,a=(i+n)/2,o=Bt(i,i),s=bt(this.options.pieSliceAngle),l=e*s+bt(this.options.pieStartAngleOffset),u=l+s,g=F.createSlicePathData(n,i,l,u),h=F("svg").addClass("slice-svg"),y=F("path").attr("d",g).translate(i,i).addClass("slice"),x=Bt.fromPolar(a,-l-s/2,o),C=this.options.pieIconSize,p=F("image").attr(x).addClass("slice-img-icon");x.y=x.y+C-2;var E=F("text",{"font-size":C}).attr(x).addClass("slice-text-icon");p.attr({width:C,height:C}),p.translate(-C/2,-C/2),E.translate(-C/2,-C/2),h.append([y,p,E]),r.append(h.node);break}return t.icon&&this.setHandleIcon(r,t.icon),ui(r,t.attrs),r},setHandleIcon:function(t,e){switch(this.options.type){case"pie":var r=t.find(".slice-img-icon");F(r[0]).attr("xlink:href",e);break;case"toolbar":case"surrounding":t.css("background-image","url("+e+")");break}},removeHandles:function(){for(;this.handles.length;)this.removeHandle(this.handles[0].name);return this},removeHandle:function(t){var e=this.getHandleIdx(t),r=this.handles[e];return r&&(Ut(r.events,function(i,n){this.off("action:"+t+":"+n)}.bind(this)),this.$(".handle."+t).remove(),this.handles.splice(e,1)),this},changeHandle:function(t,e){var r=this.getHandle(t);return r&&(this.removeHandle(t),this.addHandle(ie({name:t},r,e))),this},hasHandle:function(t){return this.getHandleIdx(t)!==-1},getHandleIdx:function(t){return lt(this.handles).findIndex(function(e){return e.name===t})},getHandle:function(t){return lt(this.handles).find(function(e){return e.name===t})},toggleHandle:function(t,e){var r=this.getHandle(t);if(r){var i=this.$(".handle."+t);e===void 0&&(e=!i.hasClass("selected")),i.toggleClass("selected",e);var n=e?r.iconSelected:r.icon;n&&this.setHandleIcon(i,n)}return this},selectHandle:function(t){return this.toggleHandle(t,!0)},deselectHandle:function(t){return this.toggleHandle(t,!1)},deselectAllHandles:function(){return lt(this.handles).forEach(function(t){this.deselectHandle(t.name)},this),this},onHandlePointerDown:function(t){var e=this._action=t.currentTarget.dataset.action;if(!!e){t.preventDefault(),t.stopPropagation(),t=ot(t);var r=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY}),i=r.x,n=r.y;this._localX=i,this._localY=n,this._evt=t,t.type==="mousedown"&&t.button===2?this.triggerAction(e,"contextmenu",t,i,n):(this.triggerAction(e,"pointerdown",t,i,n),this.delegateDocumentEvents(null,t.data))}},onPieTogglePointerDown:function(t){t.stopPropagation();var e=f(t.target).closest(".pie-toggle"),r=e.attr("data-name");this.isOpen(r)?this.toggleState(r):this.isOpen()?(this.toggleState(),this.toggleState(r)):this.toggleState(r)},triggerAction:function(t,e,r){var i=Array.prototype.slice.call(arguments,2);i.unshift("action:"+t+":"+e),this.trigger.apply(this,i)},stopBatch:function(){var t=this.options,e=t.graph;!e.hasActiveBatch("halo")||e.stopBatch("halo",{halo:this.cid})},startBatch:function(){this.options.graph.startBatch("halo",{halo:this.cid})},pointermove:function(t){if(!!this._action){t.preventDefault(),t.stopPropagation(),t=ot(t);var e=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY}),r=e.x-this._localX,i=e.y-this._localY;this._localX=e.x,this._localY=e.y,this._evt=t,this.triggerAction(this._action,"pointermove",t,e.x,e.y,r,i)}},pointerup:function(t){var e=this._action;if(!!e){this._action=null,this._evt=null;var r=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY});this.triggerAction(e,"pointerup",t,r.x,r.y),this.undelegateDocumentEvents()}},onRemove:function(){this._action&&this._evt&&this.pointerup(this._evt),this.stopBatch()},close:function(){return this.closed||(this.closed=!0,this.remove(),this.trigger("close")),this},onSetTheme:function(){this.setPieIcons()},removeElement:function(){this.options.cellView.model.remove()},toggleUnlink:function(){var t=this.options.graph.getConnectedLinks(this.options.cellView.model).length>0;this.$handles.children(".unlink").toggleClass("hidden",!t)},toggleFork:function(){var t=this.canFork();this.$handles.children(".fork").toggleClass("hidden",!t)},canFork:function(){var t=this.options,e=t.cellView,r=t.paper,i=r.options,n=i.validateConnection;if(typeof n!="function")return!0;var a=this.cloneCell({fork:!0,validation:!0}),o=a[0],s=r.createViewForModel(o),l=n.call(r,e,null,s,null,"target");return s.remove(),l},cloneCell:function(t){t===void 0&&(t={});var e=this.options,r=e.cellView,i=e.clone,n=i(r.model,t);if(n instanceof Be)return[n];if(Array.isArray(n)&&n.length>0&&n.every(function(a){return a instanceof Be}))return n;throw new Error('ui.Halo: option "clone" has to return a cell.')},toggleState:function(t){if(!!this.isRendered()){var e=this.$el;if(Ut(this.$pieToggles,function(i){i.removeClass("open")}),this.isOpen())this.trigger("state:close",t),e.removeClass("open");else{if(this.trigger("state:open",t),t){var r=lt(this.options.pieToggles).find(function(i){return i.name===t});r&&e.attr({"data-pie-toggle-position":r.position,"data-pie-toggle-name":r.name}),this.$pieToggles[t].addClass("open")}e.addClass("open")}}},isOpen:function(t){return this.isRendered()?t?this.$pieToggles[t].hasClass("open"):this.$el.hasClass("open"):!1},isRendered:function(){return this.$box!==void 0}},{clear:function(t){t.trigger("halo:create")},HandlePosition:kS}),vs=Xt.extend({className:"select-button-group",events:{"click .select-button-group-button":"onSelect","mouseover .select-button-group-button":"onOptionHover",mouseleave:"onMouseOut","mousedown .select-button-group-button":"pointerdown","touchstart .select-button-group-button":"pointerdown","mouseup .select-button-group-button":"pointerup","touchend .select-button-group-button":"pointerup"},options:{options:[],disabled:!1,multi:!1,selected:void 0,singleDeselect:!1,noSelectionValue:void 0,width:void 0,buttonWidth:void 0,buttonHeight:void 0,iconWidth:void 0,iconHeight:void 0},init:function(){ke(this,"onSelect","pointerup"),this.$el.data("view",this);var t=this.options.options,e=this.options.multi,r=this.options.selected;if(r===void 0){var i=lt(t).filter(function(n){return n&&n.selected===!0});e?this.selection=i:this.selection=i[0]}else e?this.selection=Array.isArray(r)?t.filter(function(n,a){return r.includes(a)}):[t[r]]:this.selection=t[r]},render:function(){return this.renderOptions(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions(),lt(this.options.options).forEach(function(t,e){var r=this.options.multi?this.selection.includes(t):this.selection===t,i=this.renderOption(t,e,r);this.$el.append(i),r&&i.addClass("selected")},this)},removeOptions:function(){this.$el.empty()},renderOption:function(t,e,r){var i=this.renderOptionContent(t,r);i.data("index",e);var n=t.buttonWidth||this.options.buttonWidth;n&&i.css("width",n);var a=t.buttonHeight||this.options.buttonHeight;return a&&i.css("height",a),i},renderOptionContent:function(t,e){var r=f("<div/>",{class:"select-button-group-button",html:t.content});if(t.icon||e&&t.iconSelected){var i=f("<img/>",{class:"select-button-group-button-icon",src:e&&t.iconSelected?t.iconSelected:t.icon}),n=t.iconWidth||this.options.iconWidth;n&&i.css("width",n);var a=t.iconHeight||this.options.iconHeight;a&&i.css("height",a),r.prepend(i)}return ui(r,t.attrs),r},getOptionIndex:function(t){return f(t).closest(".select-button-group-button").data("index")},onSelect:function(t){if(!this.isDisabled()){var e=this.getOptionIndex(t.target);this.select(e,{ui:!0})}},onOptionHover:function(t){if(!this.isDisabled()){var e=this.getOptionIndex(t.target);this.trigger("option:hover",this.options.options[e],e)}},onMouseOut:function(t){this.isDisabled()||this.trigger("mouseout",t)},getSelection:function(){return this.selection},getSelectionValue:function(t){t=t||this.selection;var e=this.options.noSelectionValue,r=this.options.multi;if(r){var i=lt(t);return i.length===0?e!==void 0?e:[]:i.map(function(a){var o=a.value;return o!==void 0?o:a.content})}if(!t)return e!==void 0?e:void 0;var n=t.value;return n!==void 0?n:t.content},select:function(t,e){var r=f(this.$(".select-button-group-button")[t]),i=this.options.options[t],n=null,a=null,o=null,s=null,l;if(this.options.multi)r.toggleClass("selected"),l=r.hasClass("selected"),l?(o=t,s=i,this.selection.indexOf(i)===-1&&this.selection.push(i),i.iconSelected&&r.find(".select-button-group-button-icon").attr("src",i.iconSelected)):(n=t,a=i,this.selection=hi(this.selection,i),i.iconSelected&&r.find(".select-button-group-button-icon").attr("src",i.icon));else{var u=this.$(".selected"),g=u.index(),h=this.options.options[g];r.toggleClass("selected"),l=r.hasClass("selected"),l?(h&&(n=g,a=h,u.removeClass("selected"),h.iconSelected&&u.find(".select-button-group-button-icon").attr("src",h.icon)),o=t,s=i,this.selection=i,i.iconSelected&&r.find(".select-button-group-button-icon").attr("src",i.iconSelected)):this.options.singleDeselect?(n=t,a=i,this.selection=void 0,i.iconSelected&&r.find(".select-button-group-button-icon").attr("src",i.icon)):r.addClass("selected")}var y=tt({},e);y.deselectedIndex=n,y.deselectedOption=a,y.selectedIndex=o,y.selectedOption=s,this.trigger("option:select",this.selection,t,y)},selectByValue:function(t,e){Array.isArray(t)||(t=[t]);for(var r=this.options.options||[],i=0;i<r.length;i++){var n=r[i];if(n.value===void 0&&t.includes(n.content))this.select(i,e);else if(n.value!==void 0){var a=t.find(function(o){return ze(o,n.value)});a&&this.select(i,e)}}},deselect:function(){this.$(".selected").removeClass("selected"),this.options.multi?this.selection=[]:this.selection=void 0},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},pointerdown:function(t){var e=this.getOptionIndex(t.target),r=f(this.$(".select-button-group-button")[e]);r.addClass("is-in-action"),f(document).on("mouseup.select-button-group touchend.select-button-group",this.pointerup)},pointerup:function(){this.$(".is-in-action").removeClass("is-in-action"),f(document).off("mouseup.select-button-group touchend.select-button-group")}}),An=Xt.extend({className:"inspector",options:{cellView:void 0,cell:void 0,live:!0,validateInput:function(t,e,r,i){return t.validity?t.validity.valid:!0},renderFieldContent:void 0,renderLabel:void 0,focusField:void 0,operators:{},multiOpenGroups:!0,container:null,stateKey:function(t){return t.id}},events:{"change [data-attribute]:not([data-custom-field])":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem","mousedown .field":"pointerdown","touchstart .field":"pointerdown","focusin .field":"pointerfocusin","focusout .field":"pointerfocusout"},HTMLEntities:{lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',cent:"\xA2",pound:"\xA3",euro:"\u20AC",yen:"\xA5",copy:"\xA9",reg:"\xAE"},init:function(){var t=this.options.groups=this.options.groups||{};ke(this,"stopBatchCommand","pointerup","onContentEditableBlur","replaceHTMLEntity"),this.DEFAULT_PATH_WILDCARD="${index}",this.pathWildcard=this.options.pathWildcard,this.widgets={},this._byPath={},this._attributeKeysInUse=[],this.flatAttributes=this.flattenInputs(this.options.inputs),this.expandAttributes=this.expandAttrs(this.options.inputs||{}),this._when={},this._bound={};var e=Object.keys(this.flatAttributes).map(function(a){var o=this.flatAttributes[a];return this._registerDependants.call(this,o,a),o.path=a,o},this);for(var r in t){var i=t[r];i&&t.hasOwnProperty(r)&&this.extractExpressionPaths(i.when).forEach(function(a){this._when[a]||(this._when[a]=[])},this)}var n=Fe(e,"index");this.groupedFlatAttributes=Fe(n,function(a){var o=this.options.groups[a.group];return o&&o.index||Number.MAX_VALUE}.bind(this)),this.listenTo(this.getModel(),"all",this.onCellChange,this)},_registerDependants:function(t,e){if(t.when){var r=t.when,i={expression:r,path:e};this.extractExpressionPaths(r).forEach(function(n){(this._when[n]||(this._when[n]=[])).push(i)},this)}this.needsResolving(t)&&(this._bound[e]=t.options),this._registerNestedDependants.call(this,t,e)},_registerNestedDependants:function(t,e){var r=Array.isArray(e)?e:e.split("/");if(t.type==="object"&&t.properties){var i=t.properties;Object.keys(i).forEach(function(o){var s=i[o],l=r.concat(o);this._registerDependants(s,l)},this)}else if(t.type==="list"&&t.item){var n=t.item,a=r.concat(null);this._registerDependants(n,a)}else typeof t.type!="string"&&Object.keys(t).forEach(function(o){var s=t[o];if(typeof s=="object"){var l=r.concat(o);this._registerDependants(s,l)}},this)},cacheInputs:function(){var t={};Array.from(this.$("[data-attribute]")).forEach(function(e){var r=f(e),i=r.attr("data-attribute");t[i]=r},this),this._byPath=t,this._attributeKeysInUse=this.getAttributeKeysInUse()},updateGroupsVisibility:function(){for(var t=this.$groups,e=0,r=t.length;e<r;e++){var i=f(t[e]),n=i.attr("data-name"),a=this.options.groups[n],o=i.find("> .field:not(.hidden)").length===0;i.toggleClass("empty",o);var s=!!(a&&a.when&&!this.isExpressionValid(a.when));i.toggleClass("hidden",s)}},expandAttrs:function(t){for(var e={},r=Object.keys(t),i=0;i<r.length;i++){var n=r[i],a=t[n],o=n.split("/");Yr(e,o,fe(a)?this.expandAttrs(a):a)}return e},flattenInputs:function(t){return Xn(t,"/",function(e){return typeof e.type=="string"})},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(t,e,r,i){if(i=i||{},i.inspector!=this.cid)switch(t){case"remove":this.constructor.instance&&this.trigger("close"),this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:var n="change:";if(t.slice(0,n.length)===n){var a=t.slice(n.length);this._attributeKeysInUse.includes(a)&&this.render({refresh:!0})}break}},render:function(t){var e=t&&t.refresh;e&&this.options.storeGroupsState&&this.storeGroupsState(),this.$el.empty(),this.removeWidgets();var r,i=[],n;return this.groupedFlatAttributes.forEach(function(a){if(r!==a.group){var o=this.options.groups[a.group];n=this.renderGroup({name:a.group,label:o&&o.label}),e||(o&&o.closed?this.closeGroup(n,{init:!0}):this.openGroup(n,{init:!0})),i.push(n)}this.renderTemplate(n,a,a.path),r=a.group},this),this.$document=f(this.el.ownerDocument),this.$groups=f(i),this.$el.append(i),e&&this.options.restoreGroupsState&&this.restoreGroupsState(),this.afterRender(),this},getAttributeKeysInUse:function(){var t=Object.keys(this._byPath).map(function(i){return i.substring(0,i.indexOf("/"))||i}),e=lt(this._bound),r=Object.keys(this._when);return mr([].concat(t,e,r))},getCellAttributeValue:function(t,e){var r=this.getModel(),i=Ye(r.attributes,t,"/");if(e=e||this.flatAttributes[t],!e)return i;if(i===void 0&&e.defaultValue!==void 0&&(i=e.defaultValue),e.valueRegExp){if(i===void 0)throw new Error("Inspector: defaultValue must be present when valueRegExp is used.");var n=i.match(new RegExp(e.valueRegExp));i=n&&n[2]}return i},resolvableTypes:["select","select-box","color-palette","select-button-group"],needsResolving:function(t){return!!t&&this.resolvableTypes.indexOf(t.type)>-1&&$t(t.options)},resolveBindings:function(t){if(this.resolvableTypes.indexOf(t.type)>-1){var e=t.options||[];$t(e)&&(e=Ye(this.getModel().attributes,e,"/")||[]),Yt(e[0])||(e=lt(e).map(function(r){return{value:r,content:r}})),t.items=e}},updateBindings:function(t){var e=Object.keys(this._bound).reduce(function(r,i){var n=this._bound[i];return t.indexOf(n)===0&&r.push(i),r}.bind(this),[]);je(e)||(e.forEach(function(r){var i=this.flatAttributes[r];!i||this.renderTemplate(null,i,r,{replace:!0})},this),this.afterPartialRender())},renderFieldContent:function(t,e,r){var i;if(yt(this.options.renderFieldContent)&&(i=this.options.renderFieldContent(t,e,r,this),i))return f(i).attr({"data-attribute":e,"data-type":t.type,"data-custom-field":!0});var n,a,o,s;switch(t.type){case"select-box":a=lt(t.items).findIndex(function(h){var y=h.value,x=r;if(y===void 0&&h.content===x)return!0;var C=t.key;return C&&(x=Ye(x,C,"/"),y=Ye(y,C,"/")),ze(y,x)});var l=tt({theme:this.options.theme,target:this.options.container},Ce(t,"type","group","index","selectBoxOptionsClass","options"),{options:t.items,selected:a,selectBoxOptionsClass:[Ze("inspector-select-box-options"),t.selectBoxOptionsClass].filter(function(h){return!!h}).join(" ")});n=new xn(l),n.$el.attr({"data-attribute":e,"data-type":t.type,"data-overwrite":t.overwrite}),n.render(),s=this.renderOwnLabel(t,e),i=f("<div/>").append(s,n.el),t.previewMode?(o=n.selection,n.on("options:mouseout close",function(){n.selection=o,this.processInput(n.$el,{previewCancel:!0,dry:!0})},this),n.on("option:hover",function(h,y){n.selection=h,this.processInput(n.$el,{dry:!0})},this),n.on("option:select",function(h,y){var x=o===void 0?void 0:n.getSelectionValue(o),C=n.getSelectionValue(h),p=x===C;this.processInput(n.$el,{previewDone:!0,dry:p,originalValue:x}),o=h},this)):n.on("option:select",function(h,y){this.processInput(n.$el)},this),this.widgets[e]=n;break;case"color-palette":a=lt(t.items).findIndex(function(h){return h.value===r||h.value===void 0&&h.content===r});var u=tt({theme:this.options.theme,target:this.options.container},Ce(t,"type","group","index","options"),{options:t.items,selected:a});n=new pv(u),n.$el.attr({"data-attribute":e,"data-type":t.type}),n.render(),s=this.renderOwnLabel(t,e),i=f("<div/>").append(s,n.el),t.previewMode?(o=n.selection,n.on("options:mouseout close",function(){n.selection=o,this.processInput(n.$el,{previewCancel:!0,dry:!0})},this),n.on("option:hover",function(h,y){n.selection=h,this.processInput(n.$el,{dry:!0})},this),n.on("option:select",function(h,y){var x=o===void 0?void 0:n.getSelectionValue(o),C=n.getSelectionValue(h),p=x===C;this.processInput(n.$el,{previewDone:!0,dry:p,originalValue:x}),o=h},this)):n.on("option:select",function(h,y){this.processInput(n.$el)},this),this.widgets[e]=n;break;case"select-button-group":t.multi?(a=[],lt(t.items).forEach(function(h,y){var x=h.value===void 0?h.content:h.value,C=t.key;C&&(x=Ye(x,C,"/"));var p=lt(r).find(function(E){return C&&(E=Ye(E,C,"/")),ze(x,E)});p&&a.push(y)})):a=lt(t.items).findIndex(function(h){var y=h.value,x=r;if(y===void 0&&h.content===x)return!0;var C=t.key;return C&&(x=Ye(x,C,"/"),y=Ye(y,C,"/")),ze(y,x)});var g=tt({theme:this.options.theme},Ce(t,"type","group","index","options"),{options:t.items,selected:a});n=new vs(g),n.$el.attr({"data-attribute":e,"data-type":t.type,"data-overwrite":t.overwrite}),n.render(),s=this.renderOwnLabel(t,e),i=f("<div/>").append(s,n.el),t.previewMode?(o=n.selection,n.on("mouseout",function(){n.selection=o,this.processInput(n.$el,{previewCancel:!0,dry:!0})},this),n.on("option:hover",function(h,y){t.multi?n.selection=mr(n.selection.concat([h])):n.selection=h,this.processInput(n.$el,{dry:!0})},this),n.on("option:select",function(h,y){var x=o===void 0?void 0:n.getSelectionValue(o),C=n.getSelectionValue(h),p=ze(x,C);this.processInput(n.$el,{previewDone:!0,dry:p,originalValue:x}),o=h},this)):n.on("option:select",function(h,y){this.processInput(n.$el)},this),this.widgets[e]=n;break;default:i=this.renderOwnFieldContent({options:t,type:t.type,overwrite:t.overwrite,label:t.label||e,attribute:e,value:r})}return i},renderGroup:function(t){t=t||{};var e=f("<div/>").addClass("group").attr("data-name",t.name),r=f("<h3/>").addClass("group-label").text(t.label||t.name);return e.append(r)},renderOwnLabel:function(t,e){var r,i=this.options.renderLabel;if(typeof i=="function"&&(r=i(t,e,this)),r!==void 0)return f(r);switch(t.type){case"select-box":case"color-palette":case"select-button-group":return f("<label/>").html(t.label||e);default:return f("<label/>").text(t.label||e)}},renderOwnFieldContent:function(t){var e,r,i,n,a,o,s,l;switch(l=this.renderOwnLabel(t.options,t.attribute),t.type){case"number":r=f("<input/>",{type:"number",min:t.options.min,max:t.options.max,step:t.options.step}).val(t.value),e=[l,f("<div/>").addClass("input-wrapper").append(r)];break;case"range":l.addClass("with-output"),n=f("<output/>").text(t.value),a=f("<span/>").addClass("units").text(t.options.unit),r=f("<input/>",{type:"range",name:t.type,min:t.options.min,max:t.options.max,step:t.options.step}).val(t.value),r.on("change input",function(){n.text(r.val())}),e=[l,n,a,r];break;case"textarea":r=f("<textarea/>").text(t.value),e=[l,f("<div/>").addClass("input-wrapper").append(r)];break;case"content-editable":{var u=t.value,g=t.options;g===void 0&&(g={});var h=g.html;h===void 0&&(h=!0);var y=g.readonly;y===void 0&&(y=!1);var x;if($t(u)){var C=h?Mo(u):this.encodeHTMLEntities(u);x=C.replace(/\n/g,"<br>")}else x="";r=f("<div/>").prop("contenteditable",!y).toggleClass("content-editable-readonly",Boolean(y)).css("display","inline-block").html(x).on("blur",this.onContentEditableBlur),e=[l,f("<div/>").addClass("input-wrapper").append(r)];break}case"select":var p=t.options.items;r=f("<select/>"),t.options.multiple&&r.prop({size:t.options.size||p.length,multiple:!0});var E=function(k){return t.options.multiple?lt(t.value).find(function(w){return ze(k,w)}):ze(k,t.value)};lt(p).forEach(function(k){var w=f("<option/>",{value:k.value}).text(k.content);E(k.value)&&w.attr("selected","selected"),r.append(w)}),e=[l,r];break;case"toggle":o=f("<span><i/></span>"),r=f("<input/>",{type:"checkbox"}).prop("checked",!!t.value),i=f("<div/>").addClass(t.type),e=[l,i.append(r,o)];break;case"color":r=f("<input/>",{type:"color"}).val(t.value),e=[l,r];break;case"text":r=f("<input/>",{type:"text"}).val(t.value),e=[l,f("<div/>").addClass("input-wrapper").append(r)];break;case"object":r=f("<div/>"),s=f("<div/>").addClass("object-properties"),e=[l,r.append(s)];break;case"list":o=f("<button/>").addClass("btn-list-add").text(t.options.addButtonLabel||"+"),s=f("<div/>").addClass("list-items"),r=f("<div/>"),e=[l,r.append(o,s)];break}return r&&r.addClass(t.type).attr({"data-type":t.type,"data-attribute":t.attribute,"data-overwrite":t.overwrite}),f.fn.append.apply(f("<div>"),e).children()},onContentEditableBlur:function(t){var e=f("<input/>",{disabled:!0,tabIndex:-1,style:{width:"1px",height:"1px",border:"none",margin:0,padding:0}}).appendTo(this.$el);e.focus(),e[0].setSelectionRange(0,0),e.blur().remove(),f(t.target).trigger("change")},replaceHTMLEntity:function(t,e){return this.HTMLEntities[e]||""},encodeHTMLEntities:function(t){return t.replace(/[\u00A0-\u9999<>&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},renderObjectProperty:function(t){t=t||{};var e=f("<div/>",{"data-property":t.property,class:"object-property"});return e},renderListItem:function(t){t=t||{};var e=f("<button/>").addClass("btn-list-del").text(t.options.removeButtonLabel||"-"),r=f("<div/>",{"data-index":t.index,class:"list-item"});return r.append(e)},renderFieldContainer:function(t){t=t||{};var e=f("<div/>",{"data-field":t.path,class:"field "+t.type+"-field"});return e},renderTemplate:function(t,e,r,i){t=t||this.$el,i=i||{},this.resolveBindings(e),typeof e.type!="string"&&(e={type:"object",properties:e});var n=this.renderFieldContainer({path:r,type:e.type});i.hidden&&n.addClass("hidden");var a=this.getCellAttributeValue(r,e),o=this.renderFieldContent(e,r,a);if(n.append(o),ui(n,e.attrs),e.type==="list"&&e.item){lt(a).forEach(function(y,x){var C=this.renderListItem({index:x,options:e});this.renderTemplate(C,e.item,r+"/"+x),o.children(".list-items").append(C)},this);var s=a&&a.length,l=e&&e.min,u=e&&e.max;this.fixListButtons(o,s,l,u)}else if(e.type==="object"&&e.properties){var g=this.flattenInputs(e.properties),h=Object.keys(g).map(function(y){var x=g[y];return x.path=y,x});h=Fe(h,function(y){return y.index}),h.forEach(function(y){var x=this.renderObjectProperty({property:y.path});this.renderTemplate(x,y,r+"/"+y.path),o.children(".object-properties").append(x)},this)}i.replace?t.find('[data-field="'+r+'"]').replaceWith(n):t.append(n)},updateInputPosition:function(){var t=this._byPath["position/x"],e=this._byPath["position/y"],r=this.getModel().get("position");t&&t.val(r.x),e&&e.val(r.y)},updateInputSize:function(){var t=this._byPath["size/width"],e=this._byPath["size/height"],r=this.getModel().get("size");t&&t.val(r.width),e&&e.val(r.height)},updateInputAngle:function(){var t=this._byPath.angle,e=this.getModel().get("angle");t&&t.val(e)},validateInput:function(t,e,r){switch(t){case"select-box":case"color-palette":var i=this.widgets[r];return i?i.getSelectionIndex()!==-1:!1;case"select-button-group":return!!this.widgets[r];default:return this.options.validateInput(e,r,t,this)}},focusField:function(t){var e=this.getOptionsFromPath(t),r=this._byPath[t];if(r)this._focusFieldInternal(e,t,r[0]);else throw"path not found"},_focusListField:function(e,r,i){var n=i.querySelector("[data-attribute]:not(.hidden)");n&&this._focusFieldInternal(e.item,n.getAttribute("data-attribute"),n)},_focusObjectField:function(e,r,i){var n=i.querySelector("[data-attribute]:not(.hidden)");if(n){var a=n.getAttribute("data-attribute"),o=this.getOptionsFromPath(a);this._focusFieldInternal(o,a,n)}},_focusFieldInternal:function(e,r,i){switch(e.type){case"number":case"text":case"range":case"color":case"toggle":case"select":case"textarea":case"content-editable":i.focus();break;case"object":this._focusObjectField(e,r,i);break;case"list":this._focusListField(e,r,i);break;default:this.options.focusField&&this.options.focusField(e,r,i,this);break}},onChangeInput:function(t){t.target===t.currentTarget&&this.processInput(f(t.target))},processInput:function(t,e){var r=t.attr("data-attribute"),i=t.attr("data-type");if(!!this.validateInput(i,t[0],r)){this.options.live&&this.updateCell(t,r,e);var n=this.getFieldValue(t[0],i),a=this.parse(i,n,t[0]);this.trigger("change:"+r,a,t[0],e)}},updateFieldsVisibility:function(){var t=this;this._attributeKeysInUse.forEach(function(e){t.updateBindings(e),t.updateDependants(e)})},updateDependants:function(t){var e=this,r=this._when,i=Object.keys(r),n=this._byPath,a=Object.keys(n),o=this.flatAttributes,s=u.call(this,i,t);s.forEach(function(x){var C=x.path,p=lt(r[C]);p.forEach(function(E){var k=E.path,w=E.expression,S=e._getBareExpression(w),T=e._getExpressionExtras(w),m=g(a,k);m.forEach(function(A){var M=A.path,N=A.comparisonWildcardValues,D=n[M],z=D.closest(".field"),_=z.hasClass("hidden"),j=l.call(e,S,N),V=e.isExpressionValid(j);z.toggleClass("hidden",!V);var W=T.otherwise;if(W&&W.unset&&e.options.live)if(V)_&&e.updateCell(D,M);else{e.unsetProperty(M);var Y=y(o,M);Y&&e.renderTemplate(null,Y,M,{replace:!0,hidden:!0}),e.afterPartialRender()}},e)},e)},this);function l(x,C){var p={};for(var E in x){var k=x[E];if(Array.isArray(k)){var w=E,S=k;p[w]=[];for(var T=S.length,m=0;m<T;m++){var A=S[m],M=l.call(this,A,C);p[w].push(M)}}else if(this._isComposite(x)){var N=E,D=k,z=l.call(this,D,C);p[N]=z}else{var _=E,j=k;V.call(this,_,j,C,p)}}return p;function V(W,Y,X,J){J[W]={};for(var Q in Y){var it=Y[Q],st=gt.call(this,Q,X);J[W][st]=it}function gt(nt,ut){for(var ft=this.pathWildcard||this.DEFAULT_PATH_WILDCARD,vt=[],xt=0,Et=nt.split("/"),Rt=Et.length,It=0;It<Rt;It++){var Wt=Et[It];Wt===ft&&(Wt=ut[xt]||ft,xt+=1),vt.push(Wt)}return vt.join("/")}}}function u(x,C){var p=C.split("/"),E=this.pathWildcard||this.DEFAULT_PATH_WILDCARD;return h(x,p,{pathWildcard:E})}function g(x,C){if(!Array.isArray(C))return[{path:C,pathWildcardValues:[],comparisonWildcardValues:[]}];var p=C;return p.indexOf(null)===-1?[{path:p.join("/"),pathWildcardValues:[],comparisonWildcardValues:[]}]:h(x,p,{comparisonWildcard:null})}function h(x,C,p){for(var E=p.pathWildcard,k=p.comparisonWildcard,w=[],S=C.length,T=x.length,m=0;m<T;m++){var A=x[m],M=J(A),N=M.length;if(N===S){for(var D=!0,z=[],_=[],j=0;j<N;j++){var V=M[j],W=C[j],Y=V===E,X=W===k;if(V!==W&&!Y&&!X){D=!1;break}Y?z.push(W):X&&_.push(V)}D&&w.push({path:A,pathWildcardValues:z,comparisonWildcardValues:_})}}return w;function J(Q){return Array.isArray(Q)?Q:Q.split("/")}}function y(x,C){var p=x[C];if(p!=null)return p;var E=C.split("/"),k=E.length,w=E[0];p=x[w];for(var S=p,T=1;T<k;T++){var m=E[T];if(p===void 0){w+="/"+m,S===void 0?p=x[w]:p=S[w];continue}if(S=p,p.type==="object"&&p.properties)p=p.properties[m];else if(p.type==="list"&&p.item)p=p.item;else if(typeof p.type!="string")p=p[m];else break;w=m}return p}},unsetProperty:function(t,e){var r=this.getModel(),i=t.split("/"),n=i[0],a=i.slice(1).join("/");if(e=e||{},e.inspector=this.cid,e["inspector_"+this.cid]=!0,t==="attrs")r.removeAttr(a,e);else if(t===n)r.unset(n,e);else{var o=r.get(n),s=o!==void 0?nn(o,a,"/"):void 0;r.set(n,s,e)}},getOptions:function(t){if(t.length!==0){var e=t.attr("data-attribute");return this.getOptionsFromPath(e)}},markForRemoval:function(t,e){var r=this.findParentListByPath(t);if(r){var i=t.substr(r.length+1),n=parseInt(i,10);Number.isFinite(n)&&(e.remove[r]=e.remove[r]||[],e.remove[r].includes(n)||e.remove[r].push(n))}},markForUpdate:function(t,e,r,i){var n=t.substr(i.length+1);e.update[i]&&Yr(e.update[i].value,n,r,"/")},updateCell:function(t,e,r){var i=this.getModel(),n={};t?n[e]=f(t):n=this._byPath,this.startBatchCommand();var a={},o={update:{},remove:{}};Ut(n,function(l,u){if(!l.closest(".field").hasClass("hidden")){var g=l.attr("data-type"),h=l.attr("data-overwrite"),y=h!=="false"&&h!==void 0,x=l.hasClass("remove");switch(g){case"list":x&&this.markForRemoval(u,o);break;case"object":x&&this.markForRemoval(u,o);break;default:if(!this.validateInput(g,l[0],u))return;var C=this.getFieldValue(l[0],g),p=this.parse(g,C,l[0]),E=this.getOptionsFromPath(u);if(E.valueRegExp){var k=Ye(i.attributes,u,"/")||E.defaultValue;p=k.replace(new RegExp(E.valueRegExp),"$1"+p+"$3")}if(x)this.markForRemoval(u,o);else{var w=E.parent;if(w&&w.type==="object"&&w.overwrite!==void 0&&w.overwrite!==!1){var S={},T=u.split("/"),m=T[T.length-1];S[m]=p,o.update[w.path]={value:S,overwrite:!0}}else a[u]={value:p,overwrite:y}}break}}}.bind(this)),Ut(a,function(l,u){this.setProperty(u,l.value,tt({overwrite:l.overwrite},r))}.bind(this));var s=Fe(Object.keys(o.remove),function(l){return l.split("/").length}).reverse();s.forEach(function(l){var u=o.remove[l];this.removeProperty(l,u,tt({rewrite:!0},r))}.bind(this)),Ut(o.update,function(l,u){this.setProperty(u,this.compactDeep(l.value),tt({rewrite:!0,overwrite:l.overwrite},r))}.bind(this)),this.updateFieldsVisibility(),this.updateGroupsVisibility(),this.stopBatchCommand()},compactDeep:function(t){return Array.isArray(t)?t.reduce(function(e,r){return r&&e.push(this.compactDeep(r)),e}.bind(this),[]):t},findParentListByPath:function(t){var e=t.split("/");e.pop();for(var r=e;r.length;){var i=this.getOptionsFromPath(r.join("/"));if(i&&i.type==="list")return e.slice(0,r.length).join("/");r.pop()}return null},getOptionsFromPath:function(t){for(var e=t.split("/"),r=this.expandAttributes,i,n=[];e.length;){var a,o=a;r&&r.type==="object"?a="properties":(a=e.shift(),(e.length||r.type==="list")&&(i=r,n.push(a)));var s=!Number.isNaN(parseInt(a));if(a=s&&r.type==="list"?"item":a,Object(r)===r&&(a in r||r[t]))r=r[a]||r[t];else return{}}return r=tt({},r),i=tt({},i),i.path=n.join("/"),o&&o==="properties"&&(i.type="object"),r.parent=i,r},getFieldValue:function(t,e){if(yt(this.options.getFieldValue)){var r=this.options.getFieldValue(t,e,this);if(r)return r.value}var i=f(t);switch(e){case"select-box":case"color-palette":case"select-button-group":var n=i.attr("data-attribute");return this.widgets[n].getSelectionValue();case"content-editable":return i.html().replace(/((<br\s*\/*>)?<\/div>)|(((&nbsp;)|(<br\s*\/*>))?<\/p>)|(<br\s*\/*>)/ig,`
`).replace(/(<([^>]+)>)/ig,"").replace(/&(\w+);/ig,this.replaceHTMLEntity).replace(/\n$/,"");default:return i.val()}},removeProperty:function(t,e,r){var i=this.getModel(),n=Be.prototype.prop,a=n.call(i,t);if(!!a){var o=a.reduce(function(l,u,g){return e.includes(g)||l.push(u),l},[]),s=this.flatAttributes[t];Array.isArray(o)&&o.length===0&&!s&&(o=null),n.call(i,t,o,r)}},setProperty:function(t,e,r){r=r||{},r.inspector=this.cid;var i=Be.prototype.prop,n=this.getModel(),a=r.overwrite||!1;if(r.previewDone&&i.call(n,t,r.originalValue,{rewrite:!0,silent:!0}),e===void 0)Be.prototype.removeProp.call(n,t,r);else{var o;if(Yt(e)&&!a){var s=i.call(n,t),l=Array.isArray(e)?[]:{};o=ie(l,s,e)}else o=be(e);a&&(r.rewrite=!0),i.call(n,t,o,r)}},parse:function(t,e,r){switch(t){case"number":case"range":e=parseFloat(e);break;case"toggle":e=r.checked;break}return e},startBatchCommand:function(){if(!this.inBatch){this.inBatch=!0;var t=this.getModel();t instanceof Be&&t.startBatch("inspector",{cid:this.cid})}},stopBatchCommand:function(){if(this.inBatch){var t=this.getModel();t instanceof Be&&t.stopBatch("inspector",{cid:this.cid}),this.inBatch=!1}},afterRender:function(){this.cacheInputs(),this.updateFieldsVisibility(),this.updateGroupsVisibility(),this.trigger("render")},afterPartialRender:function(){this.cacheInputs(),this.updateGroupsVisibility(),this.trigger("render")},addListItem:function(t){var e=f(t.target),r=e.parent("[data-attribute]"),i=this.getOptions(r),n=r.children(".list-items"),a=n.children(".list-item"),o=a.last(),s=o.length===0?-1:parseInt(o.attr("data-index"),10),l=s+1,u=this.renderListItem({index:l,options:i}),g=r.attr("data-attribute")+"/"+l;this.renderTemplate(u,i.item,g),n.append(u),a=n.children(".list-item");var h=a.not(".remove"),y=h.length;this.fixListButtons(r,y,i.min,i.max),this.afterPartialRender();var x=u[0];i.item.type!=="object"&&i.item.type!=="list"&&(x=x.querySelector("[data-attribute]")),this.options.live&&this.updateCell(),this._focusFieldInternal(i.item,g,x)},deleteListItem:function(t){var e=f(t.target),r=e.closest("[data-attribute]"),i=this.getOptions(r),n=e.closest(".list-item");n.hide(),n.addClass("remove"),n.find("[data-field]").each(function(){f(this).hide().addClass("remove")}),n.find("[data-attribute]").each(function(){f(this).hide().addClass("remove")});var a=r.children(".list-items"),o=a.children(".list-item"),s=o.not(".remove"),l=s.length;this.fixListButtons(r,l,i.min,i.max),this.afterPartialRender(),this.options.live&&this.updateCell()},fixListButtons:function(t,e,r,i){var n=function(g,h){return typeof h!="number"||typeof g!="number"?!0:g<h},a=function(g,h){return typeof h!="number"||h<=0?!0:typeof g!="number"||g<=0?!1:g>h},o=t.children(".btn-list-add"),s=n(e,i);s?o.removeClass("hidden"):o.addClass("hidden");var l=t.children(".list-items").children(".list-item").children(".btn-list-del"),u=a(e,r);u?l.removeClass("hidden"):l.addClass("hidden")},bindDocumentEvents:function(){var t=this.getEventNamespace();this.$document.on("mouseup"+t+" touchend"+t,this.pointerup)},unbindDocumentEvents:function(){this.$document.off(this.getEventNamespace())},pointerdown:function(t){t.stopPropagation(),this.bindDocumentEvents(),this.startBatchCommand(),this._$activeField=f(t.currentTarget).addClass("is-in-action")},pointerup:function(){this.unbindDocumentEvents(),this.stopBatchCommand(),this._$activeField&&(this._$activeField.removeClass("is-in-action"),this._$activeField=null)},pointerfocusin:function(t){t.stopPropagation(),f(t.currentTarget).addClass("is-focused")},pointerfocusout:function(t){t.stopPropagation(),f(t.currentTarget).removeClass("is-focused")},onRemove:function(){this.unbindDocumentEvents(),this.removeWidgets(),this===this.constructor.instance&&(this.constructor.instance=null)},removeWidgets:function(){var t=this.widgets;for(var e in t)t[e].remove();this.widgets={}},onGroupLabelClick:function(t){t.preventDefault(),this.options.multiOpenGroups||this.closeGroups();var e=f(t.target).closest(".group");this.toggleGroup(e)},toggleGroup:function(t){var e=$t(t)?this.$('.group[data-name="'+t+'"]'):f(t);e.hasClass("closed")?this.openGroup(e):this.closeGroup(e)},closeGroup:function(t,e){e=e||{};var r=$t(t)?this.$('.group[data-name="'+t+'"]'):f(t);(e.init||!r.hasClass("closed"))&&(r.addClass("closed"),this.trigger("group:close",r.data("name"),e))},openGroup:function(t,e){e=e||{};var r=$t(t)?this.$('.group[data-name="'+t+'"]'):f(t);(e.init||r.hasClass("closed"))&&(r.removeClass("closed"),this.trigger("group:open",r.data("name"),e))},closeGroups:function(){for(var t=0,e=this.$groups.length;t<e;t++)this.closeGroup(this.$groups[t])},openGroups:function(){for(var t=0,e=this.$groups.length;t<e;t++)this.openGroup(this.$groups[t])},COMPOSITE_OPERATORS:["not","and","or","nor"],PRIMITIVE_OPERATORS:["eq","ne","regex","text","lt","lte","gt","gte","in","nin","equal"],_isComposite:function(t){return Lo(this.COMPOSITE_OPERATORS,Object.keys(t)).length>0},_isPrimitive:function(t){var e=Object.keys(this.options.operators).concat(this.PRIMITIVE_OPERATORS);return Lo(e,Object.keys(t)).length>0},_evalCustomPrimitive:function(t,e,r,i){return!!this.options.operators[t].apply(this,[this.getModel(),e].concat(r).concat([i]))},_evalPrimitive:function(t){return Object.keys(t).reduce(function(e,r){var i=t[r];return Object.keys(i).reduce(function(n,a){var o=i[a],s=this.getCellAttributeValue(a);if(yt(this.options.operators[r]))return this._evalCustomPrimitive(r,s,o,a);switch(r){case"eq":return o==s;case"ne":return o!=s;case"regex":return new RegExp(o).test(s);case"text":return!o||$t(s)&&s.toLowerCase().indexOf(o)>-1;case"lt":return s<o;case"lte":return s<=o;case"gt":return s>o;case"gte":return s>=o;case"in":return Array.isArray(o)&&o.includes(s);case"nin":return Array.isArray(o)&&!o.includes(s);case"equal":return ze(o,s);default:return n}}.bind(this),!1)}.bind(this),!1)},_evalExpression:function(t){return this._isPrimitive(t)?this._evalPrimitive(t):Object.keys(t).reduce(function(e,r){var i=t[r];if(r=="not")return!this._evalExpression(i);var n=lt(i).map(this._evalExpression,this);switch(r){case"and":return n.every(function(a){return!!a});case"or":return n.some(function(a){return!!a});case"nor":return!n.some(function(a){return!!a});default:return e}}.bind(this),!1)},_getBareExpression:function(t){return Ce(t,"otherwise","dependencies")},_getExpressionExtras:function(t){return{otherwise:be(t.otherwise),dependencies:be(t.dependencies)}},_extractVariables:function(t){return Array.isArray(t)||this._isComposite(t)?lt(t).reduce(function(e,r){return e.concat(this._extractVariables(r))}.bind(this),[]):lt(t).reduce(function(e,r){return Object.keys(r)},[])},isExpressionValid:function(t){var e=this._getBareExpression(t);return this._evalExpression(e)},extractExpressionPaths:function(t){var e=t&&t.dependencies||[],r=this._getBareExpression(t);return mr(this._extractVariables(r).concat(e))},getGroupsStateKey:function(){if(yt(this.options.stateKey))return this.options.stateKey(this.getModel());throw new Error("Inspector: Option stateKey must be a function")},storeGroupsState:function(){var t=this.getGroupsStateKey(),e=lt(this.$(".group.closed"));An.groupStates[t]=e.map(function(r){return f(r).attr("data-name")})},getGroupsState:function(){return An.groupStates[this.getGroupsStateKey()]},restoreGroupsState:function(){var t=function(r,i){Ut(i.options.groups,function(n,a){r(n,a)?this.closeGroup(a):this.openGroup(a)}.bind(i))},e=this.getGroupsStateKey();An.groupStates[e]?t(function(r,i){return An.groupStates[e].includes(i)},this):t(function(r){return r.closed},this)}},{groupStates:{},instance:null,create:function(t,e){e=e||{},ne(e,{updateCellOnClose:!0,restoreGroupsState:!0,storeGroupsState:!0});var r=e.cell||e.cellView.model,i=this.instance;return(!i||i.getModel()!==r)&&(i&&i.el.parentNode&&(e.storeGroupsState&&i.storeGroupsState(),e.updateCellOnClose&&i.updateCell(),i.trigger("close"),i.remove()),i=new this(e).render(),this.instance=i,f(t).html(i.el),e.restoreGroupsState&&i.restoreGroupsState()),i},close:function(){var t=this.instance;if(t){var e=document.activeElement;f.contains(t.el,e)&&e.blur(),t.trigger("close"),t.remove()}}}),Ke=function(t){t===void 0&&(t={}),ke(this,"handleKey"),this.options=tt({},t),this.parser=new Gi,this.enable()};tt(Ke.prototype,d.Events),Ke.prototype.on=function(t,e,r){return d.Events.on.call(this,this.normalizeEvent(t),e,r),this},Ke.prototype.off=function(t,e,r){var i=t?this.normalizeEvent(t):null;return d.Events.off.call(this,i,e,r),this},Ke.prototype.normalizeEvent=function(t){if(typeof t=="object"){for(var e=Object.keys(t),r={},i=0,n=e.length;i<n;i++){var a=e[i];r[this.normalizeEvent(a)]=t[a]}return r}return this.normalizeShortcut(t)},Ke.prototype.normalizeShortcut=function(t){var e=t.toLowerCase();if(e in ms)return ms[e];for(var r=this.parser.toEventObjectList(t),i=[],n=0;n<r.length;n++)i.push(this.hash(r[n]));return i.join(" ")},Ke.prototype.enable=function(){window.addEventListener?(document.addEventListener("keydown",this.handleKey,!1),document.addEventListener("keypress",this.handleKey,!1),document.addEventListener("keyup",this.handleKey,!1)):window.attachEvent&&(document.attachEvent("keydown",this.handleKey,!1),document.attachEvent("keypress",this.handleKey,!1),document.attachEvent("keyup",this.handleKey,!1))},Ke.prototype.disable=function(){window.removeEventListener?(document.removeEventListener("keydown",this.handleKey,!1),document.removeEventListener("keypress",this.handleKey,!1),document.removeEventListener("keyup",this.handleKey,!1)):window.detachEvent&&(document.detachEvent("keydown",this.handleKey,!1),document.detachEvent("keypress",this.handleKey,!1),document.detachEvent("keyup",this.handleKey,!1))},Ke.prototype.isActive=function(t,e){return this.isModifierActive(t,e)},Ke.prototype.isModifierActive=function(t,e){for(var r=this.parser.toEventObjectList(t),i=0;i<r.length;i++)if(r[i].modifiersCompare(e))return!0;return!1},Ke.prototype.isKeyPrintable=function(t){if(!t)return!1;var e=t.key;return e?e.length===1||e==="Unidentified":!1},Ke.prototype.hash=function(t){var e=function(i){return i?1:0},r=[t.type,":",t.which,e(t.shiftKey),e(t.ctrlKey),e(t.altKey),e(t.metaKey)];return r.join("")},Ke.prototype.handleKey=function(t){var e=this.options.filter;if(typeof e=="function"){if(!e.call(this,t,this))return}else if(this.isConsumerElement(t))return;var r=Fi.fromNative(t);d.Events.trigger.call(this,this.hash(r),t),this.isKeyPrintable(t)&&d.Events.trigger.call(this,t.type+":printable",t)},Ke.prototype.isConsumerElement=function(t){var e=t.target||t.srcElement;if(e){var r=e.tagName.toUpperCase();return r==="INPUT"||r==="SELECT"||r==="TEXTAREA"||e.isContentEditable}return!1};var Gi=function(){};Gi.prototype={constructor:Gi,parseEventString:function(t){t=t||"";var e=t.split("+"),r,i=new Fi(0),n;for(n=0;n<e.length;n++){r=e[n];var a=this.getModifierPropertyName(r);a&&(i[a]=!0),(e.length===1||a===void 0)&&(i.which=Gi.getCode(r))}return i},toEventObjectList:function(t){var e=t.replace(/\s*\+\s*/gi,"+").split(" ");return e.map(this.composeEventObject,this)},composeEventObject:function(t){var e=t.split(":"),r=Kr.KEYDOWN,i=e[0];if(e.length>1&&(i=e[1],r=e[0]),TS.indexOf(r)===-1)throw t+": invalid shortcut definition";var n=this.parseEventString(i);return r===Kr.KEYUP&&ji[n.which]&&(n[ji[n.which]]=!1),n.setType(r)},getModifierPropertyName:function(t){var e=xv[t];return ji[e]}},Gi.getCode=function(t){return Av[t]||t.toUpperCase().charCodeAt(0)};var xv={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91,meta:91},ji={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},ps={226:"\\",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},Av={backspace:8,tab:9,shift:16,ctrl:17,alt:18,meta:91,clear:12,enter:13,return:13,esc:27,escape:27,capslock:20,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,insert:45,ins:45,pageup:33,pagedown:34,plus:187,minus:189,"-":189,",":188,".":190,"/":191,"`":192,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},ms={all:"all",printable:"keypress:printable","keypress:printable":"keypress:printable","keydown:printable":"keydown:printable","keyup:printable":"keyup:printable"};tt(Ke,{keyMap:Av,modifierMap:ji,modifiers:xv,charCodeAlternatives:ps,eventNamesMap:ms});var Kr={KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup"},TS=[Kr.KEYPRESS,Kr.KEYDOWN,Kr.KEYUP],Fi=function(t,e,r,i,n,a){this.which=t,this.shiftKey=e||!1,this.ctrlKey=r||!1,this.altKey=i||!1,this.metaKey=n||!1,this.type=a||Kr.KEYDOWN};Fi.fromNative=function(t){var e=t.which;t.type===Kr.KEYPRESS&&(e=String.fromCharCode(t.which).toUpperCase().charCodeAt(0)),ps[e]&&(e=Gi.getCode(ps[e]));var r=new Fi(e,t.shiftKey,t.ctrlKey,t.altKey,t.metaKey,t.type);return t.type===Kr.KEYUP&&ji[e]&&(r[ji[e]]=!1),r},Fi.prototype.modifiersCompare=function(t){return(this.shiftKey?this.shiftKey===t.shiftKey:!0)&&(this.ctrlKey?this.ctrlKey===t.ctrlKey:!0)&&(this.altKey?this.altKey===t.altKey:!0)&&(this.metaKey?this.metaKey===t.metaKey:!0)},Fi.prototype.setType=function(t){return this.type=t,this};var NS=Je.extend({className:Je.prototype.className+" lightbox",options:ie({},Je.prototype.options,{closeButton:!0,modal:!0,downloadable:!1,downloadAction:"download",fileName:"Image",closeAnimation:{delay:2e3,duration:200,easing:"swing",properties:{opacity:0}},top:100,windowArea:.8,openAnimation:!1}),init:function(){var t=arguments,e=this;if(ke(this,"startCloseAnimation","positionAndScale"),Je.prototype.init.apply(this,arguments),this.options.image&&(this.$image=f("<img/>").on("load",this.positionAndScale),this.options.content=this.$image),this.options.downloadable){var r={action:this.options.downloadAction,content:"Download",position:"center"};this.buttons=Array.isArray(this.buttons)?this.buttons.slice():[],this.buttons.push(r)}this.on("action:"+this.options.downloadAction,this.download),f(window).on("resize",this.positionAndScale),this.on("close:animation:complete",function(){Je.prototype.close.apply(e,t)})},open:function(){return Je.prototype.open.apply(this,arguments),this.$image&&this.$image.attr("src",this.options.image),this.positionAndScale(),this.startOpenAnimation(),this},positionAndScale:function(){var t=this.$(".fg"),e=this.$(".body > img"),r=this.$(".titlebar"),i=this.$(".controls"),n=this.options.windowArea,a=window.innerWidth*n;this.$el.css("margin-top",this.options.top),r.css("width",a);var o=r.height(),s=i.height(),l=window.innerHeight*n-this.options.top-o-s;t.css({width:a,height:l});var u=e.width(),g=e.height();t.css({width:u,height:g}),r.css("width","auto"),r.hasClass("empty")||i.css("top",r.outerHeight())},download:function(){ko(this.options.image,function(t,e){wf(e,this.options.fileName)}.bind(this))},close:function(){return this.options.closeAnimation?this.startCloseAnimation():Je.prototype.close.apply(this,arguments),this},onRemove:function(){Je.prototype.onRemove.apply(this,arguments),f(window).off("resize",this.positionAndScale),this.$image&&this.$image.off("load",this.positionAndScale)},startCloseAnimation:function(){this.$el.animate(this.options.closeAnimation.properties,tt({complete:function(){this.trigger("close:animation:complete")}.bind(this)},this.options.closeAnimation))},startOpenAnimation:function(){this.$el.animate(tt({},this.options.openAnimation.properties,{height:this._foregroundHeight}),tt({complete:function(){this.trigger("open:animation:complete")}.bind(this)},this.options.openAnimation))}}),LS=Xt.extend({className:"navigator",events:{mousedown:"startAction",touchstart:"startAction","mousedown .joint-paper":"scrollTo","touchstart .joint-paper":"scrollTo"},documentEvents:{mousemove:"doAction",touchmove:"doAction",mouseup:"stopAction",touchend:"stopAction"},options:{paperConstructor:Oe,paperOptions:{},zoomOptions:null,zoom:{min:.5,max:2},width:300,height:200,padding:10},init:function(){this.options.zoomOptions?this.options.zoom=tt({},this.options.zoom,this.options.zoomOptions):this.options.zoom&&(this.options.zoom=ne({},this.options.zoom,this.constructor.prototype.options.zoom)),ke(this,"updateCurrentView","doAction","stopAction","scrollTo"),this.updateCurrentView=sn(this.updateCurrentView,0);var t=this.options.paperScroller;t.$el.on("scroll"+this.getEventNamespace(),this.updateCurrentView);var e=this.sourcePaper=t.options.paper;this.toggleUseContentBBox(this.options.useContentBBox),this.targetPaper=new this.options.paperConstructor(ie({model:e.model,interactive:!1,frozen:!0},this.options.paperOptions))},startListening:function(){var t=this,e=this,r=e.options,i=e.sourcePaper;r.useContentBBox?this.listenTo(i,"render:done",function(){return t.updatePaper()}):this.listenTo(i,"resize",function(){return t.updatePaper()})},render:function(){if(this.targetPaper.$el.appendTo(this.el),this.targetPaper.unfreeze(),this.$currentView=f("<div>").addClass("current-view"),this.options.zoom){var t=f("<div>").addClass("current-view-control");this.$currentView.append(t)}return this.$el.append(this.$currentView).css({width:this.options.width,height:this.options.height,padding:this.options.padding}),this.updatePaper(),this},freeze:function(e){this.targetPaper.freeze(e)},unfreeze:function(e){this.targetPaper.unfreeze(e)},CONTENT_BBOX_CLASS_NAME:"navigator-use-content-bbox",NO_CONTENT_CLASS_NAME:"navigator-no-content",toggleUseContentBBox:function(t){t===void 0&&(t=!1);var e=this,r=e.CONTENT_BBOX_CLASS_NAME,i=e.$el,n=e.targetPaper;this.options.useContentBBox=t,this.stopListening(),this.startListening(),i.toggleClass(r,Boolean(t)),n&&this.updatePaper()},updatePaper:function(){var t=this,e=t.sourcePaper,r=t.targetPaper,i=t.options,n=t.$el,a=t.NO_CONTENT_CLASS_NAME,o=i.useContentBBox,s=o?e.getContentBBox(o):e.getComputedSize(),l=n.hasClass(a);if(s.width>0&&s.height>0)l&&(n.removeClass(a),r.unfreeze({key:"navigator"})),this.updatePaperWithBBox(s),this.updateCurrentView();else{if(l)return;n.addClass(a),r.freeze({key:"navigator"})}},updatePaperWithBBox:function(t){var e=t.width,r=t.height,i=t.x;i===void 0&&(i=0);var n=t.y;if(n===void 0&&(n=0),!(!e||!r)){var a=this,o=a.sourcePaper,s=a.targetPaper,l=a.options,u=o.matrix(),g=u.a,h=u.d,y=u.e,x=u.f,C=l.padding,p=l.width-2*C,E=l.height-2*C;e/=g,r/=h;var k=this.ratio=Math.min(p/e,E/r);e*=k,r*=k;var w=(y-i)*k/g,S=(x-n)*k/h;s.setDimensions(e,r),s.setOrigin(w,S),s.scale(k,k)}},updateCurrentView:function(){var t=this.ratio,e=this.sourcePaper.scale(),r=this.options.paperScroller,i=r.clientToLocalPoint(0,0),n=this.targetPaper.$el.position(),a=this.targetPaper.translate();a.ty=a.ty||0,this.currentViewGeometry={top:n.top+i.y*t+a.ty,left:n.left+i.x*t+a.tx,width:r.$el.innerWidth()*t/e.sx,height:r.$el.innerHeight()*t/e.sy},this.$currentView.css(this.currentViewGeometry)},startAction:function(t){t=ot(t);var e=t.clientX,r=t.clientY,i=f(t.target).hasClass("current-view-control")?"zooming":"panning",n=this,a=n.options,o=n.currentViewGeometry,s=n.sourcePaper,l=a.paperScroller;switch(this.delegateDocumentEvents(null,{action:i,startClientX:e,startClientY:r,startScrollLeft:l.el.scrollLeft,startScrollTop:l.el.scrollTop,startZoom:l.zoom(),startGeometry:o,startScale:s.scale()}),i){case"panning":{this.trigger("pan:start",t);break}case"zooming":{this.trigger("zoom:start",t);break}}},doAction:function(t){t=ot(t);var e=t.clientX,r=t.clientY,i=t.data,n=this,a=n.sourcePaper,o=n.options,s=n.ratio,l=i.action,u=i.startClientX,g=i.startClientY,h=i.startScrollLeft,y=i.startScrollTop,x=i.startZoom,C=i.startGeometry,p=i.startScale,E=i.frameId,k=o.paperScroller,w=o.zoom;switch(l){case"panning":{var S=a.scale(),T=S.sx,m=S.sy,A=(e-u)*T,M=(r-g)*m;k.el.scrollLeft=h+A/s,k.el.scrollTop=y+M/s;break}case"zooming":{var N=C.width,D=1+(u-e)/N/p.sx;Ti(E),i.frameId=Pi(function(){k.zoom(D*x,ne({absolute:!0},w))});break}}},stopAction:function(t){switch(this.undelegateDocumentEvents(),t.data.action){case"panning":{this.trigger("pan:stop",t);break}case"zooming":{this.trigger("zoom:stop",t);break}}},scrollTo:function(t){t=ot(t);var e=this.targetPaper.translate();e.ty=e.ty||0;var r,i;if(t.offsetX===void 0){var n=this.targetPaper.$el.offset();r=t.pageX-n.left,i=t.pageY-n.top}else r=t.offsetX,i=t.offsetY;var a=(r-e.tx)/this.ratio,o=(i-e.ty)/this.ratio;this.options.paperScroller.center(a,o)},onRemove:function(){this.targetPaper.remove(),this.options.paperScroller.$el.off(this.getEventNamespace())}}),Vi=function(t,e){this.options=tt({friction:.92},e),this._isDragging=!1,this._dragLastX=0,this._dragLastY=0,this._dragDeltaX=0,this._dragDeltaY=0,this._dragLastDeltaX=0,this._dragLastDeltaY=0,this._velocityX=0,this._velocityY=0,this._requestAnimationFrameId=-1,this.onInertiaMove=t};Vi.prototype.approxZero=function(t){return Math.abs(t)<.5},Vi.prototype.updateVelocity=function(){var t=this,e=t._velocityX,r=t._velocityY,i=t._isDragging,n=t.options,a=t.onInertiaMove;if(!(!i&&this.approxZero(e)&&this.approxZero(r)))if(this._requestAnimationFrameId=Pi(this.updateVelocity.bind(this)),i)this._dragLastDeltaX=this._dragDeltaX,this._dragLastDeltaY=this._dragDeltaY,this._dragDeltaX=this._dragLastX,this._dragDeltaY=this._dragLastY,this._velocityX=this._dragDeltaX-this._dragLastDeltaX,this._velocityY=this._dragDeltaY-this._dragLastDeltaY;else{var o=e,s=r,l=n.friction;this._velocityX*=l,this._velocityY*=l,this._dragLastX+=o,this._dragLastY+=s,typeof a=="function"&&a(o,s)}},Vi.prototype.handleDragStart=function(t){this._isDragging=!0,this._dragLastX=t.clientX,this._dragLastY=t.clientY,this._velocityX=0,this._velocityY=0,Ti(this._requestAnimationFrameId),this.updateVelocity()},Vi.prototype.handleDragMove=function(t){this._dragLastX=t.clientX,this._dragLastY=t.clientY},Vi.prototype.handleDragEnd=function(t){this._isDragging=!1};var ys=Xt.extend({className:"paper-scroller",events:{scroll:"onScroll"},options:{paper:void 0,padding:function(){var t=this.getClientSize(),e=Math.max(this.options.minVisiblePaperSize,1)||1,r={};return r.left=r.right=Math.max(t.width-e,0),r.top=r.bottom=Math.max(t.height-e,0),r},scrollWhileDragging:!1,minVisiblePaperSize:50,autoResizePaper:!1,baseWidth:void 0,baseHeight:void 0,contentOptions:void 0,cursor:"default",inertia:!1,borderless:!1},_padding:{left:0,top:0},init:function(){var t=this;ke(this,"startPanning","stopPanning","pan","onBackgroundEvent");var e=this,r=e.options,i=e.el,n=r.paper,a=r.autoResizePaper,o=r.scrollWhileDragging,s=r.cursor,l=r.inertia,u=n.scale();this._sx=u.sx,this._sy=u.sy,r.baseWidth===void 0&&(r.baseWidth=n.options.width),r.baseHeight===void 0&&(r.baseHeight=n.options.height),this.$background=f("<div/>").addClass("paper-scroller-background").css({width:n.options.width,height:n.options.height}).append(n.el).appendTo(i),this.listenTo(n,"scale",this.onScale).listenTo(n,"resize",this.onResize).listenTo(n,"beforeprint beforeexport",this.storeScrollPosition).listenTo(n,"afterprint afterexport",this.restoreScrollPosition),a&&this.listenTo(n,"render:done",this.onPaperRenderDone),o&&(this.listenTo(n,"cell:pointermove",this.onCellPointermove),this.listenTo(n,"cell:pointerup",this.onCellPointerup)),this.debouncedStoreCenter=sn(function(){return t.storeCenter()}),this.storeCenter(n.options.width/2,n.options.height/2),this.delegateBackgroundEvents(),this.setCursor(s),l&&(this.inertia=new Vi(function(g,h){var y=this,x=y.el;x.scrollTop-=h,x.scrollLeft-=g}.bind(this),l))},onCellPointermove:function(t,e,r,i){var n=this.options,a=n.scrollWhileDragging;!a||this.scrollWhileDragging(e,r,i,a)},onCellPointerup:function(t,e){this.stopScrollWhileDragging(e)},scrollWhileDragging:function(t,e,r,i){i===void 0&&(i={});var n=this,a=n.el,o=i.interval;o===void 0&&(o=25);var s=i.padding;s===void 0&&(s=-20);var l=i.scrollingFunction;l===void 0&&(l=function(j){return j<20?5:20});var u=this.eventData(t),g=u.scrollId,h=new Z(e,r),y=he(s),x=y.top,C=y.left,p=y.right,E=y.bottom,k=this.getVisibleArea().moveAndExpand({x:-C,y:-x,width:C+p,height:x+E});if(k.containsPoint(h)){clearInterval(g),this.eventData(t,{scrollId:null});return}var w=k.pointNearestToPoint(h),S=w.distance(h),T=l.call(this,S,t),m=k.x,A=k.y,M=k.width,N=k.height,D=e<m?-1:e>m+M?1:0,z=r<A?-1:r>A+N?1:0;if(this.eventData(t,{scrollX:D,scrollY:z,scrollPerTick:T,container:a}),!g){var _=this.eventData(t);g=setInterval(function(j){var V=j.scrollPerTick,W=j.scrollX,Y=j.scrollY,X=j.container;X.scrollLeft+=V*W,X.scrollTop+=V*Y},o,_),_.scrollId=g}},stopScrollWhileDragging:function(t){var e=this.eventData(t),r=e.scrollId;r&&clearInterval(r)},onPaperRenderDone:function(t){t.priority<2&&this.adjustPaper()},lock:function(){return this.$el.css("overflow","hidden"),this},unlock:function(){return this.$el.css("overflow","scroll"),this},setCursor:function(t){switch(t){case"grab":this.$el.css("cursor","");break;default:this.$el.css("cursor",t);break}return this.$el.attr("data-cursor",t),this.options.cursor=t,this},delegateBackgroundEvents:function(t){t||(t=re(this.options.paper,"events"));var e=this.paperEvents=Object.keys(t||{}).reduce(r.bind(this),{});Object.keys(e).forEach(i,this);function r(n,a){var o=t[a];return a.indexOf(" ")===-1&&(n[a]=yt(o)?o:this.options.paper[o]),n}function i(n){this.delegate(n,{guarded:!1},this.onBackgroundEvent)}return this},onBackgroundEvent:function(t){if(this.$background.is(t.target)){var e=this.paperEvents[t.type];yt(e)&&e.apply(this.options.paper,arguments)}},onScroll:function(t){this.trigger("scroll",t),this.debouncedStoreCenter()},onResize:function(){this.restoreCenter()},onScale:function(t,e,r,i){this.adjustScale(t,e),this._sx=t,this._sy=e,(r||i)&&this.center(r,i);var n=this.options,a=n.contentOptions,o=n.borderless;(typeof a=="function"||o)&&this.adjustPaper()},storeScrollPosition:function(){this._scrollLeftBeforePrint=this.el.scrollLeft,this._scrollTopBeforePrint=this.el.scrollTop},restoreScrollPosition:function(){this.el.scrollLeft=this._scrollLeftBeforePrint,this.el.scrollTop=this._scrollTopBeforePrint,this._scrollLeftBeforePrint=null,this._scrollTopBeforePrint=null},beforePaperManipulation:function(){(cr.test("msie")||cr.test("msedge"))&&this.$el.css("visibility","hidden")},afterPaperManipulation:function(){(cr.test("msie")||cr.test("msedge"))&&this.$el.css("visibility","visible")},clientToLocalPoint:function(t,e){var r=this.options.paper.matrix();return t+=this.getLTRScrollLeft()-this._padding.left-r.e,t/=r.a,e+=this.el.scrollTop-this._padding.top-r.f,e/=r.d,new Z(t,e)},localToBackgroundPoint:function(t,e){var r=new Z(t,e),i=this.options.paper.matrix(),n=this._padding;return F.transformPoint(r,i).offset(n.left,n.top)},getPadding:function(){var t=this.options.padding;return yt(t)&&(t=t.call(this,this)),he(t)},computeRequiredPadding:function(t){var e=this.options.paper.scale(),r=e.sx,i=e.sy,n=this.getCenter(),a=n.x,o=n.y;a*=r,o*=i;var s=t.x,l=t.y,u=s+t.width,g=l+t.height,h=this.getClientSize(),y=h.width/2,x=h.height/2,C=this.getPadding(),p=C.left,E=C.right,k=C.top,w=C.bottom;return{left:Math.max(y-p-a+s,0)+p,right:Math.max(y-E+a-u,0)+E,top:Math.max(x-k-o+l,0)+k,bottom:Math.max(x-w+o-g,0)+w}},addPadding:function(){var t=this.options,e=t.borderless,r=t.paper,i,n,a,o;if(e)i=n=a=o=0;else{var s=r.scale(),l=s.sx,u=s.sy,g=r.getArea(),h=this.computeRequiredPadding(g.scale(l,u,{x:0,y:0}));i=Math.round(h.left),n=Math.round(h.right),a=Math.round(h.top),o=Math.round(h.bottom)}this._padding={left:i,top:a,bottom:o,right:n};var y=r.getComputedSize(),x=y.width,C=y.height;return this.$background.css({width:i+x+n,height:a+C+o}),r.$el.css({left:i,top:a}),this},storeCenter:function(t,e){var r=Nt(t)?new Z(t,e):this.computeCenter();this._center=r},restoreCenter:function(){var t=this._center;!t||this.center(t.x,t.y)},getCenter:function(){return this._center||(this._center=this.options.paper.getArea().center()),this._center},computeCenter:function(){var t=this.getClientSize(),e=t.width,r=t.height;return this.clientToLocalPoint(e/2,r/2)},adjustPaper:function(){var t=this.options,e=t.paper,r=t.borderless,i=t.contentOptions;typeof i=="function"&&(i=i.call(this,this));var n=tt({gridWidth:this.options.baseWidth,gridHeight:this.options.baseHeight,allowNewOrigin:"negative"},i);if(r){var a=e.getFitToContentArea(this.transformContentOptions(n)),o=e.scale(),s=o.sx,l=o.sy;a.x*=s,a.y*=l,a.width*=s,a.height*=l;var u=this.computeRequiredPadding(a),g=u.left,h=u.right,y=u.top,x=u.bottom;a.moveAndExpand({x:-g,y:-y,width:g+h,height:y+x}),e.setOrigin(-a.x,-a.y),e.setDimensions(a.width,a.height)}else e.fitToContent(this.transformContentOptions(n));return this},adjustScale:function(t,e){var r=this.options,i=r.paper,n=i.options,a=t/this._sx,o=e/this._sy;i.setOrigin(n.origin.x*a,n.origin.y*o),i.setDimensions(n.width*a,n.height*o)},transformContentOptions:function(t){var e=this._sx,r=this._sy;return t.gridWidth&&(t.gridWidth*=e),t.gridHeight&&(t.gridHeight*=r),t.minWidth&&(t.minWidth*=e),t.minHeight&&(t.minHeight*=r),Yt(t.padding)?t.padding={left:(t.padding.left||0)*e,right:(t.padding.right||0)*e,top:(t.padding.top||0)*r,bottom:(t.padding.bottom||0)*r}:Nt(t.padding)&&(t.padding=t.padding*e),t},center:function(t,e,r){var i=this.options,n=i.paper,a=n.matrix(),o=a.a,s=a.d,l=a.e,u=a.f,g=Nt(t),h=Nt(e),y;if(!g&&!h){y=t;var x=n.getComputedSize(),C=-l,p=-u;t=(C+x.width)/2,e=(p+x.height)/2}else y=r,g||(t=this.getVisibleArea().center().x),h||(e=this.getVisibleArea().center().y),t*=o,e*=s;return this.storeCenter(t/o,e/s),this.addPadding(),this.scroll(t,e,y),this},centerContent:function(t){return this.positionContent("center",t)},centerElement:function(t,e){return this.checkElement(t,"centerElement"),this.positionElement(t,"center",e)},positionContent:function(t,e){var r=this.options.paper.getContentArea(e);return this.positionRect(r,t,e)},positionElement:function(t,e,r){this.checkElement(t,"positionElement");var i=t.getBBox();return this.positionRect(i,e,r)},positionRect:function(t,e,r){var i;switch(e){case"center":return i=t.center(),this.positionPoint(i,"50%","50%",r);case"top":return i=t.topMiddle(),this.positionPoint(i,"50%",0,r);case"top-right":return i=t.topRight(),this.positionPoint(i,"100%",0,r);case"right":return i=t.rightMiddle(),this.positionPoint(i,"100%","50%",r);case"bottom-right":return i=t.bottomRight(),this.positionPoint(i,"100%","100%",r);case"bottom":return i=t.bottomMiddle(),this.positionPoint(i,"50%","100%",r);case"bottom-left":return i=t.bottomLeft(),this.positionPoint(i,0,"100%",r);case"left":return i=t.leftMiddle(),this.positionPoint(i,0,"50%",r);case"top-left":return i=t.topLeft(),this.positionPoint(i,0,0,r);default:throw new Error("Provided positionName ('"+e+"') was not recognized.")}},positionPoint:function(t,e,r,i){i=i||{};var n=he(i.padding),a=new at(this.getClientSize()),o=a.clone().moveAndExpand({x:n.left,y:n.top,width:-n.right-n.left,height:-n.top-n.bottom}),s=pe(e);e=parseFloat(e),s&&(e=e/100*Math.max(0,o.width)),e<0&&(e=o.width+e);var l=pe(r);r=parseFloat(r),l&&(r=r/100*Math.max(0,o.height)),r<0&&(r=o.height+r);var u=o.origin().offset(e,r),g=a.center(),h=g.difference(u),y=this.zoom(),x=h.scale(1/y,1/y),C=t.clone().offset(x);return this.center(C.x,C.y,i)},scroll:function(t,e,r){var i=this.options.paper.matrix(),n=this.getClientSize(),a={};if(Nt(t)){var o=n.width/2;a.scrollLeft=this.getScrollLeftFromLTR(t-o+i.e+(this._padding.left||0))}if(Nt(e)){var s=n.height/2;a.scrollTop=e-s+i.f+(this._padding.top||0)}r&&r.animation?this.$el.animate(a,r.animation):this.$el.prop(a)},scrollToContent:function(t){var e=this.options.paper.getContentArea(t).center(),r=this._sx,i=this._sy;return e.x*=r,e.y*=i,this.scroll(e.x,e.y,t)},scrollToElement:function(t,e){this.checkElement(t,"scrollToElement");var r=t.getBBox().center(),i=this._sx,n=this._sy;return r.x*=i,r.y*=n,this.scroll(r.x,r.y,e)},zoom:function(t,e){if(e===void 0&&(e={}),t===void 0)return this._sx;var r=this.computeCenter(),i=t,n=t,a,o;if(!e.absolute){var s=1e12,l=function(h,y){return(h*s+y*s)/s};i=l(this._sx,i),n=l(this._sy,n)}if(e.grid&&(i=Math.round(i/e.grid)*e.grid,n=Math.round(n/e.grid)*e.grid),e.max&&(i=Math.min(e.max,i),n=Math.min(e.max,n)),e.min&&(i=Math.max(e.min,i),n=Math.max(e.min,n)),e.ox===void 0||e.oy===void 0)a=r.x,o=r.y;else{var u=i/this._sx,g=n/this._sy;a=e.ox-(e.ox-r.x)/u,o=e.oy-(e.oy-r.y)/g}return this.beforePaperManipulation(),this.options.paper.scale(i,n),this.center(a,o),this.afterPaperManipulation(),this},zoomToRect:function(t,e){e===void 0&&(e={}),t=new at(t);var r=this.options.paper,i=tt({},r.options.origin);e.fittingBBox=e.fittingBBox||tt({},new Z(i),{width:this.$el.width(),height:this.$el.height()}),e.contentArea=t,this.beforePaperManipulation(),r.scaleContentToFit(e);var n=t.center();return this.adjustPaper(),this.center(n.x,n.y),this.afterPaperManipulation(),this},zoomToFit:function(t){t===void 0&&(t={});var e=this.options.paper,r=e.getContentArea(t);return this.zoomToRect(r,t),this},transitionClassName:"transition-in-progress",transitionEventName:"transitionend.paper-scroller-transition",transitionToPoint:function(t,e,r){Yt(t)&&(r=e,e=t.y,t=t.x),r||(r={});var i=this._sx,n=Math.max(r.scale||i,1e-6),a=new Z(t,e),o=this.computeCenter(),s,l;if(i===n){var u=o.difference(a).scale(i,i).round();s="translate("+u.x+"px,"+u.y+"px)"}else{var g=n/(i-n)*a.distance(o),h=o.clone().move(a,g),y=this.localToBackgroundPoint(h).round();s="scale("+n/i+")",l=y.x+"px "+y.y+"px"}return this.$el.addClass(this.transitionClassName),this.$background.off(this.transitionEventName).on(this.transitionEventName,function(x){var C=this.paperScroller;C.syncTransition(this.scale,{x:this.x,y:this.y});var p=this.onTransitionEnd;yt(p)&&p.call(C,x)}.bind({paperScroller:this,scale:n,x:t,y:e,onTransitionEnd:r.onTransitionEnd})).css({transition:"transform",transitionDuration:r.duration||"1s",transitionDelay:r.delay,transitionTimingFunction:r.timingFunction,transformOrigin:l,transform:s}),this},syncTransition:function(t,e){return this.beforePaperManipulation(),this.options.paper.scale(t),this.removeTransition().center(e.x,e.y),this.afterPaperManipulation(),this},removeTransition:function(){return this.$el.removeClass(this.transitionClassName),this.$background.off(this.transitionEventName).css({transition:"",transitionDuration:"",transitionDelay:"",transitionTimingFunction:"",transform:"",transformOrigin:""}),this},transitionToRect:function(t,e){e===void 0&&(e={}),t=new at(t);var r=e.maxScale||1/0,i=e.minScale||Number.MIN_VALUE,n=e.scaleGrid||null,a=e.visibility||1,o=e.center?new Z(e.center):t.center(),s=this.getClientSize(),l=s.width*a,u=s.height*a,g=new at({x:o.x-l/2,y:o.y-u/2,width:l,height:u}),h=g.maxRectUniformScaleToFit(t,o);return h=Math.min(h,r),n&&(h=Math.floor(h/n)*n),h=Math.max(i,h),this.transitionToPoint(o,ne({scale:h},e)),this},startPanning:function(t){t=ot(t),this._clientX=t.clientX,this._clientY=t.clientY,this.trigger("pan:start",t),this.delegatePanning(),this.options.inertia&&this.inertia.handleDragStart(t)},pan:function(t){t=ot(t);var e=t.clientX-this._clientX,r=t.clientY-this._clientY;this.el.scrollTop-=r,this.el.scrollLeft-=e,this._clientX=t.clientX,this._clientY=t.clientY,this.options.inertia&&this.inertia.handleDragMove(t)},stopPanning:function(t){this.undelegatePanning(),t&&(t=ot(t)),this.trigger("pan:stop",t),this.options.inertia&&this.inertia.handleDragEnd(t)},delegatePanning:function(){this.$el.addClass("is-panning"),f(document.body).on({"mousemove.panning touchmove.panning":this.pan,"mouseup.panning touchend.panning":this.stopPanning}),f(window).on("mouseup.panning",this.stopPanning)},undelegatePanning:function(){this.$el.removeClass("is-panning"),f(document.body).off(".panning"),f(window).off(".panning")},getClientSize:function(){var t=this.el,e=t.clientWidth,r=t.clientHeight;return{width:e,height:r}},getVisibleArea:function(){var t=this.options.paper.matrix(),e=this.getClientSize(),r={x:this.getLTRScrollLeft(),y:this.el.scrollTop||0,width:e.width,height:e.height},i=F.transformRect(r,t.inverse());return i.x-=(this._padding.left||0)/this._sx,i.y-=(this._padding.top||0)/this._sy,new at(i)},isElementVisible:function(t,e){this.checkElement(t,"isElementVisible"),e=e||{};var r=e.strict?"containsRect":"intersect";return!!this.getVisibleArea()[r](t.getBBox())},isPointVisible:function(t){return this.getVisibleArea().containsPoint(t)},checkElement:function(t,e){if(!(t&&t instanceof At))throw new TypeError("ui.PaperScroller."+e+"() accepts instance of dia.Element only")},onRemove:function(){this.undelegatePanning()},isRTLDirection:function(){return getComputedStyle(this.el).direction==="rtl"},getLTRScrollLeft:function(){var e=this,r=e.el;if(this.isRTLDirection()){var i=r.scrollLeft,n=r.scrollWidth,a=r.clientWidth;return n-a+i}return r.scrollLeft},getScrollLeftFromLTR:function(e){if(this.isRTLDirection()){var r=this.el,i=r.scrollWidth,n=r.clientWidth,a=e-(i-n);return a}return e}});cr.addTest("msie",function(){var t=window.navigator.userAgent;return t.indexOf("MSIE")!==-1||t.indexOf("Trident")!==-1}),cr.addTest("msedge",function(){return/Edge\/\d+/.test(window.navigator.userAgent)});var ES=Xt.extend({tagName:"g",svgElement:!0,className:"path-drawer",events:{"mousedown .start-point":"onStartPointPointerDown",mousedown:"onPointerDown","touchstart .start-point":"onStartPointPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick",contextmenu:"onContextMenu"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{pathAttributes:{class:null,fill:"#ffffff",stroke:"#000000","stroke-width":1,"pointer-events":"none"},startPointMarkup:'<circle r="5"/>',snapRadius:0},init:function(){var t=this.svgTarget=F(this.options.target);this.path=new rt,this.$document=f(t.node.ownerDocument),this.action="awaiting-input",this.render()},onRemove:function(){var t=this,e=t.pathNode;e&&F(e).remove(),this.clear()},clear:function(){var t=this,e=t.path,r=t.pathNode;r&&e&&e.segments.length<=1&&F(r).remove(),this.svgStart.remove(),this.svgControl.remove(),this.pathNode=null,this.path=new rt,this.undelegateDocumentEvents(),this.action="awaiting-input",this.trigger("clear")},render:function(){var t=this,e=t.options;return this.svgPathTemplate=F("path").attr(e.pathAttributes),this.svgStart=F(e.startPointMarkup).addClass("start-point"),this.svgControl=F("path").addClass("control-path"),this.vel.append(F("rect",{x:0,y:0,width:"100%",height:"100%",fill:"transparent",stroke:"none"})),this.svgTarget.append(this.el),this},createPath:function(t,e){var r=this.svgPathTemplate.clone(),i=this.pathNode=r.node,n=this.svgStart.translate(t,e,{absolute:!0});this.trigger("path:create",i),this.addMoveSegment(t,e),this.vel.before(r),this.vel.append(n)},closePath:function(){var t=this,e=t.path,r=t.pathNode,i=e.getSegment(0),n=e.getSegment(e.segments.length-1);n.type==="L"?e.replaceSegment(e.segments.length-1,rt.createSegment("Z")):(n.end.x=i.end.x,n.end.y=i.end.y,e.appendSegment(rt.createSegment("Z"))),r.setAttribute("d",e.toString()),this.finishPath("path:close")},finishPath:function(t){var e=this,r=e.path,i=e.pathNode;r&&this.numberOfVisibleSegments()>0?(this.trigger("path:finish",i),this.trigger(t,i)):this.trigger("path:abort",i),this.clear()},numberOfVisibleSegments:function(){var t=this,e=t.path,r=e.segments.length;return r-=1,e.getSegment(e.segments.length-1).type==="Z"&&(r-=1),r},addMoveSegment:function(t,e){var r=this,i=r.path,n=r.pathNode,a=rt.createSegment("M",t,e);i.appendSegment(a),n.setAttribute("d",i.toString()),this.trigger("path:segment:add",n),this.trigger("path:move-segment:add",n)},addLineSegment:function(t,e){var r=this,i=r.path,n=r.pathNode,a=rt.createSegment("L",t,e);i.appendSegment(a),n.setAttribute("d",i.toString()),this.trigger("path:segment:add",n),this.trigger("path:line-segment:add",n)},addCurveSegment:function(t,e,r,i,n,a){var o=this,s=o.path,l=o.pathNode,u=rt.createSegment("C",r,i,n||t,a||e,t,e);s.appendSegment(u),l.setAttribute("d",s.toString()),this.trigger("path:segment:add",l),this.trigger("path:curve-segment:add",l)},adjustLastSegment:function(t,e,r,i,n,a){var o=this,s=o.path,l=o.pathNode,u=this.options.snapRadius;if(u){var g=this.snapLastSegmentCoordinates(t,e,u);t=g.x,e=g.y}var h=s.getSegment(s.segments.length-1);t!=null&&(h.end.x=t),e!=null&&(h.end.y=e),r!=null&&(h.controlPoint1.x=r),i!=null&&(h.controlPoint1.y=i),n!=null&&(h.controlPoint2.x=n),a!=null&&(h.controlPoint2.y=a),l.setAttribute("d",s.toString()),this.trigger("path:edit",l),this.trigger("path:last-segment:adjust",l)},snapLastSegmentCoordinates:function(t,e,r){for(var i=this,n=i.path,a=!1,o=!1,s=t,l=e,u=n.segments.length-2;u>=0&&!(a&&o);u--){var g=n.getSegment(u),h=g.end.x,y=g.end.y;!a&&Math.abs(h-t)<r&&(s=h,a=!0),!o&&Math.abs(y-e)<r&&(l=y,o=!0)}return new Z(s,l)},removeLastSegment:function(){var t=this,e=t.path,r=t.pathNode;e.removeSegment(e.segments.length-1),r.setAttribute("d",e.toString()),this.trigger("path:edit",r),this.trigger("path:last-segment:remove",r)},findControlPoint:function(t,e){var r=this,i=r.path,n=i.getSegment(i.segments.length-1);return new Z(t,e).reflection({x:n.end.x,y:n.end.y})},replaceLastSegmentWithCurve:function(){var t=this,e=t.path,r=t.pathNode,i=e.getSegment(e.segments.length-1),n=e.getSegment(e.segments.length-2),a=rt.createSegment("C",n.end.x,n.end.y,i.end.x,i.end.y,i.end.x,i.end.y);e.replaceSegment(e.segments.length-1,a),r.setAttribute("d",e.toString()),this.trigger("path:edit",r),this.trigger("path:last-segment:replace-with-curve",r)},adjustControlPath:function(t,e,r,i){var n=this,a=n.pathNode,o=this.svgControl.node,s=new rt([rt.createSegment("M",t,e),rt.createSegment("L",r,i)]);o.setAttribute("d",s.toString()),this.vel.append(o),this.trigger("path:interact",a),this.trigger("path:control:adjust",a)},removeControlPath:function(){var t=this,e=t.pathNode,r=this.svgControl.node;r.removeAttribute("d"),this.vel.append(r),this.trigger("path:interact",e),this.trigger("path:control:remove",e)},onPointerDown:function(t){var e=ot(t);if(e.stopPropagation(),!(e.which>1)&&!(e.originalEvent.detail>1)&&!!this.el.parentNode){var r=this.vel.toLocalPoint(e.clientX,e.clientY);switch(this.action){case"awaiting-input":this.createPath(r.x,r.y),this.action="path-created",this.delegateDocumentEvents();break;case"adjusting-line-end":this.action="awaiting-line-end";break;case"adjusting-curve-end":this.action="awaiting-curve-control-2";break}this._timeStamp=e.timeStamp}},MOVEMENT_DETECTION_THRESHOLD:150,onPointerMove:function(t){var e=ot(t);if(e.stopPropagation(),this.action!="awaiting-input"){var r,i,n=this.vel.toLocalPoint(e.clientX,e.clientY),a=this._timeStamp;if(a)if(a&&e.timeStamp-a<this.MOVEMENT_DETECTION_THRESHOLD)switch(this.action){case"path-created":r=this.svgStart.translate(),this.adjustControlPath(r.tx,r.ty,n.x,n.y);break;case"awaiting-line-end":case"adjusting-curve-control-1":this.adjustLastSegment(n.x,n.y);break;case"awaiting-curve-control-2":this.adjustLastSegment(n.x,n.y,null,null,n.x,n.y);break}else switch(this.action){case"path-created":this.action="adjusting-curve-control-1";break;case"awaiting-line-end":this.replaceLastSegmentWithCurve(),this.action="adjusting-curve-control-2";break;case"awaiting-curve-control-2":this.action="adjusting-curve-control-2";break;case"adjusting-curve-control-1":r=this.svgStart.translate(),this.adjustControlPath(r.tx,r.ty,n.x,n.y);break;case"adjusting-curve-control-2":i=this.findControlPoint(n.x,n.y),this.adjustLastSegment(null,null,null,null,i.x,i.y),this.adjustControlPath(i.x,i.y,n.x,n.y);break}else switch(this.action){case"adjusting-line-end":this.adjustLastSegment(n.x,n.y);break;case"adjusting-curve-end":this.adjustLastSegment(n.x,n.y,null,null,n.x,n.y);break}}},onPointerUp:function(t){this._timeStamp=null;var e=ot(t);if(e.stopPropagation(),!(e.which>1)&&!(e.originalEvent.detail>1)){var r=this.vel.toLocalPoint(e.clientX,e.clientY);switch(this.action){case"path-created":case"awaiting-line-end":this.addLineSegment(r.x,r.y),this.action="adjusting-line-end";break;case"awaiting-curve-control-2":this.removeControlPath(),this.addLineSegment(r.x,r.y),this.action="adjusting-line-end";break;case"adjusting-curve-control-1":case"adjusting-curve-control-2":this.addCurveSegment(r.x,r.y,r.x,r.y),this.action="adjusting-curve-end";break}}},onStartPointPointerDown:function(t){var e=ot(t);e.stopPropagation(),!(e.which>1)&&(e.originalEvent.detail>1||this.closePath())},onDoubleClick:function(t){var e=ot(t);e.preventDefault(),e.stopPropagation(),!(e.which>1)&&this.pathNode&&this.numberOfVisibleSegments()>0&&(this.removeLastSegment(),this.finishPath("path:stop"))},onContextMenu:function(t){var e=ot(t);e.preventDefault(),e.stopPropagation(),!(e.originalEvent.detail>1)&&this.pathNode&&this.numberOfVisibleSegments()>0&&(this.removeLastSegment(),this.finishPath("path:stop"))}}),DS=Xt.extend({tagName:"g",svgElement:!0,className:"path-editor",events:{"mousedown .anchor-point":"onAnchorPointPointerDown","mousedown .control-point":"onControlPointPointerDown","mousedown .segment-path":"onSegmentPathPointerDown","touchstart .anchor-point":"onAnchorPointPointerDown","touchstart .control-point":"onControlPointPointerDown","touchstart .segment-path":"onSegmentPathPointerDown","dblclick .anchor-point":"onAnchorPointDoubleClick","dblclick .control-point":"onControlPointDoubleClick","dblclick .segment-path":"onSegmentPathDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{anchorPointMarkup:'<circle r="2.5"/>',controlPointMarkup:'<circle r="2.5"/>'},init:function(){var t=this.pathNode=F(this.options.pathElement).normalizePath().node;this.path=rt.parse(this.options.pathElement.getAttribute("d")),this.svgRoot=F(t.ownerSVGElement),this.$document=f(t.ownerDocument),this.render()},onRemove:function(){this.undelegateDocumentEvents(),this.clear()},clear:function(){var t=this,e=t.vel;e.empty(),this.directionPaths=[],this.segmentPaths=[],this.segmentPathElements=[],this.controlPoints=[],this.anchorPoints=[],this._subPathIndices=[0],this.trigger("clear",this.pathNode)},_transformPoint:function(t,e,r){return F.transformPoint(new Z(t,e),r)},_getPathCTM:function(){return this.pathNode.getCTM()},render:function(){this.clear();for(var t=this,e=t.path,r=t.vel,i=t.anchorPoints,n=t.controlPoints,a=t.directionPaths,o=t.segmentPaths,s=t.segmentPathElements,l=this._getPathCTM(),u=F(this.options.anchorPointMarkup).addClass("anchor-point"),g=F(this.options.controlPointMarkup).addClass("control-point"),h=F('<path class="direction-path"/>'),y=F('<path class="segment-path"/>'),x=this._subPathIndices,C=0,p=0,E=0;C<e.segments.length;C++){var k=e.getSegment(C),w=this._transformPoint(k.end.x,k.end.y,l),S=w.x,T=w.y;if(k.type!=="Z"&&(i[C]=u.clone().attr({index:C,cx:S,cy:T})),k.type!=="M"){var m=new rt;switch(m.appendSegment(new rt.createSegment("M",p,E)),k.type){case"Z":{var A=e.getSegment(x[0]),M=this._transformPoint(A.end.x,A.end.y,l);S=M.x,T=M.y,m.appendSegment(new rt.createSegment("L",S,T)),x.unshift(C+1);break}case"L":{m.appendSegment(new rt.createSegment("L",S,T));break}case"C":{var N=this._transformPoint(k.controlPoint1.x,k.controlPoint1.y,l),D=g.clone().attr({index:C,"attribute-index":1,cx:N.x,cy:N.y}),z=this._transformPoint(k.controlPoint2.x,k.controlPoint2.y,l),_=g.clone().attr({index:C,"attribute-index":2,cx:z.x,cy:z.y});n[C]=[D,_],m.appendSegment(new rt.createSegment("C",N.x,N.y,z.x,z.y,S,T)),a[C]=[h.clone().attr("d",["M",p,E,"L",N.x,N.y].join(" ")),h.clone().attr("d",["M",S,T,"L",z.x,z.y].join(" "))];break}}o[C]=m;var j=y.clone().attr("index",C).node;j.setAttribute("d",m.toString()),s[C]=j}p=S,E=T}var V=[];s.forEach(function(W){W&&V.push(W)}),a.forEach(function(W){W&&Array.prototype.push.apply(V,W)}),i.forEach(function(W){W&&V.push(W)}),n.forEach(function(W){W&&Array.prototype.push.apply(V,W)}),r.append(V),this.svgRoot.append(r)},startMoving:function(t){var e=ot(t),r=this.$point=f(e.target);this.prevClientX=e.clientX,this.prevClientY=e.clientY;var i=parseInt(this.$point.attr("index"),10);if(this.trigger("path:interact"),r.hasClass("anchor-point"))this.trigger("path:anchor-point:select",i);else if(r.hasClass("control-point")){var n=parseInt(this.$point.attr("attribute-index"),10);this.trigger("path:control-point:select",i,n)}else this.trigger("path:segment:select",i);e.stopPropagation(),e.preventDefault(),this.index=void 0,this.controlPointIndex=void 0,this.segPoint=void 0,this.pathEditedEventType=void 0},move:function(t){var e=this,r=e.$point;if(!!r){var i=ot(t),n=i.clientX-this.prevClientX,a=i.clientY-this.prevClientY,o=parseInt(r.attr("index"),10);if(r.hasClass("anchor-point"))this.adjustAnchorPoint(o,n,a,i);else if(r.hasClass("control-point")){var s=parseInt(r.attr("attribute-index"),10);this.adjustControlPoint(o,s,n,a,i)}else this.adjustSegment(o,n,a,i);this.prevClientX=i.clientX,this.prevClientY=i.clientY}},adjustSegment:function(t,e,r,i,n){n===void 0&&(n={});var a=n.dry;a===void 0&&(a=void 0),this.adjustAnchorPoint(t-1,e,r,{dry:!0}),this.adjustAnchorPoint(t,e,r,{dry:!0}),a||(this.pathEditedEventType="path:segment:adjust",this.index=t,this.trigger("path:editing",this.pathNode,i),this.trigger("path:segment:adjusting",this.pathNode,i,{index:t}))},adjustControlPoint:function(t,e,r,i,n,a){a===void 0&&(a={});var o=a.dry;o===void 0&&(o=void 0);var s=this._getPathCTM(),l=this,u=l.path,g=l.controlPoints,h=u.getSegment(t),y=s.inverse();y.e=0,y.f=0;var x=this._transformPoint(r,i,y),C="controlPoint"+e;h[C].x+=x.x,h[C].y+=x.y;var p=this._transformPoint(h[C].x,h[C].y,s),E=new Z(p),k=g[t][e-1].attr({cx:p.x,cy:p.y});if(k.hasClass("locked")){var w=this.getBoundIndex(t,e),S=e===1?2:1,T=u.getSegment(w),m="controlPoint"+S,A=new Z(e===1?T.end.x:h.end.x,e===1?T.end.y:h.end.y),M=new Z(h[C].x,h[C].y),N=A.distance(new Z(T[m].x,T[m].y)),D=A.move(M,N);T[m].x=D.x,T[m].y=D.y;var z=this._transformPoint(T[m].x,T[m].y,s);g[w][S-1].attr({cx:z.x,cy:z.y}),this.updateDirectionPaths(w),this.updateSegmentPath(w)}this.updateDirectionPaths(t),this.updateSegmentPath(t),o||(this.pathEditedEventType="path:control-point:adjust",this.index=t,this.controlPointIndex=e,this.segPoint=E,this.trigger("path:editing",this.pathNode,n),this.trigger("path:control-point:adjusting",this.pathNode,n,{index:t,controlPointIndex:e,segPoint:E}))},findSubpathIndex:function(t){for(var e=this._subPathIndices,r=0,i=e.length;r<i;r++)if(e[r]<t)return e[r]},findReversedSubpathIndex:function(t){for(var e=this._subPathIndices,r=e.length-1;r>=0;r--)if(e[r]>t)return e[r]},adjustAnchorPoint:function(t,e,r,i,n){n===void 0&&(n={});var a=n.dry;a===void 0&&(a=void 0);var o=this._getPathCTM(),s=this,l=s.path,u=s.anchorPoints,g=s.controlPoints,h=l.getSegment(t);h.type==="Z"&&(t=this.findSubpathIndex(t),h=l.getSegment(t));var y=u.length-1;if((t===0||t===y)&&g[1]&&g[y]){var x=g[1][0],C=g[y][1];x&&x.hasClass("locked")&&x.removeClass("locked"),C&&C.hasClass("locked")&&C.removeClass("locked")}var p=o.inverse();p.e=0,p.f=0;var E=this._transformPoint(e,r,p);h.end.x+=E.x,h.end.y+=E.y;var k=this._transformPoint(h.end.x,h.end.y,o),w=new Z(k);if(u[t].attr({cx:k.x,cy:k.y}),h.type==="C"){h.controlPoint2.x+=E.x,h.controlPoint2.y+=E.y;var S=this._transformPoint(h.controlPoint2.x,h.controlPoint2.y,o);g[t][1].attr({cx:S.x,cy:S.y})}var T=t+1<l.segments.length?l.getSegment(t+1):0;if(T){if(T.type==="C"){T.controlPoint1.x+=E.x,T.controlPoint1.y+=E.y;var m=this._transformPoint(T.controlPoint1.x,T.controlPoint1.y,o);g[t+1][0].attr({cx:m.x,cy:m.y}),this.updateDirectionPaths(t+1)}this.updateSegmentPath(t+1)}this.updateDirectionPaths(t),this.updateSegmentPath(t),a||(this.pathEditedEventType="path:anchor-point:adjust",this.index=t,this.segPoint=w,this.trigger("path:editing",this.pathNode,i),this.trigger("path:anchor-point:adjusting",this.pathNode,i,{index:t,segPoint:w}))},updateDirectionPaths:function(t){var e=this._getPathCTM(),r=this,i=r.path,n=i.getSegment(t),a=this._transformPoint(n.end.x,n.end.y,e),o=t>0?i.getSegment(t-1):null,s=o?this._transformPoint(o.end.x,o.end.y,e):null,l=this.directionPaths[t];!Array.isArray(l)||l.forEach(function(u,g){g++;var h=this._transformPoint(n["controlPoint"+g].x,n["controlPoint"+g].y,e);u.attr("d",["M",g>1||!o?a.x:s.x,g>1||!o?a.y:s.y,h.x,h.y].join(" "))},this)},updateSegmentPath:function(t){var e=this,r=e.path,i=e._subPathIndices;if(i.includes(t)){var n=this.findReversedSubpathIndex(t)||this.path.segments.length;if(n--,r.getSegment(n).type!=="Z")return;t=n}var a=this.segmentPaths[t];if(!!a){var o=this._getPathCTM(),s=r.getSegment(t-1),l=this._transformPoint(s.end.x,s.end.y,o);a=new rt;var u=rt.createSegment("M",l.x,l.y);a.appendSegment(u);var g=r.getSegment(t),h=this._transformPoint(g.end.x,g.end.y,o);switch(g.type){case"Z":{var y=r.getSegment(this.findSubpathIndex(t)),x=this._transformPoint(y.end.x,y.end.y,o);u=rt.createSegment("L",x.x,x.y);break}case"L":{u=rt.createSegment("L",h.x,h.y);break}case"C":{var C=this._transformPoint(g.controlPoint1.x,g.controlPoint1.y,o),p=this._transformPoint(g.controlPoint2.x,g.controlPoint2.y,o);u=rt.createSegment("C",C.x,C.y,p.x,p.y,h.x,h.y);break}}a.appendSegment(u),this.segmentPaths[t]=a;var E=this.segmentPathElements[t];E&&E.setAttribute("d",a.toString()),this.pathNode.setAttribute("d",r.toString())}},stopMoving:function(t){var e=ot(t);if(this.$point=void 0,this.pathEditedEventType){var r=this,i=r.pathNode,n=r.index,a=r.controlPointIndex,o=r.segPoint;this.trigger("path:edit",i,e),this.trigger(this.pathEditedEventType,i,e,{index:n,controlPointIndex:a,segPoint:o})}this.index=void 0,this.controlPointIndex=void 0,this.segPoint=void 0,this.pathEditedEventType=void 0},createAnchorPoint:function(t){var e=ot(t),r=F(e.target).attr("index"),i=this,n=i.pathNode,a=i.path,o=F(n).toLocalPoint(e.pageX,e.pageY),s=a.getSegment(r);switch(s.type){case"Z":{var l=new dt(s.start,s.end),u=l.closestPoint(o);a.insertSegment(r,rt.createSegment("L",u.x,u.y));break}case"L":{var g=new dt(s.start,s.end),h=g.closestPoint(o);a.insertSegment(r,rt.createSegment("L",h.x,h.y));break}case"C":{var y=new Zt(s.start,s.controlPoint1,s.controlPoint2,s.end),x=y.closestPointT(o),C=s.divideAtT(x);a.insertSegment(r,C[0]),s.controlPoint1.x=C[1].controlPoint1.x,s.controlPoint1.y=C[1].controlPoint1.y,s.controlPoint2.x=C[1].controlPoint2.x,s.controlPoint2.y=C[1].controlPoint2.y;break}}this.render(),this.pathNode.setAttribute("d",a.toString()),this.trigger("path:edit",n,e),this.trigger("path:anchor-point:create",n,e)},removeAnchorPoint:function(t){var e=ot(t),r=parseInt(f(e.target).attr("index"),10),i=this,n=i.pathNode,a=i.path,o=a.getSegment(r),s,l;switch(o.type){case"M":s=a.getSegment(r+1),l=rt.createSegment("M",s.end.x,s.end.y),a.replaceSegment(r+1,l),a.removeSegment(r);break;case"L":a.removeSegment(r);break;case"C":r+1<=a.segments.length-1&&(s=a.getSegment(r+1),s.type==="C"&&(s.controlPoint1.x=o.controlPoint1.x,s.controlPoint1.y=o.controlPoint1.y)),a.removeSegment(r);break}this.render(),this.pathNode.setAttribute("d",a.toString()),this.trigger("path:edit",n,e),this.trigger("path:anchor-point:remove",n,e);var u=a.segments.length;a.getSegment(a.segments.length-1).type==="Z"&&(u-=1),u<2&&this.trigger("path:invalid",n,e)},lockControlPoint:function(t){var e=ot(t),r=f(e.target),i=parseInt(r.attr("index")),n=parseInt(r.attr("attribute-index"),10),a=this.getBoundIndex(i,n),o=n===1?2:1,s=this.controlPoints[a];if(s){var l=r.hasClass("locked");r.toggleClass("locked"),s[o-1].toggleClass("locked"),this.trigger("path:interact"),l?this.trigger("path:control-point:unlock",i,n):(this.trigger("path:control-point:lock",i,n),this.adjustControlPoint(i,n,0,0,{dry:!0}))}},getBoundIndex:function(t,e){var r,i=this,n=i.path,a=i.anchorPoints,o,s,l,u=a.length-1,g,h;return e===1?(r=t-1,r===0&&(o=n.segments.length-1,s=n.getSegment(o).type,l=s==="Z",g=a[0].attr("cx")===a[u].attr("cx"),h=a[0].attr("cy")===a[u].attr("cy"),l&&g&&h&&(r=u))):(r=t+1,r===u+1&&(o=n.segments.length-1,s=n.getSegment(o).type,l=s==="Z",g=a[0].attr("cx")===a[u].attr("cx"),h=a[0].attr("cy")===a[u].attr("cy"),l&&g&&h&&(r=1))),r},getControlPointLockedStates:function(){for(var t=this,e=t.controlPoints,r=[],i=0;i<e.length;i++)if(!!e[i]){r[i]=[];for(var n=0;n<=1;n++)if(!!e[i][n]){var a=n+1;e[i][n].hasClass("locked")?r[i][a]=!0:r[i][a]=!1}}return r},setControlPointLockedStates:function(t){for(var e=this,r=e.controlPoints,i=0;i<r.length;i++)if(!!t[i]&&!!r[i])for(var n=1;n<=2;n++)!t[i][n]||!r[i][n-1]||(t[i][n]===!0?r[i][n-1].addClass("locked"):r[i][n-1].removeClass("locked"))},convertSegmentPath:function(t){var e=ot(t),r=F(e.target).attr("index"),i=this,n=i.pathNode,a=i.path,o=a.getSegment(r);switch(o.type){case"Z":a.insertSegment(r,rt.createSegment("C",o.start.x,o.start.y,o.end.x,o.end.y,o.end.x,o.end.y));break;case"L":a.replaceSegment(r,rt.createSegment("C",o.start.x,o.start.y,o.end.x,o.end.y,o.end.x,o.end.y));break;case"C":a.replaceSegment(r,rt.createSegment("L",o.end.x,o.end.y));break}this.render(),this.pathNode.setAttribute("d",a.toString()),this.trigger("path:edit",n,e),this.trigger("path:segment:convert",n,e)},addClosePathSegment:function(t){var e=ot(t),r=parseInt(f(e.target).attr("index"),10),i=this,n=i.path,a=i.pathNode;if(r===0||r===n.segments.length-1){var o=n.getSegment(n.segments.length-1);o.type!=="Z"&&(n.appendSegment(rt.createSegment("Z")),this.render(),this.pathNode.setAttribute("d",n.toString()),this.trigger("path:edit",a,e),this.trigger("path:closepath-segment:add",a,e))}},removeClosePathSegment:function(t){var e=ot(t),r=F(e.target).attr("index"),i=this,n=i.path,a=i.pathNode,o=n.getSegment(r);o.type==="Z"&&(n.removeSegment(r),this.render(),this.pathNode.setAttribute("d",n.toString()),this.trigger("path:edit",a,e),this.trigger("path:closepath-segment:remove",a,e))},isMoreThanFirstClick:function(){var t=400;return this.clickCounter=this.clickCounter||0,this.clickCounter+=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.clickCounter=0},t),this.clickCounter>=2?(this.clickCounter=0,clearTimeout(this.timeout),!0):!1},onAnchorPointPointerDown:function(t){var e=ot(t);e.stopPropagation(),e.which===1&&(this.isMoreThanFirstClick()||(this.startMoving(e),this.delegateDocumentEvents()))},onControlPointPointerDown:function(t){var e=ot(t);e.stopPropagation(),e.which===1&&(this.isMoreThanFirstClick()||(this.startMoving(e),this.delegateDocumentEvents()))},onSegmentPathPointerDown:function(t){var e=ot(t);e.stopPropagation(),e.which===1&&(this.isMoreThanFirstClick()||(this.startMoving(e),this.delegateDocumentEvents()))},onPointerMove:function(t){var e=ot(t);e.stopPropagation(),this.move(e)},onPointerUp:function(t){this.undelegateDocumentEvents();var e=ot(t);e.stopPropagation(),this.stopMoving(e)},onAnchorPointDoubleClick:function(t){var e=ot(t);e.stopPropagation(),e.preventDefault(),e.which===1&&this.removeAnchorPoint(e)},onControlPointDoubleClick:function(t){var e=ot(t);e.stopPropagation(),e.preventDefault(),e.which===1&&this.lockControlPoint(e)},onSegmentPathDoubleClick:function(t){var e=ot(t);e.stopPropagation(),e.preventDefault(),e.which===1&&this.createAnchorPoint(e)}}),zS=mv.extend({className:"popup",eventNamespace:"popup",events:{},beforeMount:function(){var e=this.options,r=e.anchor,i=e.arrowPosition;this.$el.removeClass("left right top bottom top-left top-right bottom-left bottom-right"),i?this.$el.addClass(i==="none"?"":i):this.$el.addClass(r==="center"?"":r)},renderContent:function(){var t=this.options,e=t.content,r=t.arrowPosition,i=t.anchor,n=yt(e)?e(this.el):e;if(n&&this.$el.html(n),r!=="none"||i==="center"){var a=document.createElement("div");a.classList.add("popup-arrow");var o=document.createElement("div");o.classList.add("popup-arrow-mask"),this.el.append(a,o)}}}),BS={N:"n",NW:"nw",W:"w",SW:"sw",S:"s",SE:"se",E:"e",NE:"ne"},Ia={NONE:"none",SUBGRAPH:"subgraph",ALL:"all"},Cv=Xt.extend({options:{paper:void 0,graph:void 0,boxContent:function(t){return De("<%= length %> elements selected.")({length:this.model.length})},handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElements"}},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"}},{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"}}],useModelGeometry:!1,strictSelection:!1,rotateAngleGrid:15,allowTranslate:!0,translateConnectedLinks:Ia.ALL},className:"selection",events:{"mousedown .selection-box":"onSelectionBoxPointerDown","touchstart .selection-box":"onSelectionBoxPointerDown","mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown"},documentEvents:{mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},_action:null,init:function(){this.options.model&&(this.options.collection=this.options.model);var t=this.collection=this.options.collection||this.collection||new d.Collection;if(t.comparator||(t.comparator=this.constructor.depthComparator,t.sort()),this.model=t,this.options.paper)ne(this.options,{graph:this.options.paper.model});else throw new Error("Selection: paper required");ke(this,"startSelecting","stopSelecting","adjustSelection","pointerup"),this.options.paper.$el.append(this.$el),this._boxCount=0,this.$selectionWrapper=this.createSelectionWrapper(),this.handles=[],lt(this.options.handles).forEach(this.addHandle,this),this.startListening()},startListening:function(){var t=this.options.paper;this.listenTo(t,"scale translate",this.onPaperTransformation);var e=this.options.graph;this.listenTo(e,"reset",this.cancelSelection),this.listenTo(e,"change remove",this.onGraphChange);var r=this.collection;this.listenTo(r,"remove",this.onRemoveElement),this.listenTo(r,"reset",this.onResetElements),this.listenTo(r,"add",this.onAddElement)},onPaperTransformation:function(){this.updateSelectionBoxes({async:!1})},onGraphChange:function(t,e){e.selection!==this.cid&&this.updateSelectionBoxes()},cancelSelection:function(){this.model.reset([],{ui:!0})},addHandle:function(t){this.handles.push(t);var e=f("<div/>",{class:"handle "+(t.position||"")+" "+(t.name||""),"data-action":t.name});return t.icon&&e.css("background-image","url("+t.icon+")"),e.html(t.content||""),ui(e,t.attrs),this.$selectionWrapper.append(e),Ut(t.events,function(r,i){$t(r)?this.on("action:"+t.name+":"+i,this[r],this):this.on("action:"+t.name+":"+i,r)}.bind(this)),this},stopSelecting:function(t){var e,r=this.options.paper,i=this.eventData(t),n=i.action;switch(n){case"selecting":{var a=this.$el.offset(),o=this.$el.width(),s=this.$el.height();e=r.pageToLocalPoint(a.left,a.top);var l=r.scale();o/=l.sx,s/=l.sy;var u=We(e.x,e.y,o,s),g=this.getElementsInSelectedArea(u),h=this.options.filter;Array.isArray(h)?g=g.filter(function(x){return!h.includes(x.model)&&!h.includes(x.model.get("type"))}):yt(h)&&(g=g.filter(function(x){return!h(x.model)}));var y=g.map(function(x){return x.model});this.model.reset(y,{ui:!0});break}case"translating":{this.options.graph.stopBatch("selection-translate"),e=r.snapToGrid(t.clientX,t.clientY),this.notify("selection-box:pointerup",t,e.x,e.y);break}default:{n||this.cancelSelection();break}}this._action=null},removeHandle:function(t){var e=lt(this.handles).findIndex(function(i){return i.name===t}),r=this.handles[e];return r&&(Ut(r.events,function(i,n){this.off("action:"+t+":"+n)}.bind(this)),this.$(".handle."+t).remove(),this.handles.splice(e,1)),this},startSelecting:function(t){t=ot(t),this.cancelSelection();var e=this.options,r=e.paper,i=r.localToPaperPoint(r.clientToLocalPoint({x:t.clientX,y:t.clientY}));this.$el.css({width:0,height:0,left:i.x,top:i.y}),this.showLasso(),this.eventData(t,{action:"selecting",clientX:t.clientX,clientY:t.clientY,origin:i}),this.delegateDocumentEvents(null,t.data),this._action="selecting"},changeHandle:function(t,e){var r=lt(this.handles).find(function(i){return i&&i.name===t});return r&&(this.removeHandle(t),this.addHandle(ie({name:t},r,e))),this},onSelectionBoxPointerDown:function(t){t.stopPropagation(),t=ot(t);var e=this.options,r=e.paper,i=e.allowTranslate,n=this.getCellView(t.target);i&&(!n||n.can("elementMove"))&&this.startTranslatingSelection(t),this.eventData(t,{activeElementView:n});var a=r.snapToGrid(t.clientX,t.clientY);this.notify("selection-box:pointerdown",t,a.x,a.y),this.delegateDocumentEvents(null,t.data)},startTranslatingSelection:function(t){this.options.graph.startBatch("selection-translate");var e=this.options.paper.snapToGrid(t.clientX,t.clientY);this.eventData(t,{action:"translating",snappedClientX:e.x,snappedClientY:e.y}),this._action="translating"},adjustSelection:function(t){t=ot(t);var e,r,i=this.eventData(t),n=i.action;switch(n){case"selecting":{var a=this.options.paper,o=a.localToPaperPoint(a.clientToLocalPoint({x:t.clientX,y:t.clientY}));e=o.x-i.origin.x,r=o.y-i.origin.y;var s=Math.abs(e),l=Math.abs(r),u=parseFloat(window.getComputedStyle(this.el).getPropertyValue("border-width"));this.$el.css({left:e<0?o.x:i.origin.x,top:r<0?o.y:i.origin.y,width:s-u*2,height:l-u*2});break}case"translating":{var g=this.options.paper.snapToGrid(t.clientX,t.clientY),h=g.x,y=g.y;e=h-i.snappedClientX,r=y-i.snappedClientY;var x=this.options.paper.getRestrictedArea();if(x){var C=this.model.toArray(),p=this.options.graph.getCellsBBox(C),E=x.x-p.x,k=x.y-p.y,w=x.x+x.width-(p.x+p.width),S=x.y+x.height-(p.y+p.height);e<E&&(e=E),r<k&&(r=k),e>w&&(e=w),r>S&&(r=S)}if(e||r){if(this.translateSelectedElements(e,r),this.boxesUpdated)this.model.length>1&&this.updateSelectionBoxes();else{var T=this.options.paper.scale();this.$el.children(".selection-box").add(this.$selectionWrapper).css({left:"+="+e*T.sx,top:"+="+r*T.sy})}i.snappedClientX=h,i.snappedClientY=y}this.notify("selection-box:pointermove",t,h,y);break}default:{n&&this.pointermove(t);break}}this.boxesUpdated=!1},translateSelectedElements:function(t,e){var r=this,i={},n=this,a=n.collection,o=this.options,s=o.graph,l=o.translateConnectedLinks;a.each(function(u){if(!i[u.id]){var g={selection:r.cid};if(u.translate(t,e,g),i[u.id]=!0,u.getEmbeddedCells({deep:!0}).forEach(function(y){i[y.id]=!0}),l!==Ia.NONE){var h=s.getConnectedLinks(u);h.forEach(function(y){if(!i[y.id]){if(l===Ia.SUBGRAPH){var x=y.getSourceCell();if(x&&!a.get(x))return;var C=y.getTargetCell();if(C&&!a.get(C)||!x||!C)return}y.translate(t,e,g),i[y.id]=!0}})}}})},notify:function(t,e){var r=this.eventData(e),i=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t,r.activeElementView].concat(i))},getElementsInSelectedArea:function(t){var e=this.options.paper,r={strict:this.options.strictSelection};if(this.options.useModelGeometry){var i=e.model.findModelsInArea(t,r);return i.map(e.findViewByModel,e).filter(function(n){return!!n})}return e.findViewsInArea(t,r)},pointerup:function(t){var e=this.eventData(t),r=e.action;if(!!r){t=ot(t);var i=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY}),n=i.x,a=i.y;this.triggerAction(r,"pointerup",t,n,a),this.stopSelecting(t),this.undelegateDocumentEvents(),this._action=null}},destroySelectionBox:function(t){this.$('[data-model="'+t.get("id")+'"]').remove(),this.$el.children(".selection-box").length===0&&this.hide(),this._boxCount=Math.max(0,this._boxCount-1)},hide:function(){this.$el.removeClass("lasso selected")},showSelected:function(){this.$el.addClass("selected")},showLasso:function(){this.$el.addClass("lasso")},destroyAllSelectionBoxes:function(){this.hide(),this.$el.children(".selection-box").remove(),this._boxCount=0},createSelectionBox:function(t){var e=t.findView(this.options.paper);if(e){var r=e.getBBox({useModelGeometry:this.options.useModelGeometry});f("<div/>").addClass("selection-box").attr("data-model",t.get("id")).css({left:r.x,top:r.y,width:r.width,height:r.height}).appendTo(this.el),this.showSelected(),this._boxCount++}},createSelectionWrapper:function(){var t=f("<div/>",{class:"selection-wrapper"}),e=f("<div/>",{class:"box"});return t.append(e),t.attr("data-selection-length",this.model.length),this.$el.prepend(t),t},updateSelectionWrapper:function(){var t={x:1/0,y:1/0},e={x:0,y:0};if(this.model.each(function(n){var a=this.options.paper.findViewByModel(n);if(a){var o=a.getBBox({useModelGeometry:this.options.useModelGeometry});t.x=Math.min(t.x,o.x),t.y=Math.min(t.y,o.y),e.x=Math.max(e.x,o.x+o.width),e.y=Math.max(e.y,o.y+o.height)}}.bind(this)),this.$selectionWrapper.css({left:t.x,top:t.y,width:e.x-t.x,height:e.y-t.y}).attr("data-selection-length",this.model.length),yt(this.options.boxContent)){var r=this.$(".box"),i=this.options.boxContent.call(this,r[0]);i&&r.html(i)}},updateSelectionBoxes:function(t){this.collection.length!==0&&(this.boxesUpdated=!0,this.options.paper.requestViewUpdate(this,1,this.UPDATE_PRIORITY,t))},confirmUpdate:function(){this._updateSelectionBoxes()},_updateSelectionBoxes:function(){if(!!this._boxCount){this.hide();for(var t=this.$el.children(".selection-box"),e=0,r=t.length;e<r;e++){var i=t[e],n=f(i).remove().attr("data-model"),a=this.model.get(n);a&&this.createSelectionBox(a)}this.updateSelectionWrapper()}},onHandlePointerDown:function(t){var e=t.currentTarget.dataset.action;if(!!e){t.preventDefault(),t.stopPropagation(),t=ot(t);var r=this.options.paper.snapToGrid({x:t.clientX,y:t.clientY}),i=r.x,n=r.y;t.type==="mousedown"&&t.button===2?this.triggerAction(e,"contextmenu",t,i,n):(this.triggerAction(e,"pointerdown",t,i,n),this.eventData(t,{action:e,clientX:t.clientX,clientY:t.clientY,startClientX:t.clientX,startClientY:t.clientY}),this.delegateDocumentEvents(null,t.data)),this._action=e}},getCellView:function(t){var e=this.model.get(t.getAttribute("data-model"));return e&&e.findView(this.options.paper)},pointermove:function(t){var e=this.eventData(t),r=e.action;if(!!r){var i=t.clientX,n=t.clientY,a=this.options,o=a.paper,s=o.snapToGrid(i,n),l=s.x,u=s.y,g=o.snapToGrid(e.clientX,e.clientY),h=g.x,y=g.y,x=l-h,C=u-y;this.triggerAction(r,"pointermove",t,l,u,x,C),e.clientX=i,e.clientY=n}},triggerAction:function(t,e,r){var i=Array.prototype.slice.call(arguments,2);i.unshift("action:"+t+":"+e),this.trigger.apply(this,i)},onRemoveElement:function(t){this.destroySelectionBox(t),this.updateSelectionWrapper()},onResetElements:function(t){this.destroyAllSelectionBoxes(),t.each(this.createSelectionBox.bind(this)),this.updateSelectionWrapper()},onAddElement:function(t){this.createSelectionBox(t),this.updateSelectionWrapper()},removeElements:function(t){var e=this.collection.toArray();this.cancelSelection(),this.options.graph.removeCells(e,{selection:this.cid})},startRotating:function(t){var e=this.options,r=e.paper,i=e.graph;i.trigger("batch:start");var n=this.collection.toArray(),a=i.getCellsBBox(this.model.models).center(),o=r.snapToGrid(t.clientX,t.clientY),s=n.reduce(function(u,g){return u[g.id]=g.angle(),u},{}),l=n.reduce(function(u,g){return g.isLink()&&(u[g.id]={source:g.getSourceCell()?null:g.get("source"),target:g.getTargetCell()?null:g.get("target"),vertices:g.vertices()}),u},{});this.eventData(t,{center:a,clientAngle:o.theta(a),initialAngles:s,initialPoints:l})},startResizing:function(t){var e=this,r=e.options,i=e.collection,n=r.paper,a=r.graph,o=n.options,s=o.gridSize,l=i.toArray(),u=a.getCellsBBox(l),g=u.width,h=u.height,y=n.snapToGrid(t.clientX,t.clientY),x=y.x,C=y.y,p=l.map(function(A){var M=A.angle(),N=A.getBBox(),D=N.bbox(M),z;return M<=90?z=M/90:M<=270?z=Math.abs(180-M)/90:z=Math.abs(M-360)/90,{angle:M,unrotatedBBox:N,bbox:D,factor:z,center:D.center()}}),E=p.reduce(function(A,M){var N=M.unrotatedBBox;return N.width<A?N.width:A},1/0),k=p.reduce(function(A,M){var N=M.unrotatedBBox;return N.height<A?N.height:A},1/0),w=a.getSubgraph(l),S=w.filter(function(A){return A.isLink()}),T=S.map(function(A){return{source:A.getSourceCell()?null:A.get("source"),target:A.getTargetCell()?null:A.get("target"),vertices:A.vertices()}}),m=a.getCellsBBox(w);this.eventData(t,{size:{width:g,height:h},rotatedBBox:a.getCellsBBox(l),minWidth:s*g/E,minHeight:s*h/k,x0:x,y0:C,pointerX:x,pointerY:C,elements:l,elementsRecords:p,links:S,linksRecords:T,cellsBBox:m}),a.trigger("batch:start")},doResize:function(t){var e=this.eventData(t),r=e.size,i=e.rotatedBBox,n=e.minWidth,a=e.minHeight,o=e.x0,s=e.y0,l=e.pointerX,u=e.pointerY,g=e.elements,h=e.elementsRecords,y=e.links,x=e.linksRecords,C=e.cellsBBox,p=this.options.paper.snapToGrid(t.clientX,t.clientY),E=p.x,k=p.y;if(!(E===l&&k===u)){e.lastX=E,e.lastY=k;var w=r.width,S=r.height,T=Math.max(w+E-o,n),m=Math.max(S+k-s,a);if(this.options.preserveAspectRatio){var A=w*m/S,M=S*T/w;A>T?m=M:T=A}for(var N=Math.max(T/w,0),D=Math.max(m/S,0),z=0,_=g.length;z<_;z++){var j=g[z],V=h[z],W=V.bbox,Y=V.unrotatedBBox,X=V.factor,J=V.center,Q=V.angle,it=new Z(N,D).lerp(new Z(D,N),X),st=Y.clone().scale(it.x,it.y,J),gt=st.bbox(Q),nt=gt.width-W.width,ut=gt.height-W.height;Math.abs(nt)<.001&&(nt=0),Math.abs(ut)<.001&&(ut=0);var ft=new Z(i.x,0).distance(new Z(W.x,0)),vt=new Z(0,i.y).distance(new Z(0,W.y)),xt=nt/2+ft*N-ft,Et=ut/2+vt*D-vt;if(Math.abs(xt)<.001&&(xt=0),Math.abs(Et)<.001&&(Et=0),st.translate(xt,Et),z===0&&j.getBBox().equals(st))return;j.set({position:{x:st.x,y:st.y},size:{width:st.width,height:st.height}},{selection:this.cid})}for(var Rt=0,It=y.length;Rt<It;Rt++){var Wt=y[Rt],St=x[Rt],Ct=St.source,jt=St.target,wt=St.vertices,pt={};if(wt.length>0&&(pt.vertices=wt.map(function(ce){var Se=new Z(ce);return Se.scale(N,D,C.origin()),Se.toJSON()})),Ct){var ge=new Z(Ct);ge.scale(N,D,C.origin()),pt.source=ge.toJSON()}if(jt){var ye=new Z(jt);ye.scale(N,D,C.origin()),pt.target=ye.toJSON()}Wt.set(pt,{selection:this.cid})}this.updateSelectionBoxes()}},doRotate:function(t){var e=this,r=this.eventData(t),i=this.options.rotateAngleGrid,n=this.options.paper.snapToGrid(t.clientX,t.clientY),a=r.clientAngle-Bt(n).theta(r.center);Math.abs(a)>.001&&(this.collection.each(function(o){var s=ht(r.initialAngles[o.id]+a,i);if(o.isLink()){var l=r.initialPoints[o.id],u=l.source,g=l.target,h=l.vertices,y=function(C){return Z(C).rotate(r.center,-s)},x={};return u&&(x.source=y(u)),g&&(x.target=y(g)),h.length>0&&(x.vertices=h.map(y)),o.set(x,{selection:e.cid})}else o.rotate(s,!0,r.center,{selection:e.cid})}),this.updateSelectionBoxes())},stopBatch:function(){this.options.graph.trigger("batch:stop")},getAction:function(){return this._action}},{depthComparator:function(t){return t.getAncestors().length},HandlePosition:BS,ConnectedLinksTranslation:Ia}),OS=Cv,RS={N:"n",NW:"nw",W:"w",SW:"sw",S:"s",SE:"se",E:"e",NE:"ne"},_S=Xt.extend({options:{paper:void 0,usePaperGrid:!1,distance:10},className:"snaplines",documentEvents:{mouseup:"hide",touchend:"hide"},init:function(){ke(this,"hide"),this.render(),this.enable(),this.prepareFilters()},render:function(){var t=this,e=t.$el,r=t.options,i=this.$horizontal=f("<div>").addClass("snapline horizontal"),n=this.$vertical=f("<div>").addClass("snapline vertical");e.hide().append([i,n]).appendTo(r.paper.el)},startListening:function(){this.enable()},_isEnabled:!1,enable:function(){var t=this.options,e=t.paper;this.disable(),this.listenTo(e,"element:pointerdown",this.captureCursorOffset),this.listenTo(e,"element:pointermove",this.snapWhileMoving),this.listenTo(e.model,"batch:stop",this.onBatchStop),this.delegateDocumentEvents(),this._isEnabled=!0},disable:function(){var t=this.options,e=t.paper;this.stopListening(e,"element:pointerdown",this.captureCursorOffset),this.stopListening(e,"element:pointermove",this.snapWhileMoving),this.stopListening(e.model,"batch:stop",this.onBatchStop),this.undelegateDocumentEvents(),this._isEnabled=!1},isDisabled:function(){return!this._isEnabled},prepareFilters:function(){this.filterTypes={},this.filterCells={},this.filterFunction=void 0,Array.isArray(this.options.filter)?this.options.filter.forEach(function(t){$t(t)?this.filterTypes[t]=!0:this.filterCells[t.id]=!0},this):yt(this.options.filter)&&(this.filterFunction=this.options.filter)},onBatchStop:function(t){t=t||{},t.batchName==="resize"&&this.snapWhileResizing(t.cell,t)},captureCursorOffset:function(t,e,r,i){var n=t.getDelegatedView();if(!(!n||!this.canElementMove(n))){var a=n.model.get("position");this._cursorOffset={x:r-a.x,y:i-a.y}}},snapWhileResizing:function(t,e){if(!(!e.ui||e.snapped||!e.direction||!e.trueDirection)){var r=this.options,i=r.paper,n=i.findViewByModel(t);if(!(!n||!n.model.isElement())){var a=t.getBBox(),o=a.bbox(t.get("angle")),s=o.origin(),l=o.corner(),u=et(t.get("angle")),g=r.distance,h=null,y=null,x=i.options.gridSize,C={vertical:0,horizontal:0},p=e.direction,E=e.trueDirection,k=e.relativeDirection;if(E.indexOf("right")!==-1?C.vertical=l.x:C.vertical=s.x,E.indexOf("bottom")!==-1?C.horizontal=l.y:C.horizontal=s.y,i.model.getElements().find(function(W){if(W.id===t.id||W.isEmbeddedIn(t)||this.filterTypes[W.get("type")]||this.filterCells[W.id]||this.filterFunction&&this.filterFunction(W))return!1;var Y=W.getBBox().bbox(W.get("angle")),X=Y.origin(),J=Y.corner();r.usePaperGrid&&(X.snapToGrid(x),J.snapToGrid(x));var Q={vertical:[X.x,J.x],horizontal:[X.y,J.y]};return Ut(Q,function(it,st){it=it.map(function(gt){return{position:gt,distance:Math.abs(gt-C[st])}}),it=it.filter(function(gt){return gt.distance<g}),it=Fe(it,function(gt){return gt.distance}),Q[st]=it}),h===null&&Q.vertical.length>0&&(h=Q.vertical[0].position),y===null&&Q.horizontal.length>0&&(y=Q.horizontal[0].position),Nt(h)&&Nt(y)},this),this.hide(),Nt(h)||Nt(y)){var w=0;Nt(h)&&(E.indexOf("right")!==-1?w=h-o.corner().x:w=o.origin().x-h);var S=0;Nt(y)&&(E.indexOf("bottom")!==-1?S=y-o.corner().y:S=o.origin().y-y);var T=0,m=0,A=!(u%90);if(A)u===90||u===270?(T=S,m=w):(T=w,m=S);else{var M;u>=0&&u<90?M=1:u>=90&&u<180?M=4:u>=180&&u<270?M=3:M=2,y&&h&&(S>w?(S=0,y=null):(w=0,h=null));var N=bt(u%90);w&&(M===3?T=w/Math.cos(N):T=w/Math.sin(N)),S&&(M===3?m=S/Math.cos(N):m=S/Math.sin(N));var D=M===1||M===3;switch(k){case"top":case"bottom":S?m=S/(D?Math.cos(N):Math.sin(N)):m=w/(D?Math.sin(N):Math.cos(N));break;case"left":case"right":w?T=w/(D?Math.cos(N):Math.sin(N)):T=S/(D?Math.sin(N):Math.cos(N));break}}switch(k){case"top":case"bottom":T=0;break;case"left":case"right":m=0;break}var z=Math.max(a.width+T,x),_=Math.max(a.height+m,x);e.minWidth&&e.minWidth>x&&(z=Math.max(z,e.minWidth)),e.minHeight&&e.minHeight>x&&(_=Math.max(_,e.minHeight)),e.maxWidth&&(z=Math.min(z,e.maxWidth)),e.maxHeight&&(_=Math.min(_,e.maxHeight)),e.preserveAspectRatio&&(T>m?_=z*(a.height/a.width):z=_*(a.width/a.height)),(z!==a.width||_!==a.height)&&t.resize(z,_,{snaplines:this.cid,direction:p,relativeDirection:k,trueDirection:E,snapped:!0});var j=t.getBBox().bbox(u),V=1;h&&Math.abs(j.x-h)>V&&Math.abs(j.width+j.x-h)>V&&(h=null),y&&Math.abs(j.y-y)>V&&Math.abs(j.height+j.y-y)>V&&(y=null),this.show({vertical:h,horizontal:y})}}}},canElementMove:function(t){return t&&t.model.isElement()&&t.can("elementMove")},snapWhileMoving:function(t,e,r,i){var n=t.eventData(e),a=n.delegatedView||t;if(!!this.canElementMove(a)){var o=a.model,s=o.get("size"),l=We(tt({x:r-this._cursorOffset.x,y:i-this._cursorOffset.y},s)),u=l.center(),g=l.bbox(o.get("angle")),h=g.origin(),y=g.corner(),x=this.options,C=x.paper,p=x.distance,E=null,k=null,w=0,S=0;if(C.model.getElements().find(function(N){if(N===o||N.isEmbeddedIn(o)||this.filterTypes[N.get("type")]||this.filterCells[N.id]||this.filterFunction&&this.filterFunction(N))return!1;var D=N.getBBox().bbox(N.get("angle")),z=D.center(),_=D.origin(),j=D.corner();return E===null&&(Math.abs(z.x-u.x)<p?(E=z.x,w=.5):Math.abs(_.x-h.x)<p?E=_.x:Math.abs(_.x-y.x)<p?(E=_.x,w=1):Math.abs(j.x-y.x)<p?(E=j.x,w=1):Math.abs(j.x-h.x)<p&&(E=j.x)),k===null&&(Math.abs(z.y-u.y)<p?(k=z.y,S=.5):Math.abs(_.y-h.y)<p?k=_.y:Math.abs(_.y-y.y)<p?(k=_.y,S=1):Math.abs(j.y-y.y)<p?(k=j.y,S=1):Math.abs(j.y-h.y)<p&&(k=j.y)),Nt(E)&&Nt(k)},this),this.hide(),Nt(E)||Nt(k)){Nt(E)&&(g.x=E-w*g.width),Nt(k)&&(g.y=k-S*g.height);var T=g.center(),m=T.x-l.width/2,A=T.y-l.height/2,M=new Z(m,A);x.usePaperGrid&&M.snapToGrid(C.options.gridSize),o.position(M.x,M.y,{restrictedArea:C.getRestrictedArea(a,r,i),deep:!0,snapped:!0}),this.show({vertical:E,horizontal:k})}}},show:function(t){t===void 0&&(t={});var e=t.vertical,r=t.horizontal,i=this,n=i.options,a=i.$horizontal,o=i.$vertical,s=i.$el,l=n.paper.matrix(),u=l.a,g=l.d,h=l.e,y=l.f;Nt(r)?a.css("top",r*g+y).show():a.hide(),Nt(e)?o.css("left",e*u+h).show():o.hide(),s.show()},hide:function(){this.$el.hide()}},{HandlePosition:RS}),Iv={options:function(){return{columnWidth:this.options.width/2-10,columns:2,rowHeight:80,resizeToFit:!0,dy:10,dx:10}},layoutGroup:function(t,e){var r=this.options.layout;if(e=e||{},!gs)throw new Error("joint.ui.Stencil: joint.layout.GridLayout is not available.");gs.layout(t,tt({},r,e.layout))}},GS=Xt.extend({className:"stencil",events:{"click .btn-expand":"openGroups","click .btn-collapse":"closeGroups","click .groups-toggle > .group-label":"openGroups","click .group > .group-label":"onGroupLabelClick","touchstart .group > .group-label":"onGroupLabelClick","input .search":"onSearch","focusin .search":"pointerFocusIn","focusout .search":"pointerFocusOut"},documentEvents:{mousemove:"onDrag",touchmove:"onDrag",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"},options:{width:200,height:800,label:"Stencil",groups:null,groupsToggleButtons:!1,dropAnimation:!1,search:null,layout:null,snaplines:null,scaleClones:!1,usePaperGrid:!1,dragStartClone:function(t){return t.clone()},dragEndClone:function(t){return t.clone()},canDrag:null,layoutGroup:null,paperOptions:null,paperDragOptions:null,paperPadding:10,contentOptions:null,container:null},DEFAULT_GROUP:"__default__",init:function(){this.setPaper(this.options.paperScroller||this.options.paper),this.graphs={},this.papers={},this.$groups={},this.onSearch=sn(this.onSearch,200),this.delegateEvents(),this.initializeLayout()},initializeLayout:function(){var t=this.options.layout;t&&(yt(t)?this.layoutGroup=t:(this.layoutGroup=Iv.layoutGroup.bind(this),this.options.layout=Yt(t)?t:{},ne(this.options.layout,Iv.options.call(this))))},setPaper:function(t){var e=this.options;if(t instanceof Oe)e.paperScroller=null,e.paper=t,e.graph=t.model;else if(typeof ys=="function"&&t instanceof ys)e.paperScroller=t,e.paper=t.options.paper,e.graph=t.options.paper.model;else throw new Error("Stencil: paper required")},freeze:function(e){var r=this,i=r.papers;Object.keys(i).forEach(function(n){i[n].freeze(e)})},unfreeze:function(e){var r=this,i=r.papers;Object.keys(i).forEach(function(n){i[n].unfreeze(e)})},renderContent:function(){return f("<div/>").addClass("content")},renderPaperDrag:function(){return f("<div/>").addClass("stencil-paper-drag")},renderSearch:function(){return f("<div/>").addClass("search-wrap").append(f("<input/>",{type:"search",placeholder:"search"}).addClass("search"))},renderToggleAll:function(){return[f("<div/>").addClass("groups-toggle").append(f("<label/>").addClass("group-label").html(this.options.label)).append(f("<button/>",{text:"+"}).addClass("btn btn-expand")).append(f("<button/>",{text:"-"}).addClass("btn btn-collapse"))]},renderElementsContainer:function(){return f("<div/>").addClass("elements")},renderGroup:function(t){t=t||{};var e=f("<div/>").addClass("group").attr("data-name",t.name).toggleClass("closed",!!t.closed),r=f("<h3/>").addClass("group-label").html(t.label||t.name),i=this.renderElementsContainer();return e.append(r,i)},render:function(){this.dispose();var t=this.options;this.$content=this.renderContent(),this.$paperDrag=this.renderPaperDrag(),this.$el.empty().append(this.$paperDrag,this.$content),t.search&&this.$el.addClass("searchable").prepend(this.renderSearch()),t.groupsToggleButtons&&this.$el.addClass("collapsible").prepend(this.renderToggleAll()),this.el.dataset.textNoMatchesFound="No matches found";var e=Object.keys(t.groups||{}),r=e.length>0,i;if(t.paperOptions&&!yt(t.paperOptions)&&t.paperOptions.model)throw new Error("ui.Stencil: the `paperOptions` has to be a function if there is the property `model` defined.");if(r){var n=Fe(e,function(u){return this[u].index}.bind(t.groups));n.forEach(function(u){var g=this.options.groups[u],h=this.$groups[u]=this.renderGroup({name:u,label:g.label,closed:g.closed}).appendTo(this.$content);if(g.paperOptions&&g.paperOptions.model)throw new Error("ui.Stencil: the `model` property is not allowed in the `paperOptions` for the groups.");i=re(t,"paperOptions")||{};var y=i.model||new Ie;y.set("group",u);var x=tt({},i,g.paperOptions,{el:h.find(".elements"),model:y,width:g.width||t.width,height:g.height||t.height,interactive:!1,preventDefaultBlankAction:!1}),C=new Oe(x);this.graphs[u]=x.model,this.papers[u]=C},this)}else{var a=this.renderElementsContainer().appendTo(this.$content);i=re(t,"paperOptions")||{};var o=new Oe(tt({},i,{el:a,model:i.model||new Ie,width:t.width,height:t.height,interactive:!1,preventDefaultBlankAction:!1}));this.graphs[this.DEFAULT_GROUP]=o.model,this.papers[this.DEFAULT_GROUP]=o}i=re(t,"paperOptions")||{};var s=re(t,"paperDragOptions")||{},l=this._graphDrag=s.model||i.model||new Ie;return this._paperDrag=new Oe(tt({},s,{el:this.$paperDrag,width:1,height:1,model:l,sorting:Oe.sorting.NONE})),this.startListening(),this},paperEvents:{"cell:pointerdown":"onDragStart"},startListening:function(){var t=this;this.stopListening();var e=this,r=e.paperEvents,i=e.papers,n=function(o){var s=r[o];typeof s!="function"&&(s=t[s]),s&&Ut(i,function(l){t.listenTo(l,o,s)})};for(var a in r)n(a)},load:function(t,e){Array.isArray(t)?this.loadGroup(t,e):Yt(t)&&Ut(this.options.groups,function(r,i){t[i]&&this.loadGroup(t[i],i)}.bind(this))},loadGroup:function(t,e){var r=this,i=r.options,n=this.getGraph(e);n.resetCells(t);var a=i.height;e&&(a=this.getGroup(e).height),this.isLayoutEnabled()&&this.layoutGroup(n,this.getGroup(e)),a||this.fitPaperToContent(this.getPaper(e))},isLayoutEnabled:function(){return Boolean(this.options.layout)},getGraph:function(t){var e=this.graphs[t||this.DEFAULT_GROUP];if(!e)throw new Error("Stencil: group "+t+" does not exist.");return e},getPaper:function(t){return this.papers[t||this.DEFAULT_GROUP]},hasSnaplinesEnabled:function(){var t=this.options,e=t.snaplines;return Boolean(e)&&!e.isDisabled()},preparePaperForDragging:function(t,e,r){var i=this,n=i._paperDrag,a=i._graphDrag,o=i.options,s=o.snaplines,l=o.usePaperGrid,u=o.scaleClones,g=o.paper,h=o.container;this.stopListening(a),n.$el.stop(!0,!0),n.$el.addClass("dragging").appendTo(h||document.body);var y=o.dragStartClone(t.model).position(0,0);a.resetCells([y]);var x=5;if(s&&(x+=s.options.distance),s||l||u){var C=g.scale(),p=C.sx,E=C.sy;n.scale(p,E),x*=Math.max(p,E)}else n.scale(1,1);n.fitToContent({padding:x,allowNewOrigin:"any"});var k=y.findView(n),w=k.getBBox({useModelGeometry:!0}),S=w.origin().difference(k.getBBox().origin()),T=this.setPaperDragOffset(e,r,{cloneGeometryBBox:w,cloneViewDeltaOrigin:S,paperDragPadding:x}),m=f(h).offset();return m&&(T.left-=m.left,T.top-=m.top),{clone:y,cloneView:k,cloneBBox:y.getBBox(),cloneGeometryBBox:w,cloneViewDeltaOrigin:S,paperDragPadding:x,paperDragInitialOffset:T}},removePaperAfterDragging:function(){var t=this,e=t._paperDrag,r=t._graphDrag;r.resetCells([]),this.$el.append(e.$el).removeClass("dragging"),e.$el.removeClass("dragging")},setPaperDragOffset:function(t,e,r){var i=r.cloneViewDeltaOrigin,n=r.cloneGeometryBBox,a=r.paperDragPadding,o=document.body,s=document.documentElement,l=o.scrollTop||s.scrollTop,u=t-i.x-n.width/2-a,g=e-i.y-n.height/2-a+l;return this._paperDrag.$el.offset({left:u,top:g}),{left:u,top:g}},onCloneSnapped:function(t,e,r){var i=this,n=i._dragging;if(!!n){var a=r.snapped,o=r.tx,s=r.ty;if(a){var l=n.cloneBBox,u=n.cloneView;t.position(l.x+o,l.y+s,{silent:!0}),u.translate(),t.set("position",e,{silent:!0}),n.snapOffset={x:o,y:s}}else n.snapOffset=null}},_dragging:null,onDragStart:function(t,e){var r=this,i=r.options,n=r._graphDrag,a=i.canDrag,o=i.snaplines;i.usePaperGrid;var s=t.model.graph.attributes,l=s.group;if(l===void 0&&(l=null),!(typeof a=="function"&&!a.call(this,t,e,l))){this.$el.addClass("dragging");var u=e.clientX,g=e.clientY,h=this.preparePaperForDragging(t,u,g),y=h.cloneView,x=h.clone;this._dragging=h;var C=!1,p=this.getCloneArea(y,e,C);tt(h,{clientX:u,clientY:g,validDropTarget:C,cloneArea:p}),x.position(p.x,p.y,{silent:!0}),this.hasSnaplinesEnabled()&&(o.captureCursorOffset(y,e,p.x,p.y),this.listenTo(n,"change:position",this.onCloneSnapped.bind(this))),this.delegateDocumentEvents(null,e.data),this.trigger("element:dragstart",y,e,p.clone(),C),y.stopListening(),this.isDragCanceled()&&(this.notifyDragEnd(y,e,p,C),this._dragging=null)}},onDrag:function(t){var e=this,r=e._dragging,i=e.options;if(!!r){t.preventDefault();var n=ot(t);if(this.isDragCanceled()){var a=r.cloneView,o=r.validDropTarget,s=r.cloneArea;this.notifyDragEnd(a,n,s,o),this._dragging=null;return}var l=r.cloneView,u=l.model,g=i.paper,h=i.snaplines,y=i.usePaperGrid,x=this.insideValidArea({x:n.clientX,y:n.clientY}),C=this.getCloneArea(l,n,x&&y),p=C.center(),E=p.x,k=p.y,w=g.localToClientPoint(E,k),S=w.x,T=w.y;tt(r,{clientX:S,clientY:T,validDropTarget:x,cloneArea:C}),this.setPaperDragOffset(S,T,r),u.position(0,0,{silent:!0}),l.translate(),u.position(C.x,C.y,{stencil:this.cid}),this.hasSnaplinesEnabled()&&(x?h.snapWhileMoving(l,n,C.x,C.y):h.hide());var m=g.options,A=m.embeddingMode;if(A){l.eventData(n,{paper:g});var M=r.cloneViewEventData=l.eventData(n);x?l.processEmbedding(M,t,E,k):l.clearEmbedding(M)}l.startListening(),this.trigger("element:drag",l,n,C.clone(),x),l.stopListening(),this.isDragCanceled()&&(this.notifyDragEnd(l,n,C,x),this._dragging=null)}},onDragEnd:function(t){var e=this,r=e._dragging,i=e.options;if(!!r){var n=ot(t),a=r.clone,o=r.clientX,s=r.clientY,l=r.validDropTarget,u=r.cloneArea,g=r.cloneView,h=r.cloneBBox,y=r.snapOffset,x=h.x,C=h.y;if(y&&(x+=y.x,C+=y.y),a.position(x,C,{silent:!0}),this.notifyDragEnd(g,n,u,l),this.isDragCanceled()){this._dragging=null;return}var p=i.paper.clientToLocalPoint(o,s),E=!y;l?this.onDrop(g,n,p,E):this.onDropInvalid(g,n,p,E),this._dragging=null}},notifyDragEnd:function(t,e,r,i){t.startListening(),this.trigger("element:dragend",t,e,r.clone(),i),t.stopListening(),this.undelegateDocumentEvents()},onDrop:function(t,e,r,i){var n=this,a=n.options,o=a.paper,s=a.graph,l=o.options,u=l.embeddingMode,g=t.model;s.startBatch("stencil-drag");var h=a.dragEndClone(g);this.drop(h,r,i),u&&(t.eventData(e,{model:h,paper:o,initialParentId:Hn(),whenNotAllowed:"remove"}),t.finalizeEmbedding(t.eventData(e))),s.getCell(h)?(this.trigger("element:drop",h.findView(o),e,r.x,r.y),this.removePaperAfterDragging(g)):this.onDropInvalid(t,e,r,i),s.stopBatch("stencil-drag")},onDropInvalid:function(t,e,r,i){var n=t.model,a=this.options.dragEndClone(n);this.trigger("drop:invalid",e,a,r.x,r.y),this.cancelDrag()},cancelDrag:function(t){t===void 0&&(t=this.options);var e=t.dropAnimation,r=this,i=r._dragging,n=r.options,a=r._paperDrag;if(!!i){var o=i.clone,s=i.cloneView,l=i.cloneViewEventData,u=i.paperDragInitialOffset,g=n.paper,h=n.snaplines;if(g.options.embeddingMode&&l&&s.clearEmbedding(l),this.hasSnaplinesEnabled()&&h.hide(),i.canceled=!0,e){var y=e.duration;y===void 0&&(y=150);var x=e.easing;x===void 0&&(x="swing"),a.$el.animate(u,y,x,this.removePaperAfterDragging.bind(this,o))}else this.removePaperAfterDragging(o)}},isDragCanceled:function(){var t=this,e=t._dragging;return e?Boolean(e.canceled):!1},drop:function(t,e,r){var i=this,n=i.options,a=n.paper,o=n.graph,s=t.getBBox(),l=new Z({x:e.x+s.x-s.width/2,y:e.y+s.y-s.height/2});r&&l.snapToGrid(a.options.gridSize),t.unset("z"),t.position(l.x,l.y),o.addCell(t,{stencil:this.cid})},insideValidArea:function(t){var e=this.options,r=e.paper,i=e.paperScroller,n=this.getDropArea(this.$el),a;if(!i)a=this.getDropArea(r.$el);else if(i.options.autoResizePaper)a=this.getDropArea(i.$el);else{var o=this.getDropArea(i.$el),s=this.getDropArea(r.$el);a=s.intersect(o)}return!!(a&&a.containsPoint(t)&&!n.containsPoint(t))},getDropArea:function(t){var e=f(t),r=e.offset(),i=r.left,n=r.top,a=document.body,o=document.documentElement,s=a.scrollTop||o.scrollTop,l=a.scrollLeft||o.scrollLeft,u=parseInt(e.css("border-left-width"),10),g=parseInt(e.css("border-top-width"),10);return new at({x:i+u-l,y:n+g-s,width:e.innerWidth(),height:e.innerHeight()})},getCloneArea:function(e,r,i){var n=this.options,a=n.paper,o=e.model,s=r.clientX,l=r.clientY,u=a.clientToLocalPoint(s,l),g=u.x,h=u.y,y=o.size(),x=y.width,C=y.height,p=g-x/2,E=h-C/2;if(i){var k=a.snapToGrid(a.localToClientPoint(p,E)),w=k.x,S=k.y;p=w,E=S}return new at(p,E,x,C)},filter:function(t,e){var r=this;e===void 0&&(e=this.options.search);var i=Object.keys(this.papers).reduce(function(n,a){var o=r.papers[a],s=a===r.DEFAULT_GROUP?null:a,l=o.model.getCells().filter(function(C){var p=!1;yt(e)?p=e.call(r,C,t,s,r):p=r.isCellMatched(C,t,e,t.toLowerCase()!==t);var E=o.findViewByModel(C);return E&&E.vel.toggleClass("unmatched",!p),p}),u=!je(l),g=r.options,h=re(g,"paperOptions")||{},y=h.model||new Ie,x=y.resetCells(l);return r.trigger("filter",x,a,t),r.isLayoutEnabled()&&r.layoutGroup(x,r.getGroup(a)),r.$groups[a]&&r.$groups[a].toggleClass("unmatched",!u),r.fitPaperToContent(o),n||u},!1);this.$el.toggleClass("not-found",!i)},isCellMatched:function(t,e,r,i){return e?Object.keys(r).some(function(n){var a=r[n];if(n!="*"&&t.get("type")!=n)return!1;var o=a.some(function(s){var l=Ye(t.attributes,s,"/");return l==null?!1:(l=l.toString(),i||(l=l.toLowerCase()),l.indexOf(e)>=0)});return o}):!0},fitPaperToContent:function(t){var e=this,r=e.options,i=t.getComputedSize(),n=i.width,a=tt({minWidth:n,padding:r.paperPadding},r.contentOptions);t.fitToContent(a)},getGroup:function(t){return this.options.groups&&this.options.groups[t]||{}},onSearch:function(t){var e=t.target.value;this.$el.toggleClass("stencil-filtered",e.length>0),this.filter(e,this.options.search)},pointerFocusIn:function(){this.$el.addClass("is-focused")},pointerFocusOut:function(){this.$el.removeClass("is-focused")},onGroupLabelClick:function(t){if(t.type==="touchstart")this._groupLabelClicked=!0;else if(this._groupLabelClicked&&t.type==="click"){this._groupLabelClicked=!1;return}var e=f(t.target).closest(".group");this.toggleGroup(e.data("name"))},toggleGroup:function(t){this.isGroupOpen(t)?this.closeGroup(t):this.openGroup(t)},closeGroup:function(t){var e=this.$groups[t];!e||!this.isGroupOpen(t)||(this.trigger("group:close",t),e.addClass("closed"))},openGroup:function(t){var e=this.$groups[t];!e||this.isGroupOpen(t)||(this.trigger("group:open",t),e.removeClass("closed"))},isGroupOpen:function(t){var e=this.$groups[t];return e?!e.hasClass("closed"):!1},closeGroups:function(){Object.keys(this.$groups).forEach(function(t){this.closeGroup(t)},this)},openGroups:function(){Object.keys(this.$groups).forEach(function(t){this.openGroup(t)},this)},onRemove:function(){this.dispose()},dispose:function(){me(this.papers,"remove"),this.papers={},this._paperDrag&&(this._paperDrag.remove(),this._paperDrag=null),this.undelegateDocumentEvents()}}),Sv=F.mergeAttrs,Mv=ze,kv=je,Pv=Xn,jS=Yr;function Wi(t,e,r){r===void 0&&(r={});var i=r.merge;i===void 0&&(i=Sv);var n={};return t.forEach(function(a){var o=a.start,s=a.end,l=a.attrs;(o===void 0&&s===void 0||e>=o&&e<s)&&i(n,l)}),n}function bs(t,e,r,i){i===void 0&&(i={});var n=i.delim;n===void 0&&(n="/");var a=i.merge;a===void 0&&(a=Sv);var o=F.findAnnotationsBetweenIndexes(t,e,r);if(e===r)return Wi(o,e,i);for(var s,l=e;l<r;l++){var u=Wi(o,l,i);if(s&&!Mv(s,u)){s=Pv(a({},s),n),u=Pv(a({},u),n);var g={};for(var h in u)s[h]===u[h]&&jS(g,h,u[h],n);s=g}else s=u}return s}function FS(t,e){e===void 0&&(e={});var r=e.compare;r===void 0&&(r=Mv);for(var i=[],n=t.reduce(function(g,h){var y=h.end;return y===void 0?g:Math.max(g,y)},0),a=-1,o=n;a<o;a++){for(var s=null,l=a+1;l<=o;l++){var u=bs(t,l-1,l,e);if(!s){s=u;continue}r(u,s)||(l--,kv(s)||i.push({start:a,end:l,attrs:s}),s=null,a=l)}if(!!s){a<o&&!kv(s)&&i.push({start:a,end:o,attrs:s});break}}return i}var Zi=Xt.extend({options:{text:void 0,newlineCharacterBBoxWidth:10,placeholder:void 0,focus:!0,debug:!1,selectAllThreshold:20,useNativeSelection:!0,annotateUrls:!1,urlAnnotation:{attrs:{class:"url-annotation",fill:"lightblue","text-decoration":"underline"}},textareaAttributes:{autocorrect:"off",autocomplete:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}},className:"text-editor",events:{"keyup textarea":"onKeyup","input textarea":"onInput","copy textarea":"onCopy","cut textarea":"onCut","paste textarea":"onPaste","mousedown .char-selection-box":"onMousedown","dblclick .char-selection-box":"onDoubleClick","click .char-selection-box":"onTripleClick"},selection:{start:null,end:null},selecting:!1,_textCursor:null,AFTER_KEYDOWN_DELAY:10,DEFAULT_FONT_SIZE:12,init:function(){ke(this,"onMousedown","onMousemove","onMouseup","onDoubleClick","onTripleClick","onKeydown","onAfterPaste","onAfterKeydown","onDocumentPointerdown");var t=this.options.text;if(!t)throw new Error("ui.TextEditor: text option is mandatory");this.setTextElement(t),document.addEventListener("pointerdown",this.onDocumentPointerdown,{capture:!0}),f(document.body).on("mousemove",this.onMousemove),f(document.body).on("mouseup",this.onMouseup),f(document.body).on("keydown",this.onKeydown),this.$viewport=f(t),this.options.annotations&&this.setAnnotations(this.options.annotations)},setTextElement:function(t){this.options.text=t,this.bindTextElement(t)},bindTextElement:function(t){if(this.unbindTextElement(),!!t){var e=f(t);e.on("mousedown",this.onMousedown),e.on("dblclick",this.onDoubleClick),e.on("click",this.onTripleClick),this.elText=t}},unbindTextElement:function(){var t=this,e=t.elText;if(!!e){var r=f(e);r.off("mousedown",this.onMousedown),r.off("dblclick",this.onDoubleClick),r.off("click",this.onTripleClick),this.elText=null}},render:function(t){this.$caret=f("<div>",{class:"caret"}),this.$selection=f("<div>"),this.$selectionBox=f("<div>",{class:"char-selection-box"}),this.$el.append(this.$caret,this.$selection),this.$textareaContainer=f("<div>",{class:"textarea-container"}),this.$textarea=f("<textarea>",this.options.textareaAttributes),this.textarea=this.$textarea[0],this._textContent=this.textarea.value=this.getTextContent(),this._textareaValueBeforeInput=this.textarea.value,this.$textareaContainer.append(this.textarea),this.options.focus&&this.$el.append(this.$textareaContainer),f(t||document.body).append(this.$el);var e=F(this.options.text),r=e.bbox();return this.$textareaContainer.css({left:r.x,top:r.y}),this.focus(),this._textCursor=e.attr("cursor"),e.attr("cursor","text"),this.selectAll(),this},annotateURLBeforeCaret:function(t){if(t===0)return!1;var e=Math.max(t-1,0),r=this.getURLBoundary(e),i=this.getAnnotations()||[];if(r)return this.annotateURL(i,r[0],r[1]),!0;var n=F.findAnnotationsAtIndex(i,e);return!!n.some(function(a){return a.url})},hasSelection:function(){return Nt(this.selection.start)&&Nt(this.selection.end)&&this.selection.start!==this.selection.end},textContentHasChanged:function(){return this._textContent!==this.textarea.value},restoreTextAreaSelectionDirection:function(){this._selectionDirection&&(this.textarea.selectionDirection=this._selectionDirection)},storeSelectionDirection:function(){this._selectionDirection=this.textarea.selectionDirection},updateSelectionFromTextarea:function(){var t=this.textarea,e=t.selectionStart,r=t.selectionEnd;e===r?this.setCaret(e):this.select(e,r)},textSelectionHasChanged:function(){var t=this,e=t.selection,r=t.textarea;return!e||!r?!1:e.start!==r.selectionStart||e.end!==r.selectionEnd},isModifierKey:function(t){var e=[16,18,17,91];return e.some(function(r){return t.which===r})},isArrowKey:function(t){return t.which>=37&&t.which<=40},copyToClipboard:function(){var t=document.queryCommandSupported&&document.queryCommandSupported("copy");t&&(this._copied=!0,document.execCommand("copy"))},findAnnotationsUnderCursor:function(t,e){return F.findAnnotationsAtIndex(t,e)},findAnnotationsInSelection:function(t,e,r){return F.findAnnotationsBetweenIndexes(t,e,r)},inferTextOperationType:function(t,e,r){if(t.start===t.end&&e.start===e.end&&r>0)return"insert";if(t.start===t.end&&e.start===e.end&&r<=0)return"delete-single";if(t.start!==t.end&&e.start===e.end&&e.start===t.start)return"delete";if(t.start!==t.end&&e.start!==t.start)return"delete-insert"},annotate:function(t,e,r,i){var n=[],a=this.inferTextOperationType(e,r,i);return lt(t).forEach(function(o){var s,l;switch(a){case"insert":o.start<e.start&&e.start<=o.end?o.end+=i:o.start>=e.start&&(o.start+=i,o.end+=i);break;case"delete-single":o.start<e.start&&e.start<=o.end&&e.start!==r.start||o.start<=e.start&&e.start<o.end&&e.start===r.start?o.end+=i:o.start>=e.start&&(o.start+=i,o.end+=i);break;case"delete":o.start<=e.start&&e.start<=o.end?e.end<=o.end?o.end+=i:o.end+=r.start-o.end:o.start>=e.start&&o.start<e.end?(s=o.end-o.start,l=e.end-o.start,o.start=e.start,o.end=o.start+s-l):o.start>=e.end&&(o.start+=i,o.end+=i);break;case"delete-insert":if(o.start<=e.start&&e.start<=o.end)e.start<o.end&&(e.end>o.end?o.end=r.end:o.end=r.end+(o.end-e.end));else if(o.start>=e.start&&o.start<=e.end){var u=r.start-e.start;l=e.end-o.start,s=o.end-o.start,o.start=e.start+u,o.end=o.start+s-l}else o.start>=e.start&&o.end<=e.end?o.start=o.end=0:o.start>=e.end&&(o.start+=i,o.end+=i);break;default:this.options.debug&&console.log("ui.TextEditor: Unknown text operation.");break}o.end>o.start&&n.push(o)},this),n},shiftAnnotations:function(t,e,r){return F.shiftAnnotations(t,e,r)},setCurrentAnnotation:function(t){this._currentAnnotationAttributes=t},setAnnotations:function(t){this._annotations=t},getAnnotations:function(){return this._annotations},getCombinedAnnotationAttrsAtIndex:function(t,e){return Wi(lt(e),t)},getSelectionAttrs:function(t,e){var r=t.start,i=t.end;return i===void 0&&(i=r),r===i?Wi(e,r-1):bs(e,r,i)},getTextContent:function(){var t=this.options.text,e=F(t).find(".v-line");return e.length===0?t.textContent:e.reduce(function(r,i,n,a){var o=i.node.textContent;return i.hasClass("v-empty-line")&&(o=""),n===a.length-1?r+o:r+o+`
`},"")},startSelecting:function(){this.selecting=!0},stopSelecting:function(){this.selecting=!1},selectionInProgress:function(){return this.selecting===!0},selectAll:function(){return this.select(0,this.getNumberOfChars())},select:function(t,e){var r=this,i=r.options,n=r.selection;i.debug&&console.log("select(",t,e,")");var a=n.start,o=n.end;e===void 0&&(e=t),Nt(t)&&(n.start=t),Nt(e)&&(n.end=e),Nt(n.end)||(n.end=n.start);var s=n.start,l=n.end;if(Nt(s)&&Nt(l)){var u=a!==s||o!==l;if(u&&this.setCurrentAnnotation(null),s===l)this.clearSelection(),this.focus(),this.setCaret(s);else{this.hideCaret(),this.setTextAreaSelection(s,l);var g=this.textarea.value;s>l&&this.constructor.isLineEnding(g,l)?this.constructor.isLineStart(g,s)&&l!==s-1?this.renderSelection(l,s-2):this.renderSelection(l,s-1):this.renderSelection(s,l)}this.trigger("select:change",s,l)}return this},setTextAreaSelection:function(t,e){var r={start:t,end:e};r=this.normalizeSelectionRange(r),this.textarea.focus(),this.textarea.selectionStart=r.start,this.textarea.selectionEnd=r.end},renderSelection:function(t,e){this.options.debug&&console.log("renderSelection()");var r={start:t,end:e};if(r=this.normalizeSelectionRange(r),this.clearSelection(),this.options.useNativeSelection){this.$viewport&&(this._viewportUserSelectBefore=this.$viewport.css("user-select"),this.$viewport.css({"-webkit-user-select":"all","-moz-user-select":"all","user-select":"all"}));var i=r.end-r.start;this.selectTextInElement(this.options.text,r.start,i)}else this.renderSelectionBoxes(r.start,r.end)},normalizeSelectionStartAndLength:function(t,e,r){var i=t.substr(0,e),n=t.substr(e,r),a=this.countLineBreaks(i),o=this.countLineBreaks(n);e-=a,r-=o;var s=this.countEmptyLines(i),l=this.countEmptyLines(n);return e+=s,r+=s,r-=s,r+=l,{start:e,length:r}},selectTextInElement:function(t,e,r){if(yt(t.selectSubString)&&this.selectTextInElementUsingSelectSubString(t,e,r),!this.actualSelectionMatchesExpectedSelection(e,r))try{this.selectTextInElementUsingRanges(t,e,r)}catch(i){this.options.debug&&console.log(i),yt(t.selectSubString)&&this.selectTextInElementUsingSelectSubString(t,e,r)}},selectTextInElementUsingSelectSubString:function(t,e,r){var i=this.normalizeSelectionStartAndLength(this.getTextContent(),e,r);try{t.selectSubString(i.start,i.length)}catch(n){this.options.debug&&console.log(n)}},selectTextInElementUsingRanges:function(t,e,r){var i=window.getSelection();i.removeAllRanges();var n=this.normalizeSelectionStartAndLength(this.getTextContent(),e,r);e=0+n.start,r=0+n.length;for(var a=this.getTextNodesFromDomElement(t),o,s,l,u,g,h=0,y=e+r,x=document.createRange();r>0&&a.length>0;)o=a.shift(),s=h,l=h+o.length,(s>=e&&s<y||l>e&&l<=y||e>=s&&e<l||y>s&&y<=l)&&(u=Math.max(e-s,0),g=Math.min(u+Math.min(r,o.length),l),x.collapsed&&x.setStart(o,u),x.setEnd(o,g),r-=g-u),h+=o.length;x.collapsed||i.addRange(x)},actualSelectionMatchesExpectedSelection:function(t,e){var r=window.getSelection(),i=r.toString(),n=this.getExpectedSelectedContent(t,e);return i=i.replace(/\s/g," "),n===i},getExpectedSelectedContent:function(t,e){var r=this.getTextContent(),i=r.substr(t,e);return i.search(/(\n\r|\r|\n)/)===0&&(i="-"+i),i=i.replace(/(\n\r|\r|\n){2,}/g,function(n){return Array.from({length:n.length-1},function(){return"-"}).join("")}),i=i.replace(/\n\r|\r|\n/g,""),i=i.replace(/\s/g," "),i},getTextNodesFromDomElement:function(t){for(var e=[],r=0,i=t.childNodes.length;r<i;r++){var n=t.childNodes[r];n.tagName!==void 0?e=e.concat(this.getTextNodesFromDomElement(n)):e.push(n)}return e},renderSelectionBoxes:function(t,e){this.options.debug&&console.log("renderSelectionBoxes()"),this.$selection.empty();for(var r=this.getFontSize(),i=this.getTextTransforms(),n=i.rotation,a,o,s,l=t;l<e;l++){var u=this.$selectionBox.clone();try{s=this.getCharBBox(l)}catch{this.trigger("select:out-of-range",t,e);break}o&&n===0&&Math.round(s.y)===Math.round(o.y)&&Math.round(s.height)===Math.round(o.height)&&Math.round(s.x)===Math.round(o.x+o.width)?a.css({width:"+="+s.width}):(u.css({left:s.x,top:s.y-s.height,width:s.width,height:s.height,"-webkit-transform":"rotate("+n+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+n+"deg)","-moz-transform-origin":"0% 100%"}),this.$selection.append(u),a=u),o=s}s&&this.$textareaContainer.css({left:s.x,top:s.y-r*i.scaleY})},clearSelection:function(){return this.options.debug&&console.log("clearSelection()"),this.$selection.empty(),this.options.text.selectSubString&&(this.$viewport&&this._viewportUserSelectBefore&&this.$viewport.css({"-webkit-user-select":this._viewportUserSelectBefore,"-moz-user-select":this._viewportUserSelectBefore,"user-select":this._viewportUserSelectBefore}),window.getSelection().removeAllRanges()),this},deselect:function(){return this.options.debug&&console.log("deselect()"),this.stopSelecting(),this.clearSelection(),this.setTextAreaSelection(this.selection.start,this.selection.end),this},getSelectionStart:function(){return this.selection.start},getSelectionEnd:function(){return this.selection.end},getSelectionRange:function(){return this.normalizeSelectionRange(this.selection)},normalizeSelectionRange:function(t){return t=be(t),t.start>t.end&&(t.end=[t.start,t.start=t.end][0]),t},getSelectionLength:function(){var t=this.getSelectionRange();return t.end-t.start},getSelection:function(){var t=this.getSelectionRange();return this.getTextContent().slice(t.start,t.end)},getWordBoundary:function(t){for(var e=this.textarea.value,r=/\W/,i=t;i;){if(r.test(e[i])){i+=1;break}i-=1}for(var n=this.getNumberOfChars(),a=t;a<n&&!r.test(e[a]);)a+=1;return i<a?[i,a]:[a,i]},getURLBoundary:function(t){for(var e=this.textarea.value,r=/\s/,i=/[-a-zA-Z0-9@:%_+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_+.~#?&//=]*)?/,n=t;n>-1;){if(r.test(e[n])){n+=1;break}n-=1}n=Math.max(n,0);for(var a=this.getNumberOfChars(),o=Math.max(n,t);o<=a&&!r.test(e[o]);)o+=1;if(o=Math.min(o,a),i.test(e.substring(n,o)))return[n,o]},annotateURL:function(t,e,r){var i=this.textarea.value.substring(e,r);if(t.some(function(s){return s.url===i&&s.start===e&&s.end===r}))return t;var n,a=this.options,o=a.urlAnnotation;if(typeof o=="function"){if(n=o(i),!n)return t}else n=tt({},o);return tt(n,{url:i,start:e,end:r}),t.push(n),t},getCharBBox:function(t){if(this.isLineEnding(t)){var e=this.getCharBBox(t-1);return e.x=e.x2,e.y=e.y2,e.width=this.options.newlineCharacterBBoxWidth||10,e}this.ensureTextVisibility();var r=this.realToSvgCharNum(t),i=this.options.text,n=i.getStartPositionOfChar(r),a=i.getEndPositionOfChar(r),o=i.getExtentOfChar(r);n=this.localToScreenCoordinates(n),a=this.localToScreenCoordinates(a);var s=this.getTextTransforms(),l=n.x,u=n.y,g=o.width*s.scaleX,h=o.height*s.scaleY;return{x:l,y:u,width:g,height:h,x2:a.x,y2:a.y}},realToSvgCharNum:function(t){for(var e=0,r=0;r<=t;r++)this.isLineEnding(r)&&(e+=1);return t-e},selectionStartToSvgCharNum:function(t){return t-this.nonEmptyLinesBefore(t)},svgToRealCharNum:function(t){for(var e=0,r=0;r<=t+e;r++)this.isLineEnding(r)&&(e+=1);return t+e},ensureTextVisibility:function(){f(this.options.text).show()},localToScreenCoordinates:function(t){return F.transformPoint(t,this.options.text.getCTM())},getNumberOfChars:function(){return this.getTextContent().length},getCharNumFromEvent:function(t){var e=this.options.text,r=F(e).toLocalPoint(t.clientX,t.clientY);return this.getCharNumAtPosition(r)},getCharNumAtPosition:function(t){this.ensureTextVisibility();var e=this.options.text,r=e.getCharNumAtPosition(t);if(r<0){var i=F(e).getBBox();i.inflate(-1);var n=i.containsPoint(t);if(!n&&this.hasSelection()&&i.clone().inflate(this.options.selectAllThreshold).containsPoint(t))return this.selection.end;var a=n?t:i.pointNearestToPoint(t),o=F.createSVGPoint(a.x,a.y),s=e.getCharNumAtPosition(o),l=t.x>i.x;if(s===-1){var u=i.x,g=i.x+i.width,h,y=(u+g)/2;do{o.x=y;var x=e.getCharNumAtPosition(o);x>-1&&(s=x),h=y,l&&x>-1||!l&&x===-1?(y=(y+g)/2,u=h):(y=(u+y)/2,g=h)}while(Math.abs(h-y)>1)}if(s>-1){var C=this.svgToRealCharNum(s);return!l||this.getTextContent()[C]===`
`?C:C+1}return t.x<i.x&&t.y<i.y+i.height?0:this.getNumberOfChars()}var p=this.localToScreenCoordinates(t),E=this.getCharBBox(this.svgToRealCharNum(r));return Math.abs(E.x-p.x)<Math.abs(E.x+E.width-p.x)?this.svgToRealCharNum(r):this.svgToRealCharNum(r)+1},lineNumber:function(t){var e=this.textarea.value.substr(0,t);return this.countLineBreaks(e)},emptyLinesBefore:function(t){for(var e=this.textarea.value.split(/\n\r|\r|\n/g),r=this.lineNumber(t),i=0,n=r-1;n>=0;n--)e[n]||(i+=1);return i},countLineBreaks:function(t){return(t.match(/\n\r|\r|\n/g)||[]).length},countEmptyLines:function(t){var e=(t.match(/(\n\r|\r|\n){2,}/g)||[]).reduce(function(r,i){return r+(i.length-1)},0);return t.search(/(\n\r|\r|\n)/)===0&&e++,e},nonEmptyLinesBefore:function(t){return this.lineNumber(t)-this.emptyLinesBefore(t)},isEmptyLine:function(t){var e=this.textarea.value.split(/\n\r|\r|\n/g);return!e[t]},isEmptyLineUnderSelection:function(t){var e=this.lineNumber(t);return this.isEmptyLine(e)},isLineEnding:function(t){return this.constructor.isLineEnding(this.textarea.value,t)},getTextTransforms:function(){var t=this.options.text.getCTM();return F.decomposeMatrix(t)},getFontSize:function(){var t=this,e=t.DEFAULT_FONT_SIZE,r=t.options,i=parseFloat(r.text.getAttribute("font-size"));return Number.isNaN(i)?e:i},getFontFill:function(){var t=this,e=t.options,r=e.text.getAttribute("fill");return r||""},getTextAnchor:function(){var t=this,e=t.options,r=e.text.getAttribute("text-anchor");return r||""},getCaretAttrs:function(e){var r=this.getAnnotations()||[],i=this._currentAnnotationAttributes;if(r.length===0&&!i)return{"font-size":this.getFontSize(),fill:this.getFontFill()};var n=r.concat([{attrs:i}]),a=Wi(n,e-1),o=parseFloat(a["font-size"]),s=a.fill;return{"font-size":Number.isNaN(o)?this.getFontSize():o,fill:s||this.getFontFill()}},setCaret:function(t,e){this.ensureTextVisibility(),Yt(t)&&(e=t,t=void 0),e=e||{};var r=this.getNumberOfChars(),i=this.selection.start;return typeof t<"u"&&(t=Math.min(Math.max(t,0),r),i=this.selection.start=this.selection.end=t),e.silent||this.trigger("caret:change",i),this.options.debug&&console.log("setCaret(",t,e,")","selectionStart",i,"isLineEnding",this.isLineEnding(i),"isEmptyLineUnderSelection",this.isEmptyLineUnderSelection(i),"svgCharNum",this.selectionStartToSvgCharNum(i),"nonEmptyLinesBefore",this.nonEmptyLinesBefore(i)),this.updateCaret(),this.setTextAreaSelection(i,i),this.focus(),this},updateCaret:function(){var t=this,e=t.$caret,r=t.$textareaContainer,i=t.selection,n=t.options,a=t.textarea,o=i.start,s=n.text,l=n.placeholder,u=this.getNumberOfChars(),g;try{var h;!this.isEmptyLineUnderSelection(o)&&(this.isLineEnding(o)||a.value.length===o)?(h=this.selectionStartToSvgCharNum(o)-1,g=s.getEndPositionOfChar(h)):(h=this.selectionStartToSvgCharNum(o),g=s.getStartPositionOfChar(h))}catch{this.trigger("caret:out-of-range",o),g={x:0,y:0}}var y=this.localToScreenCoordinates(g),x=y.x,C=y.y,p=this.getTextTransforms(),E=p.rotation,k=p.scaleY,w=this.getCaretAttrs(o),S=w["font-size"]*k,T=w.fill;if(l){var m=typeof l=="string"?l:"Enter text...";e.attr("data-placeholder-text",m),e.toggleClass("placeholder",u===0)}e.css({left:x,top:C-S,height:S,"line-height":S+"px","font-size":S+"px","-webkit-transform":"rotate("+E+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+E+"deg)","-moz-transform-origin":"0% 100%","background-color":T}).attr({"text-anchor":this.getTextAnchor()}).show(),r.css({left:x,top:C-S})},focus:function(){return this.options.debug&&console.log("focus()"),this.showCaret(),this},blur:function(){return this.options.debug&&console.log("blur()"),this.hideCaret(),this},showCaret:function(){return this.options.debug&&console.log("showCaret()"),this.$caret.show(),this},hideCaret:function(){return this.options.debug&&console.log("hideCaret()"),this.$caret.hide(),this},onRemove:function(){var t=this.options,e=t.text,r=t.cellView;r===void 0&&(r=null),this.deselect(),this.unbindTextElement(),document.removeEventListener("pointerdown",this.onDocumentPointerdown,{capture:!0}),f(document.body).off("mousemove",this.onMousemove),f(document.body).off("mouseup",this.onMouseup),f(document.body).off("keydown",this.onKeydown),F(e).attr("cursor",this._textCursor),this.trigger("close",e,r)},onDocumentPointerdown:function(t){var e=this.options,r=e.text,i=e.onOutsidePointerdown,n=t.target;r!==n&&(r.contains(n)||typeof i=="function"&&i.call(this,t,this))},onKeydown:function(t){this.options.debug&&console.log("onKeydown(): ",t.keyCode);var e=this.options.onKeydown;typeof e=="function"&&(e.call(this,t,this),t.isPropagationStopped())||this.isModifierKey(t)||(this.hasSelection()&&(this.deselect(),this.restoreTextAreaSelectionDirection()),setTimeout(this.onAfterKeydown,this.AFTER_KEYDOWN_DELAY),this._copied=!1,this._selectionStartBeforeInput=this.textarea.selectionStart,this._selectionEndBeforeInput=this.textarea.selectionEnd)},onAfterKeydown:function(){this.textarea===document.activeElement&&(this.storeSelectionDirection(),this.setCurrentAnnotation(null),this.updateSelectionFromTextarea())},onKeyup:function(t){if(this.textContentHasChanged()&&this.onInput(t),this.textSelectionHasChanged()&&!this.isArrowKey(t)){var e=this.textarea,r=e.selectionEnd,i=e.selectionStart;r!==i&&this.updateSelectionFromTextarea()}},onCopy:function(t){this._copied||this.copyToClipboard()},onCut:function(t){this._copied||this.copyToClipboard()},onInput:function(t){if(!!this.textContentHasChanged()){var e=this.textarea.value.length-this._textareaValueBeforeInput.length,r={start:this._selectionStartBeforeInput,end:this._selectionEndBeforeInput},i={start:this.textarea.selectionStart,end:this.textarea.selectionEnd};this.options.debug&&console.log("onInput()",t,"selectionBeforeInput",r,"selectionAfterInput",i,"diffLength",e);var n=this.inferTextOperationType(r,i,e),a=!1,o=this.getAnnotations();if(this.options.annotateUrls&&n==="insert"){var s=this.textarea.value.substr(r.start,e);this.options.debug&&console.log("onInput()","inserted text",s),/\s/.test(s)&&(a=this.annotateURLBeforeCaret(r.start),a&&(o=this.shiftAnnotations(o,i.end,e)))}if(o&&(a||(o=this.annotate(o,r,i,e)),this.options.debug&&console.log("onInput()","modified annotations",o),this._currentAnnotationAttributes&&n==="insert")){var l={start:r.start,end:i.end,attrs:this._currentAnnotationAttributes};o.push(l),this.setCurrentAnnotation(null),this.options.debug&&console.log("onInput()","insert annotation",l,"final annotations",o)}this._annotations=o,this.trigger("text:change",this.textarea.value,this._textareaValueBeforeInput,o,r,i),this._selectionBeforeInput=i,this._textareaValueBeforeInput=this.textarea.value,this._textContent=this.textarea.value}},onPaste:function(t){this.options.debug&&console.log("onPaste()"),this._textareaValueBeforeInput=this.textarea.value,setTimeout(this.onAfterPaste,0)},onAfterPaste:function(){this.setCaret(this.textarea.selectionStart)},onMousedown:function(t){if(t.originalEvent.detail!==3){this.options.debug&&console.log("onMousedown()");var e=this.getCharNumFromEvent(t);this.startSelecting(),this.select(e),t.preventDefault(),t.stopPropagation()}},onMousemove:function(t){if(this.selectionInProgress()){this.options.debug&&console.log("onMousemove()");var e=this.getCharNumFromEvent(t);this.storeSelectionDirection(),this.select(null,e),t.preventDefault(),t.stopPropagation()}},onMouseup:function(t){this.selectionInProgress()&&(this.options.debug&&console.log("onMouseup()"),this.stopSelecting(),this.trigger("select:changed",this.selection.start,this.selection.end))},onDoubleClick:function(t){this.options.debug&&console.log("onDoubleClick()");var e=this.getCharNumFromEvent(t),r=this.getWordBoundary(e);this.select(r[0],r[1]),t.preventDefault(),t.stopPropagation()},onTripleClick:function(t){t.originalEvent.detail===3&&(this.options.debug&&console.log("onTripleClick()"),this.hideCaret(),this.selectAll(),t.preventDefault(),t.stopPropagation())}},tt({getTextElement:function(t){var e=t.tagName.toUpperCase();if(e==="TEXT"||e==="TSPAN"||e==="TEXTPATH")return e==="TEXT"?t:this.getTextElement(t.parentNode)},edit:function(t,e){var r=this;e=e||{};var i=e.update!==!1;this.options=tt({},e,{update:i});var n=this.getTextElement(t);if(!n){this.options.debug&&console.log("ui.TextEditor: cannot find a text element.");return}this.close(),this.ed=new Zi(tt({text:n},e)),this.ed.on("all",this.trigger,this);var a=e.cellView;a===void 0&&(a=null),this.trigger("open",n,a);var o;if(a){if(o=a.paper.el,this.cellViewUnderEdit=a,this.cellViewUnderEditInteractiveOption=this.cellViewUnderEdit.options.interactive,this.cellViewUnderEdit.options.interactive=!1,e.annotationsProperty&&!this.ed.getAnnotations()){var s=this.cellViewUnderEdit.model.prop(e.annotationsProperty);s&&this.ed.setAnnotations(ws(s))}}else{var l=F(n).svg();o=l.parentNode}return i&&this.ed.on("text:change",function(u,g,h){a?r.updateCellView(a,u,h):r.updateSVGTextNode(n,u,h)}),this.ed.render(o),this},updateCellView:function(t,e,r){var i=this.options,n=i.textProperty,a=i.annotationsProperty,o=this.ed,s=o.cid,l=t.model;n&&l.prop(n,e,{textEditor:s,async:!1}),a&&l.prop(a,ws(r),{rewrite:!0,textEditor:s,async:!1})},updateSVGTextNode:function(t,e,r){F(t).text(e,{annotations:r})},close:function(){if(!!this.ed){if(this.ed.options.annotateUrls){var t=this.ed.getSelectionStart(),e=this.findAnnotationsUnderCursor(),r=e.find(function(n){return n.url?n:!1});if(!r){var i=this.ed.annotateURLBeforeCaret(t);i&&this.applyAnnotations(this.getAnnotations())}}this.ed.remove(),this.cellViewUnderEdit&&(this.cellViewUnderEdit.options.interactive=this.cellViewUnderEditInteractiveOption),this.ed=this.cellViewUnderEdit=this.cellViewUnderEditInteractiveOption=void 0}},applyAnnotations:function(t){var e=this.options,r=this.ed;if(r&&e.update){e.cellView&&e.annotationsProperty?(e.cellView.model.prop(e.annotationsProperty,ws(t),{rewrite:!0,textEditor:r.cid}),r.setAnnotations(t)):F(r.options.text).text(r.getTextContent(),{annotations:t});var i=this.getSelectionRange(),n=this.getSelectionLength();n>0?r.select(i.start,i.end):r.setCaret()}},proxy:function(t,e){var r=this,i=r.ed;if(!!i)return i[t].apply(i,e)},isEmptyLine:function(t,e){var r=t[e-1],i=t[e];return e===0&&i===`
`||i===`
`&&r===`
`||e===t.length&&r===`
`},isLineEnding:function(t,e){return t[e]===`
`&&e>0&&t[e-1]!==`
`},isLineStart:function(t,e){return t[e]===`
`?!1:e===0||t[e-1]===`
`},getCombinedAnnotationAttrsAtIndex:Wi,getCombinedAnnotationAttrsBetweenIndexes:bs,normalizeAnnotations:FS},d.Events));Zi.findAnnotationsUnderCursor=function(){var t=this,e=t.ed;return e?this.proxy("findAnnotationsUnderCursor",[e.getAnnotations(),e.getSelectionStart()]):null},Zi.findAnnotationsInSelection=function(){var t=this,e=t.ed;if(!e)return null;var r=e.getSelectionRange(),i=r.start,n=r.end;return this.proxy("findAnnotationsInSelection",[e.getAnnotations(),i,n])},Zi.getSelectionAttrs=function(t){var e=this,r=e.ed;return r?this.proxy("getSelectionAttrs",[r.getSelectionRange(),t]):null},["setCurrentAnnotation","getAnnotations","setCaret","deselect","selectAll","select","getNumberOfChars","getCharNumFromEvent","getWordBoundary","getSelectionLength","getSelectionRange"].forEach(function(t){Zi[t]=function(){return this.proxy(t,arguments)}});function ws(t){try{return JSON.parse(JSON.stringify(t))}catch{return}}var er=Xt.extend({className:"widget",references:[],constructor:function(t,e){this.availableReferences=e||{},Xt.prototype.constructor.call(this,t)},updateAttrs:function(t){ui(this.$el,t)},bindEvents:function(){},validateReferences:function(){var t=this.references||[],e=[];return t.forEach(function(r){this.availableReferences[r]===void 0&&e.push(r)},this),e},getReference:function(t){return this.availableReferences[t]},getReferences:function(){return this.availableReferences},enable:function(){},disable:function(){},isDisabled:function(){return!1}},{create:function(t,e,r){r===void 0&&(r={});var i=un($t(t)?t:t.type);if(!yt(r[i]))throw new Error('Widget: unable to find widget: "'+i+'"');var n=new r[i](t,e),a=n.validateReferences(e);if(a.length>0)throw new Error('Widget: "'+i+'" missing dependency: '+a.join(", "));return n.render(),n.updateAttrs(t.attrs),n.bindEvents(),n.$el.attr("data-type",i),t.name&&n.$el.attr("data-name",t.name),n}}),VS=er.extend({tagName:"label",events:{"change .input":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick"},documentEvents:{mouseup:"pointerup",touchend:"pointerup"},init:function(){ke(this,"pointerup")},render:function(){var t=this.options,e=f("<span/>").text(t.label||"");return this.$input=f("<input/>",{type:"checkbox",class:"input"}).prop("checked",!!t.value),this.$span=f("<span/>"),this.$el.append([e,this.$input,this.$span]),this},onChange:function(t){this.trigger("change",!!t.target.checked,t)},pointerdown:function(t){t=ot(t),this.$el.addClass("is-in-action"),this.trigger("pointerdown",t),this.delegateDocumentEvents()},pointerclick:function(t){t=ot(t),this.trigger("pointerclick",t)},pointerup:function(t){t=ot(t),this.undelegateDocumentEvents(),this.trigger("pointerup",t),this.$el.removeClass("is-in-action"),t.type==="touchend"&&(this.$input.trigger("click"),t.preventDefault())},isDisabled:function(){return this.$input.prop("disabled")},enable:function(){this.$el.removeClass("disabled"),this.$input.prop("disabled",!1)},disable:function(){this.$el.addClass("disabled"),this.$input.prop("disabled",!0)}}),WS=er.extend({tagName:"label",events:{"change input.toggle":"onChange","click input.toggle":"pointerclick",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},documentEvents:{mouseup:"pointerup",touchend:"pointerup"},init:function(){ke(this,"pointerup")},render:function(){var t=this.options,e=f("<span/>").text(t.label||""),r=f("<span><i/></span>");this.$input=f("<input/>",{type:"checkbox",class:"toggle"}).prop("checked",!!t.value);var i=f("<div/>").addClass(t.type);return this.$el.append([e,i.append(this.$input,r)]),this},onChange:function(t){this.trigger("change",!!t.target.checked,t)},pointerclick:function(t){t=ot(t),this.trigger("pointerclick",t)},pointerdown:function(t){t=ot(t),this.$el.addClass("is-in-action"),this.trigger("pointerdown",t),this.delegateDocumentEvents()},pointerup:function(t){t=ot(t),this.undelegateDocumentEvents(),this.$el.removeClass("is-in-action"),this.trigger("pointerup",t),t.type==="touchend"&&(this.$input.trigger("click"),t.preventDefault())},isDisabled:function(){return this.$input.prop("disabled")},enable:function(){this.$el.removeClass("disabled"),this.$input.prop("disabled",!1)},disable:function(){this.$el.addClass("disabled"),this.$input.prop("disabled",!0)}}),ZS=er.extend({render:function(){return this.options.width&&this.$el.css({width:this.options.width}),this}}),YS=er.extend({tagName:"label",render:function(){return this.$el.text(this.options.text),this}}),Tv=er.extend({events:{"change .input":"onChange","input .input":"onChange"},render:function(){var t=this.options,e;return this.$output=f("<output/>").text(t.value),e=f("<span/>").addClass("units").text(t.unit),this.$input=f("<input/>",{type:"range",name:t.type,min:t.min,max:t.max,step:t.step,class:"input"}).val(t.value),this.$el.append([this.$input,this.$output,e]),this},onChange:function(t){var e=this.getValue();e!==this.currentValue&&(this.currentValue=e,this.$output.text(e),this.trigger("change",e,t))},getValue:function(){return parseInt(this.$input.val(),10)},setValue:function(t,e){e===void 0&&(e={}),this.$input.val(t),e.silent?(t=this.getValue(),this.currentValue=t,this.$output.text(t)):this.$input.trigger("change")},isDisabled:function(){return this.$input.prop("disabled")},enable:function(){this.$input.prop("disabled",!1)},disable:function(){this.$input.prop("disabled",!0)}}),US=er.extend({render:function(){var t=Ce(this.options,"type","group","index");return this.selectBox=new xn(t),this.selectBox.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectBox.on("all",this.trigger,this)},isDisabled:function(){return this.selectBox.isDisabled()},enable:function(){this.selectBox.enable()},disable:function(){this.selectBox.disable()}}),Ir=er.extend({events:{mousedown:"pointerdown",mouseup:"pointerup",touchend:"pointerup",touchstart:"pointerdown",click:"pointerclick"},tagName:"button",render:function(){var t=this.options;return this.$el.text(t.text),this},pointerclick:function(t){t=ot(t),this.trigger("pointerclick",t)},pointerdown:function(t){t=ot(t),this.trigger("pointerdown",t)},pointerup:function(t){t=ot(t),this.trigger("pointerup",t),t.type==="touchend"&&(this.$el.trigger("click"),t.preventDefault())},isDisabled:function(){return this.$el.prop("disabled")},enable:function(){this.$el.prop("disabled",!1)},disable:function(){this.$el.prop("disabled",!0)}}),XS=er.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var t=this.options;return this.$label=f("<label/>").text(t.label),this.$text=f("<input/>",{type:"text",class:"input"}).val(t.value),this.$input=f("<div/>").addClass("input-wrapper").append(this.$text),this.$el.append([this.$label,this.$input]),this},pointerclick:function(t){t=ot(t),this.trigger("pointerclick",t)},pointerdown:function(t){t=ot(t),this.trigger("pointerdown",t),t.type==="touchstart"&&this.$text.trigger("focus")},pointerup:function(t){t=ot(t),this.trigger("pointerup",t),t.type==="touchend"&&(this.$text.trigger("click"),t.preventDefault())},pointerfocusin:function(t){t=ot(t),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",t)},pointerfocusout:function(t){t=ot(t),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",t)},isDisabled:function(){return this.$text.prop("disabled")},enable:function(){this.$text.prop("disabled",!1)},disable:function(){this.$text.prop("disabled",!0)}}),HS=er.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var t=this.options;return this.$label=f("<label/>").text(t.label),this.$number=f("<input/>",{type:"number",class:"number",max:t.max,min:t.min}).val(t.value),this.$input=f("<div/>").addClass("input-wrapper").append(this.$number),this.$el.append([this.$label,this.$input]),this},pointerclick:function(t){t=ot(t),this.trigger("pointerclick",t)},pointerdown:function(t){t=ot(t),this.trigger("pointerdown",t),t.type==="touchstart"&&this.$number.trigger("focus")},pointerup:function(t){t=ot(t),this.trigger("pointerup",t),t.type==="touchend"&&(this.$number.trigger("click"),t.preventDefault())},pointerfocusin:function(t){t=ot(t),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",t)},pointerfocusout:function(t){t=ot(t),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",t)},isDisabled:function(){return this.$number.prop("disabled")},enable:function(){this.$number.prop("disabled",!1)},disable:function(){this.$number.prop("disabled",!0)}}),qS=er.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var t=this.options;return this.$label=f("<label/>").text(t.label),this.$textarea=f("<textarea/>",{class:"textarea"}).text(t.value),this.$input=f("<div/>").addClass("input-wrapper").append(this.$textarea),this.$el.append([this.$label,this.$input]),this},pointerclick:function(t){t.preventDefault(),t=ot(t),this.trigger("pointerclick",t)},pointerdown:function(t){t=ot(t),this.trigger("pointerdown",t),t.type==="touchstart"&&this.$textarea.focus()},pointerup:function(t){t=ot(t),this.trigger("pointerup",t),t.type==="touchend"&&(this.$textarea.trigger("click"),t.preventDefault())},pointerfocusin:function(t){t=ot(t),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",t)},pointerfocusout:function(t){t=ot(t),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",t)},isDisabled:function(){return this.$textarea.prop("disabled")},enable:function(){this.$textarea.prop("disabled",!1)},disable:function(){this.$textarea.prop("disabled",!0)}}),JS=er.extend({render:function(){var t=Ce(this.options,"type","group","index");return this.selectButtonGroup=new vs(t),this.selectButtonGroup.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectButtonGroup.on("all",this.trigger,this)},isDisabled:function(){return this.selectButtonGroup.isDisabled()},enable:function(){this.selectButtonGroup.enable()},disable:function(){this.selectButtonGroup.disable()}}),KS=Ir.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},bindEvents:function(){var t=this;if(!!this.options.autoToggle){var e=this.getReferences(),r=e.paperScroller;this.updateAvailability(r),this.listenTo(r.options.paper,"scale",function(){return t.updateAvailability(r)})}},pointerdown:function(t){var e=this.options;this.getReferences().paperScroller.zoom(e.step,{max:e.max,grid:e.step}),Ir.prototype.pointerdown.call(this,t)},updateAvailability:function(t){t.zoom()<this.options.max?this.enable():this.disable()}}),QS=Ir.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},bindEvents:function(){var t=this;if(!!this.options.autoToggle){var e=this.getReferences(),r=e.paperScroller;this.updateAvailability(r),this.listenTo(r.options.paper,"scale",function(){return t.updateAvailability(r)})}},pointerdown:function(t){var e=this.options;this.getReferences().paperScroller.zoom(-e.step,{min:e.min,grid:e.step}),Ir.prototype.pointerdown.call(this,t)},updateAvailability:function(t){t.zoom()>this.options.min?this.enable():this.disable()}}),$S=Ir.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2,useModelGeometry:!1,padding:20},pointerdown:function(t){var e=this,r=e.options;this.getReferences().paperScroller.zoomToFit({padding:r.padding,scaleGrid:r.step,minScale:r.min,maxScale:r.max,useModelGeometry:r.useModelGeometry}),Ir.prototype.pointerdown.call(this,t)}}),tM=Tv.extend({references:["paperScroller"],options:{min:20,max:500,step:20,value:100,unit:" %"},bindEvents:function(){var t=this,e=this.getReferences(),r=e.paperScroller;this.on("change",function(i){r.zoom(i/100,{absolute:!0,grid:this.options.step/100})},this),this.listenTo(r.options.paper,"scale",function(i){t.setValue(Math.floor(i*100),{silent:!0})})}}),eM=Ir.extend({references:["commandManager"],bindEvents:function(){var t=this;if(!!this.options.autoToggle){var e=this.getReferences(),r=e.commandManager;this.updateAvailability(r),this.listenTo(r,"stack",function(){return t.updateAvailability(r)})}},pointerclick:function(){this.getReferences().commandManager.undo()},updateAvailability:function(t){t.hasUndo()?this.enable():this.disable()}}),rM=Ir.extend({references:["commandManager"],bindEvents:function(){var t=this;if(!!this.options.autoToggle){var e=this.getReferences(),r=e.commandManager;this.updateAvailability(r),this.listenTo(r,"stack",function(){return t.updateAvailability(r)})}},pointerclick:function(){this.getReferences().commandManager.redo()},updateAvailability:function(t){t.hasRedo()?this.enable():this.disable()}}),iM=Ir.extend({onRender:function(){var t=this.target=f(this.options.target)[0];t&&!f.contains(window.top.document,t)&&this.$el.hide()},pointerclick:function(){Sf(this.target)}}),nM=er.extend({events:{"change .input ":"change","input .input ":"input"},render:function(){var t=this.options,e="#FFFFFF";return this.inputEl=document.createElement("input"),this.inputEl.classList.add("input"),this.inputEl.setAttribute("type","color"),t.value?this.setValue(t.value):this.inputEl.value=e,this.el.appendChild(this.inputEl),this},_validateHexCode:function(t){return/^#(?:[0-9a-fA-F]{6})$/.test(t)},change:function(t){t=ot(t),this.trigger("change",t.target.value,t)},input:function(t){t=ot(t),this.trigger("input",t.target.value,t)},disable:function(){this.el.classList.add("disabled"),this.inputEl.disabled=!0},enable:function(){this.el.classList.remove("disabled"),this.inputEl.disabled=!1},setValue:function(t,e){e===void 0&&(e={}),this._validateHexCode(t)&&(this.inputEl.value=t,e.silent||this.trigger("change"))}}),Nv={__proto__:null,checkbox:VS,toggle:WS,separator:ZS,label:YS,range:Tv,selectBox:US,button:Ir,inputText:XS,inputNumber:HS,textarea:qS,selectButtonGroup:JS,zoomIn:KS,zoomOut:QS,zoomToFit:$S,zoomSlider:tM,undo:eM,redo:rM,fullscreen:iM,colorPicker:nM},aM={Left:"left",Right:"right"},oM=Xt.extend({options:{autoToggle:!1,widgetNamespace:null},align:["left","right"],className:"toolbar",defaultGroup:"default",widgets:[],groupViews:[],init:function(){this.tools=lt(this.options.tools),this.groups=this.options.groups||{}},getWidgetByName:function(t){return this.widgets.find(function(e){return e.options.name===t})},getWidgets:function(){return this.widgets},groupsWithItemsPairs:function(){var t={};this.tools.forEach(function(s){var l=s.group||this.defaultGroup;t[l]=t[l]||{items:[],group:{}},t[l].items.push(s),t[l].group=this.groups[l]||{}},this);for(var e=Object.keys(t),r=[],i=0,n=e.length;i<n;i++){var a=e[i];r.push([a,t[a]])}var o=Fe(r,function(s){return s[1].group.index});return Fe(o,function(s){return s[1].group.align||"left"})},render:function(){var t=this.groupsWithItemsPairs(),e=!1;return t.forEach(function(r){var i=r[0],n=r[1],a=this.renderGroup(i,n);!e&&n.group.align&&n.group.align==="right"&&(e=!0,a.addClass("group-first")),a.appendTo(this.el)},this),this},renderGroup:function(t,e){var r=this.options,i=r.references,n=r.autoToggle,a=r.widgetNamespace,o=new sM({name:t,align:e.group.align,items:e.items,references:i,autoToggle:n,widgetNamespace:a});return this.groupViews.push(o),o.on("all",function(){this.trigger.apply(this,arguments)}.bind(this)),o.render(),this.widgets=this.widgets.concat(o.widgets),o.$el},onRemove:function(){me(this.groupViews,"off"),me(this.groupViews,"remove")}},{Align:aM}),sM=Xt.extend({className:"toolbar-group",init:function(){this.widgets=[]},onRender:function(){this.$el.attr("data-group",this.options.name),this.$el.addClass(this.options.align),this.renderItems()},renderItems:function(){lt(this.options.items).forEach(function(t){var e=this.createWidget(t);this.$el.append(e.$el)},this)},createWidget:function(t){var e=this.options,r=e.references,i=e.autoToggle,n=e.widgetNamespace,a=$t(t)?{autoToggle:i,type:t}:tt({autoToggle:i},t),o=er.create(a,r,n||Nv);return o.on("all",function(s){var l=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t.name+":"+s].concat(l))}.bind(this)),this.widgets.push(o),o},onRemove:function(){me(this.widgets,"off"),me(this.widgets,"remove")}}),lM={Left:"left",Top:"top",Bottom:"bottom",Right:"right"},uM={Left:"left",Top:"top",Bottom:"bottom",Right:"right",Auto:"auto",Off:"off"},hM=Xt.extend({className:"tooltip",options:{left:void 0,right:void 0,top:void 0,bottom:void 0,position:void 0,positionSelector:void 0,direction:"auto",minResizedWidth:100,padding:0,rootTarget:null,target:null,container:null,trigger:"hover",viewport:{selector:null,padding:0},dataAttributePrefix:"tooltip",template:'<div class="tooltip-arrow"></div><div class="tooltip-arrow-mask"></div><div class="tooltip-content"></div>',animation:!1},init:function(){this.eventNamespace=("."+this.className+this.cid).replace(/ /g,"_"),this.settings={};var t=this.options,e=t.trigger,r=t.rootTarget,i=t.target,n=t.animation;n===void 0&&(n=!1);var a=t.container,o;a&&(o=f(a)[0]),a||(o=document.body),this.container=o;var s=e.split(" ");ke(this,"render","hide","show","toggle","isVisible","position"),r?(this.$rootTarget=f(r),s.forEach(function(l){switch(l){case"click":this.$rootTarget.on("click"+this.eventNamespace,this.options.target,this.toggle);break;case"hover":this.$rootTarget.on("mouseover"+this.eventNamespace,this.options.target,this.render);break;case"focus":this.$rootTarget.on("focusin"+this.eventNamespace,this.options.target,this.render);break}},this)):(this.$target=f(i),s.forEach(function(l){switch(l){case"click":this.$target.on("click"+this.eventNamespace,this.toggle);break;case"hover":this.$target.on("mouseover"+this.eventNamespace,this.render);break;case"focus":this.$target.on("focusin"+this.eventNamespace,this.render);break}},this)),n&&this.animate(n),this.$el.append(this.options.template)},animate:function(t){t===void 0&&(t={});var e=t.duration;e===void 0&&(e="500ms");var r=t.delay;r===void 0&&(r="400ms");var i=t.timingFunction;i===void 0&&(i="ease"),this.$el.addClass("animated").css({animationDelay:r,animationDuration:e,animationTimingFunction:i})},onRemove:function(){this.options.rootTarget?this.$rootTarget.off(this.eventNamespace):this.$target.off(this.eventNamespace)},hide:function(){var t=this.settings;!t||(t.currentTarget&&this.unbindHideActions(t.currentTarget),this.$el.removeClass(t.className),this.$el.remove(),this.trigger("close"))},show:function(t){this.render(t||{target:this.options.target})},toggle:function(t){this.isVisible()?this.hide():this.show(t)},isVisible:function(){return document.body.contains(this.el)},render:function(t){var e=null;t.x!==void 0&&t.y!==void 0&&(e={x:t.x,y:t.y});var r=null;t.target&&(r=f(t.target).closest(this.options.target)[0]);var i=this.settings=this.getTooltipSettings(r);r?(i.currentTarget=r,this.bindHideActions(r)):i.currentTarget=null;var n;e?n={x:e.x,y:e.y,width:1,height:1}:n=li(r),this.$(".tooltip-content").html(i.content),this.$el.hide(),this.$el.removeClass("left right top bottom"),this.$el.addClass(i.className),f(this.container).append(this.$el);var a=this.$("img");a.length?a.on("load",function(){this.position(n),this.$el.addClass("rendered")}.bind(this)):(this.position(n),this.$el.addClass("rendered"))},getTooltipSettings:function(t){var e=this.loadDefinitionFromElementData(t);return this.evaluateOptions(t,e)},unbindHideActions:function(t){var e=this.eventNamespace+".remove";f(t).off(e),clearInterval(this.interval)},bindHideOnRemoveTarget:function(t){clearInterval(this.interval),this.interval=setInterval(function(){f.contains(document,t)||(clearInterval(this.interval),this.hide())}.bind(this),500)},bindHideActions:function(t){var e=this.settings,r=f(t),i=this.eventNamespace+".remove";this.bindHideOnRemoveTarget(t),this.options.trigger.split(" ").forEach(function(n){var a={hover:["mouseout","mousedown"],focus:["focusout"]},o=a[n]||[];e.hideTrigger&&(o=e.hideTrigger.split(" ")||[]),o.forEach(function(s){r.on(s+i,this.hide)},this)},this)},evaluateOptions:function(t,e){e=e||{};var r=tt({},e,this.options);return Ut(r,function(i,n){var a=yt(i)?i(t):i;r[n]=a==null?e[n]:a}),this.normalizePosition(r),r},loadDefinitionFromElementData:function(t){if(!t)return{};var e=function(n){return n==="left"||n==="bottom"||n==="top"||n==="right"},r=this.getAllAttrs(t,"data-"+this.options.dataAttributePrefix),i={};return Ut(r,function(n,a){a===""&&(a="content"),e(a)||(i[a]=n)}),i},getAllAttrs:function(t,e){for(var r=e||"",i=t.attributes,n={},a=0,o=i.length;a<o;a++){var s=i[a];if(s&&s.name.startsWith(r)){var l=un(s.name.slice(r.length));n[l]=s.value}}return n},normalizePosition:function(t){var e=t.left||t.right||t.top||t.bottom;!t.position&&e&&(t.left&&(t.position="left"),t.right&&(t.position="right"),t.top&&(t.position="top"),t.bottom&&(t.position="bottom")),!t.positionSelector&&e&&(t.positionSelector=e)},position:function(t){var e=this.settings;this.$el.show(),this.$el.css("width","auto");var r=li(this.container),i=this.getTooltipBBox(t,r);this.$el.css({left:i.x,top:i.y,width:i.width||"auto"});var n={};e.position==="left"||e.position==="right"?n.top=t.y+t.height/2-i.y:e.position==="top"||e.position==="bottom"?n.left=t.x+t.width/2-i.x:n.top=t.y+t.height/2-i.y,n.top-=r.y,n.left-=r.x,this.$(".tooltip-arrow, .tooltip-arrow-mask").removeAttr("style").css(n),e.direction&&e.direction!=="off"&&this.$el.addClass(e.direction==="auto"?e.position||"left":e.direction)},getViewportViewBBox:function(){var t=this.settings,e=t.viewport.selector?f(t.currentTarget).closest(t.viewport.selector):"html",r=li(e);if(!t.viewport.selector){var i=f(window);r.width=i.width()+i.scrollLeft(),r.height=i.height()+i.scrollTop()}var n=t.viewport.padding||0;return r.x+=n,r.y+=n,r.width-=2*n,r.height-=2*n,r},basePositions:{left:function(t,e){var r={x:e.positionedBBox.x+e.positionedBBox.width+e.padding,y:e.targetBBox.y+e.targetBBox.height/2-e.tooltipBBox.height/2};if(t){var i=e.viewport.x+e.viewport.width-r.x;if(i>e.minWidth&&i<e.tooltipBBox.width+e.padding&&(r.width=i),i<e.minWidth)return this.settings.position="right",this.basePositions.right(!1,e)}return r},right:function(t,e){var r={x:e.positionedBBox.x-e.tooltipBBox.width-e.padding,y:e.targetBBox.y+e.targetBBox.height/2-e.tooltipBBox.height/2};if(t){var i=e.positionedBBox.x-e.padding-e.viewport.x;if(i>e.minWidth&&i<e.tooltipBBox.width+e.padding&&(r.width=i,r.x=e.viewport.x),i<e.minWidth)return this.settings.position="left",this.basePositions.left(!1,e)}return r},top:function(t,e){var r={x:e.targetBBox.x+e.targetBBox.width/2-e.tooltipBBox.width/2,y:e.positionedBBox.y+e.positionedBBox.height+e.padding};if(t){var i=e.viewport.y+e.viewport.height-(e.positionedBBox.y+e.positionedBBox.height+e.padding);if(i<e.tooltipBBox.height)return this.settings.position="bottom",this.basePositions.bottom(!1,e)}return r},bottom:function(t,e){var r={x:e.targetBBox.x+e.targetBBox.width/2-e.tooltipBBox.width/2,y:e.positionedBBox.y-e.tooltipBBox.height-e.padding};if(t){var i=e.positionedBBox.y-e.padding-e.viewport.y;if(i<e.tooltipBBox.height)return this.settings.position="top",this.basePositions.top(!1,e)}return r}},getTooltipBBox:function(t,e){var r=this.settings,i=f(r.positionSelector),n=i[0]?li(i[0]):t,a=this.measureTooltipElement(),o=this.getViewportViewBBox(),s=r.position||"left",l=r.padding,u=Math.min(r.minResizedWidth,a.width+l),g={padding:l,targetBBox:t,positionedBBox:n,tooltipBBox:a,viewport:o,minWidth:u},h=this.basePositions[s].call(this,u>0,g);return h.x-=e.x,h.y-=e.y,h.y<o.y?h.y=o.y:h.y+a.height>o.y+o.height&&(h.y=o.y+o.height-a.height),h.x<o.x?h.x=o.x:h.x+a.width>o.x+o.width&&(h.x=o.x+o.width-a.width),h},measureTooltipElement:function(){var t=this.$el.clone().appendTo(f("body")).css({left:-1e3,top:-500}),e={width:t.outerWidth(),height:t.outerHeight()};return t.remove(),e}},{TooltipPosition:lM,TooltipArrowPosition:uM}),cM=Xt.extend({MINIMAL_PREVIEW_SIZE:10,className:"tree-layout",documentEvents:{mousemove:"onPointermove",touchmove:"onPointermove",mouseup:"onPointerup",touchend:"onPointerup"},options:{previewAttrs:{parent:{rx:2,ry:2}},useModelGeometry:!1,clone:function(t){return t.clone()},canInteract:function(){return!0},validateConnection:null,validatePosition:null,paperConstructor:Oe,paperOptions:null,reconnectElements:null,translateElements:null},init:function(){this.toggleDefaultInteraction(!1),this.startListening(),this.render(),this.onSetTheme(null,this.theme)},startListening:function(){this.enable()},_isEnabled:!1,_onPointerdown:null,enable:function(){var t=this.options,e=t.paper;this.disable();var r=this.canInteract(this.onPointerdown);this._isEnabled=!0,this.listenTo(e,"element:pointerdown",r),this._onPointerdown=r},disable:function(){var t=this,e=t._onPointerdown,r=t.options,i=r.paper;this._isEnabled=!1,e&&(this.stopListening(i,"element:pointerdown",e),this._onPointerdown=null)},isDisabled:function(){return!this._isEnabled},toggleDefaultInteraction:function(t){this.options.paper.setInteractivity(t)},render:function(){var t=this.options.paper;this.$activeBox=f("<div>").addClass("tree-layout-box active hidden").appendTo(this.el);var e=tt({},this.options.paperOptions,{interactive:!1,width:"100%",height:"100%"});return this.draggingPaper=new this.options.paperConstructor(e),this.draggingPaper.undelegateEvents(),this.$translateBox=f("<div>").addClass("tree-layout-box translate hidden").append(this.draggingPaper.render().el).appendTo(this.el),this.$mask=f("<div>").addClass("tree-layout-mask"),this.svgViewport=F(t.cells),this.svgPreviewChild=F(this.renderChildPreview()).attr(this.options.previewAttrs.child||{}).addClass("tree-layout-preview child"),this.svgPreviewConnection=F(this.renderConnectionPreview()).attr(this.options.previewAttrs.link||{}).addClass("tree-layout-preview link"),this.svgPreviewParent=F(this.renderParentPreview()).attr(this.options.previewAttrs.parent||{}).addClass("tree-layout-preview parent"),this.svgPreview=F("g").addClass("tree-layout-preview-group").append([this.svgPreviewConnection,this.svgPreviewParent,this.svgPreviewChild]),this.$el.appendTo(t.el),this},renderChildPreview:function(){return F("circle")},renderParentPreview:function(){return F("rect")},renderConnectionPreview:function(){return F("path")},onSetTheme:function(t,e){var r=[this.svgPreview,this.$mask];r.forEach(function(i){i&&(t&&i.removeClass(this.themeClassNamePrefix+t),i.addClass(this.themeClassNamePrefix+e))},this)},onRemove:function(){this.svgPreview.remove(),this.$mask.remove()},toggleDropping:function(t){this.$mask.toggleClass("dropping-not-allowed",!t),this.$translateBox.toggleClass("no-drop",!t)},canDrop:function(){return this.isActive()&&!this.$translateBox.hasClass("no-drop")},isActive:function(){return!this.$translateBox.hasClass("hidden")},updateBox:function(t,e){t.css({width:e.width,height:e.height,left:e.x,top:e.y})},positionTranslateBox:function(t){var e=F.transformPoint(t,this.ctm);this.$translateBox.css({left:e.x,top:e.y})},prepareDraggingPaper:function(t){var e=this.options.clone(t).position(0,0);this.draggingPaper.scale(this.ctm.a,this.ctm.d),this.draggingPaper.model.resetCells([e])},dragstart:function(t,e,r){var i=this,n=i.$translateBox,a=i.$activeBox,o=i.options,s=o.paper,l=o.useModelGeometry;this.toggleDropping(!1),this.ctm=s.matrix();var u=t[0],g=u.findView(s);if(g){var h=g.getBBox({useModelGeometry:l});this.updateBox(n,ne({x:e,y:r},h)),this.updateBox(a,h),a.removeClass("external")}else{var y=F.transformRect(u.getBBox(),this.ctm);this.updateBox(n,ne({x:e,y:r},y)),a.addClass("external")}this.positionTranslateBox({x:e,y:r}),this.show(),this.prepareDraggingPaper(u)},drag:function(t,e,r){var i=this,n=this.model,a={x:e,y:r},o,s;if(this.candidate&&(this.candidate=null,this.hidePreview()),this.positionTranslateBox(a),o=n.getMinimalRootAreaByPoint(a),o&&(s=o.findMinimalAreaByPoint(a,{expandBy:Math.min(n.get("siblingGap"),n.get("gap"))/2})),s){var l=this.findDirection(s,a),u=s.getLayoutSiblings(l),g=u.getSiblingRankByPoint(a),h=lt(t).every(function(C){return this.isConnectionValid(C,u,g)},this);h?(this.candidate={id:s.root.id,direction:l,siblingRank:g},this.updatePreview(u,g),this.showPreview(),this.toggleDropping(!0)):this.toggleDropping(!1)}else{var y=!0,x=this.options.validatePosition;typeof x=="function"&&(y=lt(t).every(function(C){return x.call(i,C,e,r,i)})),this.toggleDropping(y)}},dragend:function(t,e,r){var i=this.candidate,n=this.options;if(this.canDrop())if(i){var a=n.reconnectElements;typeof a=="function"?a.apply(this,[t,n.paper.getModelById(i.id),i.siblingRank,i.direction,this]):this.reconnectElements(t,i),this.candidate=null}else{var o=n.translateElements;typeof o=="function"?o.call(this,t,e,r,this):this.translateElements(t,e,r)}this.hide()},show:function(){var t=this,e=t.$mask,r=t.$activeBox,i=t.$translateBox,n=t.options,a=n.paper.$el;a.is(e.parent())||e.appendTo(a),r.toggleClass("hidden",r.hasClass("external")),i.removeClass("hidden")},hide:function(){this.$mask.remove().removeClass("dropping-not-allowed"),this.$activeBox.addClass("hidden"),this.$translateBox.addClass("hidden"),this.hidePreview()},cancelDrag:function(){this.candidate=null,this.undelegateDocumentEvents(),this.hide()},reconnectElement:function(t,e){var r=this,i=r.model,n=r.options,a=i.graph;a.getCell(t)||(a.addCell(t),i.layoutTree(t));var o=e.siblingRank+.5,s={direction:e.direction,siblingRank:o,ui:!0,treeLayoutView:this.cid},l=i.reconnectElement(t,e.id,s);if(!l){var u=n.paper,g=u.getDefaultLink(t.findView(u));g.set({source:{id:e.id},target:{id:t.id}}),g.addTo(u.model,s),i.changeSiblingRank(t,o,s),i.changeDirection(t,e.direction,s);var h=i.getAttribute(t,"direction");i.updateDirections(t,[h,e.direction],s)}},reconnectElements:function(t,e){t.forEach(function(r){this.reconnectElement(r,e)},this),this.layout()},translateElement:function(t,e,r){var i=this,n=i.model,a=n.graph,o=a.getConnectedLinks(t,{inbound:!0});me(o,"remove");var s=t.get("size");t.set("position",{x:e-s.width/2,y:r-s.height/2},{ui:!0,treeLayoutView:this.cid}),a.getCell(t)||a.addCell(t,{ui:!0,treeLayoutView:this.cid})},translateElements:function(t,e,r){t.forEach(function(i){this.translateElement(i,e,r)},this),this.layout()},layout:function(){this.model.layout({ui:!0,treeLayoutView:this.cid})},updatePreview:function(t,e){var r=t.parentArea.root,i=Math.max(this.model.get("siblingGap")/2,this.MINIMAL_PREVIEW_SIZE),n={width:i,height:i},a=t.getNeighborPointFromRank(e),o=t.getConnectionPoints(a,{ignoreSiblings:!0}),s=t.getParentConnectionPoint(),l=t.getChildConnectionPoint(a,n);this.updateParentPreview(r.position(),r.size(),r),this.updateChildPreview(a,n),this.updateConnectionPreview(s,l,o)},showPreview:function(){this.svgViewport.append(this.svgPreview)},hidePreview:function(){this.svgPreview.remove()},updateParentPreview:function(t,e){this.svgPreviewParent.attr({x:t.x,y:t.y,width:e.width,height:e.height})},updateChildPreview:function(t,e){this.svgPreviewChild.attr({cx:t.x,cy:t.y,r:e.width/2})},updateConnectionPreview:function(t,e,r){this.svgPreviewConnection.attr({d:ig(t,e,r,{})})},findDirection:function(t,e){var r,i=t.root.get("layout")||t.getType();switch(i){case"BL-BR":case"TL-TR":case"L-R":return r=i.split("-"),e.x>t.rootCX?r[1]:r[0];case"BL-TL":case"BR-TR":case"B-T":return r=i.split("-"),e.y>t.rootCY?r[0]:r[1];case"L":case"R":case"T":case"B":case"TR":case"TL":case"BR":case"BL":return i;default:return t.direction}},isConnectionValid:function(t,e,r){var i=e.parentArea.root;if(t.id==i.id||this.model.graph.isSuccessor(t,e.parentArea.root))return!1;var n=this.model.getLayoutArea(t);if(n&&n.parentArea&&n.parentArea==e.parentArea&&n.direction==e.direction){var a=n.siblingRank-r;if(a===0||a===1)return!1}var o=this.options.validateConnection;return typeof o=="function"?o.call(this,t,i,this,{siblingRank:r,direction:e.direction,level:e.parentArea.level+1,siblings:e.layoutAreas.map(function(s){return s.root})}):!0},canInteract:function(t){return function(e){this.options.canInteract(e)&&t.apply(this,arguments)}.bind(this)},startDragging:function(t){var e=Array.isArray(t)?t:[t];je(e)||this.delegateDocumentEvents(null,{moveCounter:0,draggedElements:e})},onPointerdown:function(t){this.startDragging(t.model)},onPointermove:function(t){var e=ot(t),r=e.data,i=this.options.paper,n=i.clientToLocalPoint({x:e.clientX,y:e.clientY});r.moveCounter===i.options.clickThreshold?this.dragstart(r.draggedElements,n.x,n.y):r.moveCounter>i.options.clickThreshold&&this.drag(r.draggedElements,n.x,n.y),r.moveCounter++},onPointerup:function(t){var e=ot(t),r=e.data,i=this.options.paper;if(r.moveCounter>=i.options.clickThreshold){var n=i.clientToLocalPoint({x:e.clientX,y:e.clientY});this.dragend(r.draggedElements,n.x,n.y)}this.undelegateDocumentEvents()}}),dM=function(t){function e(i){t.call(this,i),this.update()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={elements:{configurable:!0},direction:{configurable:!0},stackIndexAttributeName:{configurable:!0},stackElementIndexAttributeName:{configurable:!0}};return e.prototype.defaults=function(){return{stackGap:10,stackElementGap:10,direction:Le.Directions.TopBottom,stackIndexAttributeName:"stackIndex",stackElementIndexAttributeName:"stackElementIndex"}},e.prototype.update=function(){var n=Le.layout(this.elements,this.attributes);this.bbox=n.bbox,this.stacks=n.stacks,this.trigger("update")},e.prototype.getStackFromPoint=function(n){for(var a=0;a<this.stacks.length;a++){var o=this.stacks[a],s=o.bbox;if((this.direction===Le.Directions.BottomTop||this.direction===Le.Directions.TopBottom)&&n.x>=s.x&&n.x<s.x+s.width||(this.direction===Le.Directions.RightLeft||this.direction===Le.Directions.LeftRight)&&n.y>=s.y&&n.y<s.y+s.height)return o}return null},e.prototype.getInsertElementIndexFromPoint=function(n,a){var o=n.elements,s=o.length;if(s===0)return 0;switch(this.direction){case Le.Directions.TopBottom:{for(var l=0;l<s;l++){var u=o[l],g=u.position().y+u.size().height/2;if(a.y<g)return l}return s}case Le.Directions.BottomTop:{for(var h=0;h<s;h++){var y=o[h],x=y.position().y+y.size().height/2;if(a.y>x)return h}return s}case Le.Directions.LeftRight:for(var C=0;C<s;C++){var p=o[C],E=p.position().x+p.size().width/2;if(a.x<E)return C}return s;case Le.Directions.RightLeft:for(var k=0;k<s;k++){var w=o[k],S=w.position().x+w.size().width/2;if(a.x>S)return k}return s}},e.prototype.getStackFromElement=function(n){return this.stacks[n.get(this.stackIndexAttributeName)]},e.prototype.hasElement=function(n){return n.has(this.stackIndexAttributeName)},e.prototype.insertElement=function(n,a,o,s){var l,u=this.get("graph");u.startBatch("stack-layout-insert"),u.getCell(n)||u.addCell(n,s);var g=this,h=g.stackIndexAttributeName,y=g.stackElementIndexAttributeName,x=this.stacks[a],C;if(x){var p=x.elements,E=p[o],k=p.length;if(E){C=E.get(y);for(var w=o;w<k;w++){var S=p[w],T=S.get(y)||0;S.set(y,T+1,s)}}else if(k>0){var m=p[p.length-1],A=m.get(y)||0;C=A+1}else C=0}else C=0;n.set((l={},l[h]=a,l[y]=C,l),s),this.update(),u.stopBatch("stack-layout-insert")},r.elements.get=function(){var i=this,n=this.get("graph");return n.getElements().filter(function(a){return a.has(i.stackIndexAttributeName)})},r.direction.get=function(){return this.get("direction")},r.stackIndexAttributeName.get=function(){return this.get("stackIndexAttributeName")},r.stackElementIndexAttributeName.get=function(){return this.get("stackElementIndexAttributeName")},Object.defineProperties(e.prototype,r),e}(d.Model),fM=function(t,e){var r=e.model,i=r.direction,n=t.targetStack,a=t.invalid,o=F("path",{stroke:a?"#ccc":"#333","stroke-width":2});switch(i){case Le.Directions.RightLeft:case Le.Directions.LeftRight:{var s=n.bbox,l=s.height;o.attr("d","M 0 "+-l/2+" v "+l);break}case Le.Directions.TopBottom:case Le.Directions.BottomTop:default:{var u=n.bbox,g=u.width;o.attr("d","M "+-g/2+" 0 h "+g);break}}return o.node},gM=function(t,e){return!0},vM=function(t,e,r){return t.insertElementIndex},pM=function(t,e){return e.model.hasElement(t.model)},mM=function(t){function e(r){t.call(this,r),this.currentEventData={},this.paper=r.paper,this.model||(this.model=new dM(Object.assign({},r.layoutOptions,{graph:this.paper.model}))),this.previewFunction=r.preview||fM,this.validateMoving=r.validateMoving||gM,this.canInteract=r.canInteract||pM,this.modifyInsertElementIndex=r.modifyInsertElementIndex||vM,this.startListening()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.preinitialize=function(){this.svgElement=!0,this.tagName="g"},e.prototype.startListening=function(){var i=this,n=i.paper;this.listenTo(n,"element:pointerdown",this.onPaperPointerdown),this.listenTo(n,"element:pointermove",this.onPaperPointermove),this.listenTo(n,"element:pointerup",this.onPaperPointerup)},e.prototype.getPreviewPosition=function(i,n){var a=this.model.get("stackElementGap")/2,o=this.model,s=o.direction,l=i.bbox,u=i.elements,g=u.length,h=u[n],y={x:0,y:0};switch(s){case Le.Directions.TopBottom:{if(y.x=l.x+l.width/2,h)y.y=h.position().y-a;else{var x=u[g-1];x?y.y=x.position().y+x.size().height+a:y.y=l.y-a}break}case Le.Directions.BottomTop:{if(y.x=l.x+l.width/2,h)y.y=h.position().y+h.size().height+a;else{var C=u[g-1];C?y.y=C.position().y-a:y.y=l.y+l.height+a}break}case Le.Directions.LeftRight:if(y.y=l.y+l.height/2,h)y.x=h.position().x-a;else{var p=u[g-1];p?y.x=p.position().x+p.size().width+a:y.x=l.x-a}break;case Le.Directions.RightLeft:if(y.y=l.y+l.height/2,h)y.x=h.position().x+h.size().width+a;else{var E=u[g-1];E?y.x=E.position().x-a:y.x=l.x+l.width+a}break}return y},e.prototype.createGhost=function(i){var n=i.vel,a=n.clone();return a.attr("opacity",.4),a.node.style.transform="",a.addClass("stack-layout-ghost"),a},e.prototype.dragstart=function(i,n,a){var o=this.model.getStackFromElement(i);this.currentEventData||(this.currentEventData={}),Object.assign(this.currentEventData,{sourceStack:o})},e.prototype.drag=function(i,n,a){if(!!this.currentEventData){var o={x:n,y:a},s=this.currentEventData,l=s.sourceStack,u=this.currentEventData,g=u.preview,h=this.model.getStackFromPoint(o);if(h){var y;l&&(y=l.elements.findIndex(function(E){return E.id===i.id}));var x=this.model.getInsertElementIndexFromPoint(h,o);if(x=this.modifyInsertElementIndex({sourceStack:l,sourceElement:i,targetStack:h,insertElementIndex:x},new Z(o),this),h!==l||x!==y&&x!==y+1){if(h!==this.currentEventData.targetStack||x!==this.currentEventData.insertElementIndex){var C=!this.validateMoving({sourceStack:l,sourceElement:i,targetStack:h,insertElementIndex:x},this);g&&g.remove(),g=F(this.previewFunction({sourceStack:l,sourceElement:i,targetStack:h,insertElementIndex:x,invalid:C},this)),g.addClass("stack-layout-preview"),C&&g.addClass("stack-layout-preview-invalid"),g.appendTo(this.paper.getLayerNode(Oe.Layers.FRONT));var p=this.getPreviewPosition(h,x);F(g).attr("transform","translate("+p.x+","+p.y+")"),Object.assign(this.currentEventData,{invalid:C,preview:g,targetStack:h,insertElementIndex:x})}return}}g&&g.remove(),delete this.currentEventData.invalid,delete this.currentEventData.preview,delete this.currentEventData.targetStack,delete this.currentEventData.insertElementIndex}},e.prototype.dragend=function(i,n,a){if(!!this.currentEventData){var o=this.currentEventData,s=o.preview,l=o.targetStack,u=o.insertElementIndex,g=o.invalid;s&&s.remove(),!(!l||g)&&(this.model.insertElement(i,l.index,u,{stackLayoutView:this.cid}),delete this.currentEventData)}},e.prototype.cancelDrag=function(){if(!!this.currentEventData){var i=this.currentEventData,n=i.preview;n&&n.remove(),delete this.currentEventData}},e.prototype.canDrop=function(){if(!this.currentEventData)return!1;var i=this.currentEventData,n=i.targetStack,a=i.invalid;return n&&!a},e.prototype.onPaperPointerdown=function(i,n,a,o){if(!this.canInteract(i,this)){delete this.currentEventData;return}if(i.can("elementMove"))throw new Error('ui.StackLayoutView: requires the "elementMove" interactivity set to false. e.g. paper.setInteractivity(false)');var s=i.model;this.dragstart(s,a,o);var l=s.position();Object.assign(this.currentEventData,{ghost:this.createGhost(i),dx:a-l.x,dy:o-l.y})},e.prototype.onPaperPointermove=function(i,n,a,o){var s=this,l=s.currentEventData;if(!!l){var u=i.model;this.drag(u,a,o);var g=l.ghost,h=l.dx,y=l.dy,x=l.invalid;g&&(g.attr("transform","translate("+(a-h)+","+(o-y)+")"),g.parent()||g.appendTo(this.paper.getLayerNode(Oe.Layers.FRONT)),g.toggleClass("stack-layout-ghost-invalid",Boolean(x)))}},e.prototype.onPaperPointerup=function(i,n,a,o){var s=this,l=s.currentEventData;if(!!l){var u=l.ghost;u&&u.remove();var g=i.model;this.dragend(g,a,o)}},e}(Xt),yM={__proto__:null,Clipboard:MS,ColorPalette:pv,ContextToolbar:mv,Dialog:Je,FlashMessage:yv,FreeTransform:bv,Halo:PS,Inspector:An,Keyboard:Ke,Lightbox:NS,Navigator:LS,PaperScroller:ys,PathDrawer:ES,PathEditor:DS,Popup:zS,SelectBox:xn,SelectButtonGroup:vs,Selection:Cv,SelectionView:OS,Snaplines:_S,Stencil:GS,TextEditor:Zi,Toolbar:oM,Tooltip:hM,TreeLayoutView:cM,StackLayoutView:mM,Widget:er,widgets:Nv};function xs(t,e,r,i){e===void 0&&(e={}),r===void 0&&(r=null),i===void 0&&(i=[]);var n=e.children,a=e.makeElement,o=e.makeLink,s=yt(n)?n(t):t[n||"children"];return r||(r=a(t,null),i.push(r)),lt(s).forEach(function(l){var u=a(l,r),g=o(r,u);i.push(u,g),xs(l,e,u,i)}),i}var br=function(t){t=t||{},this.comparator=t.comparator||function(e,r){return e-r},this.index={},this.data=t.data||[],this.heapify()};br.prototype.isEmpty=function(){return this.data.length===0},br.prototype.insert=function(t,e,r){var i={priority:t,value:e};this.data.push(i);var n=this.data.length-1;r&&(i.id=r,this.index[r]=n),this.bubbleUp(n)},br.prototype.peek=function(){return this.data[0]&&this.data[0].value},br.prototype.peekPriority=function(){return this.data[0]&&this.data[0].priority},br.prototype.updatePriority=function(t,e){var r=this.index[t];if(r===null||typeof r>"u")throw new Error("Node with id "+t+" was not found in the heap.");var i=this.data,n=i[r].priority,a=this.comparator(e,n);a<0?(i[r].priority=e,this.bubbleUp(r)):a>0&&(i[r].priority=e,this.bubbleDown(r))},br.prototype.remove=function(){var t=this.data,e=t[0],r=t.pop();return this.index[t.length]=null,t.length>0&&(t[0]=r,r.id&&(this.index[r.id]=0),this.bubbleDown(0)),e&&e.value},br.prototype.heapify=function(){for(var t=0;t<this.data.length;t++)this.bubbleUp(t)},br.prototype.bubbleUp=function(t){for(var e,r,i=this.data;t>0&&(e=t-1>>>1,this.comparator(i[t].priority,i[e].priority)<0);)r=i[e],i[e]=i[t],i[t].id&&(this.index[i[t].id]=e),i[t]=r,i[t].id&&(this.index[i[t].id]=t),t=e},br.prototype.bubbleDown=function(t){for(var e=this.data,r=e.length-1;;){var i=(t<<1)+1,n=i+1,a=t;if(i<=r&&this.comparator(e[i].priority,e[a].priority)<0&&(a=i),n<=r&&this.comparator(e[n].priority,e[a].priority)<0&&(a=n),a!==t){var o=e[a];e[a]=e[t],e[t].id&&(this.index[e[t].id]=a),e[t]=o,e[t].id&&(this.index[e[t].id]=t),t=a}else break}};var Lv=function(t,e,r){r=r||function(y,x){return 1};var i={};i[e]=0;var n={},a=new br;for(var o in t)o!==e&&(i[o]=1/0),a.insert(i[o],o,o);for(var s,l,u,g,h={};!a.isEmpty();)for(s=a.remove(),h[s]=!0,l=t[s]||[],u=0;u<l.length;u++)o=l[u],h[o]||(g=i[s]+r(s,o),g<i[o]&&(i[o]=g,n[o]=s,a.updatePriority(o,g)));return n};function Ev(t,e,r,i){i===void 0&&(i={});var n={};t.getLinks().forEach(function(l){var u=l.get("source").id;n[u]||(n[u]=[]);var g=l.get("target").id;n[g]||(n[g]=[]),n[u].push(g),i.directed||n[g].push(u)});var a=Lv(n,e.id||e,i.weight),o=[],s=r.id||r;for(a[s]&&o.push(s);s=a[s];)o.unshift(s);return o}Ie.prototype.shortestPath=function(t,e,r){return Ev(this,t,e,r)},Ie.prototype.constructTree=function(t,e){return xs(t,e,null,[])};var bM={__proto__:null,constructTree:xs,shortestPath:Ev},wM={prefix:"joint.storage",insert:function(t,e,r){var i=e.id||Hn(),n=this.loadIndex(t);n.keys.indexOf(i)===-1&&n.keys.push(i),this.setItem(this.docKey(t,i),e),this.setItem(this.indexKey(t),n),this.callback(r,null,tt({},e,{id:i}))},find:function(t,e,r){var i=this.loadIndex(t),n=[];if(je(e))i.keys.forEach(function(o){var s=this.getItem(this.docKey(t,o));s||this.callback(r,new Error("Storage inconsistency. No document found for an ID "+o+" from index.")),n.push(s)},this),this.callback(r,null,n);else if(e.id){var a=this.getItem(this.docKey(t,e.id));this.callback(r,null,a?[a]:[])}else this.callback(r,null,[])},remove:function(t,e,r){var i=this.loadIndex(t);je(e)?(i.keys.forEach(function(n){localStorage.removeItem(this.docKey(t,n))},this),localStorage.removeItem(this.indexKey(t)),this.callback(r,null)):e.id&&(i.keys=i.keys.filter(function(n){return n!==e.id}),localStorage.removeItem(this.docKey(t,e.id)),this.setItem(this.indexKey(t),i),this.callback(r,null))},callback:function(t,e,r){t&&setTimeout(function(){t(e,r)},1)},setItem:function(t,e){localStorage.setItem(t,JSON.stringify(e))},getItem:function(t){var e=localStorage.getItem(t);return e&&JSON.parse(e)},loadIndex:function(t){var e=this.getItem(this.indexKey(t))||{};return e.keys=e.keys||[],e},docKey:function(t,e){return this.prefix+"."+t+".docs."+e},indexKey:function(t){return this.prefix+"."+t+".index"}},xM={__proto__:null,Local:wM},AM={__proto__:null,PriorityQueue:br,Dijkstra:Lv},CM=200,IM=200;function Dv(t,e){var r=TM(e),i=MM(t,r),n=function(o){SM(t,o,e)},a={sheetSizePx:Bv(r)};r.ready(i,n,a)}var zv=function(t,e,r){t.trigger("beforeprint",r);var i=f("<div/>").addClass("printarea"),n=f("<div/>").addClass(Ze("print-paper")).css("position","relative");r.size&&i.addClass("printarea-size-"+r.size);var a=F(t.svg).clone(),o=a.findOne("."+Ze("layers"));n.append(a.node);var s=Bv(r),l=t.getArea(),u=t.scale(),g=u.sx,h=u.sy,y=t.translate(),x=y.tx,C=y.ty,p=F.createSVGMatrix().translate(x/g,C/h),E=PM(l,e,s),k=E.scaleToFit,w=E.bBox;return n.css({left:0,top:0}),a.attr({width:w.width*k,height:w.height*k,style:"position:relative",viewBox:[w.x,w.y,w.width,w.height].join(" ")}),o.attr("transform",F.matrixToTransformString(p)),i.append([n.append([a.node])]),i.addClass("preview"),{$el:i,sheetSizePx:s}},SM=function(t,e,r){if(e){var i=f(document.body);i.addClass("joint-print");var n=t.$el.children().detach();e.forEach(function(s){s.removeClass("preview").addClass("print-ready").appendTo(i)});var a=!1,o=function(){a||(a=!0,i.removeClass("joint-print"),e.forEach(function(s){s.remove()}),t.$el.append(n),f("#print-styles").remove(),t.trigger("afterprint",r),f(window).off("afterprint",o))};f(window).one("afterprint",o),setTimeout(o,200),window.print()}},MM=function(t,e){var r=EM(t,e),i=[],n;if(e.poster)for(var a=zM(r,e.poster),o=DM(r,a),s=0;s<o.length;s++)n=zv(t,o[s],e),i.push(n.$el);else n=zv(t,r,e),i.push(n.$el);if(n){var l={width:n.sheetSizePx.cssWidth,height:n.sheetSizePx.cssHeight};LM(l,e)}return i},kM=function(t){return Object.keys(t).map(function(e){return e+":"+t[e]}).join(";")+";"},Bv=function(t){var e=he(t.margin),r=t.sheet;e.unit=t.marginUnit,r.unit=t.sheetUnit;var i="calc("+r.width+r.unit+" - "+(e.left+e.right)+e.unit+")",n="calc("+r.height+r.unit+" - "+(e.top+e.bottom)+e.unit+")",a=BM.measure(i,n,"");return{cssWidth:i,cssHeight:n,width:a.width,height:a.height}},PM=function(t,e,r){var i=new at({x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}),n=i.width/i.height,a=r.width/r.height,o;return n>a?o=r.width/i.width:o=r.height/i.height,{bBox:i,scaleToFit:o,fitHorizontal:n>a}},TM=function(t){var e=on({},t,{area:null,poster:!1,sheet:{width:210,height:297},sheetUnit:"mm",ready:function(r,i,n){i(r)},margin:.4,marginUnit:"in",padding:5});return e.area||(e.printingAll=!0),e},NM=function(t){var e=f("#print-styles"),r='<style type="text/css" id="print-styles">'+t+"</style>";e.length?e.html(t):f("head").append(r)},LM=function(t,e){var r=kM(t),i=he(e.margin),n=e.marginUnit,a=[i.top+n,i.right+n,i.bottom+n,i.left+n].join(" "),o="size:"+(e.sheet.width+e.sheet.unit)+" "+(e.sheet.height+e.sheet.unit),s=["@media print {",".printarea.print-ready {",r,"}","@page {","margin:"+a+";",o,"}",".printarea.preview {",r,"}","}"];NM(s.join(""))},EM=function(t,e){var r=e.area;if(!r){var i=he(e.padding);r=t.getContentArea().moveAndExpand({x:-i.left,y:-i.top,width:i.left+i.right,height:i.top+i.bottom})}return r},DM=function(t,e){for(var r=e.width,i=e.height,n,a=[],o=0,s=0,l=0,u=0;o<t.height;){for(;s<t.width&&(n=at(t.x+s,t.y+o,r,i),a.push(n),s+=r,!(u>IM));)u++;if(s=0,u=0,o+=i,l>CM)break;l++}return a},zM=function(t,e){var r={width:e.width,height:e.height};return r.width||(r.width=Math.ceil(t.width/(e.columns||1))),r.height||(r.height=Math.ceil(t.height/(e.rows||1))),r},BM={supportedUnits:{px:function(t){return t},mm:function(t){return this.millimeterSize*t},cm:function(t){return this.millimeterSize*t*10},in:function(t){return this.millimeterSize*t*25.4},pt:function(t){return this.millimeterSize*(t*25.4/72)},pc:function(t){return this.millimeterSize*(t*25.4/6)}},measure:function(t,e,r){r=r||"";var i=f("<div/>").css({display:"inline-block",position:"absolute",left:-15e3,top:-15e3,width:t+r,height:e+r}).appendTo(document.body),n={width:i.width(),height:i.height()};return i.remove(),n},toPx:function(t,e){if(this.millimeterSize||(this.millimeterSize=this.measure(1,1,"mm").width),e=(e||"").toLowerCase(),!this.supportedUnits[e])throw new Error("Unsupported unit "+e);return this.supportedUnits[e].call(this,t)}};Oe.prototype.print=function(t){Dv(this,t)};var Sa=function(t,e,r){if(r=r||{},t===void 0)throw new Error("The the dia.Paper is a mandatory option.");t.trigger("beforeexport",r);var i=F(t.svg).clone(),n=i.node,a=i.findOne("."+Ze("layers")),o=r.area||t.getContentArea(),s=r.preserveDimensions;s&&i.attr({width:s.width||o.width,height:s.height||o.height}),i.removeAttr("style").attr("viewBox",[o.x,o.y,o.width,o.height].join(" ")),a.removeAttr("transform"),r.useComputedStyles!==!1&&FM(t.svg,n);var l=r.stylesheet;$t(l)&&jM(i.node,l),t.trigger("afterexport",r);var u=function(){var g=r.beforeSerialize;if(typeof g=="function"){var h=g.call(t,n,t);h instanceof SVGElement&&(n=h)}e(GM(n))};r.convertImagesToDataUris?RM(i.find("image")).then(function(){return u()}):u()},OM=new RegExp(/^(data:)([\w\\+-]*)(;charset=[\w-]+|;base64){0,1},(.*)/gi);function RM(t){var e={};return t.forEach(function(r){var i=r.attr("xlink:href")||r.attr("href");!i||(i=i.trim(),!OM.test(i)&&(i in e?e[i].push(r):e[i]=[r]))}),f.when.apply(f,Object.keys(e).map(function(r){return _M(r,e[r])}))}function _M(t,e){var r=f.Deferred();return ko(t,function(i,n){i||!n||(e.forEach(function(a){return a.attr("xlink:href",n)}),r.resolve())}),r.promise()}function GM(t){return new XMLSerializer().serializeToString(t).replace(/&nbsp;/g,"\xA0")}function jM(t,e){var r=t.ownerDocument,i=r.implementation.createDocument(null,"xml",null);F(t).prepend(F("style",{type:"text/css"},[i.createCDATASection(e)]))}function FM(t,e){for(var r=Array.from(t.querySelectorAll("*")),i=Array.from(e.querySelectorAll("*")),n=t.ownerDocument,a=n.styleSheets.length,o=[],s=a-1;s>=0;s--)o[s]=n.styleSheets[s],n.styleSheets[s].disabled=!0;var l={};r.forEach(function(h,y){var x=window.getComputedStyle(h,null),C={};Ut(x,function(p){C[p]=x.getPropertyValue(p)}),l[y]=C}),a!=n.styleSheets.length&&o.forEach(function(h,y){n.styleSheets[y]=h});for(var u=0;u<a;u++)n.styleSheets[u].disabled=!1;var g={};r.forEach(function(h,y){var x=window.getComputedStyle(h,null),C=l[y],p={};Ut(x,function(E){!isNaN(E)||x.getPropertyValue(E)!==C[E]&&(p[E]=x.getPropertyValue(E))}),g[y]=p}),i.forEach(function(h,y){f(h).css(g[y])})}var Ov=function(t,e){var r="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes",i=Qn("svg_output");Sa(t,function(n){var a=window.open("",i,r),o="data:image/svg+xml,"+encodeURIComponent(n);a.document.write('<img src="'+o+'" style="max-height:100%" />')},tt({convertImagesToDataUris:!0},e))};Oe.prototype.toSVG=function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return Sa.apply(this,[this].concat(e))},Oe.prototype.openAsSVG=function(){for(var t=arguments.length,e=Array(t);t--;)e[t]=arguments[t];return Ov.apply(this,[this].concat(e))};var Cn=function(t,e,r){if(r===void 0&&(r={}),t===void 0)throw new Error("The the dia.Paper is a mandatory argument.");var i=r.canvg||(typeof canvg<"u"?canvg:void 0),n=r.area||t.paperToLocalRect(t.getContentBBox()),a=WM(n,r),o=Nt(r.width)&&Nt(r.height)?r:a,s=YM(o,ZM(r.size));if(!VM(s.width,s.height))throw new Error("dia.Paper: raster size exceeded.");var l=new Image,u;l.onload=function(){var g,h,y;function x(){y=document.createElement("canvas"),y.width=s.width,y.height=s.height,h=y.getContext("2d"),h.fillStyle=r.backgroundColor||"white",h.fillRect(0,0,s.width,s.height)}function C(){var w=r.type,S=r.quality;if(w==="canvas"){if(E(h))throw new Error("Canvas Tainted");e(y)}else g=y.toDataURL(w,S),e(g);p()}function p(){y.svg&&yt(y.svg.stop)&&setTimeout(y.svg.stop,1)}function E(w){try{var S=w.getImageData(0,0,1,1);return!1}catch{return}}x();try{h.drawImage(l,0,0,s.width,s.height),C()}catch{if(typeof i>"u"){console.error("Canvas tainted. Canvg library required.");return}x();var k={ignoreDimensions:!0,ignoreClear:!0,ignoreMouse:!0,ignoreAnimation:!0,offsetX:0,offsetY:0,useCORS:!0};i(y,u,tt(k,{forceRedraw:function(){return this.called?!1:(this.called=!0,!0)}.bind({called:!1}),renderCallback:function(){try{C()}catch{p(),u=XM(u),x(),i(y,u,tt(k,{renderCallback:C}))}}}))}},Sa(t,function(g){u=g,l.src="data:image/svg+xml,"+encodeURIComponent(g)},{paper:t,convertImagesToDataUris:!0,beforeSerialize:r.beforeSerialize,area:a,useComputedStyles:r.useComputedStyles,stylesheet:r.stylesheet,preserveDimensions:{width:s.width,height:s.height}})},As=function(t,e,r){r=r||{},r.type="image/png",Cn(t,e,r)},Rv=function(t,e,r){r=r||{},r.type="image/jpeg",Cn(t,e,r)},_v=function(t,e,r){r=r||{},r.type="canvas",Cn(t,e,r)},Gv=function(t,e){var r="menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes",i=Qn("png_output");As(t,function(n){var a=window.open("",i,r);a.document.write('<img src="'+n+'"/>')},tt({padding:10},e))};function VM(t,e){var r=document.createElement("canvas");r.width=t,r.height=e;var i=t-1,n=e-1,a=r.getContext("2d");try{a.fillStyle="rgb(1,1,1)",a.fillRect(i,n,1,1);var o=a.getImageData(i,n,1,1).data;if(o[0]!==1||o[1]!==1||o[2]!==1)return!1}catch{return!1}return!0}function WM(t,e){var r=UM(e),i=We({x:-r.left,y:-r.top,width:r.left+r.right,height:r.top+r.bottom});if(e.width&&e.height){var n=t.width+r.left+r.right,a=t.height+r.top+r.bottom;i.scale(n/e.width,a/e.height)}return at(t).moveAndExpand(i)}function ZM(t){var e=1;if(t!==void 0&&(e=parseFloat(t),!Number.isFinite(e)||e===0))throw new Error("dia.Paper: invalid raster size ("+t+")");return e}function YM(t,e){return{width:Math.max(Math.round(t.width*e),1),height:Math.max(Math.round(t.height*e),1)}}function UM(t){var e=he(t.padding);return t.width&&t.height&&(e.left+e.right>=t.width&&(e.left=e.right=0),e.top+e.bottom>=t.height&&(e.top=e.bottom=0)),e}function XM(t){return t.replace(/<image[^>]*>/g,function(e){var r=e.match(/href="([^"]*)"/),i=r&&r[1],n="data:image/svg+xml";if(i&&i.substr(0,n.length)===n){var a=atob(i.substr(i.indexOf(",")+1));return a.substr(a.indexOf("<svg"))}return e})}Oe.prototype.openAsPNG=function(t){for(var e=arguments.length,r=Array(e);e--;)r[e]=arguments[e];return Gv.apply(this,[this].concat(r))},Oe.prototype.toJPEG=function(t,e){for(var r=arguments.length,i=Array(r);r--;)i[r]=arguments[r];return Rv.apply(this,[this].concat(i))},Oe.prototype.toPNG=function(t,e){for(var r=arguments.length,i=Array(r);r--;)i[r]=arguments[r];return As.apply(this,[this].concat(i))},Oe.prototype.toDataURL=function(t,e){for(var r=arguments.length,i=Array(r);r--;)i[r]=arguments[r];return Cn.apply(this,[this].concat(i))},Oe.prototype.toCanvas=function(t,e){for(var r=arguments.length,i=Array(r);r--;)i[r]=arguments[r];return _v.apply(this,[this].concat(i))};var HM=function(t,e,r){var i=new DOMParser,n=i.parseFromString(t,"text/xml");if(n.documentElement.nodeName=="parsererror")throw new Error("Error while parsing GEXF file.");var a=Array.from(n.documentElement.querySelectorAll("node")),o=Array.from(n.documentElement.querySelectorAll("edge")),s=[];return a.forEach(function(l){var u={id:l.getAttribute("id"),label:l.getAttribute("label")},g=l.querySelector("size");if(g){var h=parseFloat(g.getAttribute("value"));u.width=h,u.height=h}var y=l.querySelector("position");if(y){var x=parseFloat(y.getAttribute("x")),C=parseFloat(y.getAttribute("y")),p=parseFloat(y.getAttribute("z"));u.x=x,u.y=C,u.z=p}var E=l.querySelector("shape");if(E){var k=E.getAttribute("value");u.shape=k}var w=l.querySelector("color");if(w){var S=w.getAttribute("r"),T=w.getAttribute("g"),m=w.getAttribute("b"),A=w.getAttribute("a");A?u.color="rgba("+S+","+T+","+m+","+A+")":u.color="rgb("+S+","+T+","+m+")"}var M=e(u,l);s.push(M)}),o.forEach(function(l){var u={source:l.getAttribute("source"),target:l.getAttribute("target")},g=r(u,l);s.unshift(g)}),s},qM={__proto__:null,toCellsArray:HM},JM={__proto__:null,gexf:qM,print:Dv,toSVG:Sa,openAsSVG:Ov,toDataURL:Cn,toPNG:As,toJPEG:Rv,toCanvas:_v,openAsPNG:Gv},KM=d.Model.extend({initialize:function(t){this._map={},this._commandManager=t.commandManager,this.listenTo(this._commandManager,"add",this._onCommand)},defaults:{cancelInvalid:!0},_onCommand:function(t){return Array.isArray(t)?t.find(function(e){return!this._validateCommand(e)},this):this._validateCommand(t)},_validateCommand:function(t){if(t.options&&t.options.validation===!1)return!0;var e;return lt(this._map[t.action]).forEach(function(r){var i=0;function n(a){var o=r[i++];try{if(o)o(a,t,n);else{e=a;return}}catch(s){n(s)}}n(e)}),e?(this.get("cancelInvalid")&&this._commandManager.cancel(),this.trigger("invalid",e),!1):!0},validate:function(t){var e=Array.prototype.slice.call(arguments,1);return e.forEach(function(r){if(!yt(r))throw new Error(t+" requires callback functions.")}),t.split(" ").forEach(function(r){(this._map[r]=this._map[r]||[]).push(e)},this),this}});function Cs(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i={};return e.forEach(function(n){if(Array.isArray(n))n.forEach(function(s){t&&t.hasOwnProperty(s)&&(i[s]=t[s])},i);else if(yt(n)){for(var a in t)if(!!t.hasOwnProperty(a)){var o=t[a];n(o,a)&&(i[a]=o)}}}),i}function jv(t){return Array.isArray(t)?t:[t]}var Ma=d.Model.extend({defaults:{cmdBeforeAdd:null,cmdNameRegex:/^(?:add|remove|change:\w+)$/,applyOptionsList:["propertyPath"],revertOptionsList:["propertyPath"],storeReducedOptions:!0,stackLimit:1/0},PREFIX_LENGTH:7,initialize:function(t){ke(this,"initBatchCommand","storeBatchCommand"),this.graph=t.graph,this.reset(),this.listen()},listen:function(){this.listenTo(this.graph,"all",this.addCommand,this),this.listenTo(this.graph,"batch:start",this.initBatchCommand,this),this.listenTo(this.graph,"batch:stop",this.storeBatchCommand,this)},createCommand:function(t){var e={action:void 0,data:{id:void 0,type:void 0,previous:{},next:{}},batch:t&&t.batch};return e},push:function(t,e){this.redoStack=[],t.batch?(this.lastCmdIndex=Math.max(this.lastCmdIndex,0),this.trigger("batch",t)):(this._push(this.undoStack,t),this.notifyStackChange("push",t,e),this.trigger("add",t))},_push:function(t,e){var r=this.attributes,i=r.stackLimit;i===void 0&&(i=1/0),t.push(e),t.length>i&&t.splice(0,t.length-i)},squashUndo:function(t){this.constructor.squashCommands(this.undoStack,t)},squashRedo:function(t){this.constructor.squashCommands(this.redoStack,t)},addCommand:function(t,e,r,i){if(i||(i={}),!i.dry&&!!this.get("cmdNameRegex").test(t)&&!(typeof this.get("cmdBeforeAdd")=="function"&&!this.get("cmdBeforeAdd").apply(this,arguments))){var n=void 0,a=e instanceof Ie;if(this.batchCommand){n=this.batchCommand[Math.max(this.lastCmdIndex,0)];var o=a&&!n.graphChange||n.data.id!==e.id,s=n.action!==t;if(this.lastCmdIndex>=0&&(o||s)){var l=this.batchCommand.findIndex(function(y,x){return(a&&y.graphChange||y.data.id===e.id)&&y.action===t});l<0||t==="add"||t==="remove"?n=this.createCommand({batch:!0}):(n=this.batchCommand[l],this.batchCommand.splice(l,1)),this.lastCmdIndex=this.batchCommand.push(n)-1}}else n=this.createCommand({batch:!1});var u=this.attributes,g=u.storeReducedOptions;if(t==="add"||t==="remove"){n.action=t,n.data.id=e.id,n.data.type=e.attributes.type,n.data.attributes=ie({},e.toJSON()),n.options=g?this.reduceOptions(i):i,this.push(n,i);return}var h=t.substr(this.PREFIX_LENGTH);(!n.batch||!n.action)&&(n.action=t,n.data.previous[h]=be(e.previous(h)),n.options=g?this.reduceOptions(i):i,a?n.graphChange=!0:(n.data.id=e.id,n.data.type=e.attributes.type)),n.data.next[h]=be(e.get(h)),this.push(n,i)}},reduceOptions:function(t){var e=this.attributes,r=e.applyOptionsList,i=e.revertOptionsList;return Cs(t,r,i)},initBatchCommand:function(){this.batchCommand?this.batchLevel++:(this.batchCommand=[this.createCommand({batch:!0})],this.lastCmdIndex=-1,this.batchLevel=0)},storeBatchCommand:function(t){if(this.batchCommand&&this.batchLevel<=0){var e=this.constructor.filterBatchCommand(this.batchCommand);e.length>0&&(this.redoStack=[],this._push(this.undoStack,e),this.notifyStackChange("push",e,t),this.trigger("add",e)),this.batchCommand=null,this.lastCmdIndex=null,this.batchLevel=null}else this.batchCommand&&this.batchLevel>0&&this.batchLevel--},revertCommand:function(t,e){this.stopListening();var r;Array.isArray(t)?r=this.constructor.sortBatchCommand(t):r=[t];for(var i=this.graph,n=r.length-1;n>=0;n--){var a=r[n],o=a.graphChange?i:i.getCell(a.data.id),s=tt({commandManager:this.id||this.cid},e,Cs(a.options,this.get("revertOptionsList")));switch(a.action){case"add":o.remove(s);break;case"remove":i.addCell(a.data.attributes,s);break;default:var l=a.action.substr(this.PREFIX_LENGTH);o.set(l,a.data.previous[l],s);break}}this.listen()},applyCommand:function(t,e){this.stopListening();var r;Array.isArray(t)?r=this.constructor.sortBatchCommand(t):r=[t];for(var i=this.graph,n=0;n<r.length;n++){var a=r[n],o=a.graphChange?i:i.getCell(a.data.id),s=tt({commandManager:this.id||this.cid},e,Cs(a.options,this.get("applyOptionsList")));switch(a.action){case"add":i.addCell(a.data.attributes,s);break;case"remove":o.remove(s);break;default:var l=a.action.substr(this.PREFIX_LENGTH);o.set(l,a.data.next[l],s);break}}this.listen()},undo:function(t){var e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack.push(e),this.notifyStackChange("undo",e,t))},redo:function(t){var e=this.redoStack.pop();e&&(this.applyCommand(e,t),this.undoStack.push(e),this.notifyStackChange("redo",e,t))},cancel:function(t){var e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack=[],this.notifyStackChange("cancel",e,t))},reset:function(t){this.undoStack=[],this.redoStack=[],this.notifyStackChange("reset",null,t)},hasUndo:function(){return this.undoStack.length>0},hasRedo:function(){return this.redoStack.length>0},notifyStackChange:function(t,e,r){var i;r===void 0&&(r={});var n;e?n=[jv(e),r]:n=[r],(i=this).trigger.apply(i,["stack:"+t].concat(n)),this.trigger("stack",r)},toJSON:function(){var e=this,r=e.undoStack,i=e.redoStack,n=this.exportBatchCommands(r),a=this.exportBatchCommands(i);return{undo:n,redo:a}},fromJSON:function(e,r){if(!e||!Array.isArray(e.undo)||!Array.isArray(e.redo))throw new Error("dia.CommandManager: JSON must contain undo and redo arrays.");this.undoStack=e.undo,this.redoStack=e.redo,this.notifyStackChange("reset",null,r)},exportBatchCommands:function(t){var e=this,r=this.attributes,i=r.storeReducedOptions;return t.map(function(n){return jv(n).map(function(a){var o=be(a);return i||(o.options=e.reduceOptions(o.options)),de(o)})})}},{squashCommands:function(t,e){e===void 0&&(e=1/0);var r=t.length;if(!(r<2)){e=Math.min(r,e);for(var i=[];e>0;){var n=t.pop();Array.isArray(n)||(n.batch=!0,n=[n]),i.unshift.apply(i,n),e--}var a=this.filterBatchCommand(i);return t.push(a),a}},sortBatchCommand:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=null;if(i.action==="add"){for(var a=i.data.id,o=0;o<r;o++)if(t[o].data.id===a){n=o;break}}n!==null?e.splice(n,0,i):e.push(i)}return e},filterBatchCommand:function(t){for(var e=t.slice(),r=[];e.length>0;){var i=e.shift(),n=i.data.id;if(!(i.action==null||n==null&&!i.graphChange)){if(i.action==="add"){var a=e.findIndex(function(s){return s.action==="remove"&&s.data&&s.data.id===n});if(a>=0){e=e.filter(function(s,l){return l>a||s.data.id!==n});continue}}else if(i.action==="remove"){var o=e.findIndex(function(s){return s.action==="add"&&s.data&&s.data.id==n});if(o>=0){e.splice(o,1);continue}}else if(i.action.indexOf("change")===0&&ze(i.data.previous,i.data.next))continue;r.push(i)}}return r}});Ma.sortBatchCommands=Ma.sortBatchCommand,Ma.prototype.filterBatchCommand=function(t){return this.constructor.filterBatchCommand(t)};var QM={__proto__:null,Validator:KM,CommandManager:Ma},$M="3.6.3",tk=tt({},nS,xS),ek=tt({},WI,SS),rk=tt({},YA,e2),ik={standard:rk,uml:rC,pn:V1,fsa:z1,erd:T1,logic:s1,chess:w1,org:R1,devs:qA,basic:SA,bpmn:I2,bpmn2:iS,chart:l2,measurement:L2},nk=tt({},DI,QM);c.V=F,c.Vectorizer=YI,c.alg=AM,c.anchors=Bg,c.config=ar,c.connectionPoints=pg,c.connectionStrategies=VC,c.connectors=cg,c.dia=nk,c.elementTools=ek,c.env=cr,c.format=JM,c.g=ff,c.graphUtils=bM,c.highlighters=gg,c.layout=tk,c.linkAnchors=zg,c.linkTools=jI,c.mvc=pA,c.routers=Lg,c.setTheme=UI,c.shapes=ik,c.storage=xM,c.ui=yM,c.util=Yx,c.version=ZI,c.versionRappid=$M,Object.defineProperty(c,"__esModule",{value:!0})});typeof joint<"u"&&(joint.g,joint.V);const Za=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Ms,Kv;function mk(){if(Kv)return Ms;Kv=1;function c(){this.__data__=[],this.size=0}return Ms=c,Ms}var ks,Qv;function Xi(){if(Qv)return ks;Qv=1;function c(d,v){return d===v||d!==d&&v!==v}return ks=c,ks}var Ps,$v;function Ya(){if($v)return Ps;$v=1;var c=Xi();function d(v,f){for(var b=v.length;b--;)if(c(v[b][0],f))return b;return-1}return Ps=d,Ps}var Ts,tp;function yk(){if(tp)return Ts;tp=1;var c=Ya(),d=Array.prototype,v=d.splice;function f(b){var I=this.__data__,P=c(I,b);if(P<0)return!1;var L=I.length-1;return P==L?I.pop():v.call(I,P,1),--this.size,!0}return Ts=f,Ts}var Ns,ep;function bk(){if(ep)return Ns;ep=1;var c=Ya();function d(v){var f=this.__data__,b=c(f,v);return b<0?void 0:f[b][1]}return Ns=d,Ns}var Ls,rp;function wk(){if(rp)return Ls;rp=1;var c=Ya();function d(v){return c(this.__data__,v)>-1}return Ls=d,Ls}var Es,ip;function xk(){if(ip)return Es;ip=1;var c=Ya();function d(v,f){var b=this.__data__,I=c(b,v);return I<0?(++this.size,b.push([v,f])):b[I][1]=f,this}return Es=d,Es}var Ds,np;function Ua(){if(np)return Ds;np=1;var c=mk(),d=yk(),v=bk(),f=wk(),b=xk();function I(P){var L=-1,B=P==null?0:P.length;for(this.clear();++L<B;){var R=P[L];this.set(R[0],R[1])}}return I.prototype.clear=c,I.prototype.delete=d,I.prototype.get=v,I.prototype.has=f,I.prototype.set=b,Ds=I,Ds}var zs,ap;function Ak(){if(ap)return zs;ap=1;var c=Ua();function d(){this.__data__=new c,this.size=0}return zs=d,zs}var Bs,op;function Ck(){if(op)return Bs;op=1;function c(d){var v=this.__data__,f=v.delete(d);return this.size=v.size,f}return Bs=c,Bs}var Os,sp;function Ik(){if(sp)return Os;sp=1;function c(d){return this.__data__.get(d)}return Os=c,Os}var Rs,lp;function Sk(){if(lp)return Rs;lp=1;function c(d){return this.__data__.has(d)}return Rs=c,Rs}var _s,up;function nw(){if(up)return _s;up=1;var c=typeof ka=="object"&&ka&&ka.Object===Object&&ka;return _s=c,_s}var Gs,hp;function wr(){if(hp)return Gs;hp=1;var c=nw(),d=typeof self=="object"&&self&&self.Object===Object&&self,v=c||d||Function("return this")();return Gs=v,Gs}var js,cp;function Hi(){if(cp)return js;cp=1;var c=wr(),d=c.Symbol;return js=d,js}var Fs,dp;function Mk(){if(dp)return Fs;dp=1;var c=Hi(),d=Object.prototype,v=d.hasOwnProperty,f=d.toString,b=c?c.toStringTag:void 0;function I(P){var L=v.call(P,b),B=P[b];try{P[b]=void 0;var R=!0}catch{}var O=f.call(P);return R&&(L?P[b]=B:delete P[b]),O}return Fs=I,Fs}var Vs,fp;function kk(){if(fp)return Vs;fp=1;var c=Object.prototype,d=c.toString;function v(f){return d.call(f)}return Vs=v,Vs}var Ws,gp;function yi(){if(gp)return Ws;gp=1;var c=Hi(),d=Mk(),v=kk(),f="[object Null]",b="[object Undefined]",I=c?c.toStringTag:void 0;function P(L){return L==null?L===void 0?b:f:I&&I in Object(L)?d(L):v(L)}return Ws=P,Ws}var Zs,vp;function fr(){if(vp)return Zs;vp=1;function c(d){var v=typeof d;return d!=null&&(v=="object"||v=="function")}return Zs=c,Zs}var Ys,pp;function Nn(){if(pp)return Ys;pp=1;var c=yi(),d=fr(),v="[object AsyncFunction]",f="[object Function]",b="[object GeneratorFunction]",I="[object Proxy]";function P(L){if(!d(L))return!1;var B=c(L);return B==f||B==b||B==v||B==I}return Ys=P,Ys}var Us,mp;function Pk(){if(mp)return Us;mp=1;var c=wr(),d=c["__core-js_shared__"];return Us=d,Us}var Xs,yp;function Tk(){if(yp)return Xs;yp=1;var c=Pk(),d=function(){var f=/[^.]+$/.exec(c&&c.keys&&c.keys.IE_PROTO||"");return f?"Symbol(src)_1."+f:""}();function v(f){return!!d&&d in f}return Xs=v,Xs}var Hs,bp;function aw(){if(bp)return Hs;bp=1;var c=Function.prototype,d=c.toString;function v(f){if(f!=null){try{return d.call(f)}catch{}try{return f+""}catch{}}return""}return Hs=v,Hs}var qs,wp;function Nk(){if(wp)return qs;wp=1;var c=Nn(),d=Tk(),v=fr(),f=aw(),b=/[\\^$.*+?()[\]{}|]/g,I=/^\[object .+?Constructor\]$/,P=Function.prototype,L=Object.prototype,B=P.toString,R=L.hasOwnProperty,O=RegExp("^"+B.call(R).replace(b,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function G(U){if(!v(U)||d(U))return!1;var H=c(U)?O:I;return H.test(f(U))}return qs=G,qs}var Js,xp;function Lk(){if(xp)return Js;xp=1;function c(d,v){return d==null?void 0:d[v]}return Js=c,Js}var Ks,Ap;function bi(){if(Ap)return Ks;Ap=1;var c=Nk(),d=Lk();function v(f,b){var I=d(f,b);return c(I)?I:void 0}return Ks=v,Ks}var Qs,Cp;function Md(){if(Cp)return Qs;Cp=1;var c=bi(),d=wr(),v=c(d,"Map");return Qs=v,Qs}var $s,Ip;function Xa(){if(Ip)return $s;Ip=1;var c=bi(),d=c(Object,"create");return $s=d,$s}var tl,Sp;function Ek(){if(Sp)return tl;Sp=1;var c=Xa();function d(){this.__data__=c?c(null):{},this.size=0}return tl=d,tl}var el,Mp;function Dk(){if(Mp)return el;Mp=1;function c(d){var v=this.has(d)&&delete this.__data__[d];return this.size-=v?1:0,v}return el=c,el}var rl,kp;function zk(){if(kp)return rl;kp=1;var c=Xa(),d="__lodash_hash_undefined__",v=Object.prototype,f=v.hasOwnProperty;function b(I){var P=this.__data__;if(c){var L=P[I];return L===d?void 0:L}return f.call(P,I)?P[I]:void 0}return rl=b,rl}var il,Pp;function Bk(){if(Pp)return il;Pp=1;var c=Xa(),d=Object.prototype,v=d.hasOwnProperty;function f(b){var I=this.__data__;return c?I[b]!==void 0:v.call(I,b)}return il=f,il}var nl,Tp;function Ok(){if(Tp)return nl;Tp=1;var c=Xa(),d="__lodash_hash_undefined__";function v(f,b){var I=this.__data__;return this.size+=this.has(f)?0:1,I[f]=c&&b===void 0?d:b,this}return nl=v,nl}var al,Np;function Rk(){if(Np)return al;Np=1;var c=Ek(),d=Dk(),v=zk(),f=Bk(),b=Ok();function I(P){var L=-1,B=P==null?0:P.length;for(this.clear();++L<B;){var R=P[L];this.set(R[0],R[1])}}return I.prototype.clear=c,I.prototype.delete=d,I.prototype.get=v,I.prototype.has=f,I.prototype.set=b,al=I,al}var ol,Lp;function _k(){if(Lp)return ol;Lp=1;var c=Rk(),d=Ua(),v=Md();function f(){this.size=0,this.__data__={hash:new c,map:new(v||d),string:new c}}return ol=f,ol}var sl,Ep;function Gk(){if(Ep)return sl;Ep=1;function c(d){var v=typeof d;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?d!=="__proto__":d===null}return sl=c,sl}var ll,Dp;function Ha(){if(Dp)return ll;Dp=1;var c=Gk();function d(v,f){var b=v.__data__;return c(f)?b[typeof f=="string"?"string":"hash"]:b.map}return ll=d,ll}var ul,zp;function jk(){if(zp)return ul;zp=1;var c=Ha();function d(v){var f=c(this,v).delete(v);return this.size-=f?1:0,f}return ul=d,ul}var hl,Bp;function Fk(){if(Bp)return hl;Bp=1;var c=Ha();function d(v){return c(this,v).get(v)}return hl=d,hl}var cl,Op;function Vk(){if(Op)return cl;Op=1;var c=Ha();function d(v){return c(this,v).has(v)}return cl=d,cl}var dl,Rp;function Wk(){if(Rp)return dl;Rp=1;var c=Ha();function d(v,f){var b=c(this,v),I=b.size;return b.set(v,f),this.size+=b.size==I?0:1,this}return dl=d,dl}var fl,_p;function kd(){if(_p)return fl;_p=1;var c=_k(),d=jk(),v=Fk(),f=Vk(),b=Wk();function I(P){var L=-1,B=P==null?0:P.length;for(this.clear();++L<B;){var R=P[L];this.set(R[0],R[1])}}return I.prototype.clear=c,I.prototype.delete=d,I.prototype.get=v,I.prototype.has=f,I.prototype.set=b,fl=I,fl}var gl,Gp;function Zk(){if(Gp)return gl;Gp=1;var c=Ua(),d=Md(),v=kd(),f=200;function b(I,P){var L=this.__data__;if(L instanceof c){var B=L.__data__;if(!d||B.length<f-1)return B.push([I,P]),this.size=++L.size,this;L=this.__data__=new v(B)}return L.set(I,P),this.size=L.size,this}return gl=b,gl}var vl,jp;function qa(){if(jp)return vl;jp=1;var c=Ua(),d=Ak(),v=Ck(),f=Ik(),b=Sk(),I=Zk();function P(L){var B=this.__data__=new c(L);this.size=B.size}return P.prototype.clear=d,P.prototype.delete=v,P.prototype.get=f,P.prototype.has=b,P.prototype.set=I,vl=P,vl}var pl,Fp;function Pd(){if(Fp)return pl;Fp=1;function c(d,v){for(var f=-1,b=d==null?0:d.length;++f<b&&v(d[f],f,d)!==!1;);return d}return pl=c,pl}var ml,Vp;function ow(){if(Vp)return ml;Vp=1;var c=bi(),d=function(){try{var v=c(Object,"defineProperty");return v({},"",{}),v}catch{}}();return ml=d,ml}var yl,Wp;function Ja(){if(Wp)return yl;Wp=1;var c=ow();function d(v,f,b){f=="__proto__"&&c?c(v,f,{configurable:!0,enumerable:!0,value:b,writable:!0}):v[f]=b}return yl=d,yl}var bl,Zp;function Ka(){if(Zp)return bl;Zp=1;var c=Ja(),d=Xi(),v=Object.prototype,f=v.hasOwnProperty;function b(I,P,L){var B=I[P];(!(f.call(I,P)&&d(B,L))||L===void 0&&!(P in I))&&c(I,P,L)}return bl=b,bl}var wl,Yp;function Ln(){if(Yp)return wl;Yp=1;var c=Ka(),d=Ja();function v(f,b,I,P){var L=!I;I||(I={});for(var B=-1,R=b.length;++B<R;){var O=b[B],G=P?P(I[O],f[O],O,I,f):void 0;G===void 0&&(G=f[O]),L?d(I,O,G):c(I,O,G)}return I}return wl=v,wl}var xl,Up;function Yk(){if(Up)return xl;Up=1;function c(d,v){for(var f=-1,b=Array(d);++f<d;)b[f]=v(f);return b}return xl=c,xl}var Al,Xp;function kr(){if(Xp)return Al;Xp=1;function c(d){return d!=null&&typeof d=="object"}return Al=c,Al}var Cl,Hp;function Uk(){if(Hp)return Cl;Hp=1;var c=yi(),d=kr(),v="[object Arguments]";function f(b){return d(b)&&c(b)==v}return Cl=f,Cl}var Il,qp;function En(){if(qp)return Il;qp=1;var c=Uk(),d=kr(),v=Object.prototype,f=v.hasOwnProperty,b=v.propertyIsEnumerable,I=c(function(){return arguments}())?c:function(P){return d(P)&&f.call(P,"callee")&&!b.call(P,"callee")};return Il=I,Il}var Sl,Jp;function Ne(){if(Jp)return Sl;Jp=1;var c=Array.isArray;return Sl=c,Sl}var Pa={exports:{}},Ml,Kp;function Xk(){if(Kp)return Ml;Kp=1;function c(){return!1}return Ml=c,Ml}var Qp;function qi(){return Qp||(Qp=1,function(c,d){var v=wr(),f=Xk(),b=d&&!d.nodeType&&d,I=b&&!0&&c&&!c.nodeType&&c,P=I&&I.exports===b,L=P?v.Buffer:void 0,B=L?L.isBuffer:void 0,R=B||f;c.exports=R}(Pa,Pa.exports)),Pa.exports}var kl,$p;function Qa(){if($p)return kl;$p=1;var c=9007199254740991,d=/^(?:0|[1-9]\d*)$/;function v(f,b){var I=typeof f;return b=b==null?c:b,!!b&&(I=="number"||I!="symbol"&&d.test(f))&&f>-1&&f%1==0&&f<b}return kl=v,kl}var Pl,tm;function Td(){if(tm)return Pl;tm=1;var c=9007199254740991;function d(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=c}return Pl=d,Pl}var Tl,em;function Hk(){if(em)return Tl;em=1;var c=yi(),d=Td(),v=kr(),f="[object Arguments]",b="[object Array]",I="[object Boolean]",P="[object Date]",L="[object Error]",B="[object Function]",R="[object Map]",O="[object Number]",G="[object Object]",U="[object RegExp]",H="[object Set]",K="[object String]",q="[object WeakMap]",et="[object ArrayBuffer]",ht="[object DataView]",mt="[object Float32Array]",bt="[object Float64Array]",Pt="[object Int8Array]",qt="[object Int16Array]",Tt="[object Int32Array]",Mt="[object Uint8Array]",Ft="[object Uint8ClampedArray]",Jt="[object Uint16Array]",te="[object Uint32Array]",ct={};ct[mt]=ct[bt]=ct[Pt]=ct[qt]=ct[Tt]=ct[Mt]=ct[Ft]=ct[Jt]=ct[te]=!0,ct[f]=ct[b]=ct[et]=ct[I]=ct[ht]=ct[P]=ct[L]=ct[B]=ct[R]=ct[O]=ct[G]=ct[U]=ct[H]=ct[K]=ct[q]=!1;function ue(Ae){return v(Ae)&&d(Ae.length)&&!!ct[c(Ae)]}return Tl=ue,Tl}var Nl,rm;function $a(){if(rm)return Nl;rm=1;function c(d){return function(v){return d(v)}}return Nl=c,Nl}var Ta={exports:{}},im;function Nd(){return im||(im=1,function(c,d){var v=nw(),f=d&&!d.nodeType&&d,b=f&&!0&&c&&!c.nodeType&&c,I=b&&b.exports===f,P=I&&v.process,L=function(){try{var B=b&&b.require&&b.require("util").types;return B||P&&P.binding&&P.binding("util")}catch{}}();c.exports=L}(Ta,Ta.exports)),Ta.exports}var Ll,nm;function Dn(){if(nm)return Ll;nm=1;var c=Hk(),d=$a(),v=Nd(),f=v&&v.isTypedArray,b=f?d(f):c;return Ll=b,Ll}var El,am;function sw(){if(am)return El;am=1;var c=Yk(),d=En(),v=Ne(),f=qi(),b=Qa(),I=Dn(),P=Object.prototype,L=P.hasOwnProperty;function B(R,O){var G=v(R),U=!G&&d(R),H=!G&&!U&&f(R),K=!G&&!U&&!H&&I(R),q=G||U||H||K,et=q?c(R.length,String):[],ht=et.length;for(var mt in R)(O||L.call(R,mt))&&!(q&&(mt=="length"||H&&(mt=="offset"||mt=="parent")||K&&(mt=="buffer"||mt=="byteLength"||mt=="byteOffset")||b(mt,ht)))&&et.push(mt);return et}return El=B,El}var Dl,om;function to(){if(om)return Dl;om=1;var c=Object.prototype;function d(v){var f=v&&v.constructor,b=typeof f=="function"&&f.prototype||c;return v===b}return Dl=d,Dl}var zl,sm;function lw(){if(sm)return zl;sm=1;function c(d,v){return function(f){return d(v(f))}}return zl=c,zl}var Bl,lm;function qk(){if(lm)return Bl;lm=1;var c=lw(),d=c(Object.keys,Object);return Bl=d,Bl}var Ol,um;function Ld(){if(um)return Ol;um=1;var c=to(),d=qk(),v=Object.prototype,f=v.hasOwnProperty;function b(I){if(!c(I))return d(I);var P=[];for(var L in Object(I))f.call(I,L)&&L!="constructor"&&P.push(L);return P}return Ol=b,Ol}var Rl,hm;function jr(){if(hm)return Rl;hm=1;var c=Nn(),d=Td();function v(f){return f!=null&&d(f.length)&&!c(f)}return Rl=v,Rl}var _l,cm;function ii(){if(cm)return _l;cm=1;var c=sw(),d=Ld(),v=jr();function f(b){return v(b)?c(b):d(b)}return _l=f,_l}var Gl,dm;function Jk(){if(dm)return Gl;dm=1;var c=Ln(),d=ii();function v(f,b){return f&&c(b,d(b),f)}return Gl=v,Gl}var jl,fm;function Kk(){if(fm)return jl;fm=1;function c(d){var v=[];if(d!=null)for(var f in Object(d))v.push(f);return v}return jl=c,jl}var Fl,gm;function Qk(){if(gm)return Fl;gm=1;var c=fr(),d=to(),v=Kk(),f=Object.prototype,b=f.hasOwnProperty;function I(P){if(!c(P))return v(P);var L=d(P),B=[];for(var R in P)R=="constructor"&&(L||!b.call(P,R))||B.push(R);return B}return Fl=I,Fl}var Vl,vm;function wi(){if(vm)return Vl;vm=1;var c=sw(),d=Qk(),v=jr();function f(b){return v(b)?c(b,!0):d(b)}return Vl=f,Vl}var Wl,pm;function $k(){if(pm)return Wl;pm=1;var c=Ln(),d=wi();function v(f,b){return f&&c(b,d(b),f)}return Wl=v,Wl}var Na={exports:{}},mm;function uw(){return mm||(mm=1,function(c,d){var v=wr(),f=d&&!d.nodeType&&d,b=f&&!0&&c&&!c.nodeType&&c,I=b&&b.exports===f,P=I?v.Buffer:void 0,L=P?P.allocUnsafe:void 0;function B(R,O){if(O)return R.slice();var G=R.length,U=L?L(G):new R.constructor(G);return R.copy(U),U}c.exports=B}(Na,Na.exports)),Na.exports}var Zl,ym;function hw(){if(ym)return Zl;ym=1;function c(d,v){var f=-1,b=d.length;for(v||(v=Array(b));++f<b;)v[f]=d[f];return v}return Zl=c,Zl}var Yl,bm;function cw(){if(bm)return Yl;bm=1;function c(d,v){for(var f=-1,b=d==null?0:d.length,I=0,P=[];++f<b;){var L=d[f];v(L,f,d)&&(P[I++]=L)}return P}return Yl=c,Yl}var Ul,wm;function dw(){if(wm)return Ul;wm=1;function c(){return[]}return Ul=c,Ul}var Xl,xm;function Ed(){if(xm)return Xl;xm=1;var c=cw(),d=dw(),v=Object.prototype,f=v.propertyIsEnumerable,b=Object.getOwnPropertySymbols,I=b?function(P){return P==null?[]:(P=Object(P),c(b(P),function(L){return f.call(P,L)}))}:d;return Xl=I,Xl}var Hl,Am;function t3(){if(Am)return Hl;Am=1;var c=Ln(),d=Ed();function v(f,b){return c(f,d(f),b)}return Hl=v,Hl}var ql,Cm;function Dd(){if(Cm)return ql;Cm=1;function c(d,v){for(var f=-1,b=v.length,I=d.length;++f<b;)d[I+f]=v[f];return d}return ql=c,ql}var Jl,Im;function eo(){if(Im)return Jl;Im=1;var c=lw(),d=c(Object.getPrototypeOf,Object);return Jl=d,Jl}var Kl,Sm;function fw(){if(Sm)return Kl;Sm=1;var c=Dd(),d=eo(),v=Ed(),f=dw(),b=Object.getOwnPropertySymbols,I=b?function(P){for(var L=[];P;)c(L,v(P)),P=d(P);return L}:f;return Kl=I,Kl}var Ql,Mm;function e3(){if(Mm)return Ql;Mm=1;var c=Ln(),d=fw();function v(f,b){return c(f,d(f),b)}return Ql=v,Ql}var $l,km;function gw(){if(km)return $l;km=1;var c=Dd(),d=Ne();function v(f,b,I){var P=b(f);return d(f)?P:c(P,I(f))}return $l=v,$l}var tu,Pm;function vw(){if(Pm)return tu;Pm=1;var c=gw(),d=Ed(),v=ii();function f(b){return c(b,v,d)}return tu=f,tu}var eu,Tm;function r3(){if(Tm)return eu;Tm=1;var c=gw(),d=fw(),v=wi();function f(b){return c(b,v,d)}return eu=f,eu}var ru,Nm;function i3(){if(Nm)return ru;Nm=1;var c=bi(),d=wr(),v=c(d,"DataView");return ru=v,ru}var iu,Lm;function n3(){if(Lm)return iu;Lm=1;var c=bi(),d=wr(),v=c(d,"Promise");return iu=v,iu}var nu,Em;function pw(){if(Em)return nu;Em=1;var c=bi(),d=wr(),v=c(d,"Set");return nu=v,nu}var au,Dm;function a3(){if(Dm)return au;Dm=1;var c=bi(),d=wr(),v=c(d,"WeakMap");return au=v,au}var ou,zm;function Ji(){if(zm)return ou;zm=1;var c=i3(),d=Md(),v=n3(),f=pw(),b=a3(),I=yi(),P=aw(),L="[object Map]",B="[object Object]",R="[object Promise]",O="[object Set]",G="[object WeakMap]",U="[object DataView]",H=P(c),K=P(d),q=P(v),et=P(f),ht=P(b),mt=I;return(c&&mt(new c(new ArrayBuffer(1)))!=U||d&&mt(new d)!=L||v&&mt(v.resolve())!=R||f&&mt(new f)!=O||b&&mt(new b)!=G)&&(mt=function(bt){var Pt=I(bt),qt=Pt==B?bt.constructor:void 0,Tt=qt?P(qt):"";if(Tt)switch(Tt){case H:return U;case K:return L;case q:return R;case et:return O;case ht:return G}return Pt}),ou=mt,ou}var su,Bm;function o3(){if(Bm)return su;Bm=1;var c=Object.prototype,d=c.hasOwnProperty;function v(f){var b=f.length,I=new f.constructor(b);return b&&typeof f[0]=="string"&&d.call(f,"index")&&(I.index=f.index,I.input=f.input),I}return su=v,su}var lu,Om;function mw(){if(Om)return lu;Om=1;var c=wr(),d=c.Uint8Array;return lu=d,lu}var uu,Rm;function zd(){if(Rm)return uu;Rm=1;var c=mw();function d(v){var f=new v.constructor(v.byteLength);return new c(f).set(new c(v)),f}return uu=d,uu}var hu,_m;function s3(){if(_m)return hu;_m=1;var c=zd();function d(v,f){var b=f?c(v.buffer):v.buffer;return new v.constructor(b,v.byteOffset,v.byteLength)}return hu=d,hu}var cu,Gm;function l3(){if(Gm)return cu;Gm=1;var c=/\w*$/;function d(v){var f=new v.constructor(v.source,c.exec(v));return f.lastIndex=v.lastIndex,f}return cu=d,cu}var du,jm;function u3(){if(jm)return du;jm=1;var c=Hi(),d=c?c.prototype:void 0,v=d?d.valueOf:void 0;function f(b){return v?Object(v.call(b)):{}}return du=f,du}var fu,Fm;function yw(){if(Fm)return fu;Fm=1;var c=zd();function d(v,f){var b=f?c(v.buffer):v.buffer;return new v.constructor(b,v.byteOffset,v.length)}return fu=d,fu}var gu,Vm;function h3(){if(Vm)return gu;Vm=1;var c=zd(),d=s3(),v=l3(),f=u3(),b=yw(),I="[object Boolean]",P="[object Date]",L="[object Map]",B="[object Number]",R="[object RegExp]",O="[object Set]",G="[object String]",U="[object Symbol]",H="[object ArrayBuffer]",K="[object DataView]",q="[object Float32Array]",et="[object Float64Array]",ht="[object Int8Array]",mt="[object Int16Array]",bt="[object Int32Array]",Pt="[object Uint8Array]",qt="[object Uint8ClampedArray]",Tt="[object Uint16Array]",Mt="[object Uint32Array]";function Ft(Jt,te,ct){var ue=Jt.constructor;switch(te){case H:return c(Jt);case I:case P:return new ue(+Jt);case K:return d(Jt,ct);case q:case et:case ht:case mt:case bt:case Pt:case qt:case Tt:case Mt:return b(Jt,ct);case L:return new ue;case B:case G:return new ue(Jt);case R:return v(Jt);case O:return new ue;case U:return f(Jt)}}return gu=Ft,gu}var vu,Wm;function bw(){if(Wm)return vu;Wm=1;var c=fr(),d=Object.create,v=function(){function f(){}return function(b){if(!c(b))return{};if(d)return d(b);f.prototype=b;var I=new f;return f.prototype=void 0,I}}();return vu=v,vu}var pu,Zm;function ww(){if(Zm)return pu;Zm=1;var c=bw(),d=eo(),v=to();function f(b){return typeof b.constructor=="function"&&!v(b)?c(d(b)):{}}return pu=f,pu}var mu,Ym;function c3(){if(Ym)return mu;Ym=1;var c=Ji(),d=kr(),v="[object Map]";function f(b){return d(b)&&c(b)==v}return mu=f,mu}var yu,Um;function d3(){if(Um)return yu;Um=1;var c=c3(),d=$a(),v=Nd(),f=v&&v.isMap,b=f?d(f):c;return yu=b,yu}var bu,Xm;function f3(){if(Xm)return bu;Xm=1;var c=Ji(),d=kr(),v="[object Set]";function f(b){return d(b)&&c(b)==v}return bu=f,bu}var wu,Hm;function g3(){if(Hm)return wu;Hm=1;var c=f3(),d=$a(),v=Nd(),f=v&&v.isSet,b=f?d(f):c;return wu=b,wu}var xu,qm;function xw(){if(qm)return xu;qm=1;var c=qa(),d=Pd(),v=Ka(),f=Jk(),b=$k(),I=uw(),P=hw(),L=t3(),B=e3(),R=vw(),O=r3(),G=Ji(),U=o3(),H=h3(),K=ww(),q=Ne(),et=qi(),ht=d3(),mt=fr(),bt=g3(),Pt=ii(),qt=wi(),Tt=1,Mt=2,Ft=4,Jt="[object Arguments]",te="[object Array]",ct="[object Boolean]",ue="[object Date]",Ae="[object Error]",ir="[object Function]",Pr="[object GeneratorFunction]",Ci="[object Map]",Bn="[object Number]",On="[object Object]",Rn="[object RegExp]",co="[object Set]",_n="[object String]",Z="[object Symbol]",Bt="[object WeakMap]",Qi="[object ArrayBuffer]",$i="[object DataView]",dt="[object Float32Array]",Tr="[object Float64Array]",Gn="[object Int8Array]",Ii="[object Int16Array]",fo="[object Int32Array]",Re="[object Uint8Array]",go="[object Uint8ClampedArray]",jn="[object Uint16Array]",vo="[object Uint32Array]",oe={};oe[Jt]=oe[te]=oe[Qi]=oe[$i]=oe[ct]=oe[ue]=oe[dt]=oe[Tr]=oe[Gn]=oe[Ii]=oe[fo]=oe[Ci]=oe[Bn]=oe[On]=oe[Rn]=oe[co]=oe[_n]=oe[Z]=oe[Re]=oe[go]=oe[jn]=oe[vo]=!0,oe[Ae]=oe[ir]=oe[Bt]=!1;function Ar(Kt,vr,Vr,at,We,pr){var _e,ni=vr&Tt,Qt=vr&Mt,Si=vr&Ft;if(Vr&&(_e=We?Vr(Kt,at,We,pr):Vr(Kt)),_e!==void 0)return _e;if(!mt(Kt))return Kt;var Fn=q(Kt);if(Fn){if(_e=U(Kt),!ni)return P(Kt,_e)}else{var Nr=G(Kt),tn=Nr==ir||Nr==Pr;if(et(Kt))return I(Kt,ni);if(Nr==On||Nr==Jt||tn&&!We){if(_e=Qt||tn?{}:K(Kt),!ni)return Qt?B(Kt,b(_e,Kt)):L(Kt,f(_e,Kt))}else{if(!oe[Nr])return We?Kt:{};_e=H(Kt,Nr,ni)}}pr||(pr=new c);var Mi=pr.get(Kt);if(Mi)return Mi;pr.set(Kt,_e),bt(Kt)?Kt.forEach(function(rt){_e.add(Ar(rt,vr,Vr,rt,Kt,pr))}):ht(Kt)&&Kt.forEach(function(rt,Ee){_e.set(Ee,Ar(rt,vr,Vr,Ee,Kt,pr))});var Zt=Si?Qt?O:R:Qt?qt:Pt,Wr=Fn?void 0:Zt(Kt);return d(Wr||Kt,function(rt,Ee){Wr&&(Ee=rt,rt=Kt[Ee]),v(_e,Ee,Ar(rt,vr,Vr,Ee,Kt,pr))}),_e}return xu=Ar,xu}var Au,Jm;function v3(){if(Jm)return Au;Jm=1;var c=xw(),d=4;function v(f){return c(f,d)}return Au=v,Au}var Cu,Km;function Bd(){if(Km)return Cu;Km=1;function c(d){return function(){return d}}return Cu=c,Cu}var Iu={exports:{}},Su,Qm;function p3(){if(Qm)return Su;Qm=1;function c(d){return function(v,f,b){for(var I=-1,P=Object(v),L=b(v),B=L.length;B--;){var R=L[d?B:++I];if(f(P[R],R,P)===!1)break}return v}}return Su=c,Su}var Mu,$m;function Od(){if($m)return Mu;$m=1;var c=p3(),d=c();return Mu=d,Mu}var ku,t0;function Rd(){if(t0)return ku;t0=1;var c=Od(),d=ii();function v(f,b){return f&&c(f,b,d)}return ku=v,ku}var Pu,e0;function m3(){if(e0)return Pu;e0=1;var c=jr();function d(v,f){return function(b,I){if(b==null)return b;if(!c(b))return v(b,I);for(var P=b.length,L=f?P:-1,B=Object(b);(f?L--:++L<P)&&I(B[L],L,B)!==!1;);return b}}return Pu=d,Pu}var Tu,r0;function ro(){if(r0)return Tu;r0=1;var c=Rd(),d=m3(),v=d(c);return Tu=v,Tu}var Nu,i0;function xi(){if(i0)return Nu;i0=1;function c(d){return d}return Nu=c,Nu}var Lu,n0;function Aw(){if(n0)return Lu;n0=1;var c=xi();function d(v){return typeof v=="function"?v:c}return Lu=d,Lu}var Eu,a0;function Cw(){if(a0)return Eu;a0=1;var c=Pd(),d=ro(),v=Aw(),f=Ne();function b(I,P){var L=f(I)?c:d;return L(I,v(P))}return Eu=b,Eu}var o0;function Iw(){return o0||(o0=1,function(c){c.exports=Cw()}(Iu)),Iu.exports}var Du,s0;function y3(){if(s0)return Du;s0=1;var c=ro();function d(v,f){var b=[];return c(v,function(I,P,L){f(I,P,L)&&b.push(I)}),b}return Du=d,Du}var zu,l0;function b3(){if(l0)return zu;l0=1;var c="__lodash_hash_undefined__";function d(v){return this.__data__.set(v,c),this}return zu=d,zu}var Bu,u0;function w3(){if(u0)return Bu;u0=1;function c(d){return this.__data__.has(d)}return Bu=c,Bu}var Ou,h0;function Sw(){if(h0)return Ou;h0=1;var c=kd(),d=b3(),v=w3();function f(b){var I=-1,P=b==null?0:b.length;for(this.__data__=new c;++I<P;)this.add(b[I])}return f.prototype.add=f.prototype.push=d,f.prototype.has=v,Ou=f,Ou}var Ru,c0;function x3(){if(c0)return Ru;c0=1;function c(d,v){for(var f=-1,b=d==null?0:d.length;++f<b;)if(v(d[f],f,d))return!0;return!1}return Ru=c,Ru}var _u,d0;function Mw(){if(d0)return _u;d0=1;function c(d,v){return d.has(v)}return _u=c,_u}var Gu,f0;function kw(){if(f0)return Gu;f0=1;var c=Sw(),d=x3(),v=Mw(),f=1,b=2;function I(P,L,B,R,O,G){var U=B&f,H=P.length,K=L.length;if(H!=K&&!(U&&K>H))return!1;var q=G.get(P),et=G.get(L);if(q&&et)return q==L&&et==P;var ht=-1,mt=!0,bt=B&b?new c:void 0;for(G.set(P,L),G.set(L,P);++ht<H;){var Pt=P[ht],qt=L[ht];if(R)var Tt=U?R(qt,Pt,ht,L,P,G):R(Pt,qt,ht,P,L,G);if(Tt!==void 0){if(Tt)continue;mt=!1;break}if(bt){if(!d(L,function(Mt,Ft){if(!v(bt,Ft)&&(Pt===Mt||O(Pt,Mt,B,R,G)))return bt.push(Ft)})){mt=!1;break}}else if(!(Pt===qt||O(Pt,qt,B,R,G))){mt=!1;break}}return G.delete(P),G.delete(L),mt}return Gu=I,Gu}var ju,g0;function A3(){if(g0)return ju;g0=1;function c(d){var v=-1,f=Array(d.size);return d.forEach(function(b,I){f[++v]=[I,b]}),f}return ju=c,ju}var Fu,v0;function _d(){if(v0)return Fu;v0=1;function c(d){var v=-1,f=Array(d.size);return d.forEach(function(b){f[++v]=b}),f}return Fu=c,Fu}var Vu,p0;function C3(){if(p0)return Vu;p0=1;var c=Hi(),d=mw(),v=Xi(),f=kw(),b=A3(),I=_d(),P=1,L=2,B="[object Boolean]",R="[object Date]",O="[object Error]",G="[object Map]",U="[object Number]",H="[object RegExp]",K="[object Set]",q="[object String]",et="[object Symbol]",ht="[object ArrayBuffer]",mt="[object DataView]",bt=c?c.prototype:void 0,Pt=bt?bt.valueOf:void 0;function qt(Tt,Mt,Ft,Jt,te,ct,ue){switch(Ft){case mt:if(Tt.byteLength!=Mt.byteLength||Tt.byteOffset!=Mt.byteOffset)return!1;Tt=Tt.buffer,Mt=Mt.buffer;case ht:return!(Tt.byteLength!=Mt.byteLength||!ct(new d(Tt),new d(Mt)));case B:case R:case U:return v(+Tt,+Mt);case O:return Tt.name==Mt.name&&Tt.message==Mt.message;case H:case q:return Tt==Mt+"";case G:var Ae=b;case K:var ir=Jt&P;if(Ae||(Ae=I),Tt.size!=Mt.size&&!ir)return!1;var Pr=ue.get(Tt);if(Pr)return Pr==Mt;Jt|=L,ue.set(Tt,Mt);var Ci=f(Ae(Tt),Ae(Mt),Jt,te,ct,ue);return ue.delete(Tt),Ci;case et:if(Pt)return Pt.call(Tt)==Pt.call(Mt)}return!1}return Vu=qt,Vu}var Wu,m0;function I3(){if(m0)return Wu;m0=1;var c=vw(),d=1,v=Object.prototype,f=v.hasOwnProperty;function b(I,P,L,B,R,O){var G=L&d,U=c(I),H=U.length,K=c(P),q=K.length;if(H!=q&&!G)return!1;for(var et=H;et--;){var ht=U[et];if(!(G?ht in P:f.call(P,ht)))return!1}var mt=O.get(I),bt=O.get(P);if(mt&&bt)return mt==P&&bt==I;var Pt=!0;O.set(I,P),O.set(P,I);for(var qt=G;++et<H;){ht=U[et];var Tt=I[ht],Mt=P[ht];if(B)var Ft=G?B(Mt,Tt,ht,P,I,O):B(Tt,Mt,ht,I,P,O);if(!(Ft===void 0?Tt===Mt||R(Tt,Mt,L,B,O):Ft)){Pt=!1;break}qt||(qt=ht=="constructor")}if(Pt&&!qt){var Jt=I.constructor,te=P.constructor;Jt!=te&&"constructor"in I&&"constructor"in P&&!(typeof Jt=="function"&&Jt instanceof Jt&&typeof te=="function"&&te instanceof te)&&(Pt=!1)}return O.delete(I),O.delete(P),Pt}return Wu=b,Wu}var Zu,y0;function S3(){if(y0)return Zu;y0=1;var c=qa(),d=kw(),v=C3(),f=I3(),b=Ji(),I=Ne(),P=qi(),L=Dn(),B=1,R="[object Arguments]",O="[object Array]",G="[object Object]",U=Object.prototype,H=U.hasOwnProperty;function K(q,et,ht,mt,bt,Pt){var qt=I(q),Tt=I(et),Mt=qt?O:b(q),Ft=Tt?O:b(et);Mt=Mt==R?G:Mt,Ft=Ft==R?G:Ft;var Jt=Mt==G,te=Ft==G,ct=Mt==Ft;if(ct&&P(q)){if(!P(et))return!1;qt=!0,Jt=!1}if(ct&&!Jt)return Pt||(Pt=new c),qt||L(q)?d(q,et,ht,mt,bt,Pt):v(q,et,Mt,ht,mt,bt,Pt);if(!(ht&B)){var ue=Jt&&H.call(q,"__wrapped__"),Ae=te&&H.call(et,"__wrapped__");if(ue||Ae){var ir=ue?q.value():q,Pr=Ae?et.value():et;return Pt||(Pt=new c),bt(ir,Pr,ht,mt,Pt)}}return ct?(Pt||(Pt=new c),f(q,et,ht,mt,bt,Pt)):!1}return Zu=K,Zu}var Yu,b0;function Pw(){if(b0)return Yu;b0=1;var c=S3(),d=kr();function v(f,b,I,P,L){return f===b?!0:f==null||b==null||!d(f)&&!d(b)?f!==f&&b!==b:c(f,b,I,P,v,L)}return Yu=v,Yu}var Uu,w0;function M3(){if(w0)return Uu;w0=1;var c=qa(),d=Pw(),v=1,f=2;function b(I,P,L,B){var R=L.length,O=R,G=!B;if(I==null)return!O;for(I=Object(I);R--;){var U=L[R];if(G&&U[2]?U[1]!==I[U[0]]:!(U[0]in I))return!1}for(;++R<O;){U=L[R];var H=U[0],K=I[H],q=U[1];if(G&&U[2]){if(K===void 0&&!(H in I))return!1}else{var et=new c;if(B)var ht=B(K,q,H,I,P,et);if(!(ht===void 0?d(q,K,v|f,B,et):ht))return!1}}return!0}return Uu=b,Uu}var Xu,x0;function Tw(){if(x0)return Xu;x0=1;var c=fr();function d(v){return v===v&&!c(v)}return Xu=d,Xu}var Hu,A0;function k3(){if(A0)return Hu;A0=1;var c=Tw(),d=ii();function v(f){for(var b=d(f),I=b.length;I--;){var P=b[I],L=f[P];b[I]=[P,L,c(L)]}return b}return Hu=v,Hu}var qu,C0;function Nw(){if(C0)return qu;C0=1;function c(d,v){return function(f){return f==null?!1:f[d]===v&&(v!==void 0||d in Object(f))}}return qu=c,qu}var Ju,I0;function P3(){if(I0)return Ju;I0=1;var c=M3(),d=k3(),v=Nw();function f(b){var I=d(b);return I.length==1&&I[0][2]?v(I[0][0],I[0][1]):function(P){return P===b||c(P,b,I)}}return Ju=f,Ju}var Ku,S0;function Ki(){if(S0)return Ku;S0=1;var c=yi(),d=kr(),v="[object Symbol]";function f(b){return typeof b=="symbol"||d(b)&&c(b)==v}return Ku=f,Ku}var Qu,M0;function Gd(){if(M0)return Qu;M0=1;var c=Ne(),d=Ki(),v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,f=/^\w*$/;function b(I,P){if(c(I))return!1;var L=typeof I;return L=="number"||L=="symbol"||L=="boolean"||I==null||d(I)?!0:f.test(I)||!v.test(I)||P!=null&&I in Object(P)}return Qu=b,Qu}var $u,k0;function T3(){if(k0)return $u;k0=1;var c=kd(),d="Expected a function";function v(f,b){if(typeof f!="function"||b!=null&&typeof b!="function")throw new TypeError(d);var I=function(){var P=arguments,L=b?b.apply(this,P):P[0],B=I.cache;if(B.has(L))return B.get(L);var R=f.apply(this,P);return I.cache=B.set(L,R)||B,R};return I.cache=new(v.Cache||c),I}return v.Cache=c,$u=v,$u}var th,P0;function N3(){if(P0)return th;P0=1;var c=T3(),d=500;function v(f){var b=c(f,function(P){return I.size===d&&I.clear(),P}),I=b.cache;return b}return th=v,th}var eh,T0;function L3(){if(T0)return eh;T0=1;var c=N3(),d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/\\(\\)?/g,f=c(function(b){var I=[];return b.charCodeAt(0)===46&&I.push(""),b.replace(d,function(P,L,B,R){I.push(B?R.replace(v,"$1"):L||P)}),I});return eh=f,eh}var rh,N0;function io(){if(N0)return rh;N0=1;function c(d,v){for(var f=-1,b=d==null?0:d.length,I=Array(b);++f<b;)I[f]=v(d[f],f,d);return I}return rh=c,rh}var ih,L0;function E3(){if(L0)return ih;L0=1;var c=Hi(),d=io(),v=Ne(),f=Ki(),b=1/0,I=c?c.prototype:void 0,P=I?I.toString:void 0;function L(B){if(typeof B=="string")return B;if(v(B))return d(B,L)+"";if(f(B))return P?P.call(B):"";var R=B+"";return R=="0"&&1/B==-b?"-0":R}return ih=L,ih}var nh,E0;function Lw(){if(E0)return nh;E0=1;var c=E3();function d(v){return v==null?"":c(v)}return nh=d,nh}var ah,D0;function no(){if(D0)return ah;D0=1;var c=Ne(),d=Gd(),v=L3(),f=Lw();function b(I,P){return c(I)?I:d(I,P)?[I]:v(f(I))}return ah=b,ah}var oh,z0;function zn(){if(z0)return oh;z0=1;var c=Ki(),d=1/0;function v(f){if(typeof f=="string"||c(f))return f;var b=f+"";return b=="0"&&1/f==-d?"-0":b}return oh=v,oh}var sh,B0;function ao(){if(B0)return sh;B0=1;var c=no(),d=zn();function v(f,b){b=c(b,f);for(var I=0,P=b.length;f!=null&&I<P;)f=f[d(b[I++])];return I&&I==P?f:void 0}return sh=v,sh}var lh,O0;function D3(){if(O0)return lh;O0=1;var c=ao();function d(v,f,b){var I=v==null?void 0:c(v,f);return I===void 0?b:I}return lh=d,lh}var uh,R0;function z3(){if(R0)return uh;R0=1;function c(d,v){return d!=null&&v in Object(d)}return uh=c,uh}var hh,_0;function Ew(){if(_0)return hh;_0=1;var c=no(),d=En(),v=Ne(),f=Qa(),b=Td(),I=zn();function P(L,B,R){B=c(B,L);for(var O=-1,G=B.length,U=!1;++O<G;){var H=I(B[O]);if(!(U=L!=null&&R(L,H)))break;L=L[H]}return U||++O!=G?U:(G=L==null?0:L.length,!!G&&b(G)&&f(H,G)&&(v(L)||d(L)))}return hh=P,hh}var ch,G0;function Dw(){if(G0)return ch;G0=1;var c=z3(),d=Ew();function v(f,b){return f!=null&&d(f,b,c)}return ch=v,ch}var dh,j0;function B3(){if(j0)return dh;j0=1;var c=Pw(),d=D3(),v=Dw(),f=Gd(),b=Tw(),I=Nw(),P=zn(),L=1,B=2;function R(O,G){return f(O)&&b(G)?I(P(O),G):function(U){var H=d(U,O);return H===void 0&&H===G?v(U,O):c(G,H,L|B)}}return dh=R,dh}var fh,F0;function zw(){if(F0)return fh;F0=1;function c(d){return function(v){return v==null?void 0:v[d]}}return fh=c,fh}var gh,V0;function O3(){if(V0)return gh;V0=1;var c=ao();function d(v){return function(f){return c(f,v)}}return gh=d,gh}var vh,W0;function R3(){if(W0)return vh;W0=1;var c=zw(),d=O3(),v=Gd(),f=zn();function b(I){return v(I)?c(f(I)):d(I)}return vh=b,vh}var ph,Z0;function Fr(){if(Z0)return ph;Z0=1;var c=P3(),d=B3(),v=xi(),f=Ne(),b=R3();function I(P){return typeof P=="function"?P:P==null?v:typeof P=="object"?f(P)?d(P[0],P[1]):c(P):b(P)}return ph=I,ph}var mh,Y0;function Bw(){if(Y0)return mh;Y0=1;var c=cw(),d=y3(),v=Fr(),f=Ne();function b(I,P){var L=f(I)?c:d;return L(I,v(P,3))}return mh=b,mh}var yh,U0;function _3(){if(U0)return yh;U0=1;var c=Object.prototype,d=c.hasOwnProperty;function v(f,b){return f!=null&&d.call(f,b)}return yh=v,yh}var bh,X0;function Ow(){if(X0)return bh;X0=1;var c=_3(),d=Ew();function v(f,b){return f!=null&&d(f,b,c)}return bh=v,bh}var wh,H0;function G3(){if(H0)return wh;H0=1;var c=Ld(),d=Ji(),v=En(),f=Ne(),b=jr(),I=qi(),P=to(),L=Dn(),B="[object Map]",R="[object Set]",O=Object.prototype,G=O.hasOwnProperty;function U(H){if(H==null)return!0;if(b(H)&&(f(H)||typeof H=="string"||typeof H.splice=="function"||I(H)||L(H)||v(H)))return!H.length;var K=d(H);if(K==B||K==R)return!H.size;if(P(H))return!c(H).length;for(var q in H)if(G.call(H,q))return!1;return!0}return wh=U,wh}var xh,q0;function Rw(){if(q0)return xh;q0=1;function c(d){return d===void 0}return xh=c,xh}var Ah,J0;function _w(){if(J0)return Ah;J0=1;var c=ro(),d=jr();function v(f,b){var I=-1,P=d(f)?Array(f.length):[];return c(f,function(L,B,R){P[++I]=b(L,B,R)}),P}return Ah=v,Ah}var Ch,K0;function Gw(){if(K0)return Ch;K0=1;var c=io(),d=Fr(),v=_w(),f=Ne();function b(I,P){var L=f(I)?c:v;return L(I,d(P,3))}return Ch=b,Ch}var Ih,Q0;function j3(){if(Q0)return Ih;Q0=1;function c(d,v,f,b){var I=-1,P=d==null?0:d.length;for(b&&P&&(f=d[++I]);++I<P;)f=v(f,d[I],I,d);return f}return Ih=c,Ih}var Sh,$0;function F3(){if($0)return Sh;$0=1;function c(d,v,f,b,I){return I(d,function(P,L,B){f=b?(b=!1,P):v(f,P,L,B)}),f}return Sh=c,Sh}var Mh,ty;function jw(){if(ty)return Mh;ty=1;var c=j3(),d=ro(),v=Fr(),f=F3(),b=Ne();function I(P,L,B){var R=b(P)?c:f,O=arguments.length<3;return R(P,v(L,4),B,O,d)}return Mh=I,Mh}var kh,ey;function V3(){if(ey)return kh;ey=1;var c=yi(),d=Ne(),v=kr(),f="[object String]";function b(I){return typeof I=="string"||!d(I)&&v(I)&&c(I)==f}return kh=b,kh}var Ph,ry;function W3(){if(ry)return Ph;ry=1;var c=zw(),d=c("length");return Ph=d,Ph}var Th,iy;function Z3(){if(iy)return Th;iy=1;var c="\\ud800-\\udfff",d="\\u0300-\\u036f",v="\\ufe20-\\ufe2f",f="\\u20d0-\\u20ff",b=d+v+f,I="\\ufe0e\\ufe0f",P="\\u200d",L=RegExp("["+P+c+b+I+"]");function B(R){return L.test(R)}return Th=B,Th}var Nh,ny;function Y3(){if(ny)return Nh;ny=1;var c="\\ud800-\\udfff",d="\\u0300-\\u036f",v="\\ufe20-\\ufe2f",f="\\u20d0-\\u20ff",b=d+v+f,I="\\ufe0e\\ufe0f",P="["+c+"]",L="["+b+"]",B="\\ud83c[\\udffb-\\udfff]",R="(?:"+L+"|"+B+")",O="[^"+c+"]",G="(?:\\ud83c[\\udde6-\\uddff]){2}",U="[\\ud800-\\udbff][\\udc00-\\udfff]",H="\\u200d",K=R+"?",q="["+I+"]?",et="(?:"+H+"(?:"+[O,G,U].join("|")+")"+q+K+")*",ht=q+K+et,mt="(?:"+[O+L+"?",L,G,U,P].join("|")+")",bt=RegExp(B+"(?="+B+")|"+mt+ht,"g");function Pt(qt){for(var Tt=bt.lastIndex=0;bt.test(qt);)++Tt;return Tt}return Nh=Pt,Nh}var Lh,ay;function U3(){if(ay)return Lh;ay=1;var c=W3(),d=Z3(),v=Y3();function f(b){return d(b)?v(b):c(b)}return Lh=f,Lh}var Eh,oy;function X3(){if(oy)return Eh;oy=1;var c=Ld(),d=Ji(),v=jr(),f=V3(),b=U3(),I="[object Map]",P="[object Set]";function L(B){if(B==null)return 0;if(v(B))return f(B)?b(B):B.length;var R=d(B);return R==I||R==P?B.size:c(B).length}return Eh=L,Eh}var Dh,sy;function H3(){if(sy)return Dh;sy=1;var c=Pd(),d=bw(),v=Rd(),f=Fr(),b=eo(),I=Ne(),P=qi(),L=Nn(),B=fr(),R=Dn();function O(G,U,H){var K=I(G),q=K||P(G)||R(G);if(U=f(U,4),H==null){var et=G&&G.constructor;q?H=K?new et:[]:B(G)?H=L(et)?d(b(G)):{}:H={}}return(q?c:v)(G,function(ht,mt,bt){return U(H,ht,mt,bt)}),H}return Dh=O,Dh}var zh,ly;function q3(){if(ly)return zh;ly=1;var c=Hi(),d=En(),v=Ne(),f=c?c.isConcatSpreadable:void 0;function b(I){return v(I)||d(I)||!!(f&&I&&I[f])}return zh=b,zh}var Bh,uy;function jd(){if(uy)return Bh;uy=1;var c=Dd(),d=q3();function v(f,b,I,P,L){var B=-1,R=f.length;for(I||(I=d),L||(L=[]);++B<R;){var O=f[B];b>0&&I(O)?b>1?v(O,b-1,I,P,L):c(L,O):P||(L[L.length]=O)}return L}return Bh=v,Bh}var Oh,hy;function J3(){if(hy)return Oh;hy=1;function c(d,v,f){switch(f.length){case 0:return d.call(v);case 1:return d.call(v,f[0]);case 2:return d.call(v,f[0],f[1]);case 3:return d.call(v,f[0],f[1],f[2])}return d.apply(v,f)}return Oh=c,Oh}var Rh,cy;function Fw(){if(cy)return Rh;cy=1;var c=J3(),d=Math.max;function v(f,b,I){return b=d(b===void 0?f.length-1:b,0),function(){for(var P=arguments,L=-1,B=d(P.length-b,0),R=Array(B);++L<B;)R[L]=P[b+L];L=-1;for(var O=Array(b+1);++L<b;)O[L]=P[L];return O[b]=I(R),c(f,this,O)}}return Rh=v,Rh}var _h,dy;function K3(){if(dy)return _h;dy=1;var c=Bd(),d=ow(),v=xi(),f=d?function(b,I){return d(b,"toString",{configurable:!0,enumerable:!1,value:c(I),writable:!0})}:v;return _h=f,_h}var Gh,fy;function Q3(){if(fy)return Gh;fy=1;var c=800,d=16,v=Date.now;function f(b){var I=0,P=0;return function(){var L=v(),B=d-(L-P);if(P=L,B>0){if(++I>=c)return arguments[0]}else I=0;return b.apply(void 0,arguments)}}return Gh=f,Gh}var jh,gy;function Vw(){if(gy)return jh;gy=1;var c=K3(),d=Q3(),v=d(c);return jh=v,jh}var Fh,vy;function oo(){if(vy)return Fh;vy=1;var c=xi(),d=Fw(),v=Vw();function f(b,I){return v(d(b,I,c),b+"")}return Fh=f,Fh}var Vh,py;function Ww(){if(py)return Vh;py=1;function c(d,v,f,b){for(var I=d.length,P=f+(b?1:-1);b?P--:++P<I;)if(v(d[P],P,d))return P;return-1}return Vh=c,Vh}var Wh,my;function $3(){if(my)return Wh;my=1;function c(d){return d!==d}return Wh=c,Wh}var Zh,yy;function tP(){if(yy)return Zh;yy=1;function c(d,v,f){for(var b=f-1,I=d.length;++b<I;)if(d[b]===v)return b;return-1}return Zh=c,Zh}var Yh,by;function eP(){if(by)return Yh;by=1;var c=Ww(),d=$3(),v=tP();function f(b,I,P){return I===I?v(b,I,P):c(b,d,P)}return Yh=f,Yh}var Uh,wy;function rP(){if(wy)return Uh;wy=1;var c=eP();function d(v,f){var b=v==null?0:v.length;return!!b&&c(v,f,0)>-1}return Uh=d,Uh}var Xh,xy;function iP(){if(xy)return Xh;xy=1;function c(d,v,f){for(var b=-1,I=d==null?0:d.length;++b<I;)if(f(v,d[b]))return!0;return!1}return Xh=c,Xh}var Hh,Ay;function nP(){if(Ay)return Hh;Ay=1;function c(){}return Hh=c,Hh}var qh,Cy;function aP(){if(Cy)return qh;Cy=1;var c=pw(),d=nP(),v=_d(),f=1/0,b=c&&1/v(new c([,-0]))[1]==f?function(I){return new c(I)}:d;return qh=b,qh}var Jh,Iy;function oP(){if(Iy)return Jh;Iy=1;var c=Sw(),d=rP(),v=iP(),f=Mw(),b=aP(),I=_d(),P=200;function L(B,R,O){var G=-1,U=d,H=B.length,K=!0,q=[],et=q;if(O)K=!1,U=v;else if(H>=P){var ht=R?null:b(B);if(ht)return I(ht);K=!1,U=f,et=new c}else et=R?[]:q;t:for(;++G<H;){var mt=B[G],bt=R?R(mt):mt;if(mt=O||mt!==0?mt:0,K&&bt===bt){for(var Pt=et.length;Pt--;)if(et[Pt]===bt)continue t;R&&et.push(bt),q.push(mt)}else U(et,bt,O)||(et!==q&&et.push(bt),q.push(mt))}return q}return Jh=L,Jh}var Kh,Sy;function Zw(){if(Sy)return Kh;Sy=1;var c=jr(),d=kr();function v(f){return d(f)&&c(f)}return Kh=v,Kh}var Qh,My;function sP(){if(My)return Qh;My=1;var c=jd(),d=oo(),v=oP(),f=Zw(),b=d(function(I){return v(c(I,1,f,!0))});return Qh=b,Qh}var $h,ky;function lP(){if(ky)return $h;ky=1;var c=io();function d(v,f){return c(f,function(b){return v[b]})}return $h=d,$h}var tc,Py;function Yw(){if(Py)return tc;Py=1;var c=lP(),d=ii();function v(f){return f==null?[]:c(f,d(f))}return tc=v,tc}var ec,Ty;function gr(){if(Ty)return ec;Ty=1;var c;if(typeof Sd=="function")try{c={clone:v3(),constant:Bd(),each:Iw(),filter:Bw(),has:Ow(),isArray:Ne(),isEmpty:G3(),isFunction:Nn(),isUndefined:Rw(),keys:ii(),map:Gw(),reduce:jw(),size:X3(),transform:H3(),union:sP(),values:Yw()}}catch{}return c||(c=window._),ec=c,ec}var rc,Ny;function Fd(){if(Ny)return rc;Ny=1;var c=gr();rc=b;var d="\0",v="\0",f="";function b(O){this._isDirected=c.has(O,"directed")?O.directed:!0,this._isMultigraph=c.has(O,"multigraph")?O.multigraph:!1,this._isCompound=c.has(O,"compound")?O.compound:!1,this._label=void 0,this._defaultNodeLabelFn=c.constant(void 0),this._defaultEdgeLabelFn=c.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[v]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}b.prototype._nodeCount=0,b.prototype._edgeCount=0,b.prototype.isDirected=function(){return this._isDirected},b.prototype.isMultigraph=function(){return this._isMultigraph},b.prototype.isCompound=function(){return this._isCompound},b.prototype.setGraph=function(O){return this._label=O,this},b.prototype.graph=function(){return this._label},b.prototype.setDefaultNodeLabel=function(O){return c.isFunction(O)||(O=c.constant(O)),this._defaultNodeLabelFn=O,this},b.prototype.nodeCount=function(){return this._nodeCount},b.prototype.nodes=function(){return c.keys(this._nodes)},b.prototype.sources=function(){var O=this;return c.filter(this.nodes(),function(G){return c.isEmpty(O._in[G])})},b.prototype.sinks=function(){var O=this;return c.filter(this.nodes(),function(G){return c.isEmpty(O._out[G])})},b.prototype.setNodes=function(O,G){var U=arguments,H=this;return c.each(O,function(K){U.length>1?H.setNode(K,G):H.setNode(K)}),this},b.prototype.setNode=function(O,G){return c.has(this._nodes,O)?(arguments.length>1&&(this._nodes[O]=G),this):(this._nodes[O]=arguments.length>1?G:this._defaultNodeLabelFn(O),this._isCompound&&(this._parent[O]=v,this._children[O]={},this._children[v][O]=!0),this._in[O]={},this._preds[O]={},this._out[O]={},this._sucs[O]={},++this._nodeCount,this)},b.prototype.node=function(O){return this._nodes[O]},b.prototype.hasNode=function(O){return c.has(this._nodes,O)},b.prototype.removeNode=function(O){var G=this;if(c.has(this._nodes,O)){var U=function(H){G.removeEdge(G._edgeObjs[H])};delete this._nodes[O],this._isCompound&&(this._removeFromParentsChildList(O),delete this._parent[O],c.each(this.children(O),function(H){G.setParent(H)}),delete this._children[O]),c.each(c.keys(this._in[O]),U),delete this._in[O],delete this._preds[O],c.each(c.keys(this._out[O]),U),delete this._out[O],delete this._sucs[O],--this._nodeCount}return this},b.prototype.setParent=function(O,G){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(c.isUndefined(G))G=v;else{G+="";for(var U=G;!c.isUndefined(U);U=this.parent(U))if(U===O)throw new Error("Setting "+G+" as parent of "+O+" would create a cycle");this.setNode(G)}return this.setNode(O),this._removeFromParentsChildList(O),this._parent[O]=G,this._children[G][O]=!0,this},b.prototype._removeFromParentsChildList=function(O){delete this._children[this._parent[O]][O]},b.prototype.parent=function(O){if(this._isCompound){var G=this._parent[O];if(G!==v)return G}},b.prototype.children=function(O){if(c.isUndefined(O)&&(O=v),this._isCompound){var G=this._children[O];if(G)return c.keys(G)}else{if(O===v)return this.nodes();if(this.hasNode(O))return[]}},b.prototype.predecessors=function(O){var G=this._preds[O];if(G)return c.keys(G)},b.prototype.successors=function(O){var G=this._sucs[O];if(G)return c.keys(G)},b.prototype.neighbors=function(O){var G=this.predecessors(O);if(G)return c.union(G,this.successors(O))},b.prototype.isLeaf=function(O){var G;return this.isDirected()?G=this.successors(O):G=this.neighbors(O),G.length===0},b.prototype.filterNodes=function(O){var G=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});G.setGraph(this.graph());var U=this;c.each(this._nodes,function(q,et){O(et)&&G.setNode(et,q)}),c.each(this._edgeObjs,function(q){G.hasNode(q.v)&&G.hasNode(q.w)&&G.setEdge(q,U.edge(q))});var H={};function K(q){var et=U.parent(q);return et===void 0||G.hasNode(et)?(H[q]=et,et):et in H?H[et]:K(et)}return this._isCompound&&c.each(G.nodes(),function(q){G.setParent(q,K(q))}),G},b.prototype.setDefaultEdgeLabel=function(O){return c.isFunction(O)||(O=c.constant(O)),this._defaultEdgeLabelFn=O,this},b.prototype.edgeCount=function(){return this._edgeCount},b.prototype.edges=function(){return c.values(this._edgeObjs)},b.prototype.setPath=function(O,G){var U=this,H=arguments;return c.reduce(O,function(K,q){return H.length>1?U.setEdge(K,q,G):U.setEdge(K,q),q}),this},b.prototype.setEdge=function(){var O,G,U,H,K=!1,q=arguments[0];typeof q=="object"&&q!==null&&"v"in q?(O=q.v,G=q.w,U=q.name,arguments.length===2&&(H=arguments[1],K=!0)):(O=q,G=arguments[1],U=arguments[3],arguments.length>2&&(H=arguments[2],K=!0)),O=""+O,G=""+G,c.isUndefined(U)||(U=""+U);var et=L(this._isDirected,O,G,U);if(c.has(this._edgeLabels,et))return K&&(this._edgeLabels[et]=H),this;if(!c.isUndefined(U)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(O),this.setNode(G),this._edgeLabels[et]=K?H:this._defaultEdgeLabelFn(O,G,U);var ht=B(this._isDirected,O,G,U);return O=ht.v,G=ht.w,Object.freeze(ht),this._edgeObjs[et]=ht,I(this._preds[G],O),I(this._sucs[O],G),this._in[G][et]=ht,this._out[O][et]=ht,this._edgeCount++,this},b.prototype.edge=function(O,G,U){var H=arguments.length===1?R(this._isDirected,arguments[0]):L(this._isDirected,O,G,U);return this._edgeLabels[H]},b.prototype.hasEdge=function(O,G,U){var H=arguments.length===1?R(this._isDirected,arguments[0]):L(this._isDirected,O,G,U);return c.has(this._edgeLabels,H)},b.prototype.removeEdge=function(O,G,U){var H=arguments.length===1?R(this._isDirected,arguments[0]):L(this._isDirected,O,G,U),K=this._edgeObjs[H];return K&&(O=K.v,G=K.w,delete this._edgeLabels[H],delete this._edgeObjs[H],P(this._preds[G],O),P(this._sucs[O],G),delete this._in[G][H],delete this._out[O][H],this._edgeCount--),this},b.prototype.inEdges=function(O,G){var U=this._in[O];if(U){var H=c.values(U);return G?c.filter(H,function(K){return K.v===G}):H}},b.prototype.outEdges=function(O,G){var U=this._out[O];if(U){var H=c.values(U);return G?c.filter(H,function(K){return K.w===G}):H}},b.prototype.nodeEdges=function(O,G){var U=this.inEdges(O,G);if(U)return U.concat(this.outEdges(O,G))};function I(O,G){O[G]?O[G]++:O[G]=1}function P(O,G){--O[G]||delete O[G]}function L(O,G,U,H){var K=""+G,q=""+U;if(!O&&K>q){var et=K;K=q,q=et}return K+f+q+f+(c.isUndefined(H)?d:H)}function B(O,G,U,H){var K=""+G,q=""+U;if(!O&&K>q){var et=K;K=q,q=et}var ht={v:K,w:q};return H&&(ht.name=H),ht}function R(O,G){return L(O,G.v,G.w,G.name)}return rc}var ic,Ly;function uP(){return Ly||(Ly=1,ic="2.1.8"),ic}var nc,Ey;function hP(){return Ey||(Ey=1,nc={Graph:Fd(),version:uP()}),nc}var ac,Dy;function cP(){if(Dy)return ac;Dy=1;var c=gr(),d=Fd();ac={write:v,read:I};function v(P){var L={options:{directed:P.isDirected(),multigraph:P.isMultigraph(),compound:P.isCompound()},nodes:f(P),edges:b(P)};return c.isUndefined(P.graph())||(L.value=c.clone(P.graph())),L}function f(P){return c.map(P.nodes(),function(L){var B=P.node(L),R=P.parent(L),O={v:L};return c.isUndefined(B)||(O.value=B),c.isUndefined(R)||(O.parent=R),O})}function b(P){return c.map(P.edges(),function(L){var B=P.edge(L),R={v:L.v,w:L.w};return c.isUndefined(L.name)||(R.name=L.name),c.isUndefined(B)||(R.value=B),R})}function I(P){var L=new d(P.options).setGraph(P.value);return c.each(P.nodes,function(B){L.setNode(B.v,B.value),B.parent&&L.setParent(B.v,B.parent)}),c.each(P.edges,function(B){L.setEdge({v:B.v,w:B.w,name:B.name},B.value)}),L}return ac}var oc,zy;function dP(){if(zy)return oc;zy=1;var c=gr();oc=d;function d(v){var f={},b=[],I;function P(L){c.has(f,L)||(f[L]=!0,I.push(L),c.each(v.successors(L),P),c.each(v.predecessors(L),P))}return c.each(v.nodes(),function(L){I=[],P(L),I.length&&b.push(I)}),b}return oc}var sc,By;function Uw(){if(By)return sc;By=1;var c=gr();sc=d;function d(){this._arr=[],this._keyIndices={}}return d.prototype.size=function(){return this._arr.length},d.prototype.keys=function(){return this._arr.map(function(v){return v.key})},d.prototype.has=function(v){return c.has(this._keyIndices,v)},d.prototype.priority=function(v){var f=this._keyIndices[v];if(f!==void 0)return this._arr[f].priority},d.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},d.prototype.add=function(v,f){var b=this._keyIndices;if(v=String(v),!c.has(b,v)){var I=this._arr,P=I.length;return b[v]=P,I.push({key:v,priority:f}),this._decrease(P),!0}return!1},d.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var v=this._arr.pop();return delete this._keyIndices[v.key],this._heapify(0),v.key},d.prototype.decrease=function(v,f){var b=this._keyIndices[v];if(f>this._arr[b].priority)throw new Error("New priority is greater than current priority. Key: "+v+" Old: "+this._arr[b].priority+" New: "+f);this._arr[b].priority=f,this._decrease(b)},d.prototype._heapify=function(v){var f=this._arr,b=2*v,I=b+1,P=v;b<f.length&&(P=f[b].priority<f[P].priority?b:P,I<f.length&&(P=f[I].priority<f[P].priority?I:P),P!==v&&(this._swap(v,P),this._heapify(P)))},d.prototype._decrease=function(v){for(var f=this._arr,b=f[v].priority,I;v!==0&&(I=v>>1,!(f[I].priority<b));)this._swap(v,I),v=I},d.prototype._swap=function(v,f){var b=this._arr,I=this._keyIndices,P=b[v],L=b[f];b[v]=L,b[f]=P,I[L.key]=v,I[P.key]=f},sc}var lc,Oy;function Xw(){if(Oy)return lc;Oy=1;var c=gr(),d=Uw();lc=f;var v=c.constant(1);function f(I,P,L,B){return b(I,String(P),L||v,B||function(R){return I.outEdges(R)})}function b(I,P,L,B){var R={},O=new d,G,U,H=function(K){var q=K.v!==G?K.v:K.w,et=R[q],ht=L(K),mt=U.distance+ht;if(ht<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+K+" Weight: "+ht);mt<et.distance&&(et.distance=mt,et.predecessor=G,O.decrease(q,mt))};for(I.nodes().forEach(function(K){var q=K===P?0:Number.POSITIVE_INFINITY;R[K]={distance:q},O.add(K,q)});O.size()>0&&(G=O.removeMin(),U=R[G],U.distance!==Number.POSITIVE_INFINITY);)B(G).forEach(H);return R}return lc}var uc,Ry;function fP(){if(Ry)return uc;Ry=1;var c=Xw(),d=gr();uc=v;function v(f,b,I){return d.transform(f.nodes(),function(P,L){P[L]=c(f,L,b,I)},{})}return uc}var hc,_y;function Hw(){if(_y)return hc;_y=1;var c=gr();hc=d;function d(v){var f=0,b=[],I={},P=[];function L(B){var R=I[B]={onStack:!0,lowlink:f,index:f++};if(b.push(B),v.successors(B).forEach(function(U){c.has(I,U)?I[U].onStack&&(R.lowlink=Math.min(R.lowlink,I[U].index)):(L(U),R.lowlink=Math.min(R.lowlink,I[U].lowlink))}),R.lowlink===R.index){var O=[],G;do G=b.pop(),I[G].onStack=!1,O.push(G);while(B!==G);P.push(O)}}return v.nodes().forEach(function(B){c.has(I,B)||L(B)}),P}return hc}var cc,Gy;function gP(){if(Gy)return cc;Gy=1;var c=gr(),d=Hw();cc=v;function v(f){return c.filter(d(f),function(b){return b.length>1||b.length===1&&f.hasEdge(b[0],b[0])})}return cc}var dc,jy;function vP(){if(jy)return dc;jy=1;var c=gr();dc=v;var d=c.constant(1);function v(b,I,P){return f(b,I||d,P||function(L){return b.outEdges(L)})}function f(b,I,P){var L={},B=b.nodes();return B.forEach(function(R){L[R]={},L[R][R]={distance:0},B.forEach(function(O){R!==O&&(L[R][O]={distance:Number.POSITIVE_INFINITY})}),P(R).forEach(function(O){var G=O.v===R?O.w:O.v,U=I(O);L[R][G]={distance:U,predecessor:R}})}),B.forEach(function(R){var O=L[R];B.forEach(function(G){var U=L[G];B.forEach(function(H){var K=U[R],q=O[H],et=U[H],ht=K.distance+q.distance;ht<et.distance&&(et.distance=ht,et.predecessor=q.predecessor)})})}),L}return dc}var fc,Fy;function qw(){if(Fy)return fc;Fy=1;var c=gr();fc=d,d.CycleException=v;function d(f){var b={},I={},P=[];function L(B){if(c.has(I,B))throw new v;c.has(b,B)||(I[B]=!0,b[B]=!0,c.each(f.predecessors(B),L),delete I[B],P.push(B))}if(c.each(f.sinks(),L),c.size(b)!==f.nodeCount())throw new v;return P}function v(){}return v.prototype=new Error,fc}var gc,Vy;function pP(){if(Vy)return gc;Vy=1;var c=qw();gc=d;function d(v){try{c(v)}catch(f){if(f instanceof c.CycleException)return!1;throw f}return!0}return gc}var vc,Wy;function Jw(){if(Wy)return vc;Wy=1;var c=gr();vc=d;function d(f,b,I){c.isArray(b)||(b=[b]);var P=(f.isDirected()?f.successors:f.neighbors).bind(f),L=[],B={};return c.each(b,function(R){if(!f.hasNode(R))throw new Error("Graph does not have node: "+R);v(f,R,I==="post",B,P,L)}),L}function v(f,b,I,P,L,B){c.has(P,b)||(P[b]=!0,I||B.push(b),c.each(L(b),function(R){v(f,R,I,P,L,B)}),I&&B.push(b))}return vc}var pc,Zy;function mP(){if(Zy)return pc;Zy=1;var c=Jw();pc=d;function d(v,f){return c(v,f,"post")}return pc}var mc,Yy;function yP(){if(Yy)return mc;Yy=1;var c=Jw();mc=d;function d(v,f){return c(v,f,"pre")}return mc}var yc,Uy;function bP(){if(Uy)return yc;Uy=1;var c=gr(),d=Fd(),v=Uw();yc=f;function f(b,I){var P=new d,L={},B=new v,R;function O(U){var H=U.v===R?U.w:U.v,K=B.priority(H);if(K!==void 0){var q=I(U);q<K&&(L[H]=R,B.decrease(H,q))}}if(b.nodeCount()===0)return P;c.each(b.nodes(),function(U){B.add(U,Number.POSITIVE_INFINITY),P.setNode(U)}),B.decrease(b.nodes()[0],0);for(var G=!1;B.size()>0;){if(R=B.removeMin(),c.has(L,R))P.setEdge(R,L[R]);else{if(G)throw new Error("Input graph is not connected: "+b);G=!0}b.nodeEdges(R).forEach(O)}return P}return yc}var bc,Xy;function wP(){return Xy||(Xy=1,bc={components:dP(),dijkstra:Xw(),dijkstraAll:fP(),findCycles:gP(),floydWarshall:vP(),isAcyclic:pP(),postorder:mP(),preorder:yP(),prim:bP(),tarjan:Hw(),topsort:qw()}),bc}var wc,Hy;function xP(){if(Hy)return wc;Hy=1;var c=hP();return wc={Graph:c.Graph,json:cP(),alg:wP(),version:c.version},wc}var Da;if(typeof Sd=="function")try{Da=xP()}catch{}Da||(Da=window.graphlib);var xr=Da,xc,qy;function AP(){if(qy)return xc;qy=1;var c=xw(),d=1,v=4;function f(b){return c(b,d|v)}return xc=f,xc}var Ac,Jy;function so(){if(Jy)return Ac;Jy=1;var c=Xi(),d=jr(),v=Qa(),f=fr();function b(I,P,L){if(!f(L))return!1;var B=typeof P;return(B=="number"?d(L)&&v(P,L.length):B=="string"&&P in L)?c(L[P],I):!1}return Ac=b,Ac}var Cc,Ky;function CP(){if(Ky)return Cc;Ky=1;var c=oo(),d=Xi(),v=so(),f=wi(),b=Object.prototype,I=b.hasOwnProperty,P=c(function(L,B){L=Object(L);var R=-1,O=B.length,G=O>2?B[2]:void 0;for(G&&v(B[0],B[1],G)&&(O=1);++R<O;)for(var U=B[R],H=f(U),K=-1,q=H.length;++K<q;){var et=H[K],ht=L[et];(ht===void 0||d(ht,b[et])&&!I.call(L,et))&&(L[et]=U[et])}return L});return Cc=P,Cc}var Ic,Qy;function IP(){if(Qy)return Ic;Qy=1;var c=Fr(),d=jr(),v=ii();function f(b){return function(I,P,L){var B=Object(I);if(!d(I)){var R=c(P,3);I=v(I),P=function(G){return R(B[G],G,B)}}var O=b(I,P,L);return O>-1?B[R?I[O]:O]:void 0}}return Ic=f,Ic}var Sc,$y;function SP(){if($y)return Sc;$y=1;var c=/\s/;function d(v){for(var f=v.length;f--&&c.test(v.charAt(f)););return f}return Sc=d,Sc}var Mc,tb;function MP(){if(tb)return Mc;tb=1;var c=SP(),d=/^\s+/;function v(f){return f&&f.slice(0,c(f)+1).replace(d,"")}return Mc=v,Mc}var kc,eb;function kP(){if(eb)return kc;eb=1;var c=MP(),d=fr(),v=Ki(),f=0/0,b=/^[-+]0x[0-9a-f]+$/i,I=/^0b[01]+$/i,P=/^0o[0-7]+$/i,L=parseInt;function B(R){if(typeof R=="number")return R;if(v(R))return f;if(d(R)){var O=typeof R.valueOf=="function"?R.valueOf():R;R=d(O)?O+"":O}if(typeof R!="string")return R===0?R:+R;R=c(R);var G=I.test(R);return G||P.test(R)?L(R.slice(2),G?2:8):b.test(R)?f:+R}return kc=B,kc}var Pc,rb;function Kw(){if(rb)return Pc;rb=1;var c=kP(),d=1/0,v=17976931348623157e292;function f(b){if(!b)return b===0?b:0;if(b=c(b),b===d||b===-d){var I=b<0?-1:1;return I*v}return b===b?b:0}return Pc=f,Pc}var Tc,ib;function PP(){if(ib)return Tc;ib=1;var c=Kw();function d(v){var f=c(v),b=f%1;return f===f?b?f-b:f:0}return Tc=d,Tc}var Nc,nb;function TP(){if(nb)return Nc;nb=1;var c=Ww(),d=Fr(),v=PP(),f=Math.max;function b(I,P,L){var B=I==null?0:I.length;if(!B)return-1;var R=L==null?0:v(L);return R<0&&(R=f(B+R,0)),c(I,d(P,3),R)}return Nc=b,Nc}var Lc,ab;function NP(){if(ab)return Lc;ab=1;var c=IP(),d=TP(),v=c(d);return Lc=v,Lc}var Ec,ob;function Qw(){if(ob)return Ec;ob=1;var c=jd();function d(v){var f=v==null?0:v.length;return f?c(v,1):[]}return Ec=d,Ec}var Dc,sb;function LP(){if(sb)return Dc;sb=1;var c=Od(),d=Aw(),v=wi();function f(b,I){return b==null?b:c(b,d(I),v)}return Dc=f,Dc}var zc,lb;function EP(){if(lb)return zc;lb=1;function c(d){var v=d==null?0:d.length;return v?d[v-1]:void 0}return zc=c,zc}var Bc,ub;function DP(){if(ub)return Bc;ub=1;var c=Ja(),d=Rd(),v=Fr();function f(b,I){var P={};return I=v(I,3),d(b,function(L,B,R){c(P,B,I(L,B,R))}),P}return Bc=f,Bc}var Oc,hb;function Vd(){if(hb)return Oc;hb=1;var c=Ki();function d(v,f,b){for(var I=-1,P=v.length;++I<P;){var L=v[I],B=f(L);if(B!=null&&(R===void 0?B===B&&!c(B):b(B,R)))var R=B,O=L}return O}return Oc=d,Oc}var Rc,cb;function zP(){if(cb)return Rc;cb=1;function c(d,v){return d>v}return Rc=c,Rc}var _c,db;function BP(){if(db)return _c;db=1;var c=Vd(),d=zP(),v=xi();function f(b){return b&&b.length?c(b,v,d):void 0}return _c=f,_c}var Gc,fb;function $w(){if(fb)return Gc;fb=1;var c=Ja(),d=Xi();function v(f,b,I){(I!==void 0&&!d(f[b],I)||I===void 0&&!(b in f))&&c(f,b,I)}return Gc=v,Gc}var jc,gb;function OP(){if(gb)return jc;gb=1;var c=yi(),d=eo(),v=kr(),f="[object Object]",b=Function.prototype,I=Object.prototype,P=b.toString,L=I.hasOwnProperty,B=P.call(Object);function R(O){if(!v(O)||c(O)!=f)return!1;var G=d(O);if(G===null)return!0;var U=L.call(G,"constructor")&&G.constructor;return typeof U=="function"&&U instanceof U&&P.call(U)==B}return jc=R,jc}var Fc,vb;function tx(){if(vb)return Fc;vb=1;function c(d,v){if(!(v==="constructor"&&typeof d[v]=="function")&&v!="__proto__")return d[v]}return Fc=c,Fc}var Vc,pb;function RP(){if(pb)return Vc;pb=1;var c=Ln(),d=wi();function v(f){return c(f,d(f))}return Vc=v,Vc}var Wc,mb;function _P(){if(mb)return Wc;mb=1;var c=$w(),d=uw(),v=yw(),f=hw(),b=ww(),I=En(),P=Ne(),L=Zw(),B=qi(),R=Nn(),O=fr(),G=OP(),U=Dn(),H=tx(),K=RP();function q(et,ht,mt,bt,Pt,qt,Tt){var Mt=H(et,mt),Ft=H(ht,mt),Jt=Tt.get(Ft);if(Jt){c(et,mt,Jt);return}var te=qt?qt(Mt,Ft,mt+"",et,ht,Tt):void 0,ct=te===void 0;if(ct){var ue=P(Ft),Ae=!ue&&B(Ft),ir=!ue&&!Ae&&U(Ft);te=Ft,ue||Ae||ir?P(Mt)?te=Mt:L(Mt)?te=f(Mt):Ae?(ct=!1,te=d(Ft,!0)):ir?(ct=!1,te=v(Ft,!0)):te=[]:G(Ft)||I(Ft)?(te=Mt,I(Mt)?te=K(Mt):(!O(Mt)||R(Mt))&&(te=b(Ft))):ct=!1}ct&&(Tt.set(Ft,te),Pt(te,Ft,bt,qt,Tt),Tt.delete(Ft)),c(et,mt,te)}return Wc=q,Wc}var Zc,yb;function GP(){if(yb)return Zc;yb=1;var c=qa(),d=$w(),v=Od(),f=_P(),b=fr(),I=wi(),P=tx();function L(B,R,O,G,U){B!==R&&v(R,function(H,K){if(U||(U=new c),b(H))f(B,R,K,O,L,G,U);else{var q=G?G(P(B,K),H,K+"",B,R,U):void 0;q===void 0&&(q=H),d(B,K,q)}},I)}return Zc=L,Zc}var Yc,bb;function jP(){if(bb)return Yc;bb=1;var c=oo(),d=so();function v(f){return c(function(b,I){var P=-1,L=I.length,B=L>1?I[L-1]:void 0,R=L>2?I[2]:void 0;for(B=f.length>3&&typeof B=="function"?(L--,B):void 0,R&&d(I[0],I[1],R)&&(B=L<3?void 0:B,L=1),b=Object(b);++P<L;){var O=I[P];O&&f(b,O,P,B)}return b})}return Yc=v,Yc}var Uc,wb;function FP(){if(wb)return Uc;wb=1;var c=GP(),d=jP(),v=d(function(f,b,I){c(f,b,I)});return Uc=v,Uc}var Xc,xb;function ex(){if(xb)return Xc;xb=1;function c(d,v){return d<v}return Xc=c,Xc}var Hc,Ab;function VP(){if(Ab)return Hc;Ab=1;var c=Vd(),d=ex(),v=xi();function f(b){return b&&b.length?c(b,v,d):void 0}return Hc=f,Hc}var qc,Cb;function WP(){if(Cb)return qc;Cb=1;var c=Vd(),d=Fr(),v=ex();function f(b,I){return b&&b.length?c(b,d(I,2),v):void 0}return qc=f,qc}var Jc,Ib;function ZP(){if(Ib)return Jc;Ib=1;var c=wr(),d=function(){return c.Date.now()};return Jc=d,Jc}var Kc,Sb;function YP(){if(Sb)return Kc;Sb=1;var c=Ka(),d=no(),v=Qa(),f=fr(),b=zn();function I(P,L,B,R){if(!f(P))return P;L=d(L,P);for(var O=-1,G=L.length,U=G-1,H=P;H!=null&&++O<G;){var K=b(L[O]),q=B;if(K==="__proto__"||K==="constructor"||K==="prototype")return P;if(O!=U){var et=H[K];q=R?R(et,K,H):void 0,q===void 0&&(q=f(et)?et:v(L[O+1])?[]:{})}c(H,K,q),H=H[K]}return P}return Kc=I,Kc}var Qc,Mb;function UP(){if(Mb)return Qc;Mb=1;var c=ao(),d=YP(),v=no();function f(b,I,P){for(var L=-1,B=I.length,R={};++L<B;){var O=I[L],G=c(b,O);P(G,O)&&d(R,v(O,b),G)}return R}return Qc=f,Qc}var $c,kb;function XP(){if(kb)return $c;kb=1;var c=UP(),d=Dw();function v(f,b){return c(f,b,function(I,P){return d(f,P)})}return $c=v,$c}var td,Pb;function HP(){if(Pb)return td;Pb=1;var c=Qw(),d=Fw(),v=Vw();function f(b){return v(d(b,void 0,c),b+"")}return td=f,td}var ed,Tb;function qP(){if(Tb)return ed;Tb=1;var c=XP(),d=HP(),v=d(function(f,b){return f==null?{}:c(f,b)});return ed=v,ed}var rd,Nb;function JP(){if(Nb)return rd;Nb=1;var c=Math.ceil,d=Math.max;function v(f,b,I,P){for(var L=-1,B=d(c((b-f)/(I||1)),0),R=Array(B);B--;)R[P?B:++L]=f,f+=I;return R}return rd=v,rd}var id,Lb;function KP(){if(Lb)return id;Lb=1;var c=JP(),d=so(),v=Kw();function f(b){return function(I,P,L){return L&&typeof L!="number"&&d(I,P,L)&&(P=L=void 0),I=v(I),P===void 0?(P=I,I=0):P=v(P),L=L===void 0?I<P?1:-1:v(L),c(I,P,L,b)}}return id=f,id}var nd,Eb;function QP(){if(Eb)return nd;Eb=1;var c=KP(),d=c();return nd=d,nd}var ad,Db;function $P(){if(Db)return ad;Db=1;function c(d,v){var f=d.length;for(d.sort(v);f--;)d[f]=d[f].value;return d}return ad=c,ad}var od,zb;function tT(){if(zb)return od;zb=1;var c=Ki();function d(v,f){if(v!==f){var b=v!==void 0,I=v===null,P=v===v,L=c(v),B=f!==void 0,R=f===null,O=f===f,G=c(f);if(!R&&!G&&!L&&v>f||L&&B&&O&&!R&&!G||I&&B&&O||!b&&O||!P)return 1;if(!I&&!L&&!G&&v<f||G&&b&&P&&!I&&!L||R&&b&&P||!B&&P||!O)return-1}return 0}return od=d,od}var sd,Bb;function eT(){if(Bb)return sd;Bb=1;var c=tT();function d(v,f,b){for(var I=-1,P=v.criteria,L=f.criteria,B=P.length,R=b.length;++I<B;){var O=c(P[I],L[I]);if(O){if(I>=R)return O;var G=b[I];return O*(G=="desc"?-1:1)}}return v.index-f.index}return sd=d,sd}var ld,Ob;function rT(){if(Ob)return ld;Ob=1;var c=io(),d=ao(),v=Fr(),f=_w(),b=$P(),I=$a(),P=eT(),L=xi(),B=Ne();function R(O,G,U){G.length?G=c(G,function(q){return B(q)?function(et){return d(et,q.length===1?q[0]:q)}:q}):G=[L];var H=-1;G=c(G,I(v));var K=f(O,function(q,et,ht){var mt=c(G,function(bt){return bt(q)});return{criteria:mt,index:++H,value:q}});return b(K,function(q,et){return P(q,et,U)})}return ld=R,ld}var ud,Rb;function iT(){if(Rb)return ud;Rb=1;var c=jd(),d=rT(),v=oo(),f=so(),b=v(function(I,P){if(I==null)return[];var L=P.length;return L>1&&f(I,P[0],P[1])?P=[]:L>2&&f(P[0],P[1],P[2])&&(P=[P[0]]),d(I,c(P,1),[])});return ud=b,ud}var hd,_b;function nT(){if(_b)return hd;_b=1;var c=Lw(),d=0;function v(f){var b=++d;return c(f)+b}return hd=v,hd}var cd,Gb;function aT(){if(Gb)return cd;Gb=1;function c(d,v,f){for(var b=-1,I=d.length,P=v.length,L={};++b<I;){var B=b<P?v[b]:void 0;f(L,d[b],B)}return L}return cd=c,cd}var dd,jb;function oT(){if(jb)return dd;jb=1;var c=Ka(),d=aT();function v(f,b){return d(f||[],b||[],c)}return dd=v,dd}var za;if(typeof Sd=="function")try{za={cloneDeep:AP(),constant:Bd(),defaults:CP(),each:Iw(),filter:Bw(),find:NP(),flatten:Qw(),forEach:Cw(),forIn:LP(),has:Ow(),isUndefined:Rw(),last:EP(),map:Gw(),mapValues:DP(),max:BP(),merge:FP(),min:VP(),minBy:WP(),now:ZP(),pick:qP(),range:QP(),reduce:jw(),sortBy:iT(),uniqueId:nT(),values:Yw(),zipObject:oT()}}catch{}za||(za=window._);var ve=za,sT=lo;function lo(){var c={};c._next=c._prev=c,this._sentinel=c}lo.prototype.dequeue=function(){var c=this._sentinel,d=c._prev;if(d!==c)return rx(d),d};lo.prototype.enqueue=function(c){var d=this._sentinel;c._prev&&c._next&&rx(c),c._next=d._next,d._next._prev=c,d._next=c,c._prev=d};lo.prototype.toString=function(){for(var c=[],d=this._sentinel,v=d._prev;v!==d;)c.push(JSON.stringify(v,lT)),v=v._prev;return"["+c.join(", ")+"]"};function rx(c){c._prev._next=c._next,c._next._prev=c._prev,delete c._next,delete c._prev}function lT(c,d){if(c!=="_next"&&c!=="_prev")return d}var Rr=ve,uT=xr.Graph,hT=sT,cT=fT,dT=Rr.constant(1);function fT(c,d){if(c.nodeCount()<=1)return[];var v=vT(c,d||dT),f=gT(v.graph,v.buckets,v.zeroIdx);return Rr.flatten(Rr.map(f,function(b){return c.outEdges(b.v,b.w)}),!0)}function gT(c,d,v){for(var f=[],b=d[d.length-1],I=d[0],P;c.nodeCount();){for(;P=I.dequeue();)fd(c,d,v,P);for(;P=b.dequeue();)fd(c,d,v,P);if(c.nodeCount()){for(var L=d.length-2;L>0;--L)if(P=d[L].dequeue(),P){f=f.concat(fd(c,d,v,P,!0));break}}}return f}function fd(c,d,v,f,b){var I=b?[]:void 0;return Rr.forEach(c.inEdges(f.v),function(P){var L=c.edge(P),B=c.node(P.v);b&&I.push({v:P.v,w:P.w}),B.out-=L,bd(d,v,B)}),Rr.forEach(c.outEdges(f.v),function(P){var L=c.edge(P),B=P.w,R=c.node(B);R.in-=L,bd(d,v,R)}),c.removeNode(f.v),I}function vT(c,d){var v=new uT,f=0,b=0;Rr.forEach(c.nodes(),function(L){v.setNode(L,{v:L,in:0,out:0})}),Rr.forEach(c.edges(),function(L){var B=v.edge(L.v,L.w)||0,R=d(L),O=B+R;v.setEdge(L.v,L.w,O),b=Math.max(b,v.node(L.v).out+=R),f=Math.max(f,v.node(L.w).in+=R)});var I=Rr.range(b+f+3).map(function(){return new hT}),P=f+1;return Rr.forEach(v.nodes(),function(L){bd(I,P,v.node(L))}),{graph:v,buckets:I,zeroIdx:P}}function bd(c,d,v){v.out?v.in?c[v.out-v.in+d].enqueue(v):c[c.length-1].enqueue(v):c[0].enqueue(v)}var pi=ve,pT=cT,mT={run:yT,undo:wT};function yT(c){var d=c.graph().acyclicer==="greedy"?pT(c,v(c)):bT(c);pi.forEach(d,function(f){var b=c.edge(f);c.removeEdge(f),b.forwardName=f.name,b.reversed=!0,c.setEdge(f.w,f.v,b,pi.uniqueId("rev"))});function v(f){return function(b){return f.edge(b).weight}}}function bT(c){var d=[],v={},f={};function b(I){pi.has(f,I)||(f[I]=!0,v[I]=!0,pi.forEach(c.outEdges(I),function(P){pi.has(v,P.w)?d.push(P):b(P.w)}),delete v[I])}return pi.forEach(c.nodes(),b),d}function wT(c){pi.forEach(c.edges(),function(d){var v=c.edge(d);if(v.reversed){c.removeEdge(d);var f=v.forwardName;delete v.reversed,delete v.forwardName,c.setEdge(d.w,d.v,v,f)}})}var ee=ve,ix=xr.Graph,rr={addDummyNode:nx,simplify:xT,asNonCompoundGraph:AT,successorWeights:CT,predecessorWeights:IT,intersectRect:ST,buildLayerMatrix:MT,normalizeRanks:kT,removeEmptyRanks:PT,addBorderNode:TT,maxRank:ax,partition:NT,time:LT,notime:ET};function nx(c,d,v,f){var b;do b=ee.uniqueId(f);while(c.hasNode(b));return v.dummy=d,c.setNode(b,v),b}function xT(c){var d=new ix().setGraph(c.graph());return ee.forEach(c.nodes(),function(v){d.setNode(v,c.node(v))}),ee.forEach(c.edges(),function(v){var f=d.edge(v.v,v.w)||{weight:0,minlen:1},b=c.edge(v);d.setEdge(v.v,v.w,{weight:f.weight+b.weight,minlen:Math.max(f.minlen,b.minlen)})}),d}function AT(c){var d=new ix({multigraph:c.isMultigraph()}).setGraph(c.graph());return ee.forEach(c.nodes(),function(v){c.children(v).length||d.setNode(v,c.node(v))}),ee.forEach(c.edges(),function(v){d.setEdge(v,c.edge(v))}),d}function CT(c){var d=ee.map(c.nodes(),function(v){var f={};return ee.forEach(c.outEdges(v),function(b){f[b.w]=(f[b.w]||0)+c.edge(b).weight}),f});return ee.zipObject(c.nodes(),d)}function IT(c){var d=ee.map(c.nodes(),function(v){var f={};return ee.forEach(c.inEdges(v),function(b){f[b.v]=(f[b.v]||0)+c.edge(b).weight}),f});return ee.zipObject(c.nodes(),d)}function ST(c,d){var v=c.x,f=c.y,b=d.x-v,I=d.y-f,P=c.width/2,L=c.height/2;if(!b&&!I)throw new Error("Not possible to find intersection inside of the rectangle");var B,R;return Math.abs(I)*P>Math.abs(b)*L?(I<0&&(L=-L),B=L*b/I,R=L):(b<0&&(P=-P),B=P,R=P*I/b),{x:v+B,y:f+R}}function MT(c){var d=ee.map(ee.range(ax(c)+1),function(){return[]});return ee.forEach(c.nodes(),function(v){var f=c.node(v),b=f.rank;ee.isUndefined(b)||(d[b][f.order]=v)}),d}function kT(c){var d=ee.min(ee.map(c.nodes(),function(v){return c.node(v).rank}));ee.forEach(c.nodes(),function(v){var f=c.node(v);ee.has(f,"rank")&&(f.rank-=d)})}function PT(c){var d=ee.min(ee.map(c.nodes(),function(I){return c.node(I).rank})),v=[];ee.forEach(c.nodes(),function(I){var P=c.node(I).rank-d;v[P]||(v[P]=[]),v[P].push(I)});var f=0,b=c.graph().nodeRankFactor;ee.forEach(v,function(I,P){ee.isUndefined(I)&&P%b!==0?--f:f&&ee.forEach(I,function(L){c.node(L).rank+=f})})}function TT(c,d,v,f){var b={width:0,height:0};return arguments.length>=4&&(b.rank=v,b.order=f),nx(c,"border",b,d)}function ax(c){return ee.max(ee.map(c.nodes(),function(d){var v=c.node(d).rank;if(!ee.isUndefined(v))return v}))}function NT(c,d){var v={lhs:[],rhs:[]};return ee.forEach(c,function(f){d(f)?v.lhs.push(f):v.rhs.push(f)}),v}function LT(c,d){var v=ee.now();try{return d()}finally{console.log(c+" time: "+(ee.now()-v)+"ms")}}function ET(c,d){return d()}var ox=ve,DT=rr,zT={run:BT,undo:RT};function BT(c){c.graph().dummyChains=[],ox.forEach(c.edges(),function(d){OT(c,d)})}function OT(c,d){var v=d.v,f=c.node(v).rank,b=d.w,I=c.node(b).rank,P=d.name,L=c.edge(d),B=L.labelRank;if(I!==f+1){c.removeEdge(d);var R,O,G;for(G=0,++f;f<I;++G,++f)L.points=[],O={width:0,height:0,edgeLabel:L,edgeObj:d,rank:f},R=DT.addDummyNode(c,"edge",O,"_d"),f===B&&(O.width=L.width,O.height=L.height,O.dummy="edge-label",O.labelpos=L.labelpos),c.setEdge(v,R,{weight:L.weight},P),G===0&&c.graph().dummyChains.push(R),v=R;c.setEdge(v,b,{weight:L.weight},P)}}function RT(c){ox.forEach(c.graph().dummyChains,function(d){var v=c.node(d),f=v.edgeLabel,b;for(c.setEdge(v.edgeObj,f);v.dummy;)b=c.successors(d)[0],c.removeNode(d),f.points.push({x:v.x,y:v.y}),v.dummy==="edge-label"&&(f.x=v.x,f.y=v.y,f.width=v.width,f.height=v.height),d=b,v=c.node(d)})}var La=ve,uo={longestPath:_T,slack:GT};function _T(c){var d={};function v(f){var b=c.node(f);if(La.has(d,f))return b.rank;d[f]=!0;var I=La.min(La.map(c.outEdges(f),function(P){return v(P.w)-c.edge(P).minlen}));return(I===Number.POSITIVE_INFINITY||I===void 0||I===null)&&(I=0),b.rank=I}La.forEach(c.sources(),v)}function GT(c,d){return c.node(d.w).rank-c.node(d.v).rank-c.edge(d).minlen}var Ba=ve,jT=xr.Graph,Oa=uo.slack,sx=FT;function FT(c){var d=new jT({directed:!1}),v=c.nodes()[0],f=c.nodeCount();d.setNode(v,{});for(var b,I;VT(d,c)<f;)b=WT(d,c),I=d.hasNode(b.v)?Oa(c,b):-Oa(c,b),ZT(d,c,I);return d}function VT(c,d){function v(f){Ba.forEach(d.nodeEdges(f),function(b){var I=b.v,P=f===I?b.w:I;!c.hasNode(P)&&!Oa(d,b)&&(c.setNode(P,{}),c.setEdge(f,P,{}),v(P))})}return Ba.forEach(c.nodes(),v),c.nodeCount()}function WT(c,d){return Ba.minBy(d.edges(),function(v){if(c.hasNode(v.v)!==c.hasNode(v.w))return Oa(d,v)})}function ZT(c,d,v){Ba.forEach(c.nodes(),function(f){d.node(f).rank+=v})}var Gr=ve,YT=sx,UT=uo.slack,XT=uo.longestPath,HT=xr.alg.preorder,qT=xr.alg.postorder,JT=rr.simplify,KT=Ai;Ai.initLowLimValues=Zd;Ai.initCutValues=Wd;Ai.calcCutValue=lx;Ai.leaveEdge=hx;Ai.enterEdge=cx;Ai.exchangeEdges=dx;function Ai(c){c=JT(c),XT(c);var d=YT(c);Zd(d),Wd(d,c);for(var v,f;v=hx(d);)f=cx(d,c,v),dx(d,c,v,f)}function Wd(c,d){var v=qT(c,c.nodes());v=v.slice(0,v.length-1),Gr.forEach(v,function(f){QT(c,d,f)})}function QT(c,d,v){var f=c.node(v),b=f.parent;c.edge(v,b).cutvalue=lx(c,d,v)}function lx(c,d,v){var f=c.node(v),b=f.parent,I=!0,P=d.edge(v,b),L=0;return P||(I=!1,P=d.edge(b,v)),L=P.weight,Gr.forEach(d.nodeEdges(v),function(B){var R=B.v===v,O=R?B.w:B.v;if(O!==b){var G=R===I,U=d.edge(B).weight;if(L+=G?U:-U,tN(c,v,O)){var H=c.edge(v,O).cutvalue;L+=G?-H:H}}}),L}function Zd(c,d){arguments.length<2&&(d=c.nodes()[0]),ux(c,{},1,d)}function ux(c,d,v,f,b){var I=v,P=c.node(f);return d[f]=!0,Gr.forEach(c.neighbors(f),function(L){Gr.has(d,L)||(v=ux(c,d,v,L,f))}),P.low=I,P.lim=v++,b?P.parent=b:delete P.parent,v}function hx(c){return Gr.find(c.edges(),function(d){return c.edge(d).cutvalue<0})}function cx(c,d,v){var f=v.v,b=v.w;d.hasEdge(f,b)||(f=v.w,b=v.v);var I=c.node(f),P=c.node(b),L=I,B=!1;I.lim>P.lim&&(L=P,B=!0);var R=Gr.filter(d.edges(),function(O){return B===Fb(c,c.node(O.v),L)&&B!==Fb(c,c.node(O.w),L)});return Gr.minBy(R,function(O){return UT(d,O)})}function dx(c,d,v,f){var b=v.v,I=v.w;c.removeEdge(b,I),c.setEdge(f.v,f.w,{}),Zd(c),Wd(c,d),$T(c,d)}function $T(c,d){var v=Gr.find(c.nodes(),function(b){return!d.node(b).parent}),f=HT(c,v);f=f.slice(1),Gr.forEach(f,function(b){var I=c.node(b).parent,P=d.edge(b,I),L=!1;P||(P=d.edge(I,b),L=!0),d.node(b).rank=d.node(I).rank+(L?P.minlen:-P.minlen)})}function tN(c,d,v){return c.hasEdge(d,v)}function Fb(c,d,v){return v.low<=d.lim&&d.lim<=v.lim}var eN=uo,fx=eN.longestPath,rN=sx,iN=KT,nN=aN;function aN(c){switch(c.graph().ranker){case"network-simplex":Vb(c);break;case"tight-tree":sN(c);break;case"longest-path":oN(c);break;default:Vb(c)}}var oN=fx;function sN(c){fx(c),rN(c)}function Vb(c){iN(c)}var wd=ve,lN=uN;function uN(c){var d=cN(c);wd.forEach(c.graph().dummyChains,function(v){for(var f=c.node(v),b=f.edgeObj,I=hN(c,d,b.v,b.w),P=I.path,L=I.lca,B=0,R=P[B],O=!0;v!==b.w;){if(f=c.node(v),O){for(;(R=P[B])!==L&&c.node(R).maxRank<f.rank;)B++;R===L&&(O=!1)}if(!O){for(;B<P.length-1&&c.node(R=P[B+1]).minRank<=f.rank;)B++;R=P[B]}c.setParent(v,R),v=c.successors(v)[0]}})}function hN(c,d,v,f){var b=[],I=[],P=Math.min(d[v].low,d[f].low),L=Math.max(d[v].lim,d[f].lim),B,R;B=v;do B=c.parent(B),b.push(B);while(B&&(d[B].low>P||L>d[B].lim));for(R=B,B=f;(B=c.parent(B))!==R;)I.push(B);return{path:b.concat(I.reverse()),lca:R}}function cN(c){var d={},v=0;function f(b){var I=v;wd.forEach(c.children(b),f),d[b]={low:I,lim:v++}}return wd.forEach(c.children(),f),d}var _r=ve,xd=rr,dN={run:fN,cleanup:pN};function fN(c){var d=xd.addDummyNode(c,"root",{},"_root"),v=gN(c),f=_r.max(_r.values(v))-1,b=2*f+1;c.graph().nestingRoot=d,_r.forEach(c.edges(),function(P){c.edge(P).minlen*=b});var I=vN(c)+1;_r.forEach(c.children(),function(P){gx(c,d,b,I,f,v,P)}),c.graph().nodeRankFactor=b}function gx(c,d,v,f,b,I,P){var L=c.children(P);if(!L.length){P!==d&&c.setEdge(d,P,{weight:0,minlen:v});return}var B=xd.addBorderNode(c,"_bt"),R=xd.addBorderNode(c,"_bb"),O=c.node(P);c.setParent(B,P),O.borderTop=B,c.setParent(R,P),O.borderBottom=R,_r.forEach(L,function(G){gx(c,d,v,f,b,I,G);var U=c.node(G),H=U.borderTop?U.borderTop:G,K=U.borderBottom?U.borderBottom:G,q=U.borderTop?f:2*f,et=H!==K?1:b-I[P]+1;c.setEdge(B,H,{weight:q,minlen:et,nestingEdge:!0}),c.setEdge(K,R,{weight:q,minlen:et,nestingEdge:!0})}),c.parent(P)||c.setEdge(d,B,{weight:0,minlen:b+I[P]})}function gN(c){var d={};function v(f,b){var I=c.children(f);I&&I.length&&_r.forEach(I,function(P){v(P,b+1)}),d[f]=b}return _r.forEach(c.children(),function(f){v(f,1)}),d}function vN(c){return _r.reduce(c.edges(),function(d,v){return d+c.edge(v).weight},0)}function pN(c){var d=c.graph();c.removeNode(d.nestingRoot),delete d.nestingRoot,_r.forEach(c.edges(),function(v){var f=c.edge(v);f.nestingEdge&&c.removeEdge(v)})}var gd=ve,mN=rr,yN=bN;function bN(c){function d(v){var f=c.children(v),b=c.node(v);if(f.length&&gd.forEach(f,d),gd.has(b,"minRank")){b.borderLeft=[],b.borderRight=[];for(var I=b.minRank,P=b.maxRank+1;I<P;++I)Wb(c,"borderLeft","_bl",v,b,I),Wb(c,"borderRight","_br",v,b,I)}}gd.forEach(c.children(),d)}function Wb(c,d,v,f,b,I){var P={width:0,height:0,rank:I,borderType:d},L=b[d][I-1],B=mN.addDummyNode(c,"border",P,v);b[d][I]=B,c.setParent(B,f),L&&c.setEdge(L,B,{weight:1})}var Sr=ve,wN={adjust:xN,undo:AN};function xN(c){var d=c.graph().rankdir.toLowerCase();(d==="lr"||d==="rl")&&vx(c)}function AN(c){var d=c.graph().rankdir.toLowerCase();(d==="bt"||d==="rl")&&CN(c),(d==="lr"||d==="rl")&&(IN(c),vx(c))}function vx(c){Sr.forEach(c.nodes(),function(d){Zb(c.node(d))}),Sr.forEach(c.edges(),function(d){Zb(c.edge(d))})}function Zb(c){var d=c.width;c.width=c.height,c.height=d}function CN(c){Sr.forEach(c.nodes(),function(d){vd(c.node(d))}),Sr.forEach(c.edges(),function(d){var v=c.edge(d);Sr.forEach(v.points,vd),Sr.has(v,"y")&&vd(v)})}function vd(c){c.y=-c.y}function IN(c){Sr.forEach(c.nodes(),function(d){pd(c.node(d))}),Sr.forEach(c.edges(),function(d){var v=c.edge(d);Sr.forEach(v.points,pd),Sr.has(v,"x")&&pd(v)})}function pd(c){var d=c.x;c.x=c.y,c.y=d}var Or=ve,SN=MN;function MN(c){var d={},v=Or.filter(c.nodes(),function(L){return!c.children(L).length}),f=Or.max(Or.map(v,function(L){return c.node(L).rank})),b=Or.map(Or.range(f+1),function(){return[]});function I(L){if(!Or.has(d,L)){d[L]=!0;var B=c.node(L);b[B.rank].push(L),Or.forEach(c.successors(L),I)}}var P=Or.sortBy(v,function(L){return c.node(L).rank});return Or.forEach(P,I),b}var $r=ve,kN=PN;function PN(c,d){for(var v=0,f=1;f<d.length;++f)v+=TN(c,d[f-1],d[f]);return v}function TN(c,d,v){for(var f=$r.zipObject(v,$r.map(v,function(R,O){return O})),b=$r.flatten($r.map(d,function(R){return $r.sortBy($r.map(c.outEdges(R),function(O){return{pos:f[O.w],weight:c.edge(O).weight}}),"pos")}),!0),I=1;I<v.length;)I<<=1;var P=2*I-1;I-=1;var L=$r.map(new Array(P),function(){return 0}),B=0;return $r.forEach(b.forEach(function(R){var O=R.pos+I;L[O]+=R.weight;for(var G=0;O>0;)O%2&&(G+=L[O+1]),O=O-1>>1,L[O]+=R.weight;B+=R.weight*G})),B}var Yb=ve,NN=LN;function LN(c,d){return Yb.map(d,function(v){var f=c.inEdges(v);if(f.length){var b=Yb.reduce(f,function(I,P){var L=c.edge(P),B=c.node(P.v);return{sum:I.sum+L.weight*B.order,weight:I.weight+L.weight}},{sum:0,weight:0});return{v,barycenter:b.sum/b.weight,weight:b.weight}}else return{v}})}var ur=ve,EN=DN;function DN(c,d){var v={};ur.forEach(c,function(b,I){var P=v[b.v]={indegree:0,in:[],out:[],vs:[b.v],i:I};ur.isUndefined(b.barycenter)||(P.barycenter=b.barycenter,P.weight=b.weight)}),ur.forEach(d.edges(),function(b){var I=v[b.v],P=v[b.w];!ur.isUndefined(I)&&!ur.isUndefined(P)&&(P.indegree++,I.out.push(v[b.w]))});var f=ur.filter(v,function(b){return!b.indegree});return zN(f)}function zN(c){var d=[];function v(I){return function(P){P.merged||(ur.isUndefined(P.barycenter)||ur.isUndefined(I.barycenter)||P.barycenter>=I.barycenter)&&BN(I,P)}}function f(I){return function(P){P.in.push(I),--P.indegree===0&&c.push(P)}}for(;c.length;){var b=c.pop();d.push(b),ur.forEach(b.in.reverse(),v(b)),ur.forEach(b.out,f(b))}return ur.map(ur.filter(d,function(I){return!I.merged}),function(I){return ur.pick(I,["vs","i","barycenter","weight"])})}function BN(c,d){var v=0,f=0;c.weight&&(v+=c.barycenter*c.weight,f+=c.weight),d.weight&&(v+=d.barycenter*d.weight,f+=d.weight),c.vs=d.vs.concat(c.vs),c.barycenter=v/f,c.weight=f,c.i=Math.min(d.i,c.i),d.merged=!0}var kn=ve,ON=rr,RN=_N;function _N(c,d){var v=ON.partition(c,function(O){return kn.has(O,"barycenter")}),f=v.lhs,b=kn.sortBy(v.rhs,function(O){return-O.i}),I=[],P=0,L=0,B=0;f.sort(GN(!!d)),B=Ub(I,b,B),kn.forEach(f,function(O){B+=O.vs.length,I.push(O.vs),P+=O.barycenter*O.weight,L+=O.weight,B=Ub(I,b,B)});var R={vs:kn.flatten(I,!0)};return L&&(R.barycenter=P/L,R.weight=L),R}function Ub(c,d,v){for(var f;d.length&&(f=kn.last(d)).i<=v;)d.pop(),c.push(f.vs),v++;return v}function GN(c){return function(d,v){return d.barycenter<v.barycenter?-1:d.barycenter>v.barycenter?1:c?v.i-d.i:d.i-v.i}}var ti=ve,jN=NN,FN=EN,VN=RN,WN=px;function px(c,d,v,f){var b=c.children(d),I=c.node(d),P=I?I.borderLeft:void 0,L=I?I.borderRight:void 0,B={};P&&(b=ti.filter(b,function(K){return K!==P&&K!==L}));var R=jN(c,b);ti.forEach(R,function(K){if(c.children(K.v).length){var q=px(c,K.v,v,f);B[K.v]=q,ti.has(q,"barycenter")&&YN(K,q)}});var O=FN(R,v);ZN(O,B);var G=VN(O,f);if(P&&(G.vs=ti.flatten([P,G.vs,L],!0),c.predecessors(P).length)){var U=c.node(c.predecessors(P)[0]),H=c.node(c.predecessors(L)[0]);ti.has(G,"barycenter")||(G.barycenter=0,G.weight=0),G.barycenter=(G.barycenter*G.weight+U.order+H.order)/(G.weight+2),G.weight+=2}return G}function ZN(c,d){ti.forEach(c,function(v){v.vs=ti.flatten(v.vs.map(function(f){return d[f]?d[f].vs:f}),!0)})}function YN(c,d){ti.isUndefined(c.barycenter)?(c.barycenter=d.barycenter,c.weight=d.weight):(c.barycenter=(c.barycenter*c.weight+d.barycenter*d.weight)/(c.weight+d.weight),c.weight+=d.weight)}var Pn=ve,UN=xr.Graph,XN=HN;function HN(c,d,v){var f=qN(c),b=new UN({compound:!0}).setGraph({root:f}).setDefaultNodeLabel(function(I){return c.node(I)});return Pn.forEach(c.nodes(),function(I){var P=c.node(I),L=c.parent(I);(P.rank===d||P.minRank<=d&&d<=P.maxRank)&&(b.setNode(I),b.setParent(I,L||f),Pn.forEach(c[v](I),function(B){var R=B.v===I?B.w:B.v,O=b.edge(R,I),G=Pn.isUndefined(O)?0:O.weight;b.setEdge(R,I,{weight:c.edge(B).weight+G})}),Pn.has(P,"minRank")&&b.setNode(I,{borderLeft:P.borderLeft[d],borderRight:P.borderRight[d]}))}),b}function qN(c){for(var d;c.hasNode(d=Pn.uniqueId("_root")););return d}var JN=ve,KN=QN;function QN(c,d,v){var f={},b;JN.forEach(v,function(I){for(var P=c.parent(I),L,B;P;){if(L=c.parent(P),L?(B=f[L],f[L]=P):(B=b,b=P),B&&B!==P){d.setEdge(B,P);return}P=L}})}var ei=ve,$N=SN,tL=kN,eL=WN,rL=XN,iL=KN,nL=xr.Graph,Xb=rr,aL=oL;function oL(c){var d=Xb.maxRank(c),v=Hb(c,ei.range(1,d+1),"inEdges"),f=Hb(c,ei.range(d-1,-1,-1),"outEdges"),b=$N(c);qb(c,b);for(var I=Number.POSITIVE_INFINITY,P,L=0,B=0;B<4;++L,++B){sL(L%2?v:f,L%4>=2),b=Xb.buildLayerMatrix(c);var R=tL(c,b);R<I&&(B=0,P=ei.cloneDeep(b),I=R)}qb(c,P)}function Hb(c,d,v){return ei.map(d,function(f){return rL(c,f,v)})}function sL(c,d){var v=new nL;ei.forEach(c,function(f){var b=f.graph().root,I=eL(f,b,v,d);ei.forEach(I.vs,function(P,L){f.node(P).order=L}),iL(f,v,I.vs)})}function qb(c,d){ei.forEach(d,function(v){ei.forEach(v,function(f,b){c.node(f).order=b})})}var zt=ve,lL=xr.Graph,uL=rr,hL={positionX:fL,findType1Conflicts:mx,findType2Conflicts:yx,addConflict:Yd,hasConflict:bx,verticalAlignment:wx,horizontalCompaction:xx,alignCoordinates:Cx,findSmallestWidthAlignment:Ax,balance:Ix};function mx(c,d){var v={};function f(b,I){var P=0,L=0,B=b.length,R=zt.last(I);return zt.forEach(I,function(O,G){var U=cL(c,O),H=U?c.node(U).order:B;(U||O===R)&&(zt.forEach(I.slice(L,G+1),function(K){zt.forEach(c.predecessors(K),function(q){var et=c.node(q),ht=et.order;(ht<P||H<ht)&&!(et.dummy&&c.node(K).dummy)&&Yd(v,q,K)})}),L=G+1,P=H)}),I}return zt.reduce(d,f),v}function yx(c,d){var v={};function f(I,P,L,B,R){var O;zt.forEach(zt.range(P,L),function(G){O=I[G],c.node(O).dummy&&zt.forEach(c.predecessors(O),function(U){var H=c.node(U);H.dummy&&(H.order<B||H.order>R)&&Yd(v,U,O)})})}function b(I,P){var L=-1,B,R=0;return zt.forEach(P,function(O,G){if(c.node(O).dummy==="border"){var U=c.predecessors(O);U.length&&(B=c.node(U[0]).order,f(P,R,G,L,B),R=G,L=B)}f(P,R,P.length,B,I.length)}),P}return zt.reduce(d,b),v}function cL(c,d){if(c.node(d).dummy)return zt.find(c.predecessors(d),function(v){return c.node(v).dummy})}function Yd(c,d,v){if(d>v){var f=d;d=v,v=f}var b=c[d];b||(c[d]=b={}),b[v]=!0}function bx(c,d,v){if(d>v){var f=d;d=v,v=f}return zt.has(c[d],v)}function wx(c,d,v,f){var b={},I={},P={};return zt.forEach(d,function(L){zt.forEach(L,function(B,R){b[B]=B,I[B]=B,P[B]=R})}),zt.forEach(d,function(L){var B=-1;zt.forEach(L,function(R){var O=f(R);if(O.length){O=zt.sortBy(O,function(q){return P[q]});for(var G=(O.length-1)/2,U=Math.floor(G),H=Math.ceil(G);U<=H;++U){var K=O[U];I[R]===R&&B<P[K]&&!bx(v,R,K)&&(I[K]=R,I[R]=b[R]=b[K],B=P[K])}}})}),{root:b,align:I}}function xx(c,d,v,f,b){var I={},P=dL(c,d,v,b),L=b?"borderLeft":"borderRight";function B(G,U){for(var H=P.nodes(),K=H.pop(),q={};K;)q[K]?G(K):(q[K]=!0,H.push(K),H=H.concat(U(K))),K=H.pop()}function R(G){I[G]=P.inEdges(G).reduce(function(U,H){return Math.max(U,I[H.v]+P.edge(H))},0)}function O(G){var U=P.outEdges(G).reduce(function(K,q){return Math.min(K,I[q.w]-P.edge(q))},Number.POSITIVE_INFINITY),H=c.node(G);U!==Number.POSITIVE_INFINITY&&H.borderType!==L&&(I[G]=Math.max(I[G],U))}return B(R,P.predecessors.bind(P)),B(O,P.successors.bind(P)),zt.forEach(f,function(G){I[G]=I[v[G]]}),I}function dL(c,d,v,f){var b=new lL,I=c.graph(),P=gL(I.nodesep,I.edgesep,f);return zt.forEach(d,function(L){var B;zt.forEach(L,function(R){var O=v[R];if(b.setNode(O),B){var G=v[B],U=b.edge(G,O);b.setEdge(G,O,Math.max(P(c,R,B),U||0))}B=R})}),b}function Ax(c,d){return zt.minBy(zt.values(d),function(v){var f=Number.NEGATIVE_INFINITY,b=Number.POSITIVE_INFINITY;return zt.forIn(v,function(I,P){var L=vL(c,P)/2;f=Math.max(I+L,f),b=Math.min(I-L,b)}),f-b})}function Cx(c,d){var v=zt.values(d),f=zt.min(v),b=zt.max(v);zt.forEach(["u","d"],function(I){zt.forEach(["l","r"],function(P){var L=I+P,B=c[L],R;if(B!==d){var O=zt.values(B);R=P==="l"?f-zt.min(O):b-zt.max(O),R&&(c[L]=zt.mapValues(B,function(G){return G+R}))}})})}function Ix(c,d){return zt.mapValues(c.ul,function(v,f){if(d)return c[d.toLowerCase()][f];var b=zt.sortBy(zt.map(c,f));return(b[1]+b[2])/2})}function fL(c){var d=uL.buildLayerMatrix(c),v=zt.merge(mx(c,d),yx(c,d)),f={},b;zt.forEach(["u","d"],function(P){b=P==="u"?d:zt.values(d).reverse(),zt.forEach(["l","r"],function(L){L==="r"&&(b=zt.map(b,function(G){return zt.values(G).reverse()}));var B=(P==="u"?c.predecessors:c.successors).bind(c),R=wx(c,b,v,B),O=xx(c,b,R.root,R.align,L==="r");L==="r"&&(O=zt.mapValues(O,function(G){return-G})),f[P+L]=O})});var I=Ax(c,f);return Cx(f,I),Ix(f,c.graph().align)}function gL(c,d,v){return function(f,b,I){var P=f.node(b),L=f.node(I),B=0,R;if(B+=P.width/2,zt.has(P,"labelpos"))switch(P.labelpos.toLowerCase()){case"l":R=-P.width/2;break;case"r":R=P.width/2;break}if(R&&(B+=v?R:-R),R=0,B+=(P.dummy?d:c)/2,B+=(L.dummy?d:c)/2,B+=L.width/2,zt.has(L,"labelpos"))switch(L.labelpos.toLowerCase()){case"l":R=L.width/2;break;case"r":R=-L.width/2;break}return R&&(B+=v?R:-R),R=0,B}}function vL(c,d){return c.node(d).width}var Tn=ve,Sx=rr,pL=hL.positionX,mL=yL;function yL(c){c=Sx.asNonCompoundGraph(c),bL(c),Tn.forEach(pL(c),function(d,v){c.node(v).x=d})}function bL(c){var d=Sx.buildLayerMatrix(c),v=c.graph().ranksep,f=0;Tn.forEach(d,function(b){var I=Tn.max(Tn.map(b,function(P){return c.node(P).height}));Tn.forEach(b,function(P){c.node(P).y=f+I/2}),f+=I+v})}var Gt=ve,Jb=mT,Kb=zT,wL=nN,xL=rr.normalizeRanks,AL=lN,CL=rr.removeEmptyRanks,Qb=dN,IL=yN,$b=wN,SL=aL,ML=mL,ri=rr,kL=xr.Graph,PL=TL;function TL(c,d){var v=d&&d.debugTiming?ri.time:ri.notime;v("layout",function(){var f=v("  buildLayoutGraph",function(){return jL(c)});v("  runLayout",function(){NL(f,v)}),v("  updateInputGraph",function(){LL(c,f)})})}function NL(c,d){d("    makeSpaceForEdgeLabels",function(){FL(c)}),d("    removeSelfEdges",function(){JL(c)}),d("    acyclic",function(){Jb.run(c)}),d("    nestingGraph.run",function(){Qb.run(c)}),d("    rank",function(){wL(ri.asNonCompoundGraph(c))}),d("    injectEdgeLabelProxies",function(){VL(c)}),d("    removeEmptyRanks",function(){CL(c)}),d("    nestingGraph.cleanup",function(){Qb.cleanup(c)}),d("    normalizeRanks",function(){xL(c)}),d("    assignRankMinMax",function(){WL(c)}),d("    removeEdgeLabelProxies",function(){ZL(c)}),d("    normalize.run",function(){Kb.run(c)}),d("    parentDummyChains",function(){AL(c)}),d("    addBorderSegments",function(){IL(c)}),d("    order",function(){SL(c)}),d("    insertSelfEdges",function(){KL(c)}),d("    adjustCoordinateSystem",function(){$b.adjust(c)}),d("    position",function(){ML(c)}),d("    positionSelfEdges",function(){QL(c)}),d("    removeBorderNodes",function(){qL(c)}),d("    normalize.undo",function(){Kb.undo(c)}),d("    fixupEdgeLabelCoords",function(){XL(c)}),d("    undoCoordinateSystem",function(){$b.undo(c)}),d("    translateGraph",function(){YL(c)}),d("    assignNodeIntersects",function(){UL(c)}),d("    reversePoints",function(){HL(c)}),d("    acyclic.undo",function(){Jb.undo(c)})}function LL(c,d){Gt.forEach(c.nodes(),function(v){var f=c.node(v),b=d.node(v);f&&(f.x=b.x,f.y=b.y,d.children(v).length&&(f.width=b.width,f.height=b.height))}),Gt.forEach(c.edges(),function(v){var f=c.edge(v),b=d.edge(v);f.points=b.points,Gt.has(b,"x")&&(f.x=b.x,f.y=b.y)}),c.graph().width=d.graph().width,c.graph().height=d.graph().height}var EL=["nodesep","edgesep","ranksep","marginx","marginy"],DL={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},zL=["acyclicer","ranker","rankdir","align"],BL=["width","height"],OL={width:0,height:0},RL=["minlen","weight","width","height","labeloffset"],_L={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},GL=["labelpos"];function jL(c){var d=new kL({multigraph:!0,compound:!0}),v=yd(c.graph());return d.setGraph(Gt.merge({},DL,md(v,EL),Gt.pick(v,zL))),Gt.forEach(c.nodes(),function(f){var b=yd(c.node(f));d.setNode(f,Gt.defaults(md(b,BL),OL)),d.setParent(f,c.parent(f))}),Gt.forEach(c.edges(),function(f){var b=yd(c.edge(f));d.setEdge(f,Gt.merge({},_L,md(b,RL),Gt.pick(b,GL)))}),d}function FL(c){var d=c.graph();d.ranksep/=2,Gt.forEach(c.edges(),function(v){var f=c.edge(v);f.minlen*=2,f.labelpos.toLowerCase()!=="c"&&(d.rankdir==="TB"||d.rankdir==="BT"?f.width+=f.labeloffset:f.height+=f.labeloffset)})}function VL(c){Gt.forEach(c.edges(),function(d){var v=c.edge(d);if(v.width&&v.height){var f=c.node(d.v),b=c.node(d.w),I={rank:(b.rank-f.rank)/2+f.rank,e:d};ri.addDummyNode(c,"edge-proxy",I,"_ep")}})}function WL(c){var d=0;Gt.forEach(c.nodes(),function(v){var f=c.node(v);f.borderTop&&(f.minRank=c.node(f.borderTop).rank,f.maxRank=c.node(f.borderBottom).rank,d=Gt.max(d,f.maxRank))}),c.graph().maxRank=d}function ZL(c){Gt.forEach(c.nodes(),function(d){var v=c.node(d);v.dummy==="edge-proxy"&&(c.edge(v.e).labelRank=v.rank,c.removeNode(d))})}function YL(c){var d=Number.POSITIVE_INFINITY,v=0,f=Number.POSITIVE_INFINITY,b=0,I=c.graph(),P=I.marginx||0,L=I.marginy||0;function B(R){var O=R.x,G=R.y,U=R.width,H=R.height;d=Math.min(d,O-U/2),v=Math.max(v,O+U/2),f=Math.min(f,G-H/2),b=Math.max(b,G+H/2)}Gt.forEach(c.nodes(),function(R){B(c.node(R))}),Gt.forEach(c.edges(),function(R){var O=c.edge(R);Gt.has(O,"x")&&B(O)}),d-=P,f-=L,Gt.forEach(c.nodes(),function(R){var O=c.node(R);O.x-=d,O.y-=f}),Gt.forEach(c.edges(),function(R){var O=c.edge(R);Gt.forEach(O.points,function(G){G.x-=d,G.y-=f}),Gt.has(O,"x")&&(O.x-=d),Gt.has(O,"y")&&(O.y-=f)}),I.width=v-d+P,I.height=b-f+L}function UL(c){Gt.forEach(c.edges(),function(d){var v=c.edge(d),f=c.node(d.v),b=c.node(d.w),I,P;v.points?(I=v.points[0],P=v.points[v.points.length-1]):(v.points=[],I=b,P=f),v.points.unshift(ri.intersectRect(f,I)),v.points.push(ri.intersectRect(b,P))})}function XL(c){Gt.forEach(c.edges(),function(d){var v=c.edge(d);if(Gt.has(v,"x"))switch((v.labelpos==="l"||v.labelpos==="r")&&(v.width-=v.labeloffset),v.labelpos){case"l":v.x-=v.width/2+v.labeloffset;break;case"r":v.x+=v.width/2+v.labeloffset;break}})}function HL(c){Gt.forEach(c.edges(),function(d){var v=c.edge(d);v.reversed&&v.points.reverse()})}function qL(c){Gt.forEach(c.nodes(),function(d){if(c.children(d).length){var v=c.node(d),f=c.node(v.borderTop),b=c.node(v.borderBottom),I=c.node(Gt.last(v.borderLeft)),P=c.node(Gt.last(v.borderRight));v.width=Math.abs(P.x-I.x),v.height=Math.abs(b.y-f.y),v.x=I.x+v.width/2,v.y=f.y+v.height/2}}),Gt.forEach(c.nodes(),function(d){c.node(d).dummy==="border"&&c.removeNode(d)})}function JL(c){Gt.forEach(c.edges(),function(d){if(d.v===d.w){var v=c.node(d.v);v.selfEdges||(v.selfEdges=[]),v.selfEdges.push({e:d,label:c.edge(d)}),c.removeEdge(d)}})}function KL(c){var d=ri.buildLayerMatrix(c);Gt.forEach(d,function(v){var f=0;Gt.forEach(v,function(b,I){var P=c.node(b);P.order=I+f,Gt.forEach(P.selfEdges,function(L){ri.addDummyNode(c,"selfedge",{width:L.label.width,height:L.label.height,rank:P.rank,order:I+ ++f,e:L.e,label:L.label},"_se")}),delete P.selfEdges})})}function QL(c){Gt.forEach(c.nodes(),function(d){var v=c.node(d);if(v.dummy==="selfedge"){var f=c.node(v.e.v),b=f.x+f.width/2,I=f.y,P=v.x-b,L=f.height/2;c.setEdge(v.e,v.label),c.removeNode(d),v.label.points=[{x:b+2*P/3,y:I-L},{x:b+5*P/6,y:I-L},{x:b+P,y:I},{x:b+5*P/6,y:I+L},{x:b+2*P/3,y:I+L}],v.label.x=v.x,v.label.y=v.y}})}function md(c,d){return Gt.mapValues(Gt.pick(c,d),Number)}function yd(c){var d={};return Gt.forEach(c,function(v,f){d[f.toLowerCase()]=v}),d}var Ea=ve,$L=rr,tE=xr.Graph,eE={debugOrdering:rE};function rE(c){var d=$L.buildLayerMatrix(c),v=new tE({compound:!0,multigraph:!0}).setGraph({});return Ea.forEach(c.nodes(),function(f){v.setNode(f,{label:f}),v.setParent(f,"layer"+c.node(f).rank)}),Ea.forEach(c.edges(),function(f){v.setEdge(f.v,f.w,{},f.name)}),Ea.forEach(d,function(f,b){var I="layer"+b;v.setNode(I,{rank:"same"}),Ea.reduce(f,function(P,L){return v.setEdge(P,L,{style:"invis"}),L})}),v}var iE="0.8.5",Ad={graphlib:xr,layout:PL,debug:eE,util:{time:rr.time,notime:rr.notime},version:iE};const nE=pk({__proto__:null,default:Ad},[Ad]),ho=iw({id:"MbtData",state:()=>({allData:{dataDefinition:{data:{}}},editingPrimaryAw:{data:null,schema:null,uiParams:null},editingExpectedAw:{data:null,schema:null,uiParams:null},mbtMeta:{detail:null,customKeys:[]},LinkData:{linkSchemaValue:null,rulesData:null,description:""},groupData:{schema:null,data:null,description:""},sectionData:{},expectedTableRow:{},awDescription:"",showSchema:!1,showData:{}}),getters:{getAllData:c=>c.allData,getMetaData:c=>c.mbtMeta,getPrimaryAw:c=>c.editingPrimaryAw,getExpectedAw:c=>c.editingExpectedAw,getDataPoolTableColumns:c=>{var d,v,f;return((f=(v=(d=c.allData)==null?void 0:d.dataDefinition)==null?void 0:v.data)==null?void 0:f.tableColumns)||[]},getDataPoolTableData:c=>{var d,v,f;return((f=(v=(d=c.allData)==null?void 0:d.dataDefinition)==null?void 0:v.data)==null?void 0:f.tableData)||[]},getExpectTableRow:c=>c.expectedTableRow,getLinkData:c=>c.LinkData,getGroupData:c=>c.groupData,getSectionData:c=>c.sectionData,getDescription:c=>c.awDescription,getVisible:c=>c.showSchema,getShowData:c=>c.showData},actions:{setAllData(c){this.allData=c},setDescription(c){this.awDescription=c},setEditingPrimaryAw(c,d){d?this.editingPrimaryAw[d]=c:this.editingPrimaryAw=c},setEditingExpectedAw(c,d){d?this.editingExpectedAw[d]=c:this.editingExpectedAw=c},setMetaData(c,d){d?this.mbtMeta[d]=c:this.mbtMeta=c},checkMetaFormItemIsCustom(c,d){let v=this.mbtMeta.detail.filter(b=>b.description===c||b.name===c)[0];return v?!v.enum.includes(d):!1},setExpectedTableRow(c){this.expectedTableRow=c},setDataDefinition(c){this.allData.dataDefinition.data=c},setLinkData(c,d){d?this.LinkData[d]=c:this.LinkData=c},setGroupData(c,d){d?this.groupData[d]=c:this.groupData=c},setSectionData(c,d){d?this.sectionData[d]=c:this.sectionData=c},resetEditingExpectedAw(){this.showData={}},setVisible(c){this.showSchema=c},setData(c){this.showData=c}}}),tw=ho();Mr.global;const Mx="link",aE="itea.mbt.test."+Mx;class Ra extends(void 0){static connectionPoint(d,v,f,b,I,P){P.model,b={offset:1,stroke:!0};const L=v.model.get("type");return L.indexOf("standard")===0&&(b.selector="root"),L==="standard.InscribedImage"&&(b.selector="border"),(void 0)(this,d,v,f,b,I,P)}constructor(d,v){var f,b,I,P,L,B,R;super(d,v),this.attr({label:{text:(I=(b=(f=this.get("prop"))==null?void 0:f.custom)==null?void 0:b.condition)!=null&&I.label?(P=this.get("prop").custom.condition)==null?void 0:P.label:"Link"}}),(R=(B=(L=this.get("prop"))==null?void 0:L.custom)==null?void 0:B.condition)!=null&&R.label||this.set("prop",{custom:{condition:{},rulesData:[],description:""}}),this.on("change",O=>{var U,H,K;const G=(H=(U=O.changed)==null?void 0:U.prop)==null?void 0:H.custom;if(G){const q=G.description?G.description:((K=G==null?void 0:G.condition)==null?void 0:K.label)||"";this.label(0,{attrs:{label:{text:q}}})}})}getInspectorSchema(){const d={colorPalette:[{content:"transparent",icon:"../assets/no-color-icon.svg"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],colorPaletteReset:[{content:void 0,icon:"y"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],strokeWidth:[{value:1,content:'<div style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:2,content:'<div style="background:#fff;width:4px;height:30px;margin:0 13px;border-radius: 2px;"/>'},{value:4,content:'<div style="background:#fff;width:8px;height:30px;margin:0 11px;border-radius: 2px;"/>'},{value:8,content:'<div style="background:#fff;width:16px;height:30px;margin:0 8px;border-radius: 2px;"/>'}],strokeStyle:[{value:"0",content:"Solid"},{value:"2,5",content:"Dotted"},{value:"10,5",content:"Dashed"}],arrowheadSize:[{value:"M 0 0 0 0",content:"None"},{value:"M 0 -3 -6 0 0 3 z",content:"Small"},{value:"M 0 -5 -10 0 0 5 z",content:"Medium"},{value:"M 0 -10 -15 0 0 10 z",content:"Large"}],router:[{value:"normal",content:'<p style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:"orthogonal",content:'<p style="width:20px;height:30px;margin:0 5px;border-bottom: 2px solid #fff;border-left: 2px solid #fff;"/>'},{value:"oneSide",content:'<p style="width:20px;height:30px;margin:0 5px;border: 2px solid #fff;border-top: none;"/>'}],connector:[{value:"normal",content:'<p style="width:20px;height:20px;margin:5px;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"rounded",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:30%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"smooth",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:100%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'}],side:[{value:"top",content:"Top Side"},{value:"right",content:"Right Side"},{value:"bottom",content:"Bottom Side"},{value:"left",content:"Left Side"}],labelPosition:[{value:30,content:"Close to source"},{value:.5,content:"In the middle"},{value:-30,content:"Close to target"}]};return{inputs:{attrs:{line:{strokeWidth:{type:"select-button-group",options:d.strokeWidth,group:"connection",label:"Link thickness",when:{ne:{"attrs/line/stroke":"transparent"}},index:4},strokeDasharray:{type:"select-box",options:d.strokeStyle,group:"connection",label:"Link style",when:{ne:{"attrs/line/stroke":"transparent"}},index:5},stroke:{type:"color-palette",options:d.colorPalette,group:"connection",label:"Color",index:6},sourceMarker:{d:{type:"select-box",options:d.arrowheadSize,group:"marker-source",label:"Source arrowhead",index:1},fill:{type:"color-palette",options:d.colorPaletteReset,group:"marker-source",label:"Color",when:{ne:{"attrs/line/sourceMarker/d":"M 0 0 0 0"}},index:2}},targetMarker:{d:{type:"select-box",options:d.arrowheadSize,group:"marker-target",label:"Target arrowhead",index:1},fill:{type:"color-palette",options:d.colorPaletteReset,group:"marker-target",label:"Color",when:{ne:{"attrs/line/targetMarker/d":"M 0 0 0 0"}},index:2}}}},router:{name:{type:"select-button-group",options:d.router,group:"connection",label:"Connection type",index:1},args:{side:{type:"select-box",options:d.side,placeholder:"Pick a side",group:"connection",label:"Anchors side",when:{eq:{"router/name":"oneSide"},otherwise:{unset:!0}},index:2}}},connector:{name:{type:"select-button-group",options:d.connector,group:"connection",label:"Connection style",index:3}},label:{type:"list",group:"labels",label:"Labels",attrs:{label:{"data-tooltip":"Set (possibly multiple) labels for the link","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}},item:{type:"object",properties:{attrs:{text:{text:{type:"content-editable",label:"text",defaultValue:"label",index:1,attrs:{label:{"data-tooltip":"Set text of the label","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}}},fill:{type:"color-palette",options:d.colorPaletteReset,label:"Text Color",index:5}},rect:{fill:{type:"color-palette",options:d.colorPaletteReset,label:"Fill",index:3},stroke:{type:"color-palette",options:d.colorPaletteReset,label:"Outline",index:4}}},position:{type:"select-box",options:d.labelPosition||[],defaultValue:.5,label:"Position",placeholder:"Custom",index:2,attrs:{label:{"data-tooltip":"Position the label relative to the source of the link","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}}}}}}},groups:{connection:{label:"Connection",index:1},"marker-source":{label:"Source marker",index:2},"marker-target":{label:"Target marker",index:3},labels:{label:"Labels",index:4}}}}setInspectorData(){}setPropertiesData(){const d=Object.assign(tw.getLinkData,{description:tw.getDescription});this.prop("prop/custom",d)}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:aE}}}ae(Ra,"shapeName",Mx);Mr.global;class kx extends(void 0){constructor(d,v){super(d,v)}ifEmbedable(d){return!0}ifDisallowLink(){return!0}getInspectorSchema(){}setInspectorData(){}defaults(){return{...super.defaults,type:"itea.mbt.test"}}}Mr.global;const ew=ho(),oE="MBTGroup";class _a extends kx{constructor(d,v){var f,b,I,P,L;super(d,v),this.attr({label:{refY:"10",text:(b=(f=this.get("prop"))==null?void 0:f.custom)!=null&&b.description?(I=this.get("prop").custom)==null?void 0:I.description:"Group"},border:{borderStyle:"dashed"},markers:{iconTypes:["loop"]}}),(L=(P=this.get("prop"))==null?void 0:P.custom)!=null&&L.description||this.set("prop",{custom:{description:"",loopCount:""}}),this.on("change",B=>{var R,O,G;if(B.changed&&B.changed.prop&&B.changed.prop.custom){const U=B.changed.prop.custom,H=U.description,K=((R=U.data)==null?void 0:R.description)||"",q=(O=U.data)!=null&&O.loopCount?((G=U.data)==null?void 0:G.loopCount)+"\u6B21":"",et=K+q,ht=H||et||"Group";this.attr({label:{text:ht}})}})}ifEmbedable(d){return super.ifEmbedable()}ifDisallowLink(){return super.ifDisallowLink()}setPropertiesData(){const d=ew.getGroupData;this.prop("prop/custom",Object.assign(d,{description:ew.getDescription}))}getInspectorSchema(){return{inputs:{attrs:{"label/text":{type:"textarea",label:"Loop Count",group:"general",index:1},"body/stroke":{type:"color",label:"Line Color",group:"appearance",index:1}}},schema:{type:"object",description:"",properties:{description:{title:"Description",type:"string"},loopCount:{title:"Loop Count",type:"integer"}}}}}setInspectorData(){}getPropertiesData(){return this.attributes.prop.custom}updataLabel(){var v;let d=this.get("attrs");this.prop("prop",{loop:(v=d==null?void 0:d.label)==null?void 0:v.text}),this.attributes.attrs.lable.text="loopCount"+d}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return super.defaults()}}ae(_a,"shapeName",oE);Mr.global;const sE=ho();window.joint=Za;const lE=["beforeAll","beforeEach","afterAll","afterEach"],uE="section";class Ga extends kx{constructor(d,v){var f,b,I,P,L;super(d,v),this.attr({label:{refY:"10",text:(b=(f=this.get("prop"))==null?void 0:f.custom)!=null&&b.description?(I=this.get("prop").custom)==null?void 0:I.description:"Section"},markers:{iconTypes:["ad-hoc"]}}),(L=(P=this.get("prop"))==null?void 0:P.custom)!=null&&L.description||this.set("prop",{custom:{description:""}}),this.on("change",B=>{var O,G;const R=(G=(O=B.changed)==null?void 0:O.prop)==null?void 0:G.custom;R&&this.attr({label:{text:R.description||"Section"}})})}ifEmbedable(d){return super.ifEmbedable()}ifDisallowLink(){return super.ifDisallowLink()}getInspectorSchema(){return{inputs:{attrs:{"label/text":{type:"textarea",label:"Section Name",group:"general",index:1},"body/stroke":{type:"color",label:"Line Color",group:"appearance",index:1}}},schema:{type:"object",description:"",properties:{type:{title:"type",type:"string",enum:lE}}}}}setPropertiesData(){this.prop("prop/custom",{description:sE.getDescription})}setInspectorData(){super.setInspectorData()}getPropertiesData(){return this.attributes.prop.custom}updateRectangles(){this.get("attrs"),this.prop("custom/step"),this.prop("custom/expectation")}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return super.defaults()}}ae(Ga,"shapeName",uE);Mr.global;window.joint=Za;const hE="startevent";class ja extends(void 0){constructor(d,v){super(d,v),this.attr({label:{text:"startevent"}}),this.on("change",f=>{f.changed&&f.changed.custom&&f.changed.custom&&(this.updateRectangles(),this.attr("label/text/0","test"))}),this.updateRectangles()}getInspectorSchema(){return{inputs:{attrs:{circle:{fill:{type:"color-palette",options:{colorPalette:[{content:"transparent",icon:"../src/assets/transparent-icon.svg"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}]}.colorPalette,label:"Fill",group:"presentation",index:1}}}},groups:{presentation:{label:"Presentation",index:1}}}}setInspectorData(){}updateRectangles(){this.get("attrs"),this.prop("custom/step"),this.prop("custom/expectation")}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:"itea.mbt.test"}}}ae(ja,"shapeName",hE);Mr.global;window.joint=Za;const cE="endevent";class Fa extends(void 0){constructor(d,v){super(d,v),this.attr({label:{text:"End"}}),this.on("change",f=>{f.changed&&f.changed.custom&&f.changed.custom&&(this.updateRectangles(),this.attr("label/text/0","test"))}),this.updateRectangles()}getInspectorSchema(){return{inputs:{attrs:{circle:{fill:{type:"color-palette",options:{colorPalette:[{content:"transparent",icon:"../src/assets/transparent-icon.svg"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}]}.colorPalette,label:"Fill",group:"presentation",index:1}}}},groups:{presentation:{label:"Presentation",index:1}}}}setInspectorData(){}updateRectangles(){this.get("attrs"),this.prop("custom/step"),this.prop("custom/expectation")}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:"itea.mbt.test"}}}ae(Fa,"shapeName",cE);Mr.global;const dE="parallelgateway";class Va extends(void 0){constructor(d,v){super(d,v),this.attr({icon:{iconType:"parallel"},label:{text:"Parallel"}}),this.on("change",f=>{f.changed&&f.changed.custom&&f.changed.custom&&(this.updateRectangles(),this.attr("label/text/0","test"))}),this.updateRectangles()}getOptions(d){return Object.keys(d).map(function(v){return{value:v,content:v}})}getInspectorSchema(){return{inputs:{attrs:{"icon/iconColor":{type:"color",label:"Icon Color",group:"appearance",index:3},"body/stroke":{type:"color",label:"Line Color",group:"appearance",index:2}}}}}setInspectorData(){}updateRectangles(){this.get("attrs"),this.prop("custom/step"),this.prop("custom/expectation")}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:"itea.mbt.test"}}}ae(Va,"shapeName",dE);Mr.global;const fE="exclusivegateway";class Wa extends(void 0){constructor(d,v){super(d,v),this.attr({icon:{iconType:"exclusive"},label:{text:"Conditional"}}),this.on("change",f=>{f.changed&&f.changed.custom&&f.changed.custom&&(this.updateRectangles(),this.attr("label/text/0","test"))}),this.updateRectangles()}getInspectorSchema(){return{inputs:{attrs:{"icon/iconColor":{type:"color",label:"Icon Color",group:"appearance",index:3},"body/stroke":{type:"color",label:"Line Color",group:"appearance",index:2}}}}}setInspectorData(){}updateRectangles(){this.get("attrs"),this.prop("custom/step"),this.prop("custom/expectation")}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:"itea.mbt.test"}}}ae(Wa,"shapeName",fE);const gE=iw("mbtmodel",{state:()=>({mbtData:{attributes:{codegen_script:"",codegen_text:""},dataDefinition:{data:{dataFrom:"",tableColumns:[],tableData:[]},meta:{schema:{},data:{}},resources:[]},modelDefinition:{cellsinfo:{},paperscale:""},name:"",_id:"",tags:[],description:""},schema:{},awData:{}}),getters:{getAlldata:c=>c.mbtData,getcells:c=>c.mbtData.modelDefinition.cellsinfo,getDafintion:c=>c.mbtData.dataDefinition,changeTemplate(c){let d={_id:"",name:"",description:"",codegen_script:"",codegen_text:""};if(c.mbtData._id.length>0)return d._id=c.mbtData._id,d.name=c.mbtData.name,d.description=c.mbtData.description,c.mbtData.attributes&&c.mbtData.attributes.codegen_script&&c.mbtData.attributes.codegen_script.length>0&&(d.codegen_script=c.mbtData.attributes.codegen_script,d.codegen_text=c.mbtData.attributes.codegen_text),d},showMetaSchema(c){var d,v;if((v=(d=c.mbtData.dataDefinition)==null?void 0:d.meta)!=null&&v.schema)return c.mbtData.dataDefinition.meta.schema},showMetaData(c){var d,v;if((v=(d=c.mbtData.dataDefinition)==null?void 0:d.meta)!=null&&v.data)return c.mbtData.dataDefinition.meta.data}},actions:{setMbtData(c){this.mbtData={...JSON.parse(JSON.stringify(c))}},async getMbtmodel(c){let d=await qv.get(`${Jv}/${c}`);this.setMbtData(d)},async saveMbtData(){this.mbtData._id&&qv.put(`${Jv}/${this.mbtData._id}`,this.mbtData).then(()=>"\u4FDD\u5B58\u6210\u529F").catch(()=>"\u4FDD\u5B58\u5931\u8D25")},saveattr(c){this.mbtData._id=c._id,this.mbtData.name=c.name,this.mbtData.description=c.description,c.codegen_text&&(this.mbtData.attributes.codegen_script=c.codegen_script,this.mbtData.attributes.codegen_text=c.codegen_text)},saveMeta(c,d){this.mbtData.dataDefinition.hasOwnProperty("meta")?(this.mbtData.dataDefinition.meta.schema={...c},this.mbtData.dataDefinition.meta.data={...d}):this.mbtData.dataDefinition.meta={schema:c,data:d}},saveData(c,d,v){this.mbtData.dataDefinition&&this.mbtData.dataDefinition.data&&this.mbtData.dataDefinition.data.dataFrom?(this.mbtData.dataDefinition.data.dataFrom=v,this.mbtData.dataDefinition.data.tableData=c,this.mbtData.dataDefinition.data.tableColumns=d):this.mbtData.dataDefinition.data={dataFrom:v,tableData:c,tableColumns:d}},saveResources(c){this.mbtData.dataDefinition.resources=c},saveAwData(c,d){this.schema=d,this.awData=c},setGraph(c){c&&this.mbtData.modelDefinition&&this.mbtData.modelDefinition.cellsinfo?this.mbtData.modelDefinition.cellsinfo=c:this.mbtData.modelDefinition={cellsinfo:c,paperscale:1}}}});gE();const Ui=ho();Mr.global;window.joint=Za;const vE="aw",pE="itea.mbt.test",Ud=class extends(void 0){constructor(d,v){var f,b,I,P,L;super(d,v),this.attr({icon:{iconType:(b=(f=this.get("prop"))==null?void 0:f.custom)!=null&&b.description?"script":"user"},label:{text:(P=(I=this.get("prop"))==null?void 0:I.custom)!=null&&P.description?(L=this.get("prop").custom)==null?void 0:L.description:"AW",fontSize:16}}),this.on("change",B=>{var R,O,G,U,H,K;if(B.changed&&B.changed.prop&&B.changed.prop.custom){const q=(O=(R=this.get("prop"))==null?void 0:R.custom)==null?void 0:O.description,et=((U=(G=Ui.getPrimaryAw)==null?void 0:G.schema)==null?void 0:U.description)||"",ht=((K=(H=Ui.getExpectedAw)==null?void 0:H.schema)==null?void 0:K.description)||"",mt=et&&ht?et+"/"+ht:et+ht,bt=q||mt||"AW";this.attr({icon:{iconType:q?"script":"user"},label:{text:bt}})}})}getPropertiesSchema(){const d=Ud.awData;return this.get("prop").custom?this.get("prop").custom:d}setPropertiesData(){const d=vk(Ui.getShowData.getPropertiesSchema());d.description=Ui.getDescription,d.expectation=Ui.getExpectedAw,d.step=Ui.getPrimaryAw,this.prop("prop/custom",d)}getInspectorSchema(){const d={colorPalette:[{content:"transparent",icon:"x"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],colorPaletteReset:[{content:void 0,icon:"y"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],fontWeight:[{value:"300",content:'<span style="font-weight: 300">Light</span>'},{value:"Normal",content:'<span style="font-weight: Normal">Normal</span>'},{value:"Bold",content:'<span style="font-weight: Bolder">Bold</span>'}],fontFamily:[{value:"Alegreya Sans",content:'<span style="font-family: Alegreya Sans">Alegreya Sans</span>'},{value:"Averia Libre",content:'<span style="font-family: Averia Libre">Averia Libre</span>'},{value:"Roboto Condensed",content:'<span style="font-family: Roboto Condensed">Roboto Condensed</span>'}],strokeStyle:[{value:"0",content:"Solid"},{value:"2,5",content:"Dotted"},{value:"10,5",content:"Dashed"}],side:[{value:"top",content:"Top Side"},{value:"right",content:"Right Side"},{value:"bottom",content:"Bottom Side"},{value:"left",content:"Left Side"}],portLabelPositionRectangle:[{value:{name:"top",args:{y:-12}},content:"Above"},{value:{name:"right",args:{y:0}},content:"On Right"},{value:{name:"bottom",args:{y:12}},content:"Below"},{value:{name:"left",args:{y:0}},content:"On Left"}],portLabelPositionEllipse:[{value:"radial",content:"Horizontal"},{value:"radialOriented",content:"Angled"}],imageIcons:[{value:"../assets/image-icon1.svg",content:'<img height="42px" src="assets/image-icon1.svg"/>'},{value:"../assets/image-icon2.svg",content:'<img height="80px" src="assets/image-icon2.svg"/>'},{value:"../assets/image-icon3.svg",content:'<img height="80px" src="assets/image-icon3.svg"/>'},{value:"../assets/image-icon4.svg",content:'<img height="80px" src="assets/image-icon4.svg"/>'}],imageGender:[{value:"../assets/member-male.png",content:'<img height="50px" src="assets/member-male.png" style="margin: 5px 0 0 2px;"/>'},{value:"../assets/member-female.png",content:'<img height="50px" src="assets/member-female.png" style="margin: 5px 0 0 2px;"/>'}],arrowheadSize:[{value:"M 0 0 0 0",content:"None"},{value:"M 0 -3 -6 0 0 3 z",content:"Small"},{value:"M 0 -5 -10 0 0 5 z",content:"Medium"},{value:"M 0 -10 -15 0 0 10 z",content:"Large"}],strokeWidth:[{value:1,content:'<div style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:2,content:'<div style="background:#fff;width:4px;height:30px;margin:0 13px;border-radius: 2px;"/>'},{value:4,content:'<div style="background:#fff;width:8px;height:30px;margin:0 11px;border-radius: 2px;"/>'},{value:8,content:'<div style="background:#fff;width:16px;height:30px;margin:0 8px;border-radius: 2px;"/>'}],router:[{value:"normal",content:'<p style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:"orthogonal",content:'<p style="width:20px;height:30px;margin:0 5px;border-bottom: 2px solid #fff;border-left: 2px solid #fff;"/>'},{value:"oneSide",content:'<p style="width:20px;height:30px;margin:0 5px;border: 2px solid #fff;border-top: none;"/>'}],connector:[{value:"normal",content:'<p style="width:20px;height:20px;margin:5px;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"rounded",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:30%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"smooth",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:100%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'}],labelPosition:[{value:30,content:"Close to source"},{value:.5,content:"In the middle"},{value:-30,content:"Close to target"}],portMarkup:[{value:[{tagName:"rect",selector:"portBody",attributes:{width:20,height:20,x:-10,y:-10}}],content:"Rectangle"},{value:[{tagName:"circle",selector:"portBody",attributes:{r:10}}],content:"Circle"},{value:[{tagName:"path",selector:"portBody",attributes:{d:"M -10 -10 10 -10 0 10 z"}}],content:"Triangle"}]};return{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2},body:{label:"body",index:3}}}}setInspectorData(){}updateRectangles(){var d,v,f,b;(v=(d=this.get("prop").custom.step)==null?void 0:d.data)!=null&&v.name&&this.attr({icon:{iconType:""},label:{text:(b=(f=this.get("prop").custom.step)==null?void 0:f.data)==null?void 0:b.name,fontSize:16}})}setSizeFromContent(){const{width:d,height:v}=this.layout();this.resize(d,v)}defaults(){return{...super.defaults,type:pE,size:{width:100,height:30},position:{x:10,y:10},prop:{isStep:!0,custom:{step:{},expectation:{},description:"",type:"aw"}}}}};let mi=Ud;ae(mi,"shapeName",vE),ae(mi,"awData",{step:{data:{},schema:{},uiParams:{}},expectation:{data:{},schema:{},uiParams:{}},description:""});/*! JointJS+ v3.6.1 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2022 client IO

 2022-11-22 


This Source Code Form is subject to the terms of the JointJS+ Trial License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/var Cd;(c=>{class d extends(void 0){constructor(){super(...arguments);ae(this,"portLabelMarkup",[{tagName:"text",selector:"portLabel"}])}defaults(){return(void 0)({type:"app.CircularModel",attrs:{root:{magnet:!1}},ports:{groups:{in:{markup:[{tagName:"circle",selector:"portBody",attributes:{r:10}}],attrs:{portBody:{magnet:!0,fill:"#61549c",strokeWidth:0},portLabel:{fontSize:11,fill:"#61549c",fontWeight:800}},position:{name:"ellipse",args:{startAngle:0,step:30}},label:{position:{name:"radial",args:null}}},out:{markup:[{tagName:"circle",selector:"portBody",attributes:{r:10}}],attrs:{portBody:{magnet:!0,fill:"#61549c",strokeWidth:0},portLabel:{fontSize:11,fill:"#61549c",fontWeight:800}},position:{name:"ellipse",args:{startAngle:180,step:30}},label:{position:{name:"radial",args:null}}}}}},void 0)}}c.CircularModel=d})(Cd||(Cd={}));const Px=(void 0)({body:null,markup:[{tagName:"rect",selector:"body",attributes:{fill:"#31d0c6"}}],initFlag:["RENDER","UPDATE","TRANSFORM"],presentationAttributes:{size:["UPDATE"],position:["TRANSFORM"],angle:["TRANSFORM"]},confirmUpdate:function(c){this.hasFlag(c,"RENDER")&&this.render(),this.hasFlag(c,"UPDATE")&&this.update(),this.hasFlag(c,"TRANSFORM")&&this.updateTransformation()},render:function(){const{fragment:c,selectors:{body:d}}=(void 0)(this.markup);this.body=d,this.el.appendChild(c)},update:function(){const{model:c,body:d}=this,{width:v,height:f}=c.size();d.setAttribute("width",v),d.setAttribute("height",f)}}),Tx=(void 0)({defaultTheme:null,initialize:function(c){(void 0)(this,c)},onMount:void 0,render:void 0,update:void 0});Object.assign(void 0,{itea:{mbt:{test:{MBTGroup:_a,MBTLink:Ra,MBTAW:mi,MBTSection:Ga,MBTStartEvent:ja,MBTEndEvent:Fa,MBTExclusiveGateway:Wa,MBTParallelGateway:Va}}}});const mE=void 0,yE=void 0,bE=void 0,wE=void 0,xE=void 0,AE=void 0,CE=void 0,Id=void 0,rw=Object.freeze(Object.defineProperty({__proto__:null,get app(){return Cd},NavigatorElementView:Px,NavigatorLinkView:Tx,basic:mE,standard:yE,fsa:bE,pn:wE,erd:xE,uml:AE,org:CE,shapes:Id},Symbol.toStringTag,{value:"Module"}));class IE{constructor(d,v,f,b,I,P){ae(this,"el");ae(this,"graph");ae(this,"paper");ae(this,"paperScroller");ae(this,"commandManager");ae(this,"snaplines");ae(this,"clipboard");ae(this,"selection");ae(this,"navigator");ae(this,"stencilService");ae(this,"toolbarService");ae(this,"haloService");ae(this,"InspectorService");ae(this,"keyboardService");ae(this,"exportStylesheet",".scalable * { vector-effect: non-scaling-stroke }");this.el=d,new(void 0)({el:d}).delegateEvents({'mouseup input[type="range"]':B=>B.target.blur()}),this.stencilService=v,this.toolbarService=f,this.haloService=b,this.InspectorService=I,this.keyboardService=P}startRappid(){(void 0)("material"),this.initializePaper(),this.initializeStencil(),this.initializeToolbar(),this.initializeTooltips(),this.initializeSelection(),this.initializeToolsAndInspector(),this.initializeKeyboardShortcuts(),this.initializeNavigator()}initializeSelection(){this.clipboard=new(void 0),this.selection=new(void 0)({paper:this.paper,useModelGeometry:!0,translateConnectedLinks:void 0}),this.selection.collection.on("reset add remove",this.onSelectionChange.bind(this));const d=this.keyboardService.keyboard;this.paper.on("element:pointerdown",(v,f)=>{d.isActive("ctrl meta",f)&&this.selection.collection.add(v.model)}),this.graph.on("remove",v=>{this.selection.collection.has(v)&&this.selection.collection.reset(this.selection.collection.models.filter(f=>f!==v))}),this.selection.on("selection-box:pointerdown",(v,f)=>{d.isActive("ctrl meta",f)&&this.selection.collection.remove(v.model)},this),this.selection.on("selection-box:pointerup",(v,f)=>{f.button===2&&(f.stopPropagation(),f.clientX&&f.clientY&&this.renderContextToolbar({x:f.clientX,y:f.clientY},this.selection.collection.toArray()))},this)}initializeKeyboardShortcuts(){this.keyboardService.create(this.graph,this.clipboard,this.selection,this.paperScroller,this.commandManager)}initializeNavigator(){const d=this.navigator=new(void 0)({width:240,height:115,paperScroller:this.paperScroller,zoom:!1,paperOptions:{async:!0,sorting:void 0,elementView:Px,linkView:Tx,cellViewNamespace:{}}});this.renderPlugin(".navigator-container",d)}onSelectionChange(){const{paper:d,selection:v}=this,{collection:f}=v;if(d.removeTools(),(void 0)(d),(void 0)(d),(void 0)(),f.length===1){const b=f.first(),I=d.findViewByModel(b);v.destroySelectionBox(b),this.selectPrimaryCell(I)}else f.length===2&&f.each(function(b){v.createSelectionBox(b)})}selectPrimaryCell(d){let v;v=d.model,v.isElement()?this.selectPrimaryElement(d):this.selectPrimaryLink(d),this.InspectorService.create(v)}selectPrimaryElement(d){let v;v=d.model,new(void 0)({cellView:d,allowRotation:!1,preserveAspectRatio:!!v.get("preserveAspectRatio"),allowOrthogonalResize:v.get("allowOrthogonalResize")!==!1}).render(),this.haloService.create(d)}selectPrimaryLink(d){const f=new(void 0)({name:"link-pointerdown",tools:[new(void 0).Vertices,new(void 0).SourceAnchor,new(void 0).TargetAnchor,new(void 0).SourceArrowhead,new(void 0).TargetArrowhead,new(void 0).Segments,new(void 0).Boundary({padding:15}),new(void 0).Remove({offset:-20,distance:40})]});d.addTools(f)}initializePaper(){const d=this.graph=new(void 0)({},{cellNamespace:Id});this.commandManager=new(void 0)({graph:d});const v=this.paper=new(void 0)({width:1100,height:1e3,gridSize:10,drawGrid:!0,model:d,cellViewNamespace:Id,defaultLink:new Ra,defaultConnectionPoint:Ra.connectionPoint,interactive:{linkMove:!1},async:!0,sorting:void 0,embeddingMode:!0,validateEmbedding:(b,I)=>{var P;return(P=I.model)!=null&&P.ifEmbedable?I.model.ifEmbedable(b.model):!1},validateConnection:function(b,I,P,L,B,R){const O=P.model;return O.ifDisallowLink&&O.ifDisallowLink()?!1:(B==="target"?P:b)instanceof void 0}});v.on("blank:contextmenu",b=>{b.clientX&&b.clientY&&this.renderContextToolbar({x:b.clientX,y:b.clientY})}),v.on("cell:contextmenu",(b,I)=>{I.clientX&&I.clientY&&b.model&&this.renderContextToolbar({x:I.clientX,y:I.clientY},[b.model])}),this.snaplines=new(void 0)({paper:v});const f=this.paperScroller=new(void 0)({paper:v,autoResizePaper:!0,scrollWhileDragging:!0,cursor:"grab"});this.renderPlugin(".paper-container",f),f.render().center(),v.on("paper:pan",(b,I,P)=>{b.preventDefault(),f.el.scrollLeft+=I,f.el.scrollTop+=P}),v.on("paper:pinch",(b,I,P,L)=>{const B=f.zoom();f.zoom(B*L,{min:.2,max:5,ox:I,oy:P,absolute:!0})})}initializeStencil(){const{stencilService:d,paperScroller:v,snaplines:f}=this;d.create(v,f),this.renderPlugin(".stencil-container",d.stencil),d.setShapes(),d.stencil.on("element:drop",b=>{var P,L,B,R;var I=(P=b.model)==null?void 0:P.get("type");I=="itea.mbt.test.MBTAW"?(L=b.model)==null||L.set("size",{width:120,height:70}):I=="itea.mbt.test.MBTGroup"?(B=b.model)==null||B.set("size",{width:150,height:100}):I=="itea.mbt.test.MBTSection"&&((R=b.model)==null||R.set("size",{width:150,height:100})),this.selection.collection.reset([b.model])})}saveData(){console.log("oooooooo data:",this.paper.model.toJSON())}initializeToolbar(){this.toolbarService.create(this.commandManager,this.paperScroller),console.log(this.toolbarService),this.toolbarService.toolbar.on({"svg:pointerclick":this.openAsSVG.bind(this),"png:pointerclick":this.openAsPNG.bind(this),"to-front:pointerclick":this.applyOnSelection.bind(this,"toFront"),"to-back:pointerclick":this.applyOnSelection.bind(this,"toBack"),"layout:pointerclick":this.layoutDirectedGraph.bind(this),"clear:pointerclick":this.graph.clear.bind(this.graph),"print:pointerclick":this.paper.print.bind(this.paper),"save:pointerclick":this.saveData.bind(this)}),this.renderPlugin(".toolbar-container",this.toolbarService.toolbar)}applyOnSelection(d){this.graph.startBatch("selection"),this.selection.collection.models.forEach(function(v){v[d]()}),this.graph.stopBatch("selection")}changeSnapLines(d){d?this.snaplines.enable():this.snaplines.disable()}renderContextToolbar(d,v=[]){this.selection.collection.reset(v);const f=new(void 0)({target:d,root:this.paper.el,padding:0,vertical:!0,anchor:"top-left",tools:[{action:"copy",content:"Copy",attrs:{disabled:v.length===0}},{action:"paste",content:"Paste",attrs:{disabled:this.clipboard.isEmpty()}}]});f.on("action:copy",()=>{f.remove(),this.clipboard.copyElements(v,this.graph)}),f.on("action:paste",()=>{f.remove();const I=this.clipboard.pasteCellsAtPoint(this.graph,this.paper.clientToLocalPoint(d)).filter(P=>P.isElement());this.selection.collection.reset(I)}),f.render()}initializeToolsAndInspector(){this.paper.on("cell:pointerup",d=>{const v=d.model,{collection:f}=this.selection;f.includes(v)||f.reset([v])}),this.paper.on("link:mouseenter",d=>{if(d.hasTools())return;const v=void 0,f=new(void 0)({name:"link-hover",tools:[new v.Vertices({vertexAdding:!1}),new v.SourceArrowhead,new v.TargetArrowhead]});d.addTools(f)}),this.paper.on("link:mouseleave",d=>{d.hasTools("link-hover")&&d.removeTools()}),this.graph.on("change",(d,v)=>{if(!d.isLink()||!v.inspector)return;const f=void 0,b=new(void 0)({name:"link-inspected",tools:[new f.Boundary({padding:15})]});d.findView(this.paper).addTools(b)})}initializeTooltips(){return new(void 0)({rootTarget:document.body,target:"[data-tooltip]",direction:void 0,padding:10})}openAsSVG(){this.paper.hideTools().toSVG(d=>{new(void 0)({image:"data:image/svg+xml,"+encodeURIComponent(d),downloadable:!0,fileName:"Rappid"}).open(),this.paper.showTools()},{preserveDimensions:!0,convertImagesToDataUris:!0,useComputedStyles:!1,stylesheet:this.exportStylesheet})}openAsPNG(){this.paper.hideTools().toPNG(d=>{new(void 0)({image:d,downloadable:!0,fileName:"Rappid"}).open(),this.paper.showTools()},{padding:10,useComputedStyles:!1,stylesheet:this.exportStylesheet})}layoutDirectedGraph(){(void 0)(this.graph,{graphlib:Ad.graphlib,dagre:nE,setVertices:!0,rankDir:"TB",marginX:100,marginY:100}),this.paperScroller.centerContent({useModelGeometry:!0})}renderPlugin(d,v){this.el.querySelector(d).appendChild(v.el),v.render()}}const PE=IE;Mr.global;class TE{constructor(){ae(this,"stencil")}create(d,v){this.stencil=new(void 0)({paper:d,snaplines:v,width:200,groups:this.getStencilGroups(),dropAnimation:!0,groupsToggleButtons:!0,paperOptions:function(){return{model:new(void 0)({},{cellNamespace:{...rw,itea:{mbt:{test:{MBTAW:mi,MBTGroup:_a,MBTSection:Ga,MBTStartEvent:ja,MBTEndEvent:Fa,MBTParallelGateway:Va,MBTExclusiveGateway:Wa}}}}}),cellViewNamespace:{...rw,itea:{mbt:{test:{MBTAW:mi,MBTGroup:_a,MBTSection:Ga,MBTStartEvent:ja,MBTEndEvent:Fa,MBTParallelGateway:Va,MBTExclusiveGateway:Wa}}}}}},search:{"*":["type","attrs/text/text","attrs/root/dataTooltip","attrs/label/text"],"org.Member":["attrs/.rank/text","attrs/root/dataTooltip","attrs/.name/text"]},layout:{columns:2,marginX:5,marginY:5,columnGap:8,columnWidth:80,resizeToFit:!1,dx:0,dy:0},dragStartClone:f=>f.clone().removeAttr("root/dataTooltip")})}setShapes(){this.stencil.load(this.getStencilShapes())}getStencilGroups(){return{standard:{index:1,label:"Standard shapes"},grouprelated:{index:2,label:"Group shapes"}}}getStencilShapes(){return{standard:[{type:"itea.mbt.test.MBTAW",size:{width:50,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"AW",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"#31d0c6",strokeWidth:2,strokeDasharray:"0"},label:{text:"AW",fill:"#c6c7e2",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}},{type:"itea.mbt.test.MBTStartEvent",size:{width:35,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"Start",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"#31d0c6",strokeWidth:2,strokeDasharray:"0"},label:{text:"Start",fill:"black",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}},{type:"itea.mbt.test.MBTEndEvent",size:{width:35,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"End",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"#31d0c6",strokeWidth:2,strokeDasharray:"0"},label:{text:"End",fill:"black",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0},border:{borderType:"double"}}},{type:"itea.mbt.test.MBTParallelGateway",size:{width:50,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"Parallel",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"black",strokeWidth:2,strokeDasharray:"0"},label:{text:"Parallel",fill:"black",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}},{type:"itea.mbt.test.MBTExclusiveGateway",size:{width:50,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"Conditional",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"black",strokeWidth:2,strokeDasharray:"0"},label:{text:"Conditional",fill:"black",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}}],grouprelated:[{type:"itea.mbt.test.MBTGroup",size:{width:50,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"Group",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"#31d0c6",strokeWidth:2,strokeDasharray:"0"},label:{text:"Group",fill:"#c6c7e2",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}},{type:"itea.mbt.test.MBTSection",size:{width:50,height:35},allowOrthogonalResize:!1,attrs:{root:{dataTooltip:"Section",dataTooltipPosition:"left",dataTooltipPositionSelector:".joint-stencil"},body:{fill:"transparent",stroke:"#31d0c6",strokeWidth:2,strokeDasharray:"0"},label:{text:"Section",fill:"#c6c7e2",fontFamily:"Roboto Condensed",fontWeight:"Normal",fontSize:11,strokeWidth:0}}}]}}}class NE{constructor(){ae(this,"toolbar",new(void 0))}create(d,v){const{tools:f,groups:b}=this.getToolbarConfig();this.toolbar=new(void 0)({groups:b,tools:f,autoToggle:!0,references:{paperScroller:v,commandManager:d}})}getToolbarConfig(){return{groups:{"undo-redo":{index:1},clear:{index:2},export:{index:3},fullscreen:{index:4},order:{index:5},layout:{index:7},zoom:{index:8},grid:{index:9,default:10},snapline:{index:10},save:{index:11}},tools:[{type:"undo",name:"undo",group:"undo-redo",attrs:{button:{"data-tooltip":"Undo","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"redo",name:"redo",group:"undo-redo",attrs:{button:{"data-tooltip":"Redo","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"button",name:"clear",group:"clear",attrs:{button:{id:"btn-clear","data-tooltip":"Clear Paper","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"button",name:"svg",group:"export",text:"Export SVG",attrs:{button:{id:"btn-svg","data-tooltip":"Open as SVG in a pop-up","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"button",name:"png",group:"export",text:"Export PNG",attrs:{button:{id:"btn-png","data-tooltip":"Open as PNG in a pop-up","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"button",group:"layout",name:"layout",attrs:{button:{"data-tooltip":"Auto-layout Graph","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"zoom-to-fit",name:"zoom-to-fit",group:"zoom",attrs:{button:{"data-tooltip":"Zoom To Fit","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"zoom-out",name:"zoom-out",group:"zoom",attrs:{button:{"data-tooltip":"Zoom Out","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"label",name:"zoom-slider-label",group:"zoom",text:"Zoom:"},{type:"zoom-slider",name:"zoom-slider",group:"zoom"},{type:"zoom-in",name:"zoom-in",group:"zoom",attrs:{button:{"data-tooltip":"Zoom In","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"fullscreen",name:"fullscreen",group:"fullscreen",attrs:{button:{"data-tooltip":"Toggle Fullscreen Mode","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}},{type:"button",name:"save",group:"export",text:"Save",attrs:{button:{id:"btn-save","data-tooltip":"Save data to backend","data-tooltip-position":"top","data-tooltip-position-selector":".toolbar-container"}}}]}}}/*! JointJS+ v3.6.1 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2022 client IO

 2022-11-22 


This Source Code Form is subject to the terms of the JointJS+ Trial License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/const Mn=void 0;class LE{create(d){let v=this.getHaloConfig();const f=d.model;f.ifDisallowLink&&f.ifDisallowLink()&&(v=v.filter(b=>["link","fork","clone"].indexOf(b.name)==-1)),new(void 0)({cellView:d,handles:v,useModelGeometry:!0}).render()}getHaloConfig(){return[{name:"remove",position:Mn.NW,events:{pointerdown:"removeElement"},attrs:{".handle":{"data-tooltip-class-name":"small","data-tooltip":"Click to remove the object","data-tooltip-position":"right","data-tooltip-padding":15}}},{name:"fork",position:Mn.NE,events:{pointerdown:"startForking",pointermove:"doFork",pointerup:"stopForking"},attrs:{".handle":{"data-tooltip-class-name":"small","data-tooltip":"Click and drag to clone and connect the object in one go","data-tooltip-position":"left","data-tooltip-padding":15}}},{name:"clone",position:Mn.SE,events:{pointerdown:"startCloning",pointermove:"doClone",pointerup:"stopCloning"},attrs:{".handle":{"data-tooltip-class-name":"small","data-tooltip":"Click and drag to clone the object","data-tooltip-position":"left","data-tooltip-padding":15}}},{name:"unlink",position:Mn.W,events:{pointerdown:"unlinkElement"},attrs:{".handle":{"data-tooltip-class-name":"small","data-tooltip":"Click to break all connections to other objects","data-tooltip-position":"right","data-tooltip-padding":15}}},{name:"link",position:Mn.E,events:{pointerdown:"startLinking",pointermove:"doLink",pointerup:"stopLinking"},attrs:{".handle":{"data-tooltip-class-name":"small","data-tooltip":"Click and drag to connect the object","data-tooltip-position":"left","data-tooltip-padding":15}}}]}}/*! JointJS+ v3.6.1 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2022 client IO

 2022-11-22 


This Source Code Form is subject to the terms of the JointJS+ Trial License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/class EE{create(d){const v=d;if(v.getInspectorSchema)return(void 0)(".inspector-container",{...v.getInspectorSchema(),cell:d});const{groups:f,inputs:b}=this.getInspectorConfig()[d.get("type")];return(void 0)(".inspector-container",{cell:d,inputs:b,groups:f})}getInspectorConfig(){const d={colorPalette:[{content:"transparent",icon:"../assets/no-color-icon.svg"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],colorPaletteReset:[{content:void 0,icon:"../assets/no-color-icon.svg"},{content:"#f6f6f6"},{content:"#dcd7d7"},{content:"#8f8f8f"},{content:"#c6c7e2"},{content:"#feb663"},{content:"#fe854f"},{content:"#b75d32"},{content:"#31d0c6"},{content:"#7c68fc"},{content:"#61549c"},{content:"#6a6c8a"},{content:"#4b4a67"},{content:"#3c4260"},{content:"#33334e"},{content:"#222138"}],fontWeight:[{value:"300",content:'<span style="font-weight: 300">Light</span>'},{value:"Normal",content:'<span style="font-weight: Normal">Normal</span>'},{value:"Bold",content:'<span style="font-weight: Bolder">Bold</span>'}],fontFamily:[{value:"Alegreya Sans",content:'<span style="font-family: Alegreya Sans">Alegreya Sans</span>'},{value:"Averia Libre",content:'<span style="font-family: Averia Libre">Averia Libre</span>'},{value:"Roboto Condensed",content:'<span style="font-family: Roboto Condensed">Roboto Condensed</span>'}],strokeStyle:[{value:"0",content:"Solid"},{value:"2,5",content:"Dotted"},{value:"10,5",content:"Dashed"}],side:[{value:"top",content:"Top Side"},{value:"right",content:"Right Side"},{value:"bottom",content:"Bottom Side"},{value:"left",content:"Left Side"}],portLabelPositionRectangle:[{value:{name:"top",args:{y:-12}},content:"Above"},{value:{name:"right",args:{y:0}},content:"On Right"},{value:{name:"bottom",args:{y:12}},content:"Below"},{value:{name:"left",args:{y:0}},content:"On Left"}],portLabelPositionEllipse:[{value:"radial",content:"Horizontal"},{value:"radialOriented",content:"Angled"}],imageIcons:[{value:"../assets/image-icon1.svg",content:'<img height="42px" src="assets/image-icon1.svg"/>'},{value:"../assets/image-icon2.svg",content:'<img height="80px" src="assets/image-icon2.svg"/>'},{value:"../assets/image-icon3.svg",content:'<img height="80px" src="assets/image-icon3.svg"/>'},{value:"../assets/image-icon4.svg",content:'<img height="80px" src="assets/image-icon4.svg"/>'}],imageGender:[{value:"../assets/member-male.png",content:'<img height="50px" src="assets/member-male.png" style="margin: 5px 0 0 2px;"/>'},{value:"../assets/member-female.png",content:'<img height="50px" src="assets/member-female.png" style="margin: 5px 0 0 2px;"/>'}],arrowheadSize:[{value:"M 0 0 0 0",content:"None"},{value:"M 0 -3 -6 0 0 3 z",content:"Small"},{value:"M 0 -5 -10 0 0 5 z",content:"Medium"},{value:"M 0 -10 -15 0 0 10 z",content:"Large"}],strokeWidth:[{value:1,content:'<div style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:2,content:'<div style="background:#fff;width:4px;height:30px;margin:0 13px;border-radius: 2px;"/>'},{value:4,content:'<div style="background:#fff;width:8px;height:30px;margin:0 11px;border-radius: 2px;"/>'},{value:8,content:'<div style="background:#fff;width:16px;height:30px;margin:0 8px;border-radius: 2px;"/>'}],router:[{value:"normal",content:'<p style="background:#fff;width:2px;height:30px;margin:0 14px;border-radius: 2px;"/>'},{value:"orthogonal",content:'<p style="width:20px;height:30px;margin:0 5px;border-bottom: 2px solid #fff;border-left: 2px solid #fff;"/>'},{value:"oneSide",content:'<p style="width:20px;height:30px;margin:0 5px;border: 2px solid #fff;border-top: none;"/>'}],connector:[{value:"normal",content:'<p style="width:20px;height:20px;margin:5px;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"rounded",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:30%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'},{value:"smooth",content:'<p style="width:20px;height:20px;margin:5px;border-top-left-radius:100%;border-top:2px solid #fff;border-left:2px solid #fff;"/>'}],labelPosition:[{value:30,content:"Close to source"},{value:.5,content:"In the middle"},{value:-30,content:"Close to target"}],portMarkup:[{value:[{tagName:"rect",selector:"portBody",attributes:{width:20,height:20,x:-10,y:-10}}],content:"Rectangle"},{value:[{tagName:"circle",selector:"portBody",attributes:{r:10}}],content:"Circle"},{value:[{tagName:"path",selector:"portBody",attributes:{d:"M -10 -10 10 -10 0 10 z"}}],content:"Triangle"}]};return{"standard.Link":{inputs:{attrs:{line:{strokeWidth:{type:"select-button-group",options:d.strokeWidth,group:"connection",label:"Link thickness",when:{ne:{"attrs/line/stroke":"transparent"}},index:4},strokeDasharray:{type:"select-box",options:d.strokeStyle,group:"connection",label:"Link style",when:{ne:{"attrs/line/stroke":"transparent"}},index:5},stroke:{type:"color-palette",options:d.colorPalette,group:"connection",label:"Color",index:6},sourceMarker:{d:{type:"select-box",options:d.arrowheadSize,group:"marker-source",label:"Source arrowhead",index:1},fill:{type:"color-palette",options:d.colorPaletteReset,group:"marker-source",label:"Color",when:{ne:{"attrs/line/sourceMarker/d":"M 0 0 0 0"}},index:2}},targetMarker:{d:{type:"select-box",options:d.arrowheadSize,group:"marker-target",label:"Target arrowhead",index:1},fill:{type:"color-palette",options:d.colorPaletteReset,group:"marker-target",label:"Color",when:{ne:{"attrs/line/targetMarker/d":"M 0 0 0 0"}},index:2}}}},router:{name:{type:"select-button-group",options:d.router,group:"connection",label:"Connection type",index:1},args:{side:{type:"select-box",options:d.side,placeholder:"Pick a side",group:"connection",label:"Anchors side",when:{eq:{"router/name":"oneSide"},otherwise:{unset:!0}},index:2}}},connector:{name:{type:"select-button-group",options:d.connector,group:"connection",label:"Connection style",index:3}},labels:{type:"list",group:"labels",label:"Labels",attrs:{label:{"data-tooltip":"Set (possibly multiple) labels for the link","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}},item:{type:"object",properties:{attrs:{text:{text:{type:"content-editable",label:"text",defaultValue:"label",index:1,attrs:{label:{"data-tooltip":"Set text of the label","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}}},fill:{type:"color-palette",options:d.colorPaletteReset,label:"Text Color",index:5}},rect:{fill:{type:"color-palette",options:d.colorPaletteReset,label:"Fill",index:3},stroke:{type:"color-palette",options:d.colorPaletteReset,label:"Outline",index:4}}},position:{type:"select-box",options:d.labelPosition||[],defaultValue:.5,label:"Position",placeholder:"Custom",index:2,attrs:{label:{"data-tooltip":"Position the label relative to the source of the link","data-tooltip-position":"right","data-tooltip-position-selector":".joint-inspector"}}}}}}},groups:{connection:{label:"Connection",index:1},"marker-source":{label:"Source marker",index:2},"marker-target":{label:"Target marker",index:3},labels:{label:"Labels",index:4}}},"standard.Rectangle":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"standard.Ellipse":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/stroke-width":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"standard.Cylinder":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}},top:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"top",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"top",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"top",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"top",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},top:{label:"Top",index:2},text:{label:"Text",index:3}}},"standard.HeaderedRectangle":{inputs:{attrs:{bodyText:{textWrap:{text:{type:"content-editable",label:"Expected",group:"Expected",index:1}},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"Expected",when:{ne:{"attrs/bodyText/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"Expected",when:{ne:{"attrs/bodyText/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"Expected",when:{ne:{"attrs/bodyText/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"Expected",when:{ne:{"attrs/boduText/text":""}},index:5}},headerText:{text:{type:"content-editable",label:"AwPrimary",group:"AwPrimary",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"AwPrimary",when:{ne:{"attrs/headerText/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"AwPrimary",when:{ne:{"attrs/headerText/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"AwPrimary",when:{ne:{"attrs/headerText/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"AwPrimary",when:{ne:{"attrs/headerText/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}},header:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"header",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"header",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"header",when:{ne:{"attrs/header/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"header",when:{and:[{ne:{"attrs/header/stroke":"transparent"}},{ne:{"attrs/header/strokeWidth":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2},header:{label:"Header",index:3},AwPrimary:{label:"AwPrimary",index:4}}},"standard.Polygon":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"app.RectangularModel":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}},ports:{items:{group:"ports",type:"list",label:"Ports",item:{type:"object",properties:{group:{type:"select-button-group",label:"Group",defaultValue:"out",options:[{value:"in",content:"IN"},{value:"out",content:"OUT"}]},attrs:{portLabel:{text:{type:"text",label:"Label"}},portBody:{fill:{type:"color-palette",options:d.colorPaletteReset,label:"Override Group Fill",index:1}}}}}},groups:{in:{attrs:{portBody:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",when:{not:{equal:{inPorts:[]}}},group:"inPorts",index:1}}},position:{name:{type:"select-box",options:d.side,label:"Position",when:{not:{equal:{inPorts:[]}}},group:"inPorts",index:3}},label:{position:{type:"select-box",options:d.portLabelPositionRectangle,label:"Text Position",when:{not:{equal:{inPorts:[]}}},group:"inPorts",index:4}},markup:{type:"select-box",options:d.portMarkup,label:"Port Shape",group:"inPorts",index:5,overwrite:!0}},out:{attrs:{portBody:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",when:{not:{equal:{outPorts:[]}}},group:"outPorts",index:2}}},position:{name:{type:"select-box",options:d.side,label:"Position",when:{not:{equal:{outPorts:[]}}},group:"outPorts",index:4}},label:{position:{type:"select-box",options:d.portLabelPositionRectangle,label:"Text Position",when:{not:{equal:{outPorts:[]}}},group:"outPorts",index:5}},markup:{type:"select-box",options:d.portMarkup,label:"Port Shape",group:"outPorts",index:6,overwrite:!0}}}}},groups:{inPorts:{label:"Input Ports Defaults",index:1},outPorts:{label:"Output Ports Defaults",index:2},ports:{label:"Ports",index:3},presentation:{label:"Presentation",index:4},text:{label:"Text",index:5}}},"app.CircularModel":{inputs:{attrs:{label:{text:{type:"content-editable",label:"Text",group:"text",index:1},fontSize:{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/label/text":""}},index:2},fontFamily:{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/label/text":""}},index:3},fontWeight:{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/label/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/label/text":""}},index:5}},body:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},strokeWidth:{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/body/stroke":"transparent"}},index:3},strokeDasharray:{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/body/stroke":"transparent"}},{ne:{"attrs/body/strokeWidth":0}}]},index:4}}},ports:{items:{group:"ports",type:"list",label:"Ports",item:{type:"object",properties:{group:{type:"select-button-group",label:"Group",defaultValue:"out",options:[{value:"in",content:"IN"},{value:"out",content:"OUT"}]},attrs:{portLabel:{text:{type:"text",label:"Label"}},portBody:{fill:{type:"color-palette",options:d.colorPaletteReset,label:"Override Group Fill",index:1}}}}}},groups:{in:{attrs:{portBody:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",when:{not:{equal:{"ports/items":[]}}},group:"inPorts",index:1}}},position:{args:{startAngle:{type:"range",min:0,max:360,step:1,defaultValue:0,unit:"\xB0",label:"Position",when:{not:{equal:{"ports/items":[]}}},group:"inPorts",index:3}}},label:{position:{name:{type:"select-button-group",options:d.portLabelPositionEllipse,label:"Text direction",when:{not:{equal:{"ports/items":[]}}},group:"inPorts",index:4}}},markup:{type:"select-box",options:d.portMarkup,label:"Port Shape",group:"inPorts",index:5,overwrite:!0}},out:{attrs:{portBody:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",when:{not:{equal:{"ports/items":[]}}},group:"outPorts",index:2}}},position:{args:{startAngle:{type:"range",min:0,max:360,step:1,defaultValue:180,unit:"\xB0",label:"Position",when:{not:{equal:{"ports/items":[]}}},group:"outPorts",index:4}}},label:{position:{name:{type:"select-button-group",options:d.portLabelPositionEllipse,label:"Text Position",when:{not:{equal:{"ports/items":[]}}},group:"outPorts",index:5}}},markup:{type:"select-box",options:d.portMarkup,label:"Port Shape",group:"outPorts",index:6,overwrite:!0}}}}},groups:{inPorts:{label:"Input Ports Defaults",index:1},outPorts:{label:"Output Ports Defaults",index:2},ports:{label:"Ports",index:3},presentation:{label:"Presentation",index:4},text:{label:"Text",index:5}}},"uml.StartState":{inputs:{attrs:{circle:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1}}}},groups:{presentation:{label:"Presentation",index:1}}},"uml.EndState":{inputs:{attrs:{".outer":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/.outer/stroke":"transparent"}},{ne:{"attrs/.outer/stroke-width":0}}]},index:4}},".inner":{fill:{type:"color-palette",options:d.colorPalette,label:"Inner fill",group:"presentation",index:2}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"fsa.State":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/text/text":""}},index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},circle:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/circle/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/circle/stroke":"transparent"}},{ne:{"attrs/circle/stroke-width":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"erd.Key":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/text/text":""}},index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},".outer":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"outer",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"outer",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"outer",when:{ne:{"attrs/.outer/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"outer",when:{and:[{ne:{"attrs/.outer/stroke":"transparent"}},{ne:{"attrs/.outer/stroke-width":0}}]},index:4}},".inner":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"inner",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"inner",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"inner",when:{ne:{"attrs/.inner/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"inner",when:{and:[{ne:{"attrs/.inner/stroke":"transparent"}},{ne:{"attrs/.inner/stroke-width":0}}]},index:4}}}},groups:{text:{label:"Text",index:1},outer:{label:"Outer ellipse",index:2},inner:{label:"Inner ellipse",index:3}}},"erd.Normal":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},".outer":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/.outer/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/.outer/stroke":"transparent"}},{ne:{"attrs/.outer/stroke-width":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}},"erd.Multivalued":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/text/text":""}},index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},".outer":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"outer",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"outer",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"outer",when:{ne:{"attrs/.outer/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"outer",when:{and:[{ne:{"attrs/.outer/stroke":"transparent"}},{ne:{"attrs/.outer/stroke-width":0}}]},index:4}},".inner":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"inner",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"inner",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"inner",when:{ne:{"attrs/.inner/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"inner",when:{and:[{ne:{"attrs/.inner/stroke":"transparent"}},{ne:{"attrs/.inner/stroke-width":0}}]},index:4}}}},groups:{text:{label:"Text",index:1},outer:{label:"Outer ellipse",index:2},inner:{label:"Inner ellipse",index:3}}},"erd.Derived":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/text/text":""}},index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},".outer":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"outer",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"outer",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"outer",when:{ne:{"attrs/.outer/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"outer",when:{and:[{ne:{"attrs/.outer/stroke":"transparent"}},{ne:{"attrs/.outer/stroke-width":0}}]},index:4}},".inner":{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"inner",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"inner",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"inner",when:{ne:{"attrs/.inner/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"inner",when:{and:[{ne:{"attrs/.inner/stroke":"transparent"}},{ne:{"attrs/.inner/stroke-width":0}}]},index:4}}}},groups:{text:{label:"Text",index:1},outer:{label:"Outer ellipse",index:2},inner:{label:"Inner ellipse",index:3}}},"erd.ISA":{inputs:{attrs:{text:{text:{type:"content-editable",label:"Text",group:"text",index:1},"font-size":{type:"range",min:5,max:80,unit:"px",label:"Font size",group:"text",when:{ne:{"attrs/text/text":""}},index:2},"font-family":{type:"select-box",options:d.fontFamily,label:"Font family",group:"text",when:{ne:{"attrs/text/text":""}},index:3},"font-weight":{type:"select-box",options:d.fontWeight,label:"Font thickness",group:"text",when:{ne:{"attrs/text/text":""}},index:4},fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"text",when:{ne:{"attrs/text/text":""}},index:5}},polygon:{fill:{type:"color-palette",options:d.colorPalette,label:"Fill",group:"presentation",index:1},stroke:{type:"color-palette",options:d.colorPalette,label:"Outline",group:"presentation",index:2},"stroke-width":{type:"range",min:0,max:30,step:1,defaultValue:1,unit:"px",label:"Outline thickness",group:"presentation",when:{ne:{"attrs/polygon/stroke":"transparent"}},index:3},"stroke-dasharray":{type:"select-box",options:d.strokeStyle,label:"Outline style",group:"presentation",when:{and:[{ne:{"attrs/polygon/stroke":"transparent"}},{ne:{"attrs/polygon/stroke-width":0}}]},index:4}}}},groups:{presentation:{label:"Presentation",index:1},text:{label:"Text",index:2}}}}}}/*! JointJS+ v3.6.1 - HTML5 Diagramming Framework - TRIAL VERSION

Copyright (c) 2022 client IO

 2022-11-22 


This Source Code Form is subject to the terms of the JointJS+ Trial License
, v. 2.0. If a copy of the JointJS+ License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the JointJS+ archive as was distributed by client IO. See the LICENSE file.*/class DE{constructor(){ae(this,"keyboard");this.keyboard=new(void 0)}create(d,v,f,b,I){this.keyboard.on({"ctrl+c":()=>{v.copyElements(f.collection,d)},"ctrl+v":()=>{const L=v.pasteCells(d).filter(B=>B.isElement());f.collection.reset(L)},"ctrl+x shift+delete":()=>{v.cutElements(f.collection,d)},"delete backspace":P=>{P.preventDefault(),d.removeCells(f.collection.toArray())},"ctrl+z":()=>{I.undo(),f.cancelSelection()},"ctrl+y":()=>{I.redo(),f.cancelSelection()},"ctrl+a":()=>{f.collection.reset(d.getElements())},"ctrl+plus":P=>{P.preventDefault(),b.zoom(.2,{max:5,grid:.2})},"ctrl+minus":P=>{P.preventDefault(),b.zoom(-.2,{min:.2,grid:.2})},"keydown:shift":P=>{b.setCursor("crosshair")},"keyup:shift":()=>{b.setCursor("grab")}})}}export{LE as H,EE as I,DE as K,PE as M,TE as S,NE as T,gE as a,ho as b};
